<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/administrator?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:26:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../node/28/index.html" />
<link rel="up" href="../content/aegir-handbook/index.html" />
<link rel="next" href="../installing/index.html" />
<link rel="canonical" href="index.html" />
<link rel="prev" href="index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../content/installing/system-requirements/index.html" />
<link rel="prev" href="../installing/index.html" />
<link rel="up" href="../installing/index.html" />
<link rel="next" href="../installing/debian/index.html" />
<link rel="prev" href="../content/installing/system-requirements/index.html" />
<link rel="up" href="../installing/index.html" />
<link rel="next" href="../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html" />
<link rel="prev" href="../installing/debian/index.html" />
<link rel="up" href="../installing/debian/index.html" />
<link rel="next" href="../installing/manual/index.html" />
<link rel="prev" href="../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html" />
<link rel="up" href="../installing/index.html" />
<link rel="next" href="../node/417/index.html" />
<link rel="prev" href="../installing/manual/index.html" />
<link rel="up" href="../installing/manual/index.html" />
<link rel="next" href="../content/apache-mysql-php-aegir/index.html" />
<link rel="prev" href="../node/417/index.html" />
<link rel="up" href="../node/417/index.html" />
<link rel="next" href="../content/nginx-mariadb-php-aegir-memp%c3%a6/index.html" />
<link rel="prev" href="../content/apache-mysql-php-aegir/index.html" />
<link rel="up" href="../node/417/index.html" />
<link rel="next" href="../content/installing/manual/centos-6x-aegir-install-guide/index.html" />
<link rel="prev" href="../content/nginx-mariadb-php-aegir-memp%c3%a6/index.html" />
<link rel="up" href="../installing/manual/index.html" />
<link rel="next" href="../installing/manual/manual-install-web-cluster-aegir-using-nginx/index.html" />
<link rel="prev" href="../content/installing/manual/centos-6x-aegir-install-guide/index.html" />
<link rel="up" href="../installing/manual/index.html" />
<link rel="next" href="../content/installing/manual/nginx-mariadb-php-fpm-single-server-installation/index.html" />
<link rel="prev" href="../installing/manual/manual-install-web-cluster-aegir-using-nginx/index.html" />
<link rel="up" href="../installing/manual/index.html" />
<link rel="next" href="../node/462/index.html" />
<link rel="prev" href="../content/installing/manual/nginx-mariadb-php-fpm-single-server-installation/index.html" />
<link rel="up" href="../installing/index.html" />
<link rel="next" href="../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html" />
<link rel="prev" href="../node/462/index.html" />
<link rel="up" href="../installing/index.html" />
<link rel="next" href="../content/administrator/post-install-configuration/index.html" />
<link rel="prev" href="../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="prev" href="../content/administrator/post-install-configuration/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../content/importing-existing-aegir-backups/index.html" />
<link rel="prev" href="../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="up" href="../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../content/importing-single-site-manually/index.html" />
<link rel="prev" href="../content/importing-existing-aegir-backups/index.html" />
<link rel="up" href="../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../content/importing-complete-drupal-platform/index.html" />
<link rel="prev" href="../content/importing-single-site-manually/index.html" />
<link rel="up" href="../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../node/517/index.html" />
<link rel="prev" href="../content/importing-complete-drupal-platform/index.html" />
<link rel="up" href="../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../node/426/index.html" />
<link rel="prev" href="../node/517/index.html" />
<link rel="up" href="../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../node/30/index.html" />
<link rel="prev" href="../node/426/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../node/396/index.html" />
<link rel="prev" href="../node/30/index.html" />
<link rel="up" href="../node/30/index.html" />
<link rel="next" href="../node/446/index.html" />
<link rel="prev" href="../node/396/index.html" />
<link rel="up" href="../node/30/index.html" />
<link rel="next" href="../content/web-clusters/index.html" />
<link rel="prev" href="../node/446/index.html" />
<link rel="up" href="../node/30/index.html" />
<link rel="next" href="../node/388/index.html" />
<link rel="prev" href="../content/web-clusters/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../node/427/index.html" />
<link rel="prev" href="../node/388/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../node/341/index.html" />
<link rel="prev" href="../node/427/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../content/content/administrator/post-install-configuration/using-ssl/index.html" />
<link rel="prev" href="../node/341/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="dns/index.html" />
<link rel="prev" href="../content/content/administrator/post-install-configuration/using-ssl/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../dnswildcard/index.html" />
<link rel="prev" href="dns/index.html" />
<link rel="up" href="dns/index.html" />
<link rel="next" href="../node/39/index.html" />
<link rel="prev" href="../dnswildcard/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../node/73/index.html" />
<link rel="prev" href="../node/39/index.html" />
<link rel="up" href="../node/39/index.html" />
<link rel="next" href="../node/72/index.html" />
<link rel="prev" href="../node/73/index.html" />
<link rel="up" href="../node/39/index.html" />
<link rel="next" href="../node/70/index.html" />
<link rel="prev" href="../node/72/index.html" />
<link rel="up" href="../node/39/index.html" />
<link rel="next" href="../content/overriding-site-specific-php-values/index.html" />
<link rel="prev" href="../node/70/index.html" />
<link rel="up" href="../node/70/index.html" />
<link rel="next" href="../node/71/index.html" />
<link rel="prev" href="../content/overriding-site-specific-php-values/index.html" />
<link rel="up" href="../node/39/index.html" />
<link rel="next" href="../content/injecting-drushrcphp/index.html" />
<link rel="prev" href="../node/71/index.html" />
<link rel="up" href="../node/39/index.html" />
<link rel="next" href="../contrib-modules/index.html" />
<link rel="prev" href="../content/injecting-drushrcphp/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../contrib-modules/aegir-services/index.html" />
<link rel="prev" href="../contrib-modules/index.html" />
<link rel="up" href="../contrib-modules/index.html" />
<link rel="next" href="../content/contrib-modules/contribs-aegir-7x-3x/index.html" />
<link rel="prev" href="../contrib-modules/aegir-services/index.html" />
<link rel="up" href="../contrib-modules/index.html" />
<link rel="next" href="../content/contrib-modules/devshop-provision/index.html" />
<link rel="prev" href="../content/contrib-modules/contribs-aegir-7x-3x/index.html" />
<link rel="up" href="../contrib-modules/index.html" />
<link rel="next" href="../content/content/contrib-modules/devshop-provision/commands/index.html" />
<link rel="prev" href="../content/contrib-modules/devshop-provision/index.html" />
<link rel="up" href="../content/contrib-modules/devshop-provision/index.html" />
<link rel="next" href="../content/contrib-modules/provision-acl/index.html" />
<link rel="prev" href="../content/content/contrib-modules/devshop-provision/commands/index.html" />
<link rel="up" href="../contrib-modules/index.html" />
<link rel="next" href="../node/516/index.html" />
<link rel="prev" href="../content/contrib-modules/provision-acl/index.html" />
<link rel="up" href="../contrib-modules/index.html" />
<link rel="next" href="../contrib-modules/provision-civicrm/index.html" />
<link rel="prev" href="../node/516/index.html" />
<link rel="up" href="../contrib-modules/index.html" />
<link rel="next" href="../content/content/administrator/post-install-configuration/create-sudo-user-server-administration/index.html" />
<link rel="prev" href="../contrib-modules/provision-civicrm/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../content/content/administrator/post-install-configuration/experimental-aegir-2-ubuntu-1204-apache-php/index.html" />
<link rel="prev" href="../content/content/administrator/post-install-configuration/create-sudo-user-server-administration/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html" />
<link rel="prev" href="../content/content/administrator/post-install-configuration/experimental-aegir-2-ubuntu-1204-apache-php/index.html" />
<link rel="up" href="../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../upgrading/index.html" />
<link rel="prev" href="../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../upgrading/manual/index.html" />
<link rel="prev" href="../upgrading/index.html" />
<link rel="up" href="../upgrading/index.html" />
<link rel="next" href="../upgrading/debian/index.html" />
<link rel="prev" href="../upgrading/manual/index.html" />
<link rel="up" href="../upgrading/index.html" />
<link rel="next" href="../upgrading/script/index.html" />
<link rel="prev" href="../upgrading/debian/index.html" />
<link rel="up" href="../upgrading/index.html" />
<link rel="next" href="../upgrading/path/index.html" />
<link rel="prev" href="../upgrading/script/index.html" />
<link rel="up" href="../upgrading/index.html" />
<link rel="next" href="../uninstalling/index.html" />
<link rel="prev" href="../upgrading/path/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../content/administrator/extracting-drupal-site-aegir/index.html" />
<link rel="prev" href="../uninstalling/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../content/administrator/troubleshooting-aegir/index.html" />
<link rel="prev" href="../content/administrator/extracting-drupal-site-aegir/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../node/321/index.html" />
<link rel="prev" href="../content/administrator/troubleshooting-aegir/index.html" />
<link rel="up" href="../content/administrator/troubleshooting-aegir/index.html" />
<link rel="next" href="../debugging/index.html" />
<link rel="prev" href="../node/321/index.html" />
<link rel="up" href="../content/administrator/troubleshooting-aegir/index.html" />
<link rel="next" href="../content/content/administrator/troubleshooting-aegir/strict-warning-error/index.html" />
<link rel="prev" href="../debugging/index.html" />
<link rel="up" href="../content/administrator/troubleshooting-aegir/index.html" />
<link rel="next" href="../node/546/index.html" />
<link rel="shortcut icon" href="../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Administrator Manual | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-11" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="index.html">Administrator Manual</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><div id='diff-inline-11'><p>Aegir is a powerful system that provides you with a lot of opportunities and methods for managing your sites.</p>

<p>These methods come in the form of 'tasks' which can be applied against the various entities that Aegir manages. Such entities include:</p>

<ul>
<li>Servers</li>
<li>Platforms</li>
<li>Sites</li>
</ul>

<p>This section 'Using Aegir' outlines all the various tasks you'll likely be performing against these entities and how to get the most out of your Aegir system. In doing so, it also represents the recommended 'best practices' associated with achieving certain results (such as upgrading sites).</p>

<p>This section can be read in any order. Choose a specific activity or task from the table of contents to get started or work your way through all the various tasks at your leisure.</p></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="print first active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../user/login/index-44.html?destination=node%2F11%23comment-form">Login</a> or <a href="../user/register/index-44.html?destination=node%2F11%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



<div  id="node-9" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../installing/index.html">Installation Guide</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p><strong>This page is being moved to <a href="https://aegir.readthedocs.org/en/latest/install/install/" title="https://aegir.readthedocs.org/en/latest/install/install/">https://aegir.readthedocs.org/en/latest/install/install/</a> </strong></p>

<p>Aegir requires some special permissions to your server in order to automate some configurations. For example, when a new site is installed, the web server will be automatically configured (vhost) and restarted. Therefore Aegir cannot be installed on a shared hosting environment. Consult the <a href="../node/389/index.html#Review_System_Requirements">system requirements</a> to ensure you meet the necessary requirements.</p>

<h2>Automatic or manual install?</h2>

<p>The <a href="../node/400/index.html">automatic install process through Debian packages</a> is the currently recommended install process on Debian and Ubuntu platforms. It should just be a matter of adding the right sources to your APT repositories and running <code>apt-get install aegir</code>.</p>

<p>The <a href="../node/389/index.html">manual install process</a> should take about 15 minutes for trained system administrators, between 30 to 60 minutes for others. The section contains detailed instructions on how to install Aegir manually on supported systems. It is aimed at system administrators and porters that want to control every step of the install process.</p>

<p>To decide which method is the right one, you may also want to review the <a href="../handbook/operating-system-support/index.html">operating system support page</a>.</p>

<p>We also provide a <a href="../node/462/index.html">troubleshooting guide</a> to resolve common installation problems.</p>

<p>Note that, while installing Aegir does change some system configurations, it does only minor changes and keeps all its system configurations in one place so that it is easy to <a href="../uninstalling/index.html">uninstall</a>. It will not remove existing configurations. However, make sure you have backups before installing.</p>

<h2>Automatic install and maintenance with Puppet</h2>

<p>There is now a <a href="http://drupal.org/project/puppet-aegir">Aegir Puppet module</a> that can further automate installation and maintenance of Aegir servers. It defaults to using the Debian packages, and is thus best-suited to Debian and it's derivatives (Ubuntu, Mepis, &amp;.), but also supports (experimental) installation via the manual install process. This currently also only works on Debian, as it follows the documented installation procedure; however, it should be pretty straight-forward to adapt it to other OSes.</p>

<h2>Development installs with Vagrant and Aegir-up</h2>

<p>If you're installing Aegir for experimental or development purposes, you might be interested in <a href="http://drupal.org/project/aegir-up">Aegir-up</a>, a <a href="http://virtualbox.org/">Virtualbox</a>/<a href="http://vagrantup.com/">Vagrant</a>-based local virtual machine automation system. It provides a simple method of building a complete Aegir system locally using the Puppet modules, and is, in fact, the primary development platform for them. In addition, you can build a dev version of Aegir from the git repos (with .git directories intact) to make debugging and writing patches and extensions easier.</p>

<h2>Related documentation</h2>

<ul>
<li><a href="../upgrading/index.html">Upgrading Aegir</a></li>
<li><a href="../uninstalling/index.html">Uninstalling Aegir</a></li>
<li><a href="../node/30/index.html">Remote servers (multiserver)</a></li>
</ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-9.html?destination=node%2F9%23comment-form">Login</a> or <a href="../user/register/index-9.html?destination=node%2F9%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2917" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/installing/system-requirements/index.html">System Requirements</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Note that the following System Requirements are the same for Aegir automatic or manual install</p>

<dl>
<dt><strong>A system capable of running Drupal</strong></dt>
<dd>The Aegir system is entirely Drupal based, and has the same base requirements that Drupal does (with the exception that it won't run on Windows). See more notes on Unix and LAMP/LEMP requirements below.</dd>

<dt><strong>Your own server</strong></dt>
<dd>The low level of access required to be able to configure and run this system is very far beyond what is commonly available to users with shared hosting. A VPS from any popular provider such as Linode, Rackspace, Slicehost, Amazon EC, etc. will do fine. You will need root access to the server and the server needs to be dedicated to Aegir.</dd>

<dt><strong>A Unix-based operating system</strong></dt>
<dd>Aegir must run on some flavour of UNIX, because the majority of functionality in this system occurs in the back-end, through command line scripting. There are also several features (such as symlinks), that are not available to users on Windows. There are no plans currently to add Windows support. See the <a href="../handbook/operating-system-support/index.html">operating system support page</a> for more information.</dd>

<dt><strong>Web server</strong></dt>
<dd>You will need at least one dedicated web server, running Apache. We generally work with <strong>Apache 2</strong> but we should be compatible with the 1.x series. Aegir also supports the <strong>Nginx</strong> web server, but requires at least version 0.7.66 or newer. Since Nginx doesn't provide php-cgi or php-fpm (recommended) modules, you will need to install and run php-fpm server separately. You can find useful examples and tips in the third party Barracuda installer available at <a href="http://drupal.org/project/barracuda">the barracuda project page</a>.</dd>

<dd>
<p><strong>N.B.:</strong> This third party installer is not supported by the core Aegir developers, but you can find helpful community support at <a href="http://groups.drupal.org/boa">the boa group</a>.</p>
</dd>

<dt><strong>PHP 5.2 and 5.3</strong></dt>
<dd>Aegir depends on <a href="http://drupal.org/project/drush">Drush 4.x</a>, which requires PHP 5.2 or higher. Aegir 2.x depends on a minimun of <a href="http://drupal.org/project/drush">Drush 5.10</a> (though Drush 6 is recommended), which requires PHP 5.3 or higher. You also need to have the command-line version of PHP to run Drush properly, and the MySQL extensions for PHP.</dd>

<dd>
<p>Given that <a href="http://www.php.net/archive/2010.php#id2010-07-22-1">PHP 5.2 has been deprecated since July 2010</a>, we suggest using PHP 5.3 if possible. Note that while Drupal 6.x and above support PHP 5.3, some contributed third-party modules may still have problems with this version. Most often these cause warnings that can be safely ignored. Aegir and Drush themselves have no known outstanding PHP 5.3 compatibility issues, although you could have a lot of warnings in Drupal 6 due to <a href="http://drupal.org/node/883038">ereg deprecation</a>, see <a href="http://drupal.org/node/883038">this issue</a> for details. If you need to host Drupal 5.x sites, note that Drupal 5.x is not compatible with PHP 5.3 and above, and most likely never will be. See <a href="http://drupal.org/node/360605" title="http://drupal.org/node/360605">http://drupal.org/node/360605</a> (amongst other issues) for details. As such, Aegir has dropped support for Drupal 5 in versions 2.0+.</p>
</dd>

<dt><strong>Database server</strong></dt>
<dd>You will require a database server, obviously. Aegir currently only supports MySQL and MariaDB. It is preferable to use a dedicated (not shared-hosting) server since Aegir will create database users and will require the use of a MySQL <code>root</code> user.</dd>

<dt><strong>Mail transfer agent</strong></dt>
<dd>Aegir requires an MTA (Mail Transfer Agent) installed on your webserver in order to be able to install new sites to your new platform. If you don't have an MTA, the site installation will fail with message like "could not send email". Additional messages will show that site has been removed because of this problem. To remedy the situation simply install an MTA like sendmail, postfix, or exim and do the minimal configuration.</dd>

<dt><strong>Other utilities: sudo, rsync, git and unzip</strong></dt>
<dd>Aegir installs itself via a <a href="http://drupal.org/project/drush_make">Drush Make</a> makefile that downloads via git if you want the bleeding edge code, or via wget if you want the latest official release. If you want the latest development version, and don't have the <strong>git</strong> program you will need to install it on the server.</dd>

<dd>
<p>The <strong>jQueryUI</strong> library is used in the Aegir UI, <strong>unzip</strong> is required to extract it. <strong>Sudo</strong> is required to allow the aegir user the limited privilege to restart the webserver when required.  <strong>Rsync</strong> is used to sync files to remote servers.</p>
</dd>

<dt><strong>No conflicting Control Panels</strong></dt>
<dd>Other popular control panels such as Plesk, cPanel etc, are designed to manage all aspects of Apache configuration and other areas that Aegir also is intended to be used for.</dd>

<dd>
<p>Running Aegir alongside such control panels is not supported and very likely may cause you problems or difficulties installing or running Aegir. Filing bug reports that are caused by interference by another control panel will likely be closed unless the problem can be fixed without causing problems for other Aegir users. Proceed at your own risk!</p>
</dd>

<dt><strong>System requirements of popular Drupal distributions</strong></dt>
<dd>Some Drupal distributions, such as OpenAtrium, are specialized products that may contain unique prerequisites for optimal performance. Such examples may include raising the php-cli program's memory_limit to something higher than 64M.</dd>

<dd>
<p>Please note that this is not a requirement of Aegir but of the distribution you are trying to install a site on. Thus the Aegir documentation may not officially 'require' such performance settings, but be aware that Aegir may report errors if the system was under-resourced to complete such a task.</p>
</dd>
</dl>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-45.html?destination=node%2F2917%23comment-form">Login</a> or <a href="../user/register/index-45.html?destination=node%2F2917%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-400" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../installing/debian/index.html">Automatic install on Debian</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>These are the installation instructions that are recommended on Debian. Aegir dependencies (Apache, MySQL, PHP...) are also automatically installed. If you are managing the installation from a remote Windows computer, well-known open source tools for this task are for example <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY</a> (<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/docs.html">a SSH client for command line</a>), and <a href="http://winscp.net/eng/download.php">WinSCP</a> (<a href="http://winscp.net/eng/docs/start">a SFTP client with easy text file editing</a>).</p>

<p>If you wish to install Debian packages over an existing manual install, it's possible. See <a href="../upgrading/debian/index.html">the Debian upgrade procedures</a>.</p>

<p>Debian packages are uploaded to <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org/">http://debian.aegirproject.org/</a> shortly after a release. We eventually want to upload those packages to the official archives, but this will take some adaptation and time to sponsor the packages in.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Requirements_for_automatic_install_on_Debian"><span class="toc-number">1. </span>Requirements for automatic install on Debian</a></li>
	<li class="toc-level-1"><a href="#Adding_the_project_repositories"><span class="toc-number">2. </span>Adding the project repositories</a></li>
	<li class="toc-level-1"><a href="#Adding_the_archive_key_to_your_keyring"><span class="toc-number">3. </span>Adding the archive key to your keyring</a></li>
	<li class="toc-level-1"><a href="#Adding_backports_for_or_manually_installing_Drush"><span class="toc-number">4. </span>Adding backports for or manually installing Drush</a></li>
	<li class="toc-level-1"><a href="#DNS_configuration"><span class="toc-number">5. </span>DNS configuration</a></li>
	<li class="toc-level-1"><a href="#Manual_sudo_configuration"><span class="toc-number">6. </span>Manual sudo configuration</a></li>
	<li class="toc-level-1"><a href="#Manual_installation_of_MySQL_on_Ubuntu_12.04_LTS"><span class="toc-number">7. </span>Manual installation of MySQL (on Ubuntu 12.04 LTS)</a></li>
	<li class="toc-level-1"><a href="#Installing_Aegir"><span class="toc-number">8. </span>Installing Aegir</a></li>
	<li class="toc-level-1"><a href="#Custom_Drupal_distributions_and_make_files"><span class="toc-number">9. </span>Custom Drupal distributions and make files</a></li>
	<li class="toc-level-1"><a href="#Troubleshooting_the_install"><span class="toc-number">10. </span>Troubleshooting the install</a></li>
</ol>
</div>
</div>

<h2 id="Requirements_for_automatic_install_on_Debian">1. Requirements for automatic install on Debian</h2>

<p><strong>Basic Linux system administration skills</strong></p>

<p><strong>Root access to your server</strong></p>

<dl>
<dt><strong>An up-to-date system and applications</strong></dt>
<dd>
<p>Run the following command lines to update your system and applications.</p>
</dd>

<dd>
<p><div class="codeblock"><code>&nbsp; aptitude update<br />&nbsp; </code></div></p>
</dd>

<dd><div class="codeblock"><code>&nbsp; aptitude safe-upgrade<br />&nbsp; </code></div></dd>

<dt><strong>A configured Fully Qualified Domain Name (FQDN)</strong></dt>
<dd>
<p>Such as aegir.example.com</p>
</dd>

<dd>The <code>hostname</code> returned by the commands <code>hostname -f</code> and <code>uname -a</code> must resolve to the IP address of your server.</dd>

<dd>
<p>After setting up your FQDN you must restart your server with a <code>reboot</code> command so your changes take effect.</p>
</dd>

<dd>
<p>Note that newly created domain name usually take 24 to 48 hours to fully start working. This period, called propagation, is the projected length of time it takes for root name servers and cache records across the entire web to be updated with your website's DNS information.</p>
</dd>

<dt><strong>Other System Requirements</strong></dt>
<dd>
<p>Find <a href="../content/installing/system-requirements/index.html" title="http://community.aegirproject.org/content/installing/system-requirements">http://community.aegirproject.org/content/installing/system-requirements</a></p>
</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Adding_the_project_repositories">2. Adding the project repositories</h2>

<p>Use this command to add the Aegir package "Software Source" repository to your system:</p>

<p><div class="codeblock"><code>echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | sudo tee -a /etc/apt/sources.list.d/aegir-stable.list</code></div></p>

<p>To install a customized Debian package, see the <a href="../debian/index.html">developer instructions for the debian package</a>. Other distributions are available for courageous people that want to try development versions.</p>

<p><strong>2.x note</strong>: to install the development version of Aegir, you can use the <code>unstable</code> or <code>stable</code> distribution above.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Adding_the_archive_key_to_your_keyring">3. Adding the archive key to your keyring</h2>

<p>This repository self-signs packages uploaded to it (and packages uploaded are verified against a whitelist of trusted uploaders) using OpenPGP (GnuPG, to be more precise).</p>

<p>Use these commands to download and add the repository's PGP key, then update the package list on your system:</p>

<p><div class="codeblock"><code>wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | sudo apt-key add -<br />sudo apt-get update</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Adding_backports_for_or_manually_installing_Drush">4. Adding backports for or manually installing Drush</h2>

<p>If you are running <strong>Debian wheezy</strong> or later, or <strong>Ubuntu Natty 11.04</strong> or later, <strong>you don't need to do anything here</strong>. The Drush package you need is available from your distribution's repositories.</p>

<p>If not, you should also configure <a href="http://backports.debian.org/">backports</a> repositories for Drush. Version 4.4 of Drush is now in Debian <a href="http://packages.debian.org/sid/drush">unstable</a>, <a href="http://packages.debian.org/wheezy/drush">wheezy</a>, <a href="http://packages.debian.org/squeeze-backports/drush">squeeze-backports</a> and <a href="http://packages.ubuntu.com/natty/drush">Ubuntu Natty</a>.</p>

<p><span id="debian-backport"></span>
<strong>1.x note</strong>: if you are running <strong>Debian Squeeze 6.0</strong> or <strong>Debian Squeeze 7.0</strong>, add the following line to /etc/apt/sources.list :</p>

<p><div class="codeblock"><code>deb <a href="http://backports.debian.org/debian-backports" title="http://backports.debian.org/debian-backports">http://backports.debian.org/debian-backports</a> squeeze-backports main</code></div></p>

<p>You might also have to add a proper Pin-Priority before this works. Create a file called <strong>drush</strong> containing the following and drop it into /etc/apt/preferences.d:
<div class="codeblock"><code>Package: drush<br />Pin: release a=squeeze-backports<br />Pin-Priority: 1001</code></div></p>

<p>Alternatively, you could download and install the squeeze-backports package for Drush 4.5 directly from: <a href="http://packages.debian.org/squeeze-backports/all/drush/download" title="http://packages.debian.org/squeeze-backports/all/drush/download">http://packages.debian.org/squeeze-backports/all/drush/download</a>. Then you could install it with:</p>

<pre><code>dpkg -i drush_4.5-2~bpo60+1_all.deb
</code></pre>

<p><strong>2.x note</strong>: if you are running <strong>Debian Squeeze 6.0</strong>, to get drush-5.8.x and above, download <a href="http://ftp.debian.org/debian/pool/main/p/php-console-table/php-console-table_1.1.4-1_all.deb">php-console-table</a> manually and install it</p>

<p><div class="codeblock"><code>wget &quot;http://ftp.debian.org/debian/pool/main/p/php-console-table/php-console-table_1.1.4-1_all.deb&quot;<br />dpkg -i php-console-table_1.1.4-1_all.deb</code></div></p>

<p>You do not need to edit /etc/apt/sources.list or create /etc/apt/preferences.d/drush</p>

<p>Then run:
<div class="codeblock"><code>sudo apt-get update &amp;&amp; sudo apt-get install drush</code></div></p>

<p>If you are running <strong>Debian lenny 5.0</strong> or <strong>Ubuntu Maverick 10.10</strong> or Karmic Koala or earlier, we recommend downloading and installing the Drush package <a href="http://packages.debian.org/wheezy/all/drush/download">manually</a>.  The version of Drush in the Ubuntu Universe repository for these versions of Ubuntu is outdated.  If you are using <strong>Ubuntu Lucid LTS 10.04</strong>, you can install the Drush package manually or instead use <a href="https://launchpad.net/~brianmercer/+archive/drush">Brian Mercer's PPA</a> (Personal Package Archive) using the following command:</p>

<p><div class="codeblock"><code>sudo apt-get install python-software-properties<br />sudo add-apt-repository ppa:brianmercer/drush</code></div></p>

<p>Now run apt-get update again to refresh the apt database.</p>

<p><div class="codeblock"><code>sudo apt-get update</code></div></p>

<p><strong>N.B.</strong> Since Aegir 2 requires Drush 5, which in turn requires PHP 5.3+, Drupal 5 sites are not supported in Aegir 2.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="DNS_configuration">5. DNS configuration</h2>

<p>Aegir requires a properly configured "FQDN" (Fully Qualified Domain Name) be assigned to the machine. In practice, this means that the hostname returned by the <code>hostname -f</code> and <code>uname -n</code> shell commands should resolve to the IP address for this server, and vice versa, with the <code>resolveip</code> command (included with the mysql-server package).</p>

<p>For Ubuntu, /etc/hosts should have entries that look like:
<div class="codeblock"><code>::1 host.example.com host ip6-localhost ip6-loopback<br />127.0.0.1 host.example.com host localhost<br />123.123.123.123 host.example.com host localhost</code></div></p>

<p>To set this up in a virtual machine (e.g. Virtualbox), here are the steps:</p>

<ol>
<li>Create a new VM</li>
<li>Go to settings-&gt;network.  Enable Adapter 2, and set to "host-only"</li>
<li>Install Ubuntu.  Set hostname as FQDN during install</li>
<li>You may need to add the lines `auto eth1` and `iface eth1 inet dhcp` to /etc/network/interfaces</li>
</ol>

<p>If you have a virtual machine already setup and want to change the FDQN:</p>

<ol>
<li>change /etc/hostname using: `sudo hostname NEW_NAME`</li>
<li>change /etc/hosts using: `sudo nano /etc/hosts` and change name</li>
<li>reboot and test `hostname -f`, `uname -n`, `resolveip NEW_NAME`, `resolveip IP`</li>
<li><a href="http://www.ducea.com/2006/08/07/how-to-change-the-hostname-of-a-linux-system/">YMMV - Your Mileage May Vary</a></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Manual_sudo_configuration">6. Manual sudo configuration</h2>

<p>If you are running <strong>Debian squeeze</strong> or later, or <strong>Ubuntu Lucid 11.04</strong> or later, <strong>you don't need to do anything here</strong>. The Aegir package configures sudoers automatically.</p>

<p>If not, you will need to manually modify your /etc/sudoers file to add the following line:</p>

<p><div class="codeblock"><code>echo &quot;aegir ALL=NOPASSWD: /usr/sbin/apache2ctl&quot; | sudo tee -a /etc/sudoers</code></div></p>

<p>The line above assumes that you have created a user aegir as specified in the installation instructions.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Manual_installation_of_MySQL_on_Ubuntu_12.04_LTS">7. Manual installation of MySQL (on Ubuntu 12.04 LTS)</h2>

<p>Please note that Ubuntu 12.04 LTS installs, by default, an insecure MySQL installation that contains an anonymous user grant, allowing anyone to login without a password. This breaks Aegir functionality.</p>

<p>If you are running Ubuntu 12.04, you should install MySQL manually, and then ensure it is installed securely:</p>

<p><div class="codeblock"><code>sudo apt-get install mysql-server<br />sudo mysql_secure_installation</code></div></p>

<p>When running 'sudo mysql_secure_installation', answer 'Y' to 'Remove anonymous users?'</p>

<p><div class="codeblock"><code>By default, a MySQL installation has an anonymous user, allowing anyone<br />to log into MySQL without having to have a user account created for<br />them.&nbsp; This is intended only for testing, and to make the installation<br />go a bit smoother.&nbsp; You should remove them before moving into a<br />production environment.<br /><br />Remove anonymous users? [Y/n] Y<br /> ... Success!</code></div></p>

<p>Now you can proceed with installing Aegir below.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Installing_Aegir">8. Installing Aegir</h2>

<p>To install Aegir version 2, frontend and backend, use the following command:
<div class="codeblock"><code>sudo apt-get install aegir2</code></div></p>

<p><strong>2.x note</strong>: Aegir version 2 is now stable. Read more at <a href="../2/index-2.html" title="http://community.aegirproject.org/2.1">http://community.aegirproject.org/2.1</a></p>

<p><strong>1.x note</strong>: to install Aegir version 1, use <code>sudo apt-get install aegir</code> instead.</p>

<p>If apt-get reports that the aegir packages have unmet dependencies, then make sure that you have installed Drush (as explained above).  On a debian system, you can force the install of Drush from the squeeze-backports repository:</p>

<p><div class="codeblock"><code>sudo apt-get -t squeeze-backports install drush</code></div></p>

<p>Then install aegir using the apt-get command above.</p>

<p>This will prompt you for the required information (MySQL password, Postfix configuration...) and go ahead with the install.</p>

<p>During the Postfix configuration, the following options appear: "No configuration, Internet site, Internet with smarthost, Satellite system, Local only". That first text screen only allows to use the tab key to select "OK", and then the enter key to display a second screen where you can select one of the choices. The default is "Internet site", useful in most cases to enable the server to send email messages, for example to the admin.</p>

<p>At the end of the installation, you will receive an email message or, if the user "aegir" has been assigned with a local email account during the installation, the file /var/mail/aegir will contain the message. It will include a one-time login to your new Aegir control panel, that is a URL to copy into your browser so that you can set the password for the "admin" user.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Custom_Drupal_distributions_and_make_files">9. Custom Drupal distributions and make files</h2>

<p>If you have your own Drupal make file, you can go ahead with the above process, but change the make file to the one you want:</p>

<pre><code>echo debconf aegir/makefile string /var/aegir/makefiles/aegir/aegir-custom.make | debconf-set-selections
apt-get install aegir
</code></pre>

<p>This allows you to specify the makefile path for your custom distribution of Aegir. To maintain these customizations, you'll need to ensure you do the same when upgrading.</p>

<p>An example aegir-custom.make file could look like:</p>

<p><div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />includes[aegir] = &quot;/usr/share/drush/commands/provision/aegir.make&quot;<br /><br />projects[] = module_filter</code></div></p>

<p>Note that for this to work, you may need the patch from <a href="http://drupal.org/node/1118616">this issue</a>, allowing drush_make to reference absolute system paths.  If <code>drush make --version</code> &lt;= 2.2 you need this patch.</p>

<p>After installing Aegir, you can reinstall the front end (hostmaster), with following commands:
<div class="codeblock"><code>sudo rm -rf /var/aegir/hostmaster-&#42;.&#42;<br />sudo su -s /bin/sh aegir -c &quot;drush -y hostmaster-install --aegir_db_pass=$DB_PASSWORD --makefile=$MAKEFILE $DOMAIN&quot;</code></div>
<code>su -s /bin/sh aegir -c "some command"</code> runs <code>some command</code> in the <code>/bin/sh</code> shell as user <code>aegir</code>.  <code>sudo</code> runs the <code>su</code> command as root - prompting for your user's password instead <code>su</code> asking for aegir's password.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Troubleshooting_the_install">10. Troubleshooting the install</h2>

<p>To make the install smoother, the install command is run without much debugging information, which can make diagnostics pretty hard. For this, there's a special environment variable you can set that will trigger debugging output. Install aegir with this*:</p>

<p><div class="codeblock"><code>env DPKG_DEBUG=developer apt-get install aegir</code></div></p>

<p>You can build your own Debian packages from our repositories using <a href="../node/543/index.html">those instructions</a>.</p>

<p><em>Note: Prior to 1.1-4.</em> the command was <code>env DEBUG=yes apt-get install aegir</code></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/400/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-1080" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html">Automatic Installation on Ubuntu 11.04+ (QuickStart)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_50 first"><a href="../category/keywords/install/index.html" rel="tag" title="">Install</a></li>
<li class="taxonomy_term_70"><a href="../category/keywords/installation-ubuntu/index.html" rel="tag" title="">installation ubuntu</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Here are simplified instructions for installing Aegir on a server, quickly and easily.</p>

<p>The fastest way to install Aegir is on the latest Ubuntu Server LTS (Long Term Support). <em>Currently 12.04</em>.</p>

<h1>Command Summary</h1>

<p>Here is every command, ready to copy and paste.</p>

<p><div class="codeblock"><code>sudo su<br />echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | tee -a /etc/apt/sources.list.d/aegir-stable.list<br />wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | apt-key add -<br />apt-get update<br />apt-get install aegir</code></div></p>

<p>It is highly recommended to read through the <strong>Installation Instructions</strong> step by step to give yourself the feel for how this is done.  In addition, if you are not already familiar in Linux system administration, please read up on the subject.  Standard linux security protocols should be followed.</p>

<h1>Installation Instructions</h1>

<p>Enter all commands in <code>code boxes</code> exactly as they are written.</p>

<p>ALL commands should be entered as <code>root</code> user until these instructions are complete.  After that, you should never have to use the root user.</p>

<p>Self-installation of Ubuntu has you create an additional user in the <code>admin</code> group, which means they can sudo.  If you are using a cloud hosting service, it likely just sent you root user credentials.  <em>Server security and user management is up to you.  Don't give away access to root or the aegir user unless you know what you are doing.  Follow standard web host best practices</em></p>

<p>For a summary of all needed commands, scroll to the bottom of the page.</p>

<ol>
<li><h2>Fire up a new server</h2>

<ul>
<li>Use <strong>Ubuntu 11.04 Server Edition</strong> for the smoothest and most reliable installation experience.  </li>
<li>Make sure it has at least 1024MB, preferably 2048MB of memory.  Depending on your host you will have to configure a hostname.  It can be convenient to call this 'aegir'.</li>
<li>If you want the smoothest installation, create a brand new server.  There will be the least chance of conflicts if you start with a brand new <strong>Ubuntu 11.04</strong> server.  If you use Ubuntu Desktop, you should be able follow these instructions without any problems.</li>
<li><em>Run all commands as root.  If you are not root, enter</em>
<div class="codeblock"><code>sudo su</code></div></li>
</ul></li>
<li><h2>Add the project repositories and archive key</h2>

<p>Use this command to add the Aegir package "Software Source" repository to your system:
<div class="codeblock"><code>echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | tee -a /etc/apt/sources.list.d/aegir-stable.list</code></div>
Use this command to add the archive key to your keyring:
<div class="codeblock"><code>wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | apt-key add -</code></div>
Then, finally, update your apt repositories:
<div class="codeblock"><code>apt-get update</code></div></p></li>
<li><h2>Install configure Aegir and dependencies</h2>

<p>Once you have added the repositories, you can now fire off the standard debian installation command. For Aegir 1.x, the command is:
<div class="codeblock"><code>apt-get install aegir</code></div>
For Aegir 2.x, the command is:
<div class="codeblock"><code>apt-get install aegir2</code></div>
This fires off the installation script for AEgir, along all dependencies including Apache, MySQ and PHP.  You will be asked a number of questions about your server.</p>

<ul>
<li>You will be asked to create a <em>MySQL root user password</em>.  Make this long and random and type it down somewhere safe, you won't need it very often, but you will need it later on in the installation process.</li>
<li>In <em>Postfix Configuration</em>:  Choose Internet Site, unless you have a reason otherwise.  When asked for the <em>System mail name</em>, pick either the hostname (default) or the domain name you will be hosting this server on.</li>
<li>In <em>Configure aegir-hostmaster</em>, you will be asked to choose a "URL of the hostmaster frontend".  This should be either the hostname (default) or the domain name the server will be hosting, with "aegir" as a subdomain.  For example, "aegir.example.com".  You may want to change this to whatever you prefer, just don't forget it as it will be where you use the Aegir front-end.</li>
<li>After entering your domain, Aegir Hostmaster installation will ask you for the MySQL root password you created earlier.  You did write it down, didn't you?<br />
<strong>NOTE:</strong> The current DEB package requires you to enter the MySQL root password twice.
When this script is done, if everything went ok, after a lot of other interesting information, you should see this:
<div class="codeblock"><code>Aegir is now installed. You can visit it at <a href="http://test/user/reset/1/1329504351/eda205d9a27abde400a27cf160dff69a<br />************************************************************************<br />Aegir" title="http://test/user/reset/1/1329504351/eda205d9a27abde400a27cf160dff69a<br />************************************************************************<br />Aegir">http://test/user/reset/1/1329504351/eda205d9a27abde400a27cf160dff69a<br />***...</a> frontend bootstrap correctly, operation was a success!<br />Setting up aegir (1.6-1) ...<br />Setting up libhtml-template-perl (2.9-2) ...<br />Setting up mysql-server (5.1.54-1ubuntu4) ...<br />Setting up php5 (5.3.5-1ubuntu7.7) ...<br />Processing triggers for libc-bin ...<br />ldconfig deferred processing now taking place<br />root@test:~# </code></div></li>
</ul>

<p>At this point, everything is installed.  Visit the link the script provided you to check out the frontend.  Switch to the <code>aegir</code> user to check out the backend:
<div class="codeblock"><code>su - aegir</code></div></p>

<p>Once you are the aegir user, check out the drush site aliases  it gives you. <code>@hostmaster</code> is the alias for the new front-end you created.  You will get new site aliases for every platform and site you create.
<div class="codeblock"><code>drush site-aliases</code></div></p></li>
<li><h2>Give yourself access to the server</h2>

<p>As the "Administrators Manual" can tell you, you should only manage the Aegir server from the backend as the <code>aegir</code> user.</p>

<p>However, by default, the <code>aegir</code> user cannot sudo (except to restart apache).  The aegir user also does not have a password.  Therefor, the only way to become aegir is to <code>sudo su - aegir</code> from a user that can.</p>

<p>So, to finish the server, you should give yourself a personal account that you can use to login to the server with a password in case all of your SSH keys get lost.</p>

<p>To add yourself as a user:
<div class="codeblock"><code>adduser yourname</code></div>
Then fill out the little wizard it gives you.</p>

<p>//@TODO: Add some helpful notes about SSH keys and remote aliases.</p>

<p>Install SSH on your server, generating your SSH keys and install them on your Ubuntu server. (Directions to generate your SSH keys are assuming your PC is Ubuntu as well, Windows users look below for SSH directions)</p>

<ul>
<li>Tutorial: <a href="https://help.ubuntu.com/11.04/serverguide/C/openssh-server.html" title="https://help.ubuntu.com/11.04/serverguide/C/openssh-server.html">https://help.ubuntu.com/11.04/serverguide/C/openssh-server.html</a></li>
</ul>

<p>If using Windows, you must use Putty, PuttyGen, and PuttyPageant to generate and use your SSH keys.</p>

<ul>
<li>Tutorial #1: <a href="http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter8.html" title="http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter8.html">http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter8.html</a></li>
<li>Tutorial #2: <a href="http://www.howtoforge.com/ssh_key_based_logins_putty" title="http://www.howtoforge.com/ssh_key_based_logins_putty">http://www.howtoforge.com/ssh_key_based_logins_putty</a></li>
</ul>

<p>You will want to also be a part of the aegir and www-data groups so you can write to some of their files:
<div class="codeblock"><code>addgroup yourname aegir<br />addgroup yourname www-data</code></div></p></li>
<li><h2>Start Using!</h2>

<p>Now that aegir is installed, head to the  <a href="../using/index.html">User Manual</a> page to get your first platform and site up and running.</p></li>
</ol>

<h1>Credits</h1>

<p><em>This document was originally based on <a href="../installing/debian/index.html" title="http://community.aegirproject.org/installing/debian">http://community.aegirproject.org/installing/debian</a> but has been trimmed down to list only the steps you need to use on an Ubuntu server to get Aegir up and running as quickly and easily as possible.</em></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/1080/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-389" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../installing/manual/index.html">Manual Installation</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This page describes to process you need to follow if Aegir doesn't have packages for your distribution. We currently provide <a href="../node/400/index.html">Debian packages</a> and others should be coming, if you help! This manual assumes you are fairly familiar with the UNIX commandline interface, but should be possible to follow through if you copy and paste faithfully <em>all</em> steps of the procedure.</p>

<p><strong>A note on supported systems</strong></p>

<p>These instructions provide example commands for a Debian-like distribution, but should be fairly easy to adapt to other environments. This document is meant as a canonical reference that should work on every supported platform. It can also be used for people porting Aegir to new platforms or installing on alien platform for which Aegir is not yet packaged.</p>

<p>It currently contains special recommendations for CentOS, RHEL 6, Arch Linux and Solaris. Users of those platforms are also strongly encouraged to review the <a href="../node/462/index.html">common installation problems</a> that occur on those platforms. Aegir is also known to be installable (and was developed partly on) Mac OS X, but that process is so obtuse that it has a <a href="../node/417/index.html">separate page</a> for the first part of the manual (up to <a href="#Install_Aegir_components">Install Aegir components</a>).</p>

<p>Installing Aegir may seem daunting at first (which is why we provide automated installs through packages), but once you get around it, it's fairly simple. It follows those steps:</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc1">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Review_System_Requirements"><span class="toc-number">1. </span>Review System Requirements</a></li>
	<li class="toc-level-1"><a href="#Install_system_requirements"><span class="toc-number">2. </span>Install system requirements</a>
<ol>
	<li class="toc-level-2"><a href="#CentOS-specific_configuration"><span class="toc-number">2.1. </span>CentOS-specific configuration</a></li>
	<li class="toc-level-2"><a href="#RHEL_6_specific_configuration"><span class="toc-number">2.2. </span>RHEL 6 specific configuration</a></li>
	<li class="toc-level-2"><a href="#Solaris_specific_configuration"><span class="toc-number">2.3. </span>Solaris specific configuration</a></li>
	<li class="toc-level-2"><a href="#Arch_Linux_specific_configuration"><span class="toc-number">2.4. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Configure_system_requirements"><span class="toc-number">3. </span>Configure system requirements</a>
<ol>
	<li class="toc-level-2"><a href="#Create_the_Aegir_user"><span class="toc-number">3.1. </span>Create the Aegir user</a>
<ol>
	<li class="toc-level-3"><a href="#CentOS_specific_configuration"><span class="toc-number">3.1.1. </span>CentOS specific configuration</a></li>
	<li class="toc-level-3"><a href="#Solaris_specific_configuration-1"><span class="toc-number">3.1.2. </span>Solaris specific configuration</a></li>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-2"><span class="toc-number">3.1.3. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Webserver_configuration"><span class="toc-number">3.2. </span>Webserver configuration</a>
<ol>
	<li class="toc-level-3"><a href="#Apache_configuration"><span class="toc-number">3.2.1. </span>Apache configuration</a></li>
	<li class="toc-level-3"><a href="#Nginx_configuration"><span class="toc-number">3.2.2. </span>Nginx configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#PHP_configuration"><span class="toc-number">3.3. </span>PHP configuration</a>
<ol>
	<li class="toc-level-3"><a href="#RHEL_6_specific_configuration-3"><span class="toc-number">3.3.1. </span>RHEL 6 specific configuration</a></li>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-4"><span class="toc-number">3.3.2. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Sudo_configuration"><span class="toc-number">3.4. </span>Sudo configuration</a>
<ol>
	<li class="toc-level-3"><a href="#CentOS_Linux_specific_sudo_configuration"><span class="toc-number">3.4.1. </span>CentOS Linux specific sudo configuration</a></li>
	<li class="toc-level-3"><a href="#Nginx_specific_configuration"><span class="toc-number">3.4.2. </span>Nginx specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#DNS_configuration"><span class="toc-number">3.5. </span>DNS configuration</a></li>
	<li class="toc-level-2"><a href="#Database_configuration"><span class="toc-number">3.6. </span>Database configuration</a>
<ol>
	<li class="toc-level-3"><a href="#Ubuntu_RHEL_Arch_linux_specific_configurations"><span class="toc-number">3.6.1. </span>Ubuntu, RHEL, Arch linux specific configurations</a></li>
	<li class="toc-level-3"><a href="#RHEL_6_specific_configuration-5"><span class="toc-number">3.6.2. </span>RHEL 6 specific configuration</a></li>
</ol>
</li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Install_Aegir_components"><span class="toc-number">4. </span>Install Aegir components</a>
<ol>
	<li class="toc-level-2"><a href="#Install_drush"><span class="toc-number">4.1. </span>Install drush</a>
<ol>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-6"><span class="toc-number">4.1.1. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Stop_Now_become_the_Aegir_user"><span class="toc-number">4.2. </span>Stop! Now become the Aegir user!</a></li>
	<li class="toc-level-2"><a href="#Install_provision"><span class="toc-number">4.3. </span>Install provision</a></li>
	<li class="toc-level-2"><a href="#Running_hostmaster-install"><span class="toc-number">4.4. </span>Running hostmaster-install</a>
<ol>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-7"><span class="toc-number">4.4.1. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Install_the_Hosting_Queue_Daemon"><span class="toc-number">5. </span>Install the Hosting Queue Daemon</a></li>
	<li class="toc-level-1"><a href="#Checkpoint_Finished"><span class="toc-number">6. </span>Checkpoint / Finished!</a></li>
</ol>
</div>
</div>

<p>Note that these instructions setup a complete Aegir system. If you want to only setup a new remote web/db server, it should be sufficient to install the <a href="#Install_system_requirements">system requirements</a> (step 1),  <a href="#Configure_system_requirements">configure them</a> (step 2) and follow the <a href="../node/30/index.html">Remote server how-to</a>.</p>

<h1 id="Review_System_Requirements">1. Review System Requirements</h1>

<p>Find <a href="../content/installing/system-requirements/index.html" title="http://community.aegirproject.org/content/installing/system-requirements">http://community.aegirproject.org/content/installing/system-requirements</a></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Install_system_requirements">2. Install system requirements</h1>

<p>To install the required components, run the following command as root:</p>

<pre><code>apt-get install apache2 php5 php5-cli php5-gd php5-mysql php-pear postfix sudo rsync git-core unzip
</code></pre>

<p><em>Note</em>: replace <code>apache2</code> with <code>nginx php5-fpm</code> to install nginx on Ubuntu Precise or newer. Since Debian Squeeze doesn't provide php5-fpm, you will need to follow <a href="http://www.dotdeb.org/instructions/" title="http://www.dotdeb.org/instructions/">http://www.dotdeb.org/instructions/</a> before you will be able to install php5-fpm.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS-specific_configuration">2.1. CentOS-specific configuration</h2>

<pre><code>yum install httpd php php-mysql php-cli php-gd php-process sudo rsync git postfix
</code></pre>

<p>For versions of CentOS previous to 6.0, you will need to upgrade to PHP 5.3 using <a href="http://wiki.centos.org/HowTos/PHP_5.1_To_5.2">those instructions</a>.</p>

<p>Also for Centos minimal you should install cron (for queue and drupal cron) and unzip (for jquery.ui)</p>

<pre><code>yum install cronie unzip
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="RHEL_6_specific_configuration">2.2. RHEL 6 specific configuration</h2>

<p>RHEL 6 Server needs an additional PHP package to enable POSIX support. To find the package php-process you must enable the RHEL Server Optional channel. Once enabled, download and install the php-process-5.3.2-6.el6_0.1.i686.rpm.</p>

<p>You will also need to install the php-xml package if you are planning to use Aegir to manage Drupal 7 sites.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Solaris_specific_configuration">2.3. Solaris specific configuration</h2>

<p>Solaris has this way of dealing with third party software that is... far from ideal. You will need to find the best way to install the following packages: apache2, git, sudo, mysql, PHP 5.2 and wget. unzip and sendmail should be part of the base Solaris install. The other applications should be available on the companion CDs or on <a href="http://www.sunfreeware.com/">sunfreeware.com</a>.</p>

<p>In particular, git can be compiled easily by exporting the following
environment::</p>

<pre><code>export CFLAGS="-I/usr/sfw/include -I/opt/sfw/include"
export LD_LIBRARY_PATH="/usr/sfw/lib:/opt/sfw/lib:$LD_LIBRARY_PATH"
</code></pre>

<p>Then the compile instructions bundled with git should just be followed
directly. I had trouble installing the binaries, as git expects ginstall to be
available in the <code>$PATH</code>. I ended up adding the source directory in the <code>$PATH</code>, which works fine for most uses.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Arch_Linux_specific_configuration">2.4. Arch Linux specific configuration</h2>

<p>To install the required components, run the following command as root:</p>

<pre><code>pacman -S apache php php-apache php-gd mysql postfix sudo rsync unzip git
</code></pre>

<p>Although all of the necessary apache modules and php extensions are installed at this stage, further configuration is required to enable and tweak certain features. Critically, virtual hosts are not enabled. It is worth examining the <a href="https://wiki.archlinux.org/index.php/LAMP">Arch Linux wiki page on LAMP server set up</a> and verifying that more than one named virtual host functions properly.</p>

<p>If setting up for standalone development, see this useful <a href="https://wiki.archlinux.org/index.php/Local_Mail_Delivery_with_Postfix">wiki page</a> to configuring postfix for local mail only.</p>

<p>To ensure Apache and mysql start when the machine boots, enable the httpd and mysqld daemons by adding them to the <code>/etc/rc.conf</code> file:</p>

<pre><code>DAEMONS=(... mysqld httpd ...)
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Configure_system_requirements">3. Configure system requirements</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_the_Aegir_user">3.1. Create the Aegir user</h2>

<p>The provision framework of Aegir requires that the scripts run as a non-root system account, to ensure that it can correctly set the file permissions on the hosted files.</p>

<p>Also to ensure that the file permissions of the hosted sites are always as safe as can be, and especially to make sure that the web server does not have the ability to modify the code of the site, the configured system account needs to be a member of the web server group, in order to be able to correctly set the file permissions.</p>

<p>While you can choose another username, most aegir documentation assumes the Aegir user is <code>aegir</code>, its home directory is <code>/var/aegir</code> and the webserver group is <code>www-data</code>.</p>

<p>Shell commands as root:</p>

<pre><code>adduser --system --group --home /var/aegir aegir
adduser aegir www-data    #make aegir a user of group www-data
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="CentOS_specific_configuration">3.1.1. CentOS specific configuration</h3>

<p>CentOS requires special commands to create the user, use those instead:</p>

<pre>
useradd --home-dir /var/aegir aegir
gpasswd -a aegir apache
chmod -R 755 /var/aegir
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Solaris_specific_configuration-1">3.1.2. Solaris specific configuration</h3>

<pre>
groupadd aegir
useradd -g aegir -G webservd -d /var/aegir -s /bin/bash -c "Aegir sandbox" aegir
chown aegir:aegir /var/aegir
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-2">3.1.3. Arch Linux specific configuration</h3>

<pre>
useradd --system --groups http --home /var/aegir --create-home aegir
chmod -R 755 /var/aegir
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Webserver_configuration">3.2. Webserver configuration</h2>

<p>Aegir supports two popular web servers, Apache and Nginx.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Apache_configuration">3.2.1. Apache configuration</h3>

<p>Aegir assumes a few Apache modules are available on the server, and generates its own configuration files. The way we enable this is by symlinking a single file which contains all the configuration necessary. In Debian-based systems, you should symlink this file inside <code>/etc/apache2/conf.d</code> that will be parsed on startup or alternatively you can place include that file in your apache.conf/httpd.conf. We prefer the former. In other systems there are similar ways to accomplish this. Consult your OS's documentation if unsure.</p>

<p>If you are on a <strong>Debian-based</strong> system, you will also need to enable the mod_rewrite module manually.</p>

<p>Run the following shell commands as root. First, configure Apache to enable RewriteEngine:</p>

<pre><code>a2enmod rewrite
</code></pre>

<p>Finally, create a symlink from an apache configuration file to a folder within the /var/aegir/:</p>

<pre><code>ln -s /var/aegir/config/apache.conf /etc/apache2/conf.d/aegir.conf  
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="Ubuntu_14.04_specific_Apache_configuration">3.2.1.1. Ubuntu 14.04+ specific Apache configuration</h4>

<p>Ubuntu 14.04 departs from Debian and previous Ubuntu Apache setup in that it doesn't use <code>/etc/apache2/conf.d</code> any more and better separates out <code>sites-enabled</code> from <code>conf-enabled</code> configurations. So:</p>

<pre><code>ln -s /var/aegir/config/apache.conf /etc/apache2/conf-available/aegir.conf  
a2enconf aegir
</code></pre>

<p><strong>Do not reload/restart Apache if prompted to after running these commands, it will fail.</strong></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="CentOS_specific_Apache_configuration">3.2.1.2. CentOS specific Apache configuration</h4>

<p>On <strong>CentOS</strong>, mod_rewrite is enabled by default and you can create the following symlink:</p>

<pre><code>ln -s /var/aegir/config/apache.conf /etc/httpd/conf.d/aegir.conf
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="Arch_Linux_specific_Apache_configuration">3.2.1.3. Arch Linux specific Apache configuration</h4>

<p>On <strong>Arch Linux</strong>, mod_rewrite is also enabled by default. Add the aegir apache configuration include file to the httpd.conf file:</p>

<pre><code>echo "Include /var/aegir/config/apache.conf" &gt;&gt; /etc/httpd/conf/httpd.conf
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="Other_systems-_Apache_configuration">3.2.1.4. Other systems' Apache configuration</h4>

<p>In other systems that do not have a conf.d directory, this could also work:</p>

<pre>
echo "Include /var/aegir/config/apache.conf" &gt;&gt; /etc/apache2/httpd.conf
</pre>

<p><strong>N.B.:</strong></p>

<ul>
<li>A standard umask of 022 is assumed. This is the default on most systems.</li>
<li>For more information, see the <a href="../node/462/index.html">common installation errors</a>.</li>
<li>For all OSes, the installer script creates the configuration file referenced by the newly created symlink/or file referenced in the Apache config file.</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Nginx_configuration">3.2.2. Nginx configuration</h3>

<p>(If you just succeeded in installing Apache, please skip this section.)</p>

<p>Aegir assumes standard Nginx configuration is available on the server, and generates its own configuration files. The way we enable this is by symlinking a single file which contains all the configuration necessary. In Debian-based systems, you should symlink this file inside <code>/etc/nginx/conf.d</code> that will be parsed on startup.</p>

<p>Please make sure your nginx installation is up and running before continuing. On Ubuntu 12.04 Server, for instance, you must edit /etc/nginx/nginx.conf and uncomment the line "types_hash_max_size 2048;" in order for nginx to start successfully.</p>

<p>Shell command as root::</p>

<pre><code>ln -s /var/aegir/config/nginx.conf /etc/nginx/conf.d/aegir.conf
</code></pre>

<p><strong>Do not reload/restart Nginx after running these commands, it will fail.</strong></p>

<p>The installer script creates the configuration file referenced by the newly created symlink.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="PHP_configuration">3.3. PHP configuration</h2>

<p>Some complex installation profiles or distributions require a PHP memory limit that is higher than the default. To avoid common errors when installing sites on some distributions, the PHP command line tool should be configured to use 192Mb 
of RAM.</p>

<p>Change the memory_limit directive in /etc/php5/cli/php.ini to read:</p>

<pre><code>memory_limit = 192M      ; Maximum amount of memory a script may consume (192MB)
</code></pre>

<p>Most modern Drupal sites require around 96M or even 128M of RAM for certain operations. This is far more than what is provided by the default PHP configuration.</p>

<p>Change the memory_limit directive in /etc/php5/apache2/php.ini to read:</p>

<pre><code>memory_limit = 128M      ; Maximum amount of memory a script may consume (128MB)
</code></pre>

<p>If your distributions require more memory than these limits, then use some common sense and update it as appropriate to suit your individual needs.</p>

<p>For Aegir 3, make sure you've installed the <a href="https://www.drupal.org/requirements/php#extensions">required PHP extensions</a>, particularly the image library (php-gd).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="RHEL_6_specific_configuration-3">3.3.1. RHEL 6 specific configuration</h3>

<p>The default php.ini configuration beyond the above changes also requires that the timezone be set for your location. Otherwise, you get fun errors and warnings during the host-master install step.</p>

<ol>
<li>sudo vi /etc/php.ini</li>
<li>enter your password</li>
<li>/zone (this will bring you to the date specific timezone module area</li>
<li><p>Remove the semi colon in front of date.timezone and enter your <a href="http://www.php.net/manual/en/timezones.php">specific timezone</a>.</p>

<p><div class="codeblock"><code>[Date]<br />&nbsp; ; Defines the default timezone used by the date functions<br />&nbsp; ; <a href="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone<br />" title="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone<br />">http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone<br /></a>&nbsp; date.timezone = Your Time Zone Goes Here </code></div></p></li>
<li><p>Restart apache to compile these changes. <code> sudo httpd -k graceful </code></p></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-4">3.3.2. Arch Linux specific configuration</h3>

<p>Make the following changes to the php.ini file (<code>/etc/php/php.ini</code>):</p>

<p>Add <code>:/var/aegir/</code> to the <code>open_basedir</code> directive:</p>

<pre><code>open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/var/aegir/
</code></pre>

<p>Add <code>date.timezone</code> value as per <a href="http://php.net/date.timezone">PHP's runtime configuration instructions</a> - <em>this is an example</em>:</p>

<pre><code>date.timezone = Europe/London
</code></pre>

<p>Modify the <code>memory_limit</code> directive:</p>

<pre><code>memory_limit = 192M
</code></pre>

<p>Uncomment</p>

<pre><code>extension=posix.so
extension=mysqli.so
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Sudo_configuration">3.4. Sudo configuration</h2>

<p>Next, we need to give the aegir user permission to execute the Apache2 command to restart the web server without entering a password.</p>

<p>Create a file at <code>/etc/sudoers.d/aegir</code> and add the following:</p>

<pre>
Defaults:aegir  !requiretty
aegir ALL=NOPASSWD: /usr/sbin/apache2ctl
</pre>

<p>After saving, change the permissions on the file:</p>

<pre><code>chmod 0440 /etc/sudoers.d/aegir
</code></pre>

<p><strong>Note</strong> - the path to your apache2ctl program may differ from this example. On some systems it may also be called 'apachectl' instead of apache2ctl. Adjust to suit your own requirements.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="CentOS_Linux_specific_sudo_configuration">3.4.1. CentOS Linux specific sudo configuration</h3>

<p>For CentOS apache2ctl is apachectl and you should use this instead, as root::</p>

<pre><code>visudo
</code></pre>

<p>This command opens an editor to allow you to edit the /etc/sudoers file.  Add the following to the end of the file (specific directions cannot be given since this depends on what editor you're using):</p>

<pre><code>Defaults:aegir  !requiretty
aegir ALL=NOPASSWD: /usr/sbin/apachectl
</code></pre>

<p><strong>Note</strong> - the <code>!requiretty</code> bit is to make aegir able to run sudo even though it's not attached to a terminal. By default CentOS enforces requiretty so this exception is necessary.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Nginx_specific_configuration">3.4.2. Nginx specific configuration</h3>

<p>For those using Nginx, set the sudoers line as follows</p>

<pre><code>aegir ALL=NOPASSWD: /etc/init.d/nginx
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="DNS_configuration">3.5. DNS configuration</h2>

<p>Aegir requires a properly configured "FQDN" (Fully Qualified Domain Name) be assigned to the machine. In practice, this means that the hostname returned by the <code>hostname</code> and <code>uname -n</code> shell commands should resolve to the IP address for this server, and vice versa.</p>

<p>If you only intend to use Aegir on a single server, it is acceptable for the resolved IP address to be the '127.0.0.1' loopback address.</p>

<p>If you intend to manage multiple servers using Aegir, you will need to make sure that the IP address is the public IP of this server.</p>

<p>You can add multiple entries to your /etc/hosts file for testing purposes, for example:</p>

<pre><code>127.0.0.1 aegir.example.com example.com test1.example.com test2.example.com test3.example.com
</code></pre>

<p>Then you can use test1.example.com to create your first site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Database_configuration">3.6. Database configuration</h2>

<p>Aegir supports MySQL right now. It is best to install the MySQL server using your Linux distribution's package manager.</p>

<p>Shell commands as root::</p>

<pre><code>apt-get install mysql-server
</code></pre>

<p>To make sure that the Aegir backend, and all the possible web servers can reach your database server, you need to configure mysql to listen on all the public IP addresses available to it.</p>

<p>Again, as root, edit the MySQL configuration file <code>/etc/mysql/my.cnf</code> configuration line to comment out by placing a # at the beginning of the line as follow:</p>

<p>Before</p>

<pre><code>bind-address        = 127.0.0.1
</code></pre>

<p>After</p>

<pre><code># bind-address      = 127.0.0.1
</code></pre>

<p>Without this line commented out, MySQL will listen only on localhost for database connection requests.</p>

<p>Now you need to restart mysql, to clear any caches.</p>

<p>Shell command as root:</p>

<pre><code>/etc/init.d/mysql restart
</code></pre>

<p>The installer will prompt you for your MySQL root user password. The root user will be used to make administrative tasks such as creating new databases, and granting and revoking access to those databases for sites.</p>

<p>Even though MySQL is now listening on all IP's, it will not allow invalid users to connect to the databases, without the correct user accounts configured.</p>

<p>If you are concerned about MySQL being accessible in this way, you can also configure your firewall to only allow incoming connections from certain addresses. This is outside the scope of this document however.</p>

<p>Note that Aegir will ask you for your MySQL root password. If you do not want to use your regular root password for Aegir, you will need to create another root account for Aegir using a MySQL command like:</p>

<pre><code>GRANT ALL PRIVILEGES ON *.* TO 'aegir_root'@'%' IDENTIFIED BY 'password' WITH GRANT OPTION;
</code></pre>

<p>Note: If you are running your Aegir databases on a remote DB server, you will want to create this aegir_root user. The install will often fail if you're trying to use the root user on a remote database. See <a href="http://drupal.org/node/1237112">this issue</a> for details.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Ubuntu_RHEL_Arch_linux_specific_configurations">3.6.1. Ubuntu, RHEL, Arch linux specific configurations</h3>

<p><strong>NOTE</strong>: If you are running either Ubuntu 12.04 LTS, RHEL 6 or Arch Linux, you should still install MySQL in the same way as above. However, once done, you must now  remove the anonymous, passwordless login that those platforms creates by default. To do this, run:</p>

<pre><code>sudo mysql_secure_installation
</code></pre>

<p>Otherwise, Aegir will fail to install and work at all. See <a href="../faq/index.html#Install_fails_with_-dummy_connection_failed_to_fail-_on_Ubuntu_12.04_LTS">this FAQ entry</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="RHEL_6_specific_configuration-5">3.6.2. RHEL 6 specific configuration</h3>

<p>In Red Hat, you may need to move a default configuration file from <code>/usr/share/mysql/</code> to <code>/etc/my.cnf</code> to view or modify any of the settings mentioned above.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Install_Aegir_components">4. Install Aegir components</h1>

<p>Next step is to install the Aegir software components themselves, that is: drush, provision and hostmaster.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_drush">4.1. Install drush</h2>

<p>Before installing Aegir proper, you first need to install Drush. This can be done through your operating system's package manager (Drush is shipped with <a href="http://packages.debian.org/drush">Debian</a> and <a href="http://packages.ubuntu.com/drush">Ubuntu</a> currently) or by following the <a href="http://drupalcode.org/project/drush.git/blob_plain/HEAD:/README.txt">Drush README.txt file</a> which has all the information for installing and using drush.</p>

<p><strong>Note for 1.x users</strong>: you should use Drush version 4. Aegir 1.x does <strong>not</strong> support Drush 5. Also note there is a <a href="http://drupal.org/node/1041386">bug in Drush 4.0 and 4.1</a> so you should use a version of Drush between 4.1 and 5.</p>

<pre>
pear channel-discover pear.drush.org
pear install drush/drush-4.6.0
</pre>

<p><strong>Note for 2.x users</strong>: you need to install a minimum of Drush version 5.10, though Drush 6.x is recommended. In this case, you may be able to install the regular release:</p>

<p><strong>Note for 3.x users</strong>: you need to install a minimum of Drush version 6,some time you need apt-get install 
php-console-table before you become the Aegir user:</p>

<pre>
pear channel-discover pear.drush.org
pear install drush/drush
</pre>

<p>This should install Drush system-wide, but if you follow the manual install, you may end up with Drush in a non-standard location (traditionally <code>/var/aegir/drush/drush.php</code>), in which case you will need to add that directory to your path or use the following symlink:</p>

<pre>
ln -s /var/aegir/drush/drush /usr/local/bin/drush
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-6">4.1.1. Arch Linux specific configuration</h3>

<p>It seems that Arch's PHP environment needs to be modified for Drush:</p>

<pre>
mkdir /var/aegir/.drush
cp /etc/php/php.ini /var/aegir/.drush/
</pre>

<p>Edit <code>/var/aegir/.drush/php.ini</code> to remove the values after <code>open_basedir =</code>, as this will any <code>open_basedir</code> values are likely to cause Drush to fail.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Stop_Now_become_the_Aegir_user">4.2. Stop! Now become the Aegir user!</h2>

<p>The remaining of this manual assumes you are running as the Aegir user. Things will go very wrong if you do not change your shell credentials to become that user. You can do this by running the following command as root:</p>

<pre>
su -s /bin/bash - aegir
</pre>

<p>If this fails because <code>/bin/bash</code> doesn't exist, try using <code>/bin/sh</code>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_provision">4.3. Install provision</h2>

<p>Once Drush is installed you should be able to install the latest recommended Provision release using the following drush command:</p>

<p><strong>Note for 1.x users</strong>:</p>

<pre>
drush dl --destination=/var/aegir/.drush provision-6.x
</pre>

<p><strong>Note for 2.x users</strong>:</p>

<pre>
drush dl --destination=/var/aegir/.drush provision-6.x-2.0
drush cache-clear drush
</pre>

<p><strong>Note for 3.x users</strong>:
replace provison-6.x-2.0 to provison-7.x</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Running_hostmaster-install">4.4. Running hostmaster-install</h2>

<p>Once you have downloaded drush and provision, you can just install provision in the commands directory of Drush (either ~aegir/.drush or /usr/share/drush/commands), if that's not already done. Once provision is properly installed, you can install all other aegir components using the hostmaster-install command:</p>

<pre><code>drush hostmaster-install
</code></pre>

<p>You will be prompted for the required information if not provided on the commandline. See the inline help for the available options:</p>

<pre><code>drush help hostmaster-install
</code></pre>

<p>For example, to install the frontend on Nginx, use:</p>

<pre><code>drush hostmaster-install --http_service_type=nginx
</code></pre>

<p><em>Note for 2.x users:</em> Drush 5 has a <em>commandfile cache</em> which you need to clear before installing Aegir:</p>

<pre><code>drush cache-clear drush
</code></pre>

<p>It is imperative that you provide a valid FQDN to the installer. This is used for database GRANTs. Remote web servers depend on the FQDN being resolvable in order to connect back to your Aegir master server if it is used as your database server for managed sites.</p>

<p>Upon completion of the installation, the traditional Drupal 'Welcome' e-mail will be sent to the e-mail address specified by <code>--client_email=(your e-mail)</code> or if not provided as a command line switch, the address prompted by the installer process. This e-mail address will also be used as the default e-mail address of the first user and client in Aegir, but can be changed later.</p>

<p>There are other commandline switches available, documented in <code>drush help hostmaster-install</code>, as usual.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-7">4.4.1. Arch Linux specific configuration</h3>

<pre>
drush hostmaster-install --web_group=http
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Install_the_Hosting_Queue_Daemon">5. Install the Hosting Queue Daemon</h1>

<p>For Aegir 2.x installs, using the Hosting Queued Daemon (hosting_queued) is highly recommended. For Aegir 1.x, check out <a href="http://drupal.org/project/hosting_queue_runner" title="http://drupal.org/project/hosting_queue_runner">http://drupal.org/project/hosting_queue_runner</a> instead.</p>

<p>These instructions will install the daemon to run as a regular service in /etc/init.d/. Instructions will vary according to platforms, but the following should work in Debian, running as root.</p>

<ol>
<li><p>Install the init script in place</p>

<pre><code>cp &lt;hostmaster_platform_root&gt;/profiles/hostmaster/modules/hosting/queued/init.d.example /etc/init.d/hosting-queued
</code></pre></li>
<li><p>Setup symlinks and runlevels</p>

<pre><code>update-rc.d hosting-queued defaults
</code></pre></li>
<li><p>Start the daemon</p>

<pre><code>/etc/init.d/hosting-queued
</code></pre></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Checkpoint_Finished">6. Checkpoint / Finished!</h1>

<p>At this point, you have checked out all the code and setup your basic Drupal system (Drupal core, hosting, hostmaster and eldir) that will be the Aegir frontend and the backend system (provision and drush). Your filesystem layout should look something like this:</p>

<pre>
 /var/aegir/hostmaster-1.x/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/admin_menu/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/hosting/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/install_profile_api/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/jquery_ui/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/modalframe/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/themes/eldir/
 /var/aegir/hostmaster-1.x/sites/aegir.example.com/
 /var/aegir/config/server_master/apache.conf
 /var/aegir/config/server_master/apache/conf.d/
 /var/aegir/config/server_master/apache/vhost.d/
 /var/aegir/config/server_master/apache/platform.d/
 /var/aegir/backups/
 /var/aegir/drush/drush.php
 /var/aegir/.drush/drush_make/
 /var/aegir/.drush/provision/
</pre>

<p>Variations on this are acceptable (for example, the Drush Debian package works out of <code>/usr/bin/drush</code> and that's fine), but you are better to stick with the defaults if you really want to get through this.</p>

<p>The installation will provide you with a one-time login URL to stdout or via an e-mail. Use this link to login to your new Aegir site for the first time.</p>

<p>For troubleshooting this process and resulting install, see the <a href="../node/462/index.html">common installation problems page</a>.</p>

<p>You may also want to read on with <a href="../content/administrator/aegir-installed-now-what/index.html">what you can do with Aegir</a> now that it is installed.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/389/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-417" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/417/index.html">Mac OS X installation instructions</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h2>Apache</h2>

<p>For Apache based installation hints see <a href="../content/apache-mysql-php-aegir/index.html">Apache / mySQL / PHP / Aegir</a></p>

<h2>Nginx</h2>

<p>Nginx is more performant than Apache, if you are interested in setting Aegir up using nginx <a href="https://drupal.org/user/139189">Brian Gilbert</a> from <a href="http://realityloop.com/">Realityloop</a> has created a script to install everything that you need on a clean Mac (not already running anything on port 80), see <a href="http://rl.cm/osxaegirscript">OSX Aegir Installer</a> on github.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-46.html?destination=node%2F417%23comment-form">Login</a> or <a href="../user/register/index-46.html?destination=node%2F417%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-932" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/apache-mysql-php-aegir/index.html">Apache / mySQL / PHP / Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>This is a helper file to the canonical <a href="../installing/manual/index.html">manual install process</a>. It is aimed at
helping you install Aegir on Mac OS X. Since PHP and MySQL support on OS X is fairly limited and complicated, a separate documentation page was created for that part of the documentation. You should follow this page all the way through and then proceed with the regular install, <a href="../node/389/index.html#Stop_Now_become_the_Aegir_user">step 4: becoming the aegir user</a>.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc2">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Special_software_requirements"><span class="toc-number">1. </span>Special software requirements</a></li>
	<li class="toc-level-1"><a href="#Configure_system_requirements"><span class="toc-number">2. </span>Configure system requirements</a></li>
</ol>
</div>
</div>

<h1 id="Special_software_requirements">1. Special software requirements</h1>

<p>While Mac OS X comes with Apache &amp; PHP (and even MySQL on the Server
version), the version of PHP shipped with 10.6 Snow Leopard is 5.3.x
and thus may not work with Aegir (as of the 0.4alpha-era) and various
other software. If you're running 10.5 Leopard, it may work out of the
box, but I haven't tested it.</p>

<p>There are several different ways to get Apache, PHP 5.2, and MySQL 5
onto a Mac OS X machine. I give detailed instructions for MacPorts
below, but if that's a bit more than you're ready to bite off right
now, feel free to use an alternative approach.</p>

<p>One such alternative is MAMP. There is a good but outdated HOWTO for
installing Aegir on Mac OS X 10.6 (Snow Leopard) using MAMP located
here: <a href="http://groups.drupal.org/node/30270" title="http://groups.drupal.org/node/30270">http://groups.drupal.org/node/30270</a></p>

<p>MAMP stands for Mac, Apache, MySQL, and PHP and is the Mac equivalent
of "LAMP". It is a self-contained package of all of these programs
with a nice graphical installer and control panel.  You can find it
here: <a href="http://www.mamp.info/" title="http://www.mamp.info/">http://www.mamp.info/</a></p>

<p>MAMP is pretty straightforward, but it's also not very flexible
(IMHO).  While certainly not without its own headaches, MacPorts is a
decently powerful way to sanely manage a healthy stack of open source
UNIX software on your Mac. Since this is what I use, I'm going to
assume MacPorts is in use for the rest of this HINTS file. I have also
only tested this on Mac OS X 10.6 Snow Leopard.</p>

<p>If you don't yet have MacPorts installed, go here to get it:
<a href="http://www.macports.org/install.php" title="http://www.macports.org/install.php">http://www.macports.org/install.php</a></p>

<p>Once it's installed, quit and re-launch your Terminal before
continuing.  Otherwise MacPorts won't yet be in your PATH.</p>

<p>The first two commands below are optional but recommended.</p>

<p><div class="codeblock"><code>&nbsp; sudo port selfupdate<br />&nbsp; sudo port upgrade outdated<br />&nbsp; sudo port install apache2 mysql5-server git-core unzip php52 php5-posix php5-gd php5-apc +mysql5</code></div></p>

<p>php5-apc is optional, but highly recommended as it will significantly increase
PHP performance.</p>

<p>Watch the output of the last port command carefully, as there are
usually some boring tasks for you to perform once the install is
done. You'll be wishing you were running Ubuntu/Debian and apt-get by
the time you're done.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Configure_system_requirements">2. Configure system requirements</h1>

<p>Next we'll create the aegir user and add it to the _www group. This
part is very different on Mac OS X than Linux or most other
Unices. Must be a NeXTism. The command we will use he is "dscl", which
is a short for Directory Service Command Line. In OSX 10.3 and
earlier, that command is "nicl" (short for Net Info Command Line). It is also
possible to create the user using the "Workgroup Manager" utility included with
OS X Server. To obtain Workgroup Manager for the OS X Client, download the
"Server Admin Tools" from Apple. For example, for Mac OS X 10.6, the admin tools
can be found at:</p>

<p><a href="http://support.apple.com/downloads/Server_Admin_Tools_10_6" title="http://support.apple.com/downloads/Server_Admin_Tools_10_6">http://support.apple.com/downloads/Server_Admin_Tools_10_6</a></p>

<p><div class="codeblock"><code>&nbsp; sudo dscl . -create /Users/aegir NFSHomeDirectory /var/aegir</code></div></p>

<p>Now you need to find the next spare UID to assign the user.</p>

<p>Here's how you find out on your system:</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo dsexport users.out /Local/Default dsRecTypeStandard:Users</code></div></p>

<p>Then open the file users.out in a text editor, search for the highest
5xx user ID and add 1 to it (in your brain, not in the file). So if
you find 506 but no 507, use 507. When you're done, delete users.out
to be safe.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo rm users.out</code></div></p>

<p>Now assign this UID to the aegir user, replacing "5xx" with the UID.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo dscl . -create /Users/aegir UniqueID 5xx</code></div></p>

<pre>
!! If you're running Mac OSX Lion, you also need to assign PrimaryGroupID to the aegir user.
   sudo dscl . -create /Users/aegir PrimaryGroupID XXX
</pre>

<p>Set a secure password for the aegir user, as it needs shell access.</p>

<p><div class="codeblock"><code>sudo passwd aegir</code></div></p>

<p>Create the aegir home directory and set its permissions.</p>

<p><div class="codeblock"><code>sudo mkdir /var/aegir<br />sudo chown aegir /var/aegir<br />sudo chgrp _www /var/aegir</code></div></p>

<p>Add the aegir user to the _www group. This is the group Apache runs as.</p>

<p><div class="codeblock"><code>sudo dscl . -append /Groups/_www GroupMembership aegir</code></div></p>

<p>Give the aegir user the ability to restart Apache.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo mv /usr/sbin/apachectl /usr/sbin/apachectl-apple<br />&nbsp;&nbsp; sudo ln -s /opt/local/apache2/bin/apachectl /usr/sbin/apachectl<br />&nbsp;&nbsp; sudo visudo</code></div></p>

<p>Go to the last line of the file and add the following.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; aegir ALL=NOPASSWD: /usr/sbin/apachectl</code></div></p>

<p>Save the file and exit your text editor.</p>

<p>Next configure Apache to include the Aegir config.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; echo &quot;Include /var/aegir/config/apache.conf&quot; &gt;&gt; /opt/local/apache2/conf/httpd.conf</code></div></p>

<p>Configuring your MySQL database and user accounts is the same as in
the INSTALL.txt file. But you probably want to add the path to its
executables to your user's PATH and the aegir user's PATH.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; echo &#039;export PATH=/opt/local/lib/mysql5/bin:$PATH&#039; &gt;&gt; ~/.profile<br />&nbsp;&nbsp; su - aegir<br />&nbsp;&nbsp; Password: (the password you setup earlier)<br />&nbsp;&nbsp; echo &#039;export PATH=/opt/local/lib/mysql5/bin:$PATH&#039; &gt;&gt; ~/.profile<br />&nbsp;&nbsp; exit</code></div></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/932/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-931" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/nginx-mariadb-php-aegir-memp%c3%a6/index.html">nginx / MariaDB / PHP / Aegir (MEMP)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p><strong>The instructions that used to be here are now outdated, instead use the <a href="http://rl.cm/osxaegirscript">OSXAegirInstaller</a> created by <a href="https://drupal.org/user/139189">Brian Gilbert</a> of <a href="http://realityloop.com/">Realityloop</a>.</strong></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-47.html?destination=node%2F931%23comment-form">Login</a> or <a href="../user/register/index-47.html?destination=node%2F931%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2855" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/installing/manual/centos-6x-aegir-install-guide/index.html">Centos 6.x Aegir Install Guide</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_520 first"><a href="../category/keywords/centos-install-guide/index.html" rel="tag" title="">Centos Install Guide</a></li>
<li class="taxonomy_term_27"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>There are 2 methods of installing AEgir on CentOS both are the same but one is scripted and the other is manual and is documented below.</p>

<h2>Scripted</h2>

<p>The script can be found at <a href="https://github.com/marafa/aegir/tree/master/version2" title="https://github.com/marafa/aegir/tree/master/version2">https://github.com/marafa/aegir/tree/master/version2</a></p>

<p>NB. There is preliminary work to fix selinux at <a href="https://github.com/marafa/aegir/blob/master/aegir_selinux.sh" title="https://github.com/marafa/aegir/blob/master/aegir_selinux.sh">https://github.com/marafa/aegir/blob/master/aegir_selinux.sh</a>.
Feedback is quite welcome as well as git pulls.</p>

<h2>Explanation</h2>

<p>Connect to the server via ssh as root user.</p>

<blockquote>
  <p>ssh root@000.000.000.000</p>
</blockquote>

<h2>Install system requirements</h2>

<blockquote>
  <p>yum install httpd php php-mysql php-cli php-gd php-process php-pear php-mbstring php-xml php-soap sudo rsync git postfix tree wget cronie unzip mysql-server mlocate nmap samba samba-client samba-common vim</p>
</blockquote>

<p>Note: The following packages are not required but are very useful to include git wget mlocate nmap samba samba-client samba-common vim</p>

<h2>SElinux</h2>

<p>Make sure Security-Enhanced Linux is disabled as it creates install problems.</p>

<blockquote>
  <p>vim /etc/selinux/config
  Make sure SELINUX=disabled</p>
</blockquote>

<p>If was SELINUX=enabled then we need to restart.</p>

<blockquote>
  <p>shutdown -r now</p>
</blockquote>

<p>Note: I am not sure if it can be enabled at the end I have never tried.</p>

<h2>Create the Aegir user</h2>

<p>The provision framework of Aegir requires that the scripts run as a non-root system account, to ensure that it can correctly set the file permissions on the hosted files.</p>

<p>Also to ensure that the file permissions of the hosted sites are always as safe as can be, and especially to make sure that the web server does not have the ability to modify the code of the site, the configured system account needs to be a member of the web server group, in order to be able to correctly set the file permissions.</p>

<p>While you can choose another username, most aegir documentation assumes the Aegir user is aegir, its home directory is /var/aegir and the webserver group is www-data.</p>

<blockquote>
  <p>useradd --home-dir /var/aegir aegir</p>
  
  <p>gpasswd -a aegir apache</p>
  
  <p>chmod -R 755 /var/aegir</p>
</blockquote>

<h2>Apache configuration</h2>

<p>Start Apache</p>

<blockquote>
  <p>service httpd start</p>
</blockquote>

<p>Make apache start automatically after reboot.</p>

<blockquote>
  <p>chkconfig httpd on</p>
</blockquote>

<p>We need to create a symbolic link between aegir and apache.</p>

<blockquote>
  <p>ln -s /var/aegir/config/apache.conf /etc/httpd/conf.d/aegir.conf</p>
</blockquote>

<h2>PHP configuration</h2>

<blockquote>
  <p>vim /etc/php.ini</p>
</blockquote>

<p>Increase the memory limit as complex installation profiles or distributions require a PHP memory limit that is higher than the default (128M)</p>

<blockquote>
  <p>memory_limit = 192M</p>
</blockquote>

<p>Set Date Zone to your time zone see <a href="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone" title="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone">http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone</a></p>

<blockquote>
  <p>date.timezone = </p>
</blockquote>

<h2>Sudo configuration</h2>

<p>Next, we need to give the aegir user permission to execute the Apache2 command to restart the web server without entering a password.</p>

<blockquote>
  <p>visudo</p>
</blockquote>

<p>Add to end of file</p>

<blockquote>
  <p>Defaults:aegir  !requiretty</p>
  
  <p>aegir ALL=NOPASSWD: /usr/sbin/apachectl</p>
</blockquote>

<h2>DNS configuration</h2>

<p>Aegir requires a properly configured "FQDN" (Fully Qualified Domain Name) be assigned to the machine. In practice, this means that the hostname returned by the hostname and uname -n shell commands should resolve to the IP address for this server, and vice versa.</p>

<p>If you only intend to use Aegir on a single server, it is acceptable for the resolved IP address to be the '127.0.0.1' loopback address.</p>

<p>If you intend to manage multiple servers using Aegir, you will need to make sure that the IP address is the public IP of this server.</p>

<p>You can add multiple entries to your /etc/hosts file for testing purposes, for example:#&gt; &gt;vim /etc/hosts
Add your ip and hostname</p>

<blockquote>
  <p>000.000.000.000 hostname</p>
</blockquote>

<h2>Database configuration</h2>

<p>Start mysql</p>

<blockquote>
  <p>service mysqld start</p>
</blockquote>

<p>Make mysql start automatically after reboot.</p>

<blockquote>
  <p>chkconfig mysqld on</p>
</blockquote>

<p>Configure Mysql</p>

<blockquote>
  <p>/usr/bin/mysql_secure_installation</p>
</blockquote>

<p>Recommended:</p>

<blockquote>
  <p>Set root Password</p>
  
  <p>Remove anonymous users? y</p>
  
  <p>Disallow root login remotely? y</p>
  
  <p>Remove test database and access to it? y</p>
  
  <p>Reload privilege tables now? y</p>
</blockquote>

<h2>Install drush</h2>

<blockquote>
  <p>pear channel-discover pear.drush.org</p>
  
  <p>pear install drush/drush-4.5.0</p>
</blockquote>

<p>Check if drush works
If you get PHP Fatal error:  Class 'Console_Table' not found then</p>

<blockquote>
  <p>pear install Console_Table</p>
</blockquote>

<h2>Stop! Now become the Aegir user!</h2>

<p>The remaining of this manual assumes you are running as the Aegir user. Things will go very wrong if you do not change your shell credentials to become that user.</p>

<blockquote>
  <p>su -s /bin/bash - aegir</p>
</blockquote>

<p>Install provision</p>

<blockquote>
  <p>drush dl --destination=/var/aegir/.drush provision-6.x</p>
</blockquote>

<p>Clear the drush cache</p>

<blockquote>
  <p>drush cache-clear drush</p>
</blockquote>

<p>Run hostmaster-install</p>

<blockquote>
  <p>drush hostmaster-install</p>
</blockquote>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-48.html?destination=node%2F2855%23comment-form">Login</a> or <a href="../user/register/index-48.html?destination=node%2F2855%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-887" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../installing/manual/manual-install-web-cluster-aegir-using-nginx/index.html">Manual install of a web cluster aegir using nginx</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>These are some really rough notes on how to go about creating a 4 server aegir installation (aegir, mysql, web1, web2).</p>

<p>Adapted from reading through the BOA project and my own experimentation.</p>

<p>** Note -- regarding the wildcard SSL, your sites will need some configuration in your settings.php or local.settings.php to check for the X-Forwarded-Proto headers.  I can't recall if the wildcard SSL config.</p>

<p>These notes also assume the last Ubuntu LTS -- 10.04/Lucid.</p>

<pre>
aegirmysql:

sudo apt-get update
sudo apt-get upgrade
sudo apt-get install vim mysql-server


_USER="aegir"
_DOMAIN="aegir.domain.com"
_AEGIR_HOST="aegir.server.hostname"
_AEGIR_HOST_IP="123.456.789.01"
_AEGIR_PASSWORD="password"

#AEGIR_DB_USER=aegir_root
#AEGIR_DB_PASS=`echo $RANDOM:\`date\`:$AEGIR_HOST | openssl md5`

echo "[client]
user=root
password=password" &gt;&gt; .my.cnf

mysql -uroot mysql&lt;&lt;EOFMYSQL
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'$_DOMAIN' IDENTIFIED BY 'password' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'$_AEGIR_HOST' IDENTIFIED BY 'password' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'$_AEGIR_HOST_IP' IDENTIFIED BY 'password' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'localhost' IDENTIFIED BY 'password' WITH GRANT OPTION;
FLUSH PRIVILEGES;
EOFMYSQL


========================

# <a href="https://launchpad.net/~brianmercer/+archive/nginx" title="https://launchpad.net/~brianmercer/+archive/nginx">https://launchpad.net/~brianmercer/+archive/nginx</a>
# <a href="https://launchpad.net/~nginx/+archive/php5" title="https://launchpad.net/~nginx/+archive/php5">https://launchpad.net/~nginx/+archive/php5</a>

aegircontrol:

sudo apt-get update
sudo apt-get upgrade

sudo mkdir -p /var/www/nginx-default

#php5-suhosin
CATHOSTDEBDEPS="git-core git-doc mysql-client-5.1 vim nginx-custom drush postfix php5-cli php5-mysql php5-fpm php5-gd rsync unzip bzr patch curl"
sudo apt-get -V install $CATHOSTDEBDEPS

#postfix config already sorted

sudo adduser --system --group --home /var/aegir aegir
sudo adduser aegir www-data
sudo chsh -s /bin/bash aegir

#patch drush, re: ereg()

#as root:
echo "aegir ALL=NOPASSWD: /etc/init.d/nginx" &gt;&gt; /etc/sudoers

ln -s /var/aegir/config/nginx.conf /etc/nginx/conf.d/aegir.conf
#disable directives in nginx.conf:
#types_hash_max_size
#tcp_nopush
#error_log
invoke-rc.d nginx restart

#install SSL cert to:
/etc/ssl/private/domain.com.cert.pem
cd /etc/ssl/private/
ln -s domain.com.cert.pem nginx-wild-ssl.crt
ln -s domain.com.cert.pem nginx-wild-ssl.key

#install SSL config to:
/var/aegir/config/server_master/nginx/pre.d/nginx_wild_ssl.conf
#TODO: also install for /var/aegir/config/server_aegirweb{1,2}.host.name

#as aegir:
cd ~

mkdir .ssh
ssh-keygen -t rsa

ln -s /usr/share/drush /var/aegir/drush
mkdir ~/.drush
cd ~/.drush
wget -c <a href="http://ftp.drupal.org/files/projects/provision-6.x-1.3.tar.gz" title="http://ftp.drupal.org/files/projects/provision-6.x-1.3.tar.gz">http://ftp.drupal.org/files/projects/provision-6.x-1.3.tar.gz</a>
tar -zxf provision-6.x-1.3.tar.gz

#htaccess password bit
mkdir ~/tmp
cd ~/tmp
git clone --branch develop git://github.com/computerminds/aegir_http_basic.git
#must be develop branch to use crypt() and for nginx support
cp -r aegir_http_basic/provision ~/.drush/provision/aegir_http_basic
cp -r aegir_http_basic/hosting ~/hostmaster-6.x-1.3/profiles/hostmaster/modules/hosting/http_basic_auth
#set directory permissions? -- patch aegir/http_basic module to do so?

_DOMAIN="aegir.domain.com"
_USER="aegir"
#_AEGIR_HOST=`uname -n`
_AEGIR_HOST="aegir.server.hostname"
_AEGIR_HOME="$HOME"
_AEGIR_DB_PASS="password"
_AEGIR_DB_HOST="mysql.server.fqdn"
_AEGIR_VERSION="1.3"
#_AEGIR_ROOT="$_AEGIR_HOME/hostmaster-$_AEGIR_VERSION"
_ADM_EMAIL="admin@domain.com""
_WEBG=www-data
_USRG=users

#going vanilla
echo "drush hostmaster-install $_DOMAIN --aegir_host=$_AEGIR_HOST --aegir_db_user=$_USER --aegir_db_pass=$_AEGIR_DB_PASS --http_service_type=nginx --db_service_type=mysql --db_port=3306 --aegir_db_host=$_AEGIR_DB_HOST --client_email=$_ADM_EMAIL --script_user=$_USER --web_group=$_WEBG --profile=hostmaster -d -v"

drush hostmaster-install $_DOMAIN --aegir_host=$_AEGIR_HOST --aegir_db_user=$_USER --aegir_db_pass=$_AEGIR_DB_PASS --http_service_type=nginx --db_service_type=mysql --db_port=3306 --aegir_db_host=$_AEGIR_DB_HOST --client_email=$_ADM_EMAIL --script_user=$_USER --web_group=$_WEBG --profile=hostmaster -d -v

cd hostmaster-6.x-1.3
echo "alive" &gt;&gt; healthcheck

#enable aegir modules
drush @hostmaster en hosting_web_cluster
drush @hostmaster en hosting_alias
drush @hostmaster en hosting_http_basic_auth
#*** enable hosting client in features -- disabling client module cause WSOD on site add page

# setup aegirweb{1,2}
# test ssh to aegirweb{1,2}
# add to known_hosts

# NOTE: Aegir web clusters need to share the files, and private directories between web servers (also cache directory, if using boost module)
# Setup provision hook for NFS links
# <a href="http://drupal.org/node/1283738" title="http://drupal.org/node/1283738">http://drupal.org/node/1283738</a>

mkdir -p /var/lib/sitedata/aegir
chown -R aegir:www-data /var/lib/sitedata/aegir

mkdir -p /var/lib/sitedata/aegir/cache
chown -R aegir:www-data /var/lib/sitedata/aegir/cache


# add web servers
# add web cluster
#TODO: Add DR web servers to cluster
#TODO: Add WR, re: DR web servers &amp; firewall

# set date/time settings in Aegir

#TODO: Logrotate webserver logs

#TODO: Add an alias for the aegir user:
#aegir: "admin@domain.com""

========================

aegirweb{1,2}:
#TODO: Check puppeted stuff, fix, etc

sudo apt-get update
sudo apt-get upgrade

sudo mkdir -p /var/www/nginx-default

CATWEBDEBDEPS="mysql-client-5.1 vim nginx-custom drush postfix php5-cli php5-mysql php5-fpm php5-gd rsync unzip patch"
sudo apt-get -V install $CATWEBDEBDEPS


sudo adduser --system --group --home /var/aegir aegir
sudo adduser aegir www-data
sudo chsh -s /bin/bash aegir

#install SSL cert to:
/etc/ssl/private/domain.com.cert.pem
cd /etc/ssl/private/
ln -s domain.com.cert.pem nginx-wild-ssl.crt
ln -s domain.com.cert.pem nginx-wild-ssl.key

#install SSL config to:
/var/aegir/config/server_master/nginx/pre.d/nginx_wild_ssl.conf
#TODO: also install for /var/aegir/config/server_aegirweb{1,2}.host.name

#as root:
echo "aegir ALL=NOPASSWD: /etc/init.d/nginx" &gt;&gt; /etc/sudoers

#as aegir:
mkdir /var/aegir/.ssh
cat aegir.aegircontrol.id_rsa.pub &gt;&gt; /var/aegir/.ssh/authorized_keys2


#TODO: Logrotate webserver logs

==========================

</pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-49.html?destination=node%2F887%23comment-form">Login</a> or <a href="../user/register/index-49.html?destination=node%2F887%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1075" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/installing/manual/nginx-mariadb-php-fpm-single-server-installation/index.html">nginx / MariaDB / PHP-FPM Single Server Installation</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc3">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Housekeeping"><span class="toc-number">1. </span>Housekeeping</a></li>
	<li class="toc-level-1"><a href="#Install_MariaDB"><span class="toc-number">2. </span>Install MariaDB</a></li>
	<li class="toc-level-1"><a href="#Install_Nginx"><span class="toc-number">3. </span>Install Nginx</a></li>
	<li class="toc-level-1"><a href="#Install_all_the_other_stuff"><span class="toc-number">4. </span>Install all the other stuff</a></li>
	<li class="toc-level-1"><a href="#Create_the_Aegir_user"><span class="toc-number">5. </span>Create the Aegir user</a></li>
	<li class="toc-level-1"><a href="#Misc_Configuration"><span class="toc-number">6. </span>Misc Configuration</a></li>
	<li class="toc-level-1"><a href="#Install_Aegir"><span class="toc-number">7. </span>Install Aegir</a></li>
	<li class="toc-level-1"><a href="#Optional_Improvements"><span class="toc-number">8. </span>Optional Improvements</a></li>
</ol>
</div>
</div>

<p>Note: This installation process assumes that you're using a fresh install of Ubuntu 14.04 x64. If you use a lower version of Ubuntu, you may have trouble with this guide.</p>

<p>On most VPS providers, you'll be logged in as root initially. The installation process below assumes that you are logged in as root. Obviously, this is not a secure long-term solution, so once you're done with this guide, I suggest setting up public key authentication, turning off root login over SSH, and creating yourself a new unprivileged user. That's out of scope for this doc page, so you're probably <a href="http://google.com/">on your own</a> for that.</p>

<p>Finally, this document assumes that you're going to be installing aegir at aegir.example.com. Any time you see example.com, replace it with your domain.</p>

<h2 id="Housekeeping">1. Housekeeping</h2>

<p>Make sure you're up to date:</p>

<pre><code>apt-get update
apt-get upgrade
</code></pre>

<p>And that you have the the python-software-properties package (we'll need it later):</p>

<pre><code>apt-get install python-software-properties
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_MariaDB">2. Install MariaDB</h2>

<p>From mariadb.org:</p>

<pre><code>MariaDB is a database server that offers drop-in replacement functionality for MySQL. 
MariaDB is built by some of the original authors of MySQL, with assistance from the
broader community of Free and open source software developers. In addition to the core
functionality of MySQL, MariaDB offers a rich set of feature enhancements including
alternate storage engines, server optimizations, and patches.
</code></pre>

<p>Install MariaDB:</p>

<pre><code>apt-get install mariadb-server
</code></pre>

<p>You'll need to set your root password for the MariaDB server</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_Nginx">3. Install Nginx</h2>

<p>Next, install Nginx and PHP-FPM:</p>

<pre><code>apt-get install nginx php5-cli php5-mysql php5-fpm php5-gd
</code></pre>

<p>Create the default docroot for Nginx as well:</p>

<pre><code>mkdir -p /var/www/nginx-default
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_all_the_other_stuff">4. Install all the other stuff</h2>

<pre><code>apt-get install git-core git-doc vim drush postfix rsync unzip bzr patch curl
</code></pre>

<p>When prompted for Postfix configuration, select "Internet Site", then use "example.com" for the System mail name.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_the_Aegir_user">5. Create the Aegir user</h2>

<p>Easy:</p>

<pre><code>adduser --system --group --home /var/aegir aegir
adduser aegir www-data
chsh -s /bin/bash aegir
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Misc_Configuration">6. Misc Configuration</h2>

<p>Make sure the Aegir user is allowed to restart Nginx:</p>

<pre><code>echo "aegir ALL=NOPASSWD: /etc/init.d/nginx" &gt;&gt; /etc/sudoers
</code></pre>

<p>Symlink Aegir's nginx configuration into place:</p>

<pre><code>ln -s /var/aegir/config/nginx.conf /etc/nginx/conf.d/aegir.conf
</code></pre>

<p>Disable duplicated directives in <code>/etc/nginx/nginx.conf</code> (the Aegir config specifies these values as well - if you do not disable them in the main nginx.conf, nginx will fail to restart). You can just remove (or comment them out with a "#") the lines that start with the following</p>

<pre><code>types_hash_max_size
tcp_nopush
error_log
</code></pre>

<p>Then, restart Nginx:</p>

<pre><code>service nginx restart
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_Aegir">7. Install Aegir</h2>

<p><strong>IMPORTANT</strong> Switch to the Aegir user now: <strong>IMPORTANT</strong></p>

<pre><code>su - aegir
cd ~/
</code></pre>

<p>Download the latest Provision release:</p>

<pre><code>mkdir ~/.drush
cd ~/.drush
wget -c <a href="http://ftp.drupal.org/files/projects/provision-6.x-2.1.tar.gz" title="http://ftp.drupal.org/files/projects/provision-6.x-2.1.tar.gz">http://ftp.drupal.org/files/projects/provision-6.x-2.1.tar.gz</a>
tar -zxf provision-6.x-2.1.tar.gz
rm provision-6.x-2.1.tar.gz
</code></pre>

<p>Start the Aegir install process:</p>

<pre><code>cd ~/
drush hostmaster-install aegir.example.com \
--aegir_host="aegir.example.com" \
--http_service_type="nginx" \
--aegir_db_user="root" \
--aegir_db_pass="[YOUR ROOT DATABASE PASSWORD]" \
--db_service_type="mysql" \
--db_port=3306 \
--aegir_db_host="localhost" \
--client_email="[YOUR EMAIL ADDRESS]" \
--script_user="aegir" \
--web_group="www-data" \
--profile=hostmaster
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Optional_Improvements">8. Optional Improvements</h2>

<p>drupal.org/project/hosting_queue_runner</p>

<p>drupal.org/project/provision_boost</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-50.html?destination=node%2F1075%23comment-form">Login</a> or <a href="../user/register/index-50.html?destination=node%2F1075%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-462" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/462/index.html">Common installation problems</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>There are a few things that can go wrong in the install.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc4">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Verify_and_install_run_everything_through_SSH"><span class="toc-number">1. </span>Verify and install run everything through SSH</a></li>
	<li class="toc-level-1"><a href="#NameVirtualHost_:80_has_no_VirtualHosts"><span class="toc-number">2. </span>NameVirtualHost *:80 has no VirtualHosts</a></li>
	<li class="toc-level-1"><a href="#Making_sure_it_works"><span class="toc-number">3. </span>Making sure it works</a></li>
	<li class="toc-level-1"><a href="#Access_by_the_server-s_physical_IP_address"><span class="toc-number">4. </span>Access by the server's physical IP address</a></li>
	<li class="toc-level-1"><a href="#CentOS_firewall_settings"><span class="toc-number">5. </span>CentOS firewall settings</a></li>
	<li class="toc-level-1"><a href="#CentOS_cron_requires_restart"><span class="toc-number">6. </span>CentOS cron requires restart?!</a></li>
	<li class="toc-level-1"><a href="#CentOS_aegir.conf_permission_denied"><span class="toc-number">7. </span>CentOS aegir.conf permission denied</a></li>
	<li class="toc-level-1"><a href="#Solaris_cron_issues"><span class="toc-number">8. </span>Solaris cron issues</a></li>
	<li class="toc-level-1"><a href="#Drush_execution_path_issues"><span class="toc-number">9. </span>Drush execution path issues</a></li>
	<li class="toc-level-1"><a href="#APC_issues"><span class="toc-number">10. </span>APC issues</a></li>
</ol>
</div>
</div>

<h2 id="Verify_and_install_run_everything_through_SSH">1. Verify and install run everything through SSH</h2>

<p>Since Aegir has multi-server support, it is possible that you have a misconfigured "FQDN" and that aegir then tries to connect to the local server as a remote server. To check if you have a misconfigured server, run the following commands:</p>

<pre><code>resolveip `uname -n`
</code></pre>

<p>If the command returns your IP address, you are all set. If it returns an error you will need to edit your <code>/etc/hosts</code> file.</p>

<p>First line of this file looks like:</p>

<pre><code>127.0.0.1  localhost
</code></pre>

<p>Simply add all domains you want to this line. e.g:</p>

<pre><code>127.0.0.1  localhost aegir.example.com example.com
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="NameVirtualHost_:80_has_no_VirtualHosts">2. NameVirtualHost *:80 has no VirtualHosts</h2>

<p>It does not hurt anything, but it can be annoying in your logs.  This may disappear as soon as you define your first virtual site using Aegir. If it does not, you most likely have a second NameVirtualHost statement in your configuration someplace other than in the Aegir configurations.</p>

<p>If you are on a Debian system, that is usually a configuration fragment in /etc/apache2/ports.conf or in a fragment symbolically linked in /etc/apache2/sites-enabled and it is safe to comment out any NameVirtualHost statements you find there as this really is a large part of the job you have asked Aegir to do for you.</p>

<p>Once those are commented out, the message should disappear.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Making_sure_it_works">3. Making sure it works</h2>

<p>Your new Aegir server will be installed with a single site named the way you specified in your install script.  That's great, but you may have more paths to that same server.</p>

<p>When you try to browse to your server for the first time from a non-localhost browser you may get an addressing issue.  If you do, make sure that you actually have the server defined in DNS and that the DNS server was reloaded.  If it was reloaded and you use slave servers, make sure that the serial number in the zone file was incremented so that the slaves automatically reload.</p>

<p>If you already have multiple URLs in your DNS which resolve to the same Aegir, you should check them.  For instance: if your DNS resolves both aegir.example.com and sitecontrol.example.com to your new Aegir server's IP, you need to make sure that both are accommodated.  If they will both get the same physical hostmaster site, one should be set up as an alias to the other.  If they are indeed going to be separate sites you will have to create a new site node with the other name as a virtual site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Access_by_the_server-s_physical_IP_address">4. Access by the server's physical IP address</h2>

<p>Another "gotcha" that you may run into is http access using the actual IP itself.  Remember that the IP is not picked up by the site vhost and will not match a ServerName or ServerAlias - so it gets picked up by the default vhost.  This is just standard apache stuff, nothing Aegir or Drupal specific here, but quite the annoyance and a potential problem.</p>

<p>You can easily work around it by simply adding the IP as a Site Alias in the site node in either the Aegir site (or another site that you may have defined which you would prefer the IP to address).</p>

<p>You can tell if you have the IP problem by simply pointing your browser to the server by IP as <a href="http://999.999.999.999/" title="http://999.999.999.999/">http://999.999.999.999/</a> and seeing what comes up.  If you get an install screen, you have the problem.  You certainly do not want that install screen getting executed!</p>

<p>The good news is that fixing it is easy.</p>

<p>Simply log into Aegir, click on Sites, click on the site name that you want the IP to address, click on Edit and scroll down to Domain Aliases.  Put the IP into the box, click on the Redirect checkbox so that Aegir instructs Apache to do a rewrite to the real domain name, and finally click Save.</p>

<p>If you do not have the Domain Aliases entry box, you need to turn that feature on.  In that case, go to your administration menu at the top of the page, point to Hosting and then click on Features.  Click the checkbox for Site Aliasing and then Save Configuration.  The Aliases box will now appear when you edit a site.  There is excellent information about the site alias feature in this handbook at <a href="../node/60/index.html" title="http://community.aegirproject.org/node/60">http://community.aegirproject.org/node/60</a> with much more detail.</p>

<p>After the Verify job completes you should test your server again.  Now when you address the server by it's IP address the URL should automatically change to the site you selected and the install screen never appears.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS_firewall_settings">5. CentOS firewall settings</h2>

<p>You may need to adjust CentOS's firewall settings to allow HTTP
traffic on port 80.  If you installed CentOS with a UI, enable
"Firewall settings -- WWW (HTTP)".</p>

<p>Alternatively, another solution may be to edit /etc/sysconfig/iptables 
and add a rule accepting traffic on the relevant interface on port 80.</p>

<p>Afterwards, you can restart the firewall with this command:</p>

<p>Shell commands::
<div class="codeblock"><code> service iptables restart</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS_cron_requires_restart">6. CentOS cron requires restart?!</h2>

<p>Also, in some configurations, it seems necessary to restart crond for
the user crontab changes to take effect (very bizarre). For that, use:</p>

<p>Shell commands::
<div class="codeblock"><code> service crond restart</code></div></p>

<p>See <a href="http://drupal.org/node/632308" title="http://drupal.org/node/632308">http://drupal.org/node/632308</a> if you have more information about
this issue.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS_aegir.conf_permission_denied">7. CentOS aegir.conf permission denied</h2>

<p>If you receive:
<div class="codeblock"><code>Starting httpd: httpd: Syntax error on line 209 of /etc/httpd/conf/httpd.conf: Could not open configuration file /etc/httpd/conf.d/aegir.conf: Permission denied</code></div>
when trying to restart httpd, check your SELinux settings. If enabled, you can run the following command on the aegir.conf file in /var/aegir/config/server_master directory:
<div class="codeblock"><code>chcon -t httpd_config_t apache.conf</code></div>
Alternatively, you can disable SELinux completely if you desire. Both options will result in removing the permisson denied error.</p>

<p>You can see this comment: <a href="http://drupal.org/node/1286926#comment-5028062" title="http://drupal.org/node/1286926#comment-5028062">http://drupal.org/node/1286926#comment-5028062</a> for a little more info.</p>

<p>Try the following if nothing works:</p>

<pre><code>setenforce permissive
</code></pre>

<p>See this doc to make the change permanent: <a href="http://wiki.centos.org/HowTos/SELinux" title="http://wiki.centos.org/HowTos/SELinux">http://wiki.centos.org/HowTos/SELinux</a></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Solaris_cron_issues">8. Solaris cron issues</h2>

<p>I had numerous problems setting up a proper cron job, as Solaris' crond seems
pretty anal about what it accepts. The only way I could get it to work was to
create a wrapper shell script that would be called using the simplest cron
tab.</p>

<p>Crontab entry:</p>

<p><div class="codeblock"><code>* * * * * /var/aegir/dispatch.sh</code></div></p>

<p>Content of dispatch.sh:</p>

<p><div class="codeblock"><code>#!/usr/bin/bash<br /><br />HOME=/var/aegir<br />LD_LIBRARY_PATH=/usr/lib:/usr/local/lib:/usr/lib/sparcv9:/opt/mysql/mysql/lib:/usr/sfw/lib:/usr/sfw/lib/gcc:/opt/sfw/lib<br />PATH=/usr/bin:/opt/mysql/mysql/bin:/usr/sfw/bin:/opt/sfw/bin:/opt/SUNWspro/bin:/usr/local/bin:/opt/csw/bin<br /><br />export HOME<br />export LD_LIBRARY_PATH<br />export PATH<br /><br />php &#039;/var/aegir/drush/drush.php&#039; --php=/usr/local/bin/php &#039;@hostmaster&#039; hosting-dispatch</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Drush_execution_path_issues">9. Drush execution path issues</h2>

<p>Solaris (and maybe others) suffers from the dreaded execution issues of drush:</p>

<ul>
<li><a href="http://drupal.org/node/637574" title="http://drupal.org/node/637574">http://drupal.org/node/637574</a></li>
<li><a href="http://drupal.org/node/586466" title="http://drupal.org/node/586466">http://drupal.org/node/586466</a></li>
</ul>

<p>Those can be worked around by hardcoding the --php executable on the
commandline path. Adding the proper shebang (<code>#!/usr/local/bin/php</code>, for example) header and using a proper PATH
that includes the PHP executable also helps.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="APC_issues">10. APC issues</h2>

<p>If you are having trouble running APC with Aegir, try downgrading to APC 3.1.4.  This can be achieved by the following:</p>

<p><code>sudo pecl uninstall apc</code></p>

<p><code>sudo pecl install apc-3.1.4</code></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-51.html?destination=node%2F462%23comment-form">Login</a> or <a href="../user/register/index-51.html?destination=node%2F462%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-646" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html">Ubuntu 10.04 Specific : How to downgrade to php 5.2 before install</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>As explained at <a href="../installing/manual/index.html" title="http://community.aegirproject.org/installing/manual">http://community.aegirproject.org/installing/manual</a>, the recommended version of PHP is 5.3, but some users may wish to use PHP 5.2 in order to host Drupal 5.x sites or to use modules which have PHP 5.3 compatibility issues. Should you choose to do so, the following documentation may be useful. What is explained here is specific to Ubuntu 10.04. It hasn't been tested on further versions, mostly because many sysadmins prefer to use the latest Long Term Support (LTS) version of Ubuntu, currently 10.04, on their production servers.</p>

<p>Follow this procedure :</p>

<p><code>sudo apt-get install python-software-properties</code></p>

<p><code>add-apt-repository ppa:txwikinger/php5.2</code></p>

<p>Create the file /etc/apt/preferences.d/php and input the following code in it :</p>

<pre>
Package: libapache2-mod-php5
Pin: version 5.2.10*
Pin-Priority: 991

Package: libapache2-mod-php5filter
Pin: version 5.2.10*
Pin-Priority: 991

Package: php-pear
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-cgi
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-cli
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-common
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-curl
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-dbg
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-dev
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-gd
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-gmp
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-ldap
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-mhash
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-mysql
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-odbc
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-pgsql
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-pspell
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-recode
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-snmp
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-sqlite
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-sybase
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-tidy
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-xmlrpc
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-xsl
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-mcrypt
Pin: version 5.2.6*
Pin-Priority: 991

Package: php5-imap
Pin: version 5.2.6*
Pin-Priority: 991
</pre>

<p>Then proceed Aegir install as explained at <a href="../installing/debian/index.html" title="http://community.aegirproject.org/installing/debian">http://community.aegirproject.org/installing/debian</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/646/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-945" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/administrator/post-install-configuration/index.html">Post-install configuration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>Alright, so you have installed Aegir, what else is there?</p>

<p>You have a lot of things you can do now:</p>

<ul>
<li><a href="../node/19/index.html">Get to know the interface</a></li>
<li><a href="../node/256/index.html">Use drush make</a></li>
<li><a href="../node/427/index.html">Work as the Aegir user</a></li>
<li><a href="../debugging/index.html">Debugging Aegir</a></li>
<li>Setup <a href="http://drupal.org/project/hosting_queue_runner">the hosting queue runner</a> for lower waiting times</li>
</ul>

<p>A lot more is available in the <a href="../using/index.html">user manual</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-52.html?destination=node%2F945%23comment-form">Login</a> or <a href="../user/register/index-52.html?destination=node%2F945%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-21" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/content/administrator/post-install-configuration/importing-sites/index.html">Importing sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>It is possible to import existing sites into the Aegir hosting system, so that they can be managed by Aegir.</p>

<p>These instructions assume you've set up a new server with Aegir on it, and you want to import sites into Aegir from another server, or even from the same server, using backups.</p>

<p>There are basically three ways of importing sites in Aegir:</p>

<ul>
<li><a href="../content/importing-existing-aegir-backups/index.html">from Aegir backups</a> - simplest and fastest, scriptable</li>
<li><a href="../content/importing-single-site-manually/index.html">from any single site, manually</a> - most reliable, can import even non-aegir sites, hard to automate</li>
<li><a href="../content/importing-complete-drupal-platform/index.html">from a complete Drupal install</a> - fairly reliable, can import non-aegir sites, could be automated but requires access to the database servers currently in use by the site</li>
</ul>

<p>This section also regroups troubleshooting and other less orthodox techniques.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-53.html?destination=node%2F21%23comment-form">Login</a> or <a href="../user/register/index-53.html?destination=node%2F21%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-117" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/importing-existing-aegir-backups/index.html">Importing from existing Aegir backups</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc5">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Copy_backups"><span class="toc-number">1. </span>Copy backups</a></li>
	<li class="toc-level-1"><a href="#Create_the_site_context_and_deploy_the_backup"><span class="toc-number">2. </span>Create the site context and deploy the backup</a></li>
	<li class="toc-level-1"><a href="#Verify_the_Platform"><span class="toc-number">3. </span>Verify the Platform</a></li>
	<li class="toc-level-1"><a href="#Caveats"><span class="toc-number">4. </span>Caveats</a></li>
	<li class="toc-level-1"><a href="#Setting_a_Non-Default_Install_Profile"><span class="toc-number">5. </span>Setting a Non-Default Install Profile</a></li>
</ol>
</div>
</div>

<p>If you need to import a site from an existing Aegir system, this can be done from an Aegir site backup.</p>

<p><strong>Requirements:</strong></p>

<ol>
<li>New Aegir version 0.4 alpha15 or later.</li>
<li>Access to Aegir backups from the old server.</li>
<li>A platform set up and verified that matches the platform on the old Aegir server.</li>
</ol>

<h2 id="Copy_backups">1. Copy backups</h2>

<p>First log into the new server via ssh - switch to the aegir user. Create a temporary directory somewhere, for example:
<div class="codeblock"><code>mkdir /var/aegir/tmp/migrate</code></div></p>

<p>Run a command to syncronize the new directory with the backups directory of the old Aegir hosting system. This command does the entire directory, but you may want to modify this if you have a lot of unneeded backups on the old system.</p>

<p>This command also assumes that you can shell into the other server as the aegir user. Modify as required.</p>

<p><div class="codeblock"><code>rsync -aPv -e ssh aegir@old-server.com:/var/aegir/backups/* /var/aegir/tmp/migrate</code></div></p>

<p>Now you can re-run the above command just before you are going to migrate a site. This is handy if you have a lot of sites to migrate and each site requires attention. Simply make a new backup of the site in the old system, and rerun the rsync command.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_the_site_context_and_deploy_the_backup">2. Create the site context and deploy the backup</h2>

<p>For brevity, I assume that drush can be executed as <code>drush</code>. Replace with <code>php /var/aegir/drush/drush.php</code> if needed.</p>

<p>Pay attention to these two commands, they require modification to match the name of the site, the alias of the platform, and the name of the backup archive. These commands should each be on one line. You also need to know the platform alias. You can see all the platform aliases available by typing <code>drush sa | grep platform</code>.</p>

<p>First tell Aegir about the site, which creates a site alias.</p>

<p><div class="codeblock"><code>drush provision-save @example.com --context_type=site --platform=@platform_d6 --uri=example.com --db_server=@server_localhost --client_name=admin</code></div></p>

<p>Then run the provision-deploy:</p>

<p><div class="codeblock"><code>drush @example.com provision-deploy /var/aegir/tmp/migrate/example.com-2010-11-11.tar.gz</code></div></p>

<p>Note: if you receive an error, you might also try adding the site to your new Aegir platform (using the same platform and site name, of course). Then run the provision-deploy again.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Verify_the_Platform">3. Verify the Platform</h2>

<p>The final step is to import the site into Aegir. This is easily done by logging into the Aegir front-end and verifying the platform, which then will trigger an import task for the new site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Caveats">4. Caveats</h2>

<p>The provision-save command will assume the database server is the same as the master server and that you are not using any install profile. So if your DB lives in another server or if you are using an install profile like openatrium you will probably need to edit the file created at /var/aegir/.drush/example.com.alias.drushrc.php</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Setting_a_Non-Default_Install_Profile">5. Setting a Non-Default Install Profile</h2>

<p>If you are using a non-default install profile, you may want to specify your install profile by adding <code>--profile=profilemachinename</code> to the <code>drush provision-save</code> command above.</p>

<p>Using the example above but using an install profile for Open Atrium, the command would look like:</p>

<p><div class="codeblock"><code>drush provision-save @example.com --context_type=site --platform=@platform_d6 --profile=openatrium --uri=example.com</code></div></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/117/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-115" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/importing-single-site-manually/index.html">Importing a single site manually</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>If you already have a platform setup on Aegir with EXACTLY the same codebase as your existing site, then you don't need to transfer the entire old codebase - you can just transfer the sites/example.com directory. However, you also need to make sure any dependencies on contrib modules that your site has, are covered on the codebase or Platform that you're importing it into.</p>

<p>In general it may be considered safer/less prone to confusing errors to transfer the entire old codebase into Aegir as a whole Platform, whereby the site will be imported automatically under that Platform. You can then migrate it in Aegir to one of your existing Platforms later. See <a href="../content/importing-complete-drupal-platform/index.html">importing from a complete Drupal platform</a> for this method.</p>

<p>Also, it is much faster to just <a href="../content/importing-existing-aegir-backups/index.html">"deploy" an Aegir backup</a> than go through the manual procedure here, so you should generally follow <a href="../content/importing-existing-aegir-backups/index.html">that procedure</a> instead of the one defined here unless you have a very hairy setup.</p>

<p>To transer a site manually into Aegir, those are the steps you should follow:</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc6">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Create_the_site_database_user_and_directory"><span class="toc-number">1. </span>Create the site database, user and directory</a></li>
	<li class="toc-level-1"><a href="#Transfer_the_files"><span class="toc-number">2. </span>Transfer the files</a></li>
	<li class="toc-level-1"><a href="#Transfer_the_Database"><span class="toc-number">3. </span>Transfer the Database</a></li>
	<li class="toc-level-1"><a href="#Verify_In_Aegir"><span class="toc-number">4. </span>Verify In Aegir</a></li>
</ol>
</div>
</div>

<h2 id="Create_the_site_database_user_and_directory">1. Create the site database, user and directory</h2>

<p>In order to import the site, you need to create a database and database user for the site, along with a directory in the platform.</p>

<p>The simplest way to do this is to create an empty site in the right platform and overwrite it. Through the commandline:</p>

<p><div class="codeblock"><code>drush provision-save @example.com --context_type=site --platform=@platform_d6 --uri=example.com --db_server=@server_localhost --client_name=admin<br />drush provision-install @example.com</code></div></p>

<p>Through the UI, this can be done simply by creating a site in Create content.</p>

<p>If this is not working for some reason, you can create the mysql user and database manually using the following:</p>

<p><div class="codeblock"><code>GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, LOCK TABLES, CREATE TEMPORARY TABLES ON <code>databasename</code>.* TO &#039;databaseuser&#039;@&#039;localhost&#039; IDENTIFIED BY &#039;password&#039;;<br />CREATE DATABASE <code>databasename</code>;</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Transfer_the_files">2. Transfer the files</h2>

<p>You need to copy the <code>sites/example.com</code> directory from your old server to the new Aegir server.</p>

<p>To do this, first create a tarball of the site on the old server. Within the <code>sites/example.com</code> directory type:</p>

<p><div class="codeblock"><code>tar -zcvf example.com.tar.gz .</code></div></p>

<p>Then, on the Aegir server, you can create a directory for it in the codebase (platform) you want to put it under:</p>

<p><div class="codeblock"><code>cd /var/aegir/platforms/drupal-X.Y/sites<br />mkdir example.com<br />cd example.com<br />wget <a href="http://example.com/example.com.tar.gz<br />tar" title="http://example.com/example.com.tar.gz<br />tar">http://example.com/example.com.tar.gz<br />tar</a> -zxvf example.com.tar.gz ./files ./modules ./libraries ./themes</code></div></p>

<p>Instead of using wget you could of course use SCP or FTP to transfer the tarball onto the Aegir server.</p>

<p>In the above we assume that you have created an empty site as directed above, if not, you will also need to extract the settings.php file, so that last command should instead be simply:</p>

<p><div class="codeblock"><code>tar -zxvf example.com.tar.gz</code></div></p>

<p>Then you will need to modify the settings.php file to follow the user and database created in the first step. Again, this is not necessary if you let Aegir create the site for you.</p>

<p>Once the file is unpacked, check the ownership and group of each file by using <code>ls -al</code>. It should be either 'aegir:aegir' or 'aegir:www-data'. Change it if necessary.  In particular, files that may have been uploaded on your site via modules like imagecache, upload, Profile pics etc, may need to have their ownership changed:</p>

<p><div class="codeblock"><code>sudo chown -R aegir:www-data $platform/sites/*/files</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Transfer_the_Database">3. Transfer the Database</h2>

<p>Make a backup of the database on your old server (Backup and Migrate module is good for this, or you can use phpmyadmin or your favourite MySQL management tool. It's a good idea to truncate the cache, search and watchdog tables first to reduce the size of the database. The "Backup and Migrate" module does this for you.</p>

<p>If you are importing a site from a previous Aegir installation somewhere, such as from a backup tarball, the database.sql will already be within the tarball you unpacked. You can use this to import into a new database on your new server.</p>

<p>You can import the database with drush using the following command:</p>

<p><div class="codeblock"><code>drush @example.com sqlc &lt; database.sql</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Verify_In_Aegir">4. Verify In Aegir</h2>

<p>In the Aegir web interface click on the name of the platform you have added your site to. You can access the list of platforms via the 'Platforms' tab in the primary links menu.</p>

<p>Execute a new Verify task on this platform via the 'Verify' button in the task list.</p>

<p>Aegir will now re-verify the platform. In the process of this, it will discover your new site and spawn a new 'Import' task for the site.</p>

<p>Once it's done this (it may take a couple of cron runs to dispatch these tasks in the queue) the tasks should turn green (if not, see 'Troubleshooting' below).</p>

<p>At this point, presuming you have updated DNS or are overriding DNS via an entry in your <code>/etc/hosts</code> file to access the site via the new Aegir server, you can visit the site in a browser and check around to see that it has worked. Pay particular attention to any links in node content that pointed to paths referencing <code>/sites/community.aegirproject.org</code> if your site was not part of a multisite setup. (Drupal has a habit of storing these paths in the database, or they may have been hard-coded into nodes by users).</p>

<p>Aegir will not go through all your database and update all URLs, so some images or links may be broken. This will need to be done manually. Aegir does attempt to update paths stored in tables such as 'files' though.</p>

<p>It's a good idea to clear the caches, and you may need to get imagecache to rebuild its thumbnails if you use it.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-54.html?destination=node%2F115%23comment-form">Login</a> or <a href="../user/register/index-54.html?destination=node%2F115%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-116" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/importing-complete-drupal-platform/index.html">Importing a complete Drupal platform</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc7">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Transfer_the_codebase"><span class="toc-number">1. </span>Transfer the codebase</a></li>
	<li class="toc-level-1"><a href="#Transfer_the_Database"><span class="toc-number">2. </span>Transfer the Database</a></li>
	<li class="toc-level-1"><a href="#Setup_Platform_in_Aegir"><span class="toc-number">3. </span>Setup Platform in Aegir</a></li>
	<li class="toc-level-1"><a href="#Import_and_Verify_Sites_In_Aegir"><span class="toc-number">4. </span>Import and Verify Sites In Aegir</a></li>
	<li class="toc-level-1"><a href="#Migrate_To_Another_Platform"><span class="toc-number">5. </span>Migrate To Another Platform</a></li>
	<li class="toc-level-1"><a href="#Troubleshooting"><span class="toc-number">6. </span>Troubleshooting</a></li>
</ol>
</div>
</div>

<p>This way of importing sites is often considered the safest whereby you transfer across an entire codebase containing Drupal core, and define it as a Platform first. This makes sure you bring any dependencies, contrib modules etc, in exactly the same version and configuration that is referenced in the database for the site.</p>

<h3 id="Transfer_the_codebase">1. Transfer the codebase</h3>

<p>Create a tarball of the codebase on the old server. Within the drupal root directory type:
<code>tar -zcvf example.com.tar.gz * .htaccess</code></p>

<p>Note that we have to specify including the .htaccess because it isn't picked up by the * wildcard due to being prefixed with a full stop. <strong>It is important to bring along the .htaccess for a platform so that Aegir can consider these settings when it generates Apache configuration for this platform.</strong></p>

<p>Then, on the new server you can create a directory for it in the codebase you want to put it under:
<div class="codeblock"><code>cd /var/aegir/platforms<br />mkdir your-new-platform<br />cd your-new-platform<br />wget <a href="http://example.com/example.com.tar.gz<br />tar" title="http://example.com/example.com.tar.gz<br />tar">http://example.com/example.com.tar.gz<br />tar</a> -zxvf example.com.tar.gz</code></div></p>

<p>Instead of using wget you could of course use SCP or FTP to transfer the tarball onto the Aegir server.</p>

<p>Once the file is unpacked, check the ownership and group of each file by using <code>ls -al</code>. It should be either 'aegir:aegir' or 'aegir:www-data'. Change it if necessary. We have to assume you have basic knowledge of Linux and POSIX permissions - we can't be responsible for teaching you sysadmin skills :)</p>

<p>In particular, files that may have been uploaded on your site via modules like imagecache, upload, Profile pics etc, may need to have their ownership changed:
<code>sudo chown -R aegir $platform/sites/*/files</code></p>

<p>If your site previously resided in sites/defau1t you need to move it because Aegir ignores the default directory (it has no way of understanding what URL this would be accessed by, so it is impossible to 'manage' it). Each site needs its own directory with the correct domain in typical Drupal multisite design:</p>

<p><div class="codeblock"><code>mv sites/defau1t sites/example.com</code></div></p>

<p>If you do this, you may need to also update your filepath's stored in the files table by running the following query on your database:
<div class="codeblock"><code>UPDATE files SET filepath = REPLACE(filepath, &#039;sites/defau1t&#039;, &#039;sites/example.com&#039;);</code></div></p>

<p>There are many other places in the database that can suffer the same problem, the <code>node_revisions</code> table for example. If you have phpMyAdmin available you can easily search the entire database for 'sites/defau1t'. Select the database, then click the Search tab. Once you know which tables are affected you can run a variation of the above query to correct these records.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Transfer_the_Database">2. Transfer the Database</h3>

<p><strong>Note:  This step is not necessary if you are moving your site from one directory on your server (e.g., /var/www/html) to a newly created Aegir directory on the same server (e.g., /var/aegir).</strong></p>

<p>Make a backup of the database on your old server (Backup and Migrate module is good for this, or you can use phpmyadmin or your favourite MySQL management tool. It's a good idea to truncate the cache, search and watchdog tables first to reduce the size of the database (Backup and Migrate does this for you).</p>

<p>Aegir does not provide support for importing databases with prefixed tables so it is best to remove prefixes form the database. However, there is work to bring this support in (<a href="http://drupal.org/node/483346" title="http://drupal.org/node/483346">http://drupal.org/node/483346</a>) and a solution if you want to keep prefixes on your tables (<a href="http://drupal.org/node/483346#comment-3113516" title="http://drupal.org/node/483346#comment-3113516">http://drupal.org/node/483346#comment-3113516</a>)</p>

<p>Unlike traditional Drupal projects the database settings cannot be found in settings.php. The database credentials are stored in the Apache vhost config of the associated site. This is a security measure implemented by the Aegir project.</p>

<p>In the vhost directory on your old server, <code>/var/aegir/config/server_master/apache/vhost.d/</code>, is a vhost file for every site on your server. The contents of the file can be displayed in your terminal with the command <code>cat thenameofthefile</code>. At the top of the file you will find the credentials  needed to create a database on the new server.</p>

<p>On your new server, manually create a new database and upload the .sql file from your backup.</p>

<p>Then create the mysql user that your site accesses the database as, and grant it all permissions on that database except 'GRANT'.</p>

<p>Connect to the database on the old server:
<code>mysql -u root -p</code></p>

<p>Create the new database:
<code>create database yourdatabasename</code></p>

<p>Add the user:
<code>CREATE USER &#039;yourdatabaseuser&#039;@&#039;localhost&#039; identified by &#039;youruserpassword&#039;;</code></p>

<p>Give the necessary privileges:
<code>GRANT ALL PRIVILEGES ON yourdatabasename.* TO &#039;yourdatabaseuser&#039;@&#039;localhost&#039;;</code></p>

<p>Import the database:
<code>mysql -u yourdatabaseuser -p -h localhost yourdatabasename &lt; thenameofthedatabase.sql</code></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Setup_Platform_in_Aegir">3. Setup Platform in Aegir</h3>

<p>In the Aegir web interface click on 'Create Content' and 'Platform'. This step is often easiest when using the admin-menu on the top of your screen.</p>

<p>Enter the name you want to use for the platform (eg 'My Platform import'), and the path to the platform on the server (eg '/var/aegir/platforms/your-new-platform')</p>

<p>Click Save to submit the form, and Aegir will spawn a Verify task for this platform into the queue.</p>

<p>Once the task is complete this the task should turn green (click through to the homepage to refesh and check. If not, see 'Troubleshooting' below).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Import_and_Verify_Sites_In_Aegir">4. Import and Verify Sites In Aegir</h3>

<p>Upon completion of the above Platform verification task, Aegir will discover your new site and spawn a new 'Import' task for the site.</p>

<p>Once it's done this (it may take a couple of cron runs to dispatch these tasks in the queue) the tasks should turn green (if not, see 'Troubleshooting' below).</p>

<p>At this point, presuming you have updated DNS or are overriding DNS via an entry in your /etc/hosts file to access the site via the new Aegir server, you can visit site in a browser and check around to see that it has worked. Pay particular attention to any links in node content that pointed to paths referencing <code>/sites/community.aegirproject.org</code> if your site was not part of a multisite setup. (Drupal has a habit of storing these paths in the database, or they may have been hard-coded into nodes by users).</p>

<p>It's a good idea to clear the caches, and you may need to get imagecache to rebuild its thumbnails if you use it.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Migrate_To_Another_Platform">5. Migrate To Another Platform</h3>

<p>Now that you have your sites under Aegir's control you can take advantage of its power, and easily migrate them to another platform. In the event that your sites were on old versions of Drupal core and a new one is available and present as another Platform on your Aegir server, you can use the Migrate process to upgrade those sites onto the new core.</p>

<p>For details on how to Migrate sites, consult the <a href="../node/23/index.html">Migrate documentation</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Troubleshooting">6. Troubleshooting</h3>

<p>For those who are migrating existing sites that live with their files in the sites/community.aegirproject.org folder, things can get tricky. However, you can <a href="http://palma-seo.com/content/moving-single-drupal-install-default-directory-multi-site-drupal-installation">follow this tutorial</a> and successfully get things moved over rather easily.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/116/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-517" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/517/index.html">Setting up a test Aegir site from an existing one</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>We have <a href="../node/316/index.html">already seen</a> how to import sites in an Aegir install, but what if we want to test the "hostmaster" site itself, ie. setup a development or staging environment of an Aegir install itself?</p>

<p>This page explains how. The basic steps are:</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc8">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Installing_aegir"><span class="toc-number">1. </span>Installing aegir</a></li>
	<li class="toc-level-1"><a href="#Backup_the_production_site"><span class="toc-number">2. </span>Backup the production site</a></li>
	<li class="toc-level-1"><a href="#Deploy_the_production_site_in_staging"><span class="toc-number">3. </span>Deploy the production site in staging</a></li>
	<li class="toc-level-1"><a href="#Tweaking_the_install_for_the_staging_server"><span class="toc-number">4. </span>Tweaking the install for the staging server</a></li>
	<li class="toc-level-1"><a href="#Troubleshooting"><span class="toc-number">5. </span>Troubleshooting</a></li>
</ol>
</div>
</div>

<h1 id="Installing_aegir">1. Installing aegir</h1>

<p>The first step should be fairly simple and intuitive if you got that far: you have to <a href="../installing/index.html">install aegir itself</a> on the staging server. You should install the specific version that is currently in production.</p>

<p>Maybe that also involves <a href="../uninstalling/index.html">uninstalling the existing install</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Backup_the_production_site">2. Backup the production site</h1>

<p>Run a backup on the production site, on the production server. This can be done in the frontend or in the backend using:</p>

<p><div class="codeblock"><code>drush @hostmaster provision-backup</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Deploy_the_production_site_in_staging">3. Deploy the production site in staging</h1>

<p>Copy the resulting backup to the staging server. Then you should be able to deploy it with the following command:</p>

<p><div class="codeblock"><code>drush @hostmaster provision-deploy --old_uri=aegir.koumbit.net /home/anarcat/aegir.koumbit.net-20110326.161420.tar.gz --debug</code></div></p>

<p>In this case, we use deploy to also rename the site (<code>--old_uri=aegir.koumbit.net</code>).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Tweaking_the_install_for_the_staging_server">4. Tweaking the install for the staging server</h1>

<p>The environment on the staging server could be <em>very</em> different from the production server. The server name will be different, maybe there will not be a dedicated mysql server, platforms will not exist, etc.</p>

<p>It is recommended to review the "Servers" page to change the domain names to the staging environment. In Koumbit's case, this means:</p>

<ol>
<li>editing the master server to change the hostname and IPs</li>
<li>renaming the DB server to "localhost" and changing the database credentials</li>
<li>renaming the main hostmaster site:
<div class="codeblock"><code>drush @hostmaster sqlq &quot;UPDATE node n JOIN hosting_context h ON h.nid = n.nid SET n.title=&#039;hostmaster.koumbit.net&#039; WHERE name=&#039;hostmaster&#039;;&quot;<br />drush @hostmaster sqlq &quot;UPDATE node_revisions nr JOIN hosting_context h ON h.nid = nr.nid JOIN node n ON n.vid = nr.vid SET nr.title=&#039;hostmaster.koumbit.net&#039; WHERE h.name=&#039;hostmaster&#039;;&quot;</code></div></li>
<li>change the sites to point to the good web and db servers:
<div class="codeblock"><code>UPDATE hosting_site SET db_server=3631 WHERE db_server &lt;&gt; 3631;<br />UPDATE hosting_platform SET web_server = 3 WHERE web_server &lt;&gt; 3;</code></div></li>
</ol>

<p>Note that this will have the added benefit of reverifying all platforms and therefore create them if they are makefile-based.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Troubleshooting">5. Troubleshooting</h1>

<p>I had weird issues with failing to run updatedb on the hostmaster site (while deploying to another alias would work). My workaround was to suspend the process right before it would run drush updatedb, then run updatedb manually, twice:</p>

<p><div class="codeblock"><code>drush @hostmaster updatedb<br />drush @hostmaster cc all<br />drush @hostmaster updatedb</code></div></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-55.html?destination=node%2F517%23comment-form">Login</a> or <a href="../user/register/index-55.html?destination=node%2F517%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-426" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/426/index.html">Troubleshooting creating a platform or importing sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>First things to check:</p>

<p>Does the aegir user have proper permissions?</p>

<pre>
sudo chown aegir -R PLATFORM/sites/yoursite
</pre>

<p>Is the database properly set up?
Try drush sql-cli to see if the site db user has access and if there are tables (try SHOW TABLES).</p>

<p>If something goes wrong with importing a site you might end up with a node for a non-working site.  In such a case it can be good to delete the node for this non-working site and verify the underlying platform again.  Since there is no direct way to delete such a node from the user interface you have change the URL from node/NUMBER/edit into node/NUMBER/delete to do this.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-56.html?destination=node%2F426%23comment-form">Login</a> or <a href="../user/register/index-56.html?destination=node%2F426%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-30" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/30/index.html">Remote servers (multiserver)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir supports multiple 'server' entities. These servers have 'services' such as 'Web' or 'Database', and 'service types' which are implementations of that service, such as 'Apache' or 'MySQL'.</p>

<p>Some previous experience in the configuration of Apache and MySQL will help if you want to use remote servers with Aegir. If you haven't had any experience in setting up and maintaining Apache or MySQL before you might want get familiar with the basic concepts first.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc9">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Remote_web_servers"><span class="toc-number">1. </span>Remote web servers</a>
<ol>
	<li class="toc-level-2"><a href="#System_dependencies"><span class="toc-number">1.1. </span>System dependencies</a></li>
	<li class="toc-level-2"><a href="#Aegir_user"><span class="toc-number">1.2. </span>Aegir user</a></li>
	<li class="toc-level-2"><a href="#Web_server_configuration"><span class="toc-number">1.3. </span>Web server configuration</a></li>
	<li class="toc-level-2"><a href="#Sudoers"><span class="toc-number">1.4. </span>Sudoers</a></li>
	<li class="toc-level-2"><a href="#Login_shell"><span class="toc-number">1.5. </span>Login shell</a></li>
	<li class="toc-level-2"><a href="#MySQL_access"><span class="toc-number">1.6. </span>MySQL access</a></li>
	<li class="toc-level-2"><a href="#SSH_keys"><span class="toc-number">1.7. </span>SSH keys</a></li>
	<li class="toc-level-2"><a href="#Verify_the_server"><span class="toc-number">1.8. </span>Verify the server</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="Remote_web_servers">1. Remote web servers</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="System_dependencies">1.1. System dependencies</h2>

<p>On the remote server, install these packages</p>

<p><div class="codeblock"><code>&nbsp; apt-get install rsync apache2 php5 php5-cli php5-mysql postfix mysql-client sudo</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Aegir_user">1.2. Aegir user</h2>

<p>Any number of remote web servers may be configured. The remote server needs an aegir user created on the system.</p>

<p><div class="codeblock"><code> adduser --system --group --home /var/aegir aegir<br /> adduser aegir www-data&nbsp;&nbsp;&nbsp; #make aegir a user of group www-data</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Web_server_configuration">1.3. Web server configuration</h2>

<p>You'll also need to prepare the web server in the same way you did for the master Aegir server during installation:</p>

<p><div class="codeblock"><code> a2enmod rewrite<br /> ln -s /var/aegir/config/apache.conf /etc/apache2/conf.d/aegir.conf</code></div></p>

<p>Don't restart Apache even when it prompts you. This will be done by the Verify task you'll spawn for the server from the Aegir frontend later.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Sudoers">1.4. Sudoers</h2>

<p>Add the aegir user to sudoers so it can restart Apache (e.g. sudo visudo -f /etc/sudoers.d/aegir):</p>

<p><div class="codeblock"><code>aegir ALL=NOPASSWD: /usr/sbin/apache2ctl</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Login_shell">1.5. Login shell</h2>

<p>The remote aegir user will also need a login shell, which can be modified using the <code>chsh</code> command.</p>

<p><div class="codeblock"><code>chsh -s /bin/sh aegir</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="MySQL_access">1.6. MySQL access</h2>

<p>Aegir connects directly to the remote server's MySQL to create databases and users. Therefore, you need to log into MySQL in the remote server as root and create a user with the following command:
<div class="codeblock"><code>GRANT ALL PRIVILEGES ON &#42;.&#42; TO root@aegir_server_ip IDENTIFIED BY &#039;password&#039; WITH GRANT OPTION;<br />FLUSH PRIVILEGES;</code></div></p>

<p>Where</p>

<p><UL>
<LI>'root' is the username on the Aegir server that will be connecting. Leave 'root';
</li><LI>'aegir_server_ip' is the IP address of your Aegir server. For example '123.123.123.123';
</li><LI>'password' is the password that will be used by your Aegir 'root' user to connect to the remote server's MySQL to create databases and users. It is suggested to store that password in a secure location. To increase security, it is recommended to choose a password with 6 to 16 alphanumeric and or punctuation characters.
</li></ul></p>

<p>If MySQL returns something like "Query OK", that means the command was successful. For example:</p>

<blockquote>
<code>Query OK, 0 rows affected (0.00 sec)</code>
</blockquote>

<p>Note the comment about "bind-address    = 127.0.0.1" on <a href="../installing/manual/index.html#Database_configuration" title="http://community.aegirproject.org/installing/manual#Database_configuration">http://community.aegirproject.org/installing/manual#Database_configuration</a></p>

<p>When the server is being verified, Aegir will attempt to create a database and grant privileges to a user for that database. If any of these two fails, <a href="http://www.ghacks.net/2009/12/27/allow-remote-connections-to-your-mysql-server/" target="_blank">verify that your MySQL configuration is correct</a> and that there is no firewall blocking your MySQL port.</p>

<p>You can confirm that MySQL is configured correctly on the remote server by manually connecting from the command line on your Aegir machine:</p>

<p><div class="codeblock"><code>[aegir@aegir_box:~]$ mysql -h &lt;mysql_server_IP&gt; -u root -p</code></div></p>

<p>If your MySql database is running on the same server as the Aegir master and is configured with the name "localhost", you may run an issue where the remote web server tries to access MySql via a local socket rather than the hostname. To resolve this, just change the server hostname for the MySql server in Aegir from "localhost" to the hostname of the server.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="SSH_keys">1.7. SSH keys</h2>

<p>SSH public/private keys should be set up so the main Aegir server's aegir user can access remote web aegir users with no passwords required.</p>

<p>Example: on main Aegir server:</p>

<p><div class="codeblock"><code>ssh-keygen -t rsa<br />(follow prompts)</code></div></p>

<p><strong>Do not</strong> use a passphrase when you create your key.  Simply press Enter to leave the passphrase blank.  Otherwise, SSH will insist that you enter the passphrase everytime you try to SSH using the key.  We don't want SSH to present any prompts.</p>

<p>Put the public key's contents into <code>/var/aegir/.ssh/authorized_keys</code> on the remote web server.  The easiest way to do this is to use the ssh-copy-id command.</p>

<p>You should manually login for the first time from your Aegir master server to your remote server as the aegir user, so that the remote web server is added to the known_hosts file in /var/aegir/.ssh on your Aegir master server. <strong>Verifying the remote webserver will fail until this has been done.</strong></p>

<p>You can confirm that SSH is set up correctly by manually connecting from your aegirmaster server to your remote server as aegir@ user to aegir@ user:
<div class="codeblock"><code>[aegir@aegirmaster:~]$ ssh aegir@&lt;remoteserver&gt;</code></div>
This should directly log you into the remote shell command line without any additional keys pressed.
<div class="codeblock"><code>[...]<br />[aegir@&lt;remoteserver&gt;:~]$</code></div></p>

<p>There are many, many tutorials online for setting up ssh keys, and various mistakes can be made by inexperienced users such as permissions etc. Aegir isn't a 'Linux beginner's practice tool', so setting these up is really out of the scope of this document and users are encouraged to research this on their own.  (For Ubuntu, see <a href="http://help.ubuntu.com/community/SSH/OpenSSH/Keys" title="Ubuntu guide to SSH keys">this article</a>).</p>

<p>If you have followed the instructions above, and your SSH connection gets closed immediately after you try to connect to the remote server as the aegir user, you may not have given the aegir user a shell correctly.  Check the /etc/passwd file on the remote server to make sure that the aegir user has a shell.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Verify_the_server">1.8. Verify the server</h2>

<p>Now you can add a new server node in Aegir, set the hostname and/or IP and set the service type to be 'Apache' (or Apache_SSL if this site is to handle SSL sites).</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/server/index.png" /></div>

<p>A verify task will be spawned and added to the Task queue ready for dispatching. During a server verification task, various configurations will be set on the Aegir master server and also synced to the remote web server, restarting Apache.</p>

<p>Now when you add a new Platform node in Aegir, you have the option of setting which web server to host it on. If you are not using a makefile but are downloading a platform manually, you must still do this on the main Aegir server. The contents will then be synced across to the web server.</p>

<p>You don't choose a web server when installing a new site. Because a site depends on a platform, its web server is implied by which platform has been chosen.  In other words, all sites on a platform are hosted on the same server.  You cannot host two sites on the same platform on different servers.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script><div class="itu-attachments"><table class="itu-attachment-list withoutstats sticky-enabled" id="attachments">
 <thead><tr><th class="preview">Preview</th><th class="file">Attachment</th><th class="size">Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td class="mime mime-png"><div  class="form-item" id="">
    <div class="itu-attachment-thumb"><a href="../sites/community.aegirproject.org/files/sudoers/index.png" title="sudoers.png"><img src="../sites/community.aegirproject.org/files/imagecache/AttachmentThumbnail/sudoers/index.png" alt="sudoers.png" title="sudoers.png" width="60" height="60" class="imagecache imagecache-AttachmentThumbnail"/></a></div>  </div>
</td><td class="file"><a href="../sites/community.aegirproject.org/files/sudoers/index.png">sudoers.png</a></td><td class="size">68.03 KB</td> </tr>
</tbody>
</table>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/30/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-396" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/396/index.html">Remote webserver configuration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Any number of remote web servers may be configured. They need an <a href="../installing/manual/index.html#Create_the_Aegir_user">aegir user</a> and webserver configuration, with the same user name and directory paths. SSH public/private keys should be set up so hostmaster's Aegir user can access remote web Aegir users with no passwords. The above Apache configuration needs to be performed too.</p>

<p>Additionally, the remote web server needs the 'mysql' client binary installed so that Aegir can test that it can successfully connect to the database server. On (at least) Debian-based systems, this can be installed via the 'mysql-client' package.</p>

<p>They will also need a login shell, which can be modified using the <code>chsh</code> command.</p>

<p>Shell commands as root::</p>

<pre><code>apt-get install mysql-client
adduser --system --group --home /var/aegir aegir
adduser aegir www-data    #make aegir a user of group www-data
chsh -s /bin/sh aegir
apt-get install rsync apache2 php5 php5-cli php5-mysql
mkdir /var/aegir/.ssh
cat &gt; /var/aegir/.ssh/authorized_keys &lt;&lt;EOF
ssh-rsa AAAAB3NzaC1yc2EAAAADAQAB...UF aegir@filer01
EOF
chown aegir:aegir /var/aegir/.ssh -R
chmod 750 /var/aegir/.ssh
chmod 640 /var/aegir/.ssh/authorized_keys
a2enmod rewrite
ln -s /var/aegir/config/apache.conf /etc/apache2/conf.d/aegir.conf
cat &gt; /etc/sudoers.d/aegir &lt;&lt;EOF
Defaults:aegir  !requiretty
aegir ALL=NOPASSWD: /usr/sbin/apache2ctl
EOF
chmod 440 /etc/sudoers.d/aegir
</code></pre>

<p>For clusters, use the aegir-cluster-slave package to operate the above and NFS mounts for you. See also <a href="../content/web-clusters/index.html">web cluster configuration documentation</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-57.html?destination=node%2F396%23comment-form">Login</a> or <a href="../user/register/index-57.html?destination=node%2F396%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-446" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/446/index.html">Adding a platform on a remote web server</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_119 first"><a href="../category/keywords/add-platform/index.html" rel="tag" title="">add platform</a></li>
<li class="taxonomy_term_120 last"><a href="../category/keywords/remote-server/index.html" rel="tag" title="">remote server</a></li>
</ul></div><p>Especially if you have been using Aegir for a while simply because it handles updates, moving to new releases, cloning, aliases and everything Drupal with such elegance on a single server - you might not be entirely clear on what changes when you make the move to multiple servers.  Hopefully this will help.</p>

<h2>Understanding the process</h2>

<p>Multiple servers are great even if you do not have to manage a server farm.  Having a server for development that you are free to break, one for testing that you hope will not break, one for approvals so your clients can go to see how their "real" website will look, and one for production that serves the daily grind of live sites is a wonderful thing.  This DTAP (Development, Testing, Acceptance, and Production) structure works and it is surprisingly easy to accomplish under Aegir.</p>

<p>If you are managing a farm, creating massive numbers of servers is quick and easy with Aegir - especially if you use virtual machines like Xen where a server image can be cloned or generated using LVM disks that can be migrated (even while running) to other physical machines.</p>

<p>When it is time break out an Aegir master controller and remote slaves you have to remember that Aegir is the place that it (almost) all happens.  Everything is stored in Aegir - including your remote platforms and your sites - and then distributed to the slave servers by Aegir in the Verify process.</p>

<p>Remember too that sites reside on platforms, and platforms reside on servers.  You are turning your Aegir install into an Aegir Master as the hub, and the Aeger Remote Slaves as the spokes.  To move into this "hub and spoke" architecture, you must build the remote server, tell the Aegir Master about that server and verify it, install a Drupal platform for that server on the Aegir Master and finally tell the Aegir Master about that Drupal install and verify that.  You then create the sites on the platform you want based upon the install profile you select for that site.  Need more?  How about an example:</p>

<h2>The mechanics</h2>

<p>(1) Build a server image on your network to become your Aegir Slave.  This can be anything from a separate headless server to a Virtual Machine image on physical machine with a dozen other Virtual Machines on it.  As long as it has its own IP and is capable of running a Drupal image, it will work.</p>

<p>(2) Ensure that your new server image is resolved in your DNS by adding it to your zone files and incrementing the serial number in the zone file.  Aegir can manage that for you now to some extent, but you might want to wait until that feature leaves the experimental status.  Make sure the entries in /etc/hostname and /etc/hosts all match your zone files (including reverse DNS).  Reload/restart the DNS server.  Any DNS slaves should automatically get notified and the incremented serial number should make sure they reload automatically.  Test the resolution and ping the new Aegir Slave server image from the Aegir Master to Ensure that the IPs all resolved properly.</p>

<p>(2) Follow the steps in the Aegir Handbook page at <a href="../node/30/index.html" title="http://community.aegirproject.org/node/30">http://community.aegirproject.org/node/30</a> carefully.  You should be able to use cut and paste if you are using Debian Stable or the like.  In any case, you will need those packages.  You do not need Aegir on the slave, but you do need the aegir user and that user must have a shell.  I prefer the bash shell, but the sh shell in the instructions will do.</p>

<p>(3) You need to have the "passphraseless" ssh working and proven before you continue.  A web search on the terms "passphraseless ssh" plus your operating system will generally get you great instructions, but putting those instructions here for every possible combination is beyond the scope of this example.  In terms of helpful hints, however, you do not need to have a password for the aegir user on the Aegir Slave.  Your access will be this certificate.  By simply hitting enter when it asks for the passphrase, you make the certificate passphraseless.  You should carefully set the permissions and back these certificates up to a secure location.  You MUST log in manually from the Aegir Master to the Aegir Slave the first time or your verify will fail.  This is because the system has to add the ssh keys to the known hosts and it will ask about about it before it will allow the connection.  Aegir nows nothing about this and will not answer, so the verify will fail.  To be absolutely sure it works, after exiting the initial login, you should retry the login to verify it does not ask for a password and then exit the login and try an rsync (which is the process by which the Aegir Master controls the Aegir Slaves).  All of these commands should work from the Aegir Master to the new Aegir Slave while logged into the Aegir Master as the aegir user with no request for a password, proving that the systems are exchanging keys (do not proceed until you can do this flawlessly without having to enter a response):</p>

<p><div class="codeblock"><code>##&nbsp; Start from the Aegir Master as the aegir user<br /># Log in to the slave from the Aegir Master and exit without any password or reply required<br />ssh slavename.example.com<br />exit<br /># Create a test file for rsync<br />echo &#039;rsync test file&#039; &gt; MyRsyncTest<br /># Send the test file to the remote slave by name using rsync<br />rsync -azvv /var/aegir/MyRsyncTest aegir@slavename.example.com:/var/aegir<br /># Log back into the remote slave<br />ssh slavename.example.com<br /># Make sure the file is there and readable<br />cat /var/aegir/MyRsyncTest<br /># Delete the test file from the remote slave<br />rm /var/aegir/MyRsyncTest<br /># Exit the ssh login session on the remote<br />exit<br /># Delete the test file on the Aegir Master<br />rm /var/aegir/MyRsyncTest</code></div></p>

<p>(4) Go to Add Content/Server and put in the server name, leave the Database set as None (Your sites will use the Aegir Master database and none is required on the Remote Slave) and under Web select apache or apache ssl (to match the example) then click Save. After the process completes you should see that it found the IP address properly on its own, plugged it in all by itself and then Verify quite nicely. If you look on the Aegir Slave remote server you will see that you now have directories named config and platform.</p>

<p>(5) Now that hard decision for platform choice comes in play.  My preference is a Drupal install that is the same release as the Aegir Master server or higher.  Since sites are eventually destined to be Drupal 7 one day, and the Aegir system is not Drupal 7 ready as of this writing but heading that direction, making at least one Drupal 7 slave is a good idea so that you can migrate sites to that platform as they are ready.  If you are migrating sites off of your existing Aegir and onto slaves, migrating to platforms of the same Drupal version makes that process much easier.  In any case, firm up your decision about which Drupal version you want to install on your new Aegir Slave Platform.</p>

<p>(6) Time to create that platform.  The big thing here is to do it right the first time and make certain that the name of the platform is unique to any platform on your Aegir Master server.  If you look in your /var/aegir directory you will notice that Aegir has its own naming convention.  For instance, you should see /var/aegir/hostmaster-0.4-rc1 as the platform for the Aegir 0.4 release candidate 1.  You need to consider doing the same.  For instance, name your platform something like: /var/aegir/slavename-drupal-version and you will make it easier to distinguish which server the platform resides upon and the drupal version so that you can manage updates and migrations more easily.  Make certain that you are not destroying one platform when creating another.  Be aware that at some point Aegir started organizing platforms into a separate directory: /var/aegir/platforms and you should change to that structure if you have an older original install.  Again, be careful you are not overwriting an existing install when you create the new one.  For instance, if you already have a Drupal install in /var/aegir/platforms/drupal-7.14 the code below will attempt to recreate it on top of the existing install.  If you are using a Makefile, be sure that the same problem does not occur in that makefile.  To create a Drupal 7 Aegir Remote Slave Platform, log into the Aegir Master as the aegir user and run this simple code (of course edit it to match the platform and name you want to create:
<div class="codeblock"><code># Make sure you are in the proper directory<br />cd /var/aegir/platforms<br /># Install Drupal 7.14<br />drush/drush.php dl drupal-7.14<br /># Rename the platform to your own naming convention<br />mv /var/aegir/platforms/drupal-7.14 /var/aegir/platforms/slavename-drupal-7.14</code></div></p>

<p>(7) The final step in creating this platform is to actually tell the Aegir Master about it so that it can distribute it (via rsync) to the new Aegir Remote Slave.  Simple enough.  Just go to Create Content/Platform and the Create Platform screen comes up.  Under Name write something descriptive and unique.  In the example so far, this will be something like 'slavename Drupal 7.14' or in some way adhere to your chosen naming convention.  I use the directory name I created above since that serves two purposes.  Under Publish Path you will put the path that holds this Drupal distribution.  In the example above that will be /var/aegir/platforms/slavename-drupal-7.14 but the path will be reflected from the Aegir Master to the Aegir Slave and will be the same on both.  If you are using a Makefile you need to enter the full path and name of that Makefile here as well, but the creation and use of the Makefile is beyond the scope of this example.  Lastly choose the server that this platform will reside upon.  When you are finished, double check the screen and then click on Save.  The Verify step should execute flawlessly and when it does, your Aegir Remote Slave will be complete and ready to accept sites.</p>

<p>(8) Lather, rinse and repeat for each Aegir Remote Slave.</p>

<h2>Creating sites on the remote</h2>

<p>The only difference you will notice when creating a new site under Aegir will be the choice of platform.  The Create Site screen is quite self explanatory, but the main thing is to select the Install Profile that you  require and then the list of Platforms that support that install profile will be populated.</p>

<p>As usual, Aegir makes it all faster and easier than you expect.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/446/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-37" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/web-clusters/index.html">Web clusters</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h1>Cluster module</h1>

<p>The cluster module is a simplified solution for maintaining platforms across multiple web servers.  A cluster server node does not require a physical machine to be present on the network.  Simply create web servers as usual and create a server node that has "Cluster" selected under the web field set of the server node add form.  Select the servers that should be part of the new web cluster by clicking the check box next to each web server in the "Servers" section.</p>

<p>The cluster module will rsync the platforms between each web server and keep them up to date.</p>

<h1>Pack module</h1>

<p>A Pack consists of a single server node that is specified as "pack" and any number of server nodes specified as "apache" or "nginx".  The main difference between the Pack functionality and Web Cluster functionality is that Aegir rsync's configuration (Apache &amp; Nginx) to "all" nodes in the Pack and rysnc's the platform and site code to only the "master" node in the Pack.  All other "slave" nodes will see the platform and site code via NFS.</p>

<p><strong>Configuring the Pack server node:</strong></p>

<p>The "pack" server node will not be used by Aegir to physically deploy sites or platforms on, so consider it more of a 'virtual server group' for logistical purposes only.  When creating the pack node, you do not need to supply a valid Server hostname or IP address, so choose a naming convention that makes sense in your environment.</p>

<p>Next, select the "pack" radio button option under the web configuration when creating or editing the server node, in order to designate this server node as the "pack" server.</p>

<p>Now select the "Master" server from the list of Master servers.  The Master server will be the server node that Aegir rsync's the platform and site to. Typically, you would choose the Aegir server itself as the 'master'.</p>

<p>Finally, select the "Slave" servers from the list of Slave servers.  The Slave servers will have the Apache or Nginx config rsync'd to them but not the platform or site code, since those will be available to all Slave servers via the NFS share.</p>

<p><strong>Configuring the Web server nodes (Master and Slaves):</strong></p>

<p>Configure all web server nodes using <a href="../node/396/index.html">these instructions</a>. Take care to ensure the 'aegir' user and group on your NFS client machines, have the same UID/GID as that of the NFS server, or else you may run into permissions issues with NFS.</p>

<p>Then mount the files on the remote server.</p>

<p>On the NFS server:</p>

<pre><code>sudo apt-get install nfs-kernel-server
echo "/var/aegir/platforms    10.0.0.0/24(rw,no_subtree_check)" &gt;&gt; /etc/exports
sudo service nfs-kernel-server reload
</code></pre>

<p>(Replace the subnet here or add specific /32 hosts as necessary for your environment)</p>

<p>Then on the web servers (Master, if it wasn't also the NFS server, and the Slaves):</p>

<pre><code>sudo apt-get install nfs-client
sudo mount 10.0.0.1:/var/aegir/platforms /var/aegir/platforms
</code></pre>

<p>(Replace the NFS server's IP here with that of your master server/Aegir server)</p>

<p>Add this to your fstab on the servers that mount the NFS share, so that the share is mounted on boot:</p>

<pre><code>10.0.0.1:/var/aegir/platforms /var/aegir/platforms nfs rw 0 0
</code></pre>

<p><strong>Creating a Platform on a Pack:</strong></p>

<p>When configuring a Platform to be deployed on a Pack, choose the "Pack" server node from the Web server radio group during the Platform node creation. Then you choose this Platform as usual when adding a site, and that site will be served from any servers within the Pack.</p>

<p><strong>Caveats</strong></p>

<p>Relying on an NFS share to serve your entire /var/aegir/platforms can be a single point of failure if the NFS share becomes unavailable. You may want to look into providing some sort of failover for NFS (google for things like DRBD and Heartbeat), or using some other form of redundancy for your NFS (Netapp filer clusters etc)</p>

<p>There have also been reports of issues with MySQL GRANT statements not being provided to all webservers in the pack - especially where the master server is <em>not</em> the Aegir hostmaster server. This issue is ongoing - see the Talk page here or <a href="http://drupal.org/node/1555398">this ticket</a></p>

<p>Also attached is an example diagram of a Pack cluster known to be functioning in production (with an optional MySQL-MMM cluster out of scope for this documentation), which may help you visualise the Pack and how it can be put together.</p><div class="itu-attachments"><table class="itu-attachment-list withoutstats sticky-enabled" id="attachments">
 <thead><tr><th class="preview">Preview</th><th class="file">Attachment</th><th class="size">Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td class="mime mime-png"><div  class="form-item" id="">
    <div class="itu-attachment-thumb"><a href="../sites/community.aegirproject.org/files/aegir_pack/index.png" title="aegir_pack.png"><img src="../sites/community.aegirproject.org/files/imagecache/AttachmentThumbnail/aegir_pack/index.png" alt="aegir_pack.png" title="aegir_pack.png" width="60" height="60" class="imagecache imagecache-AttachmentThumbnail"/></a></div>  </div>
</td><td class="file"><a href="../sites/community.aegirproject.org/files/aegir_pack/index.png">aegir_pack.png</a></td><td class="size">41.2 KB</td> </tr>
</tbody>
</table>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/37/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-388" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/388/index.html">Setting Up Varnish &amp; Memcache with Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first last"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
</ul></div><p>I had the hardest time finding resources &amp; documentation on how to get this configured properly so I am adding this to the documentation for those of you who may need it.</p>

<p>A couple of notes:
I am using Ubuntu 10.04 LTS.
I set my apache to port 8082 because there was a conflict on port 8080 on my system.
You should make a copy of each file before editing it.
Memcache settings are drupal 7.</p>

<h2>Varnish</h2>

<p>Setting up varnish isn't too hard but it could end up being kind of tedious if you configure something incorrectly &amp; you have alot of sites.</p>

<p>First you install it
<code>sudo apt-get install varnish</code></p>

<p>Then you have to go to configure it. I use vim.
<code>sudo vim /etc/varnish/default.vcl</code></p>

<p>These are my settings.</p>

<pre>
backend default {
    .host = "127.0.0.1";
    .port = "8082";
    .connect_timeout = 600s;
    .first_byte_timeout = 600s;
    .between_bytes_timeout = 600s;
}
sub vcl_recv {
  // Remove has_js and Google Analytics __* cookies.
  set req.http.Cookie = regsuball(req.http.Cookie, "(^|;\s*)(__[a-z]+|has_js)=[^;]*", "");
  // Remove a ";" prefix, if present.
  set req.http.Cookie = regsub(req.http.Cookie, "^;\s*", "");
  // Remove empty cookies.
  if (req.http.Cookie ~ "^\s*$") {
    unset req.http.Cookie;
  }
 

// Skip the Varnish cache for install, update, and cron
  if (req.url ~ "install\.php|update\.php|cron\.php") {
    return (pass);
  }
 

// Cache all requests by default, overriding the
  // standard Varnish behavior.
  // if (req.request == "GET" || req.request == "HEAD") {
  //   return (lookup);
  // }
}
sub vcl_hash {
  if (req.http.Cookie) {
    set req.hash += req.http.Cookie;
  }
}

</pre>

<p>Now you have to edit /etc/default/varnish
<code>sudo vim /etc/default/varnish</code></p>

<p>Here are my settings</p>

<pre>
# Should we start varnishd at boot?  Set to "yes" to enable.
START=yes
# Maximum number of open files (for ulimit -n)
NFILES=$(ulimit -n)
#Malloc size depend on your memory server
DAEMON_OPTS="-a :80 \
             -T localhost:6082 \
             -f /etc/varnish/default.vcl \
             -S /etc/varnish/secret \
             -s malloc,512M \
             -u www-data \
             -g www-data"
</pre>

<p>Now we have to configure apache's listening ports</p>

<p><code>sudo vim /etc/apache2/ports.conf</code></p>

<p>change</p>

<pre>
NameVirtualHost *:80
Listen 80
</pre>

<p>So that it looks like this</p>

<pre>
NameVirtualHost *:8082
Listen 8082
</pre>

<p>Start varnish
<code>services varnish start</code></p>

<p>Now login to aegir
Edit your server &amp; change the port from 80 to 8082</p>

<p>Aegir will re-verify the server, as well as all platforms &amp; sites on the server.</p>

<p>If that doesnt work, you need to go to 
/var/aegir/config/server_master/apache/vhost.d 
and edit all of your virtual hosts so that the port shows 8082 instead of 80
then do the same thing with
/var/aegir/config/server_master/apache.conf
Reverify your server.</p>

<p>Now add this to the local.settings.php of the sites that you want to leverage varnish</p>

<pre>
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000"># Tell Drupal it's behind a proxy<br /></span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'reverse_proxy'</span><span style="color: #007700">] = </span><span style="color: #0000BB">TRUE</span><span style="color: #007700">;<br /></span><span style="color: #FF8000"># Tell Drupal what addresses the proxy server(s) use<br /></span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'reverse_proxy_addresses'</span><span style="color: #007700">] = array(</span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">,</span><span style="color: #DD0000">'your-ip-address-here'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000"># Bypass Drupal bootstrap for anonymous users so that Drupal sets max-age &amp;gt; 0<br /></span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_cache_invoke_hooks'</span><span style="color: #007700">] = </span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
</pre>

<h2>Memcache</h2>

<p>There is hardly any current documentation for setting up memcache on D7, especially not for aegir.</p>

<p>FIrst you install memcache &amp; its dependencies
Download &amp; install memcache module into the platform of the site/sites in which you will be using memcache</p>

<p>Then you have to edit 
/etc/default/memcached
<code>sudo vim ./etc/init.d/memcached</code></p>

<p>Here are my settings</p>

<pre>
#! /bin/sh
#

PORT=11211
USER=nobody
MAXCONN=1024
OPTIONS=""
DAEMON=/usr/bin/memcached

RETVAL=0
prog="memcached"

start_instance() {
        echo -n $"Starting $prog ($1): "
        start-stop-daemon --start --quiet --pidfile /var/run/memcached/memcached.$1.pid --exec $DAEMON -- -d -p $PORT -u $USER  -m $2 -c $MAXCONN -P /var/run/memcached/memcached.$1.pid $OPTIONS
        RETVAL=$?
        echo
        [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/memcached.$1
        PORT=`expr $PORT + 1`
}

stop_instance() {
        echo -n $"Stopping $prog ($1): "
        start-stop-daemon --stop --quiet --oknodo --pidfile /var/run/memcached/memcached.$1.pid --exec $DAEMON 
        RETVAL=$?
        echo
        if [ $RETVAL -eq 0 ] ; then
            rm -f /var/lock/memcached.$1
            rm -f /var/run/memcached/memcached.$1.pid
        fi
}
start () {
        # insure that /var/run/memcached has proper permissions
        mkdir -p /var/run/memcached
        if [ "`stat -c %U /var/run/memcached`" != "$USER" ]; then
                chown $USER /var/run/memcached
        fi

        start_instance default 64;
        start_instance block 16;
        start_instance content 128;
        start_instance filter 128;
        start_instance form 32;
        start_instance menu 16;
        start_instance page 8;
        start_instance update 8;
        start_instance views 8;
        start_instance path 8;
        start_instance field 8;
        start_instance rules 8;
        start_instance token 8;
        start_instance image 8;
        start_instance apachesolr 16;
}
stop () {
        stop_instance default;
        stop_instance block;
        stop_instance content;
        stop_instance filter;
        stop_instance form;
        stop_instance menu;
        stop_instance page;
        stop_instance update;
        stop_instance views;
        stop_instance path;
        stop_instance field;
        stop_instance rules;
        stop_instance token;
        stop_instance image;
        stop_instance apachesolr;
}

restart () {
        stop
        start
}

# See how we were called.
case "$1" in
  start)
        start
        ;;
  stop)
        stop
        ;;
  status)
        status memcached
        ;;
  restart|reload|force-reload)
        restart
        ;;
  *)
        echo $"Usage: $0 {start|stop|status|restart|reload|force-reload}"
        exit 1
esac

exit $?
</pre>

<p>Start memcache
<code>sudo services memcached start</code>
If you see errors u may have an issue where a one line got split into two lines.
Check and make sure that none of your lines got broken off.</p>

<p>Place this code in your local.settings.php file inside your site folder</p>

<pre>
// the path to the core cache file
  include_once('./includes/cache.inc');
  // the path to the memcache cache file
  include_once('./sites/all/modules/memcache/memcache.inc');
  // make MemCacheDrupal the default cache class
  $conf['cache_default_class'] = 'MemCacheDrupal';
  
  # Key Prefix: edit this for multisite use.
  $conf['memcache_key_prefix'] = "$_SERVER[db_user]";
  
  $conf['memcache_servers'] = array(
  '127.0.0.1:11211' =&gt; 'default',
  '127.0.0.1:11212' =&gt; 'menu',
  '127.0.0.1:11213' =&gt; 'filter',
  '127.0.0.1:11214' =&gt; 'form',
  '127.0.0.1:11215' =&gt; 'block',
  '127.0.0.1:11216' =&gt; 'update',
  '127.0.0.1:11217' =&gt; 'views',
  '127.0.0.1:11218' =&gt; 'content',
  '127.0.0.1:11219' =&gt; 'apachesolr',
  '127.0.0.1:11220' =&gt; 'path',
  '127.0.0.1:11221' =&gt; 'field',
  '127.0.0.1:11222' =&gt; 'rules',
  '127.0.0.1:11223' =&gt; 'token',
  '127.0.0.1:11224' =&gt; 'image',    
);
$conf['memcache_bins'] = array(
  'cache' =&gt; 'default',
  'cache_menu'   =&gt; 'menu',
  'cache_filter' =&gt; 'filter',
  'cache_form'   =&gt; 'form',
  'cache_block'  =&gt; 'block',
  'cache_update' =&gt; 'update',
  'cache_views'  =&gt; 'views',
  'cache_views_data'  =&gt; 'views',
  'cache_content'  =&gt; 'content',
  'cache_apachesolr'  =&gt; 'apachesolr',
  'cache_path'  =&gt; 'path',
  'cache_field'  =&gt; 'field',
  'cache_rules'  =&gt; 'rules',
  'cache_token'  =&gt; 'token',
  'cache_image'  =&gt; 'image',
);
</pre>

<p>And that should be basically it.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/388/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-427" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/427/index.html">Working as aegir user</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>It can be convenient to do stuff as the aegir user.
The default shell of the aegir user is /bin/false, so you have to make sure to use something more usable:</p>

<pre>
sudo su - aegir -s /bin/bash
</pre>

<p>GNU Screen is a super useful window manager for the console.  When launching screen you will usually get errors like</p>

<pre>
Cannot open your terminal '/dev/pts/6' - please check.
</pre>

<p>You can get around this by running</p>

<pre>
script /dev/null
</pre>

<p>All in all this works nicely:</p>

<pre>sudo su aegir -s /bin/bash -c "script -q /dev/null"</pre>

<p>It can be convenient to put it in a little script as <code>/usr/local/bin/suaegir</code></p>

<h2>Allowing other users besides root on your system to run commands as aegir</h2>

<p>If you wish to allow other users on your system to run commands as the aegir user using sudo, without allowing them to use sudo generally, you can add the following two lines to your /etc/sudoers file using visudo:</p>

<p><div class="codeblock"><code>User_Alias&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AEGIRUSERS = comma, separated, list, of, users<br />AEGIRUSERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL = (aegir) ALL</code></div></p>

<p>If you want to allow these users to use aegir without entering a password, simply change the second line to this:</p>

<p><div class="codeblock"><code>AEGIRUSERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL = (aegir) NOPASSWD:ALL</code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/427/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-341" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/341/index.html">Adding apache config files</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>If you connect to your Hostmaster server and look at
~aegir/config/server_examplecom/apache.conf, you can see that this
file includes files from pre.d and post.d directories.  The includes
are done in the following order:</p>

<ol>
<li>pre.d</li>
<li>vhost.d</li>
<li>platform.d</li>
<li>post.d</li>
</ol>

<p>The earlier files take precendence over the later files for &lt;VirtualHost&gt; blocks. The latter files take precedence over earlier files for &lt;Directory&gt; blocks.</p>

<p>If we wanted to add a phpini directive that can only be set on a <a href="http://us2.php.net/manual/en/configuration.changes.modes.php">PHP_INI_PERDIR</a>-for
example, <a href="http://us2.php.net/manual/en/ini.core.php">post_max_size</a>-we
could create a file called upload.conf and add it either to pre.d or
post.d.</p>

<p>Here's a possible upload.conf:
<div class="codeblock"><code>####################################<br /># Custom Server-wide configuration #<br />####################################<br /># our php.ini sets memory limit to 96M<br /># <br /># post_max_size should also be less than memory_limit.<br /># <a href="http://us2.php.net/manual/en/ini.core.php#ini.post-max-size<br />#" title="http://us2.php.net/manual/en/ini.core.php#ini.post-max-size<br />#">http://us2.php.net/manual/en/ini.core.php#ini.post-max-size<br />#</a> <br />php_value post_max_size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 90M<br />php_value upload_max_filesize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 85M</code></div>
If we put upload.conf in pre.d, our setting would always take
precedence, because it occurs higher up the chain of include files.</p>

<p>If we put upload.conf in post.d, our setting would be applied only
if the same setting is not defined higher up the chain by the
aegir code. As Antoine <a href="http://drupal.org/node/936720#comment-3552466">states here</a>
post.d is mainly useful when migrating in sites.  It would also be
useful if you wanted to set a server-wide default which could be
overridden on by a virtual host or platform config setting.</p>

<p>Related: <a href="../node/73/index.html" title="http://community.aegirproject.org/node/73">http://community.aegirproject.org/node/73</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/341/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-29" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/content/administrator/post-install-configuration/using-ssl/index.html">Using SSL</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h3>Introduction</h3>

<p>SSL support was significantly improved in Aegir 0.4 alpha9 and subsequent releases have further refined the SSL functionality. Here are the current steps to configure SSL support in Aegir and apply it to your web sites.</p>

<h3>Prepare Your Server</h3>

<p><OL>
<LI>Make sure port 443 is open for SSL traffic.
</li><LI>From the command line, install SSL software for your web server (e.g. on Debian/Ubuntu you can use <code>sudo apt-get install openssl</code>).</li>
<LI>Enable SSL support (e.g. <code>sudo a2enmod ssl</code>).  You will need to restart Apache at this point.
</li></ol></p>

<h3>Enable SSL Support in Aegir</h3>

<p><OL>
<LI>You have to enable SSL support in Aegir as it is off by default.  Assuming the URL of your Aegir front end is aegir.example.com, browse to aegir.example.com/admin/hosting/features 
<img src="../sites/community.aegirproject.org/files/features-page/index.png" alt="how to get to the Aegir features page" />
</li><LI>Click on Experimental to reveal experimental features <img src="../sites/community.aegirproject.org/files/ssl-support/index.png" alt="experimental features of Aegir" />
</li><LI>Check SSL support
</li><LI>Click Save configuration
</li></ol></p>

<h3>Configure Your Aegir Server</h3>

<p><OL>
<LI>Click on the Servers tab
</li><LI>Click on the server that you wish to enable SSL support
</li><LI>Click Edit to change the server configuration
</li><LI>Click apache_ssl (this will reveal an additional field: SSL port, which should be already populated with 443).<img src="../sites/community.aegirproject.org/files/enable-ssl-on-server/index.png" alt="enabling SSL on your Aegir server" />
</li><LI>You may also have to add an IP address to the IP addresses field. The field is used as an "IP pool" for SSL certificates: IPs are assigned to SSL sites when they are created on a first come, first served basis. (Note that there are known issues with this process, see <a href="http://drupal.org/node/1126640">issue #1126640</a> for details.)
</li><LI>Click Save - this will start various tasks beginning with a verify task on the server followed by verify tasks on all platforms that are associated with that server
</li><LI>If all goes well you will see the following changes in your Aegir <a href="http://groups.drupal.org/node/93849">file system structure</a>:
a new <code>/var/aegir/config/ssl.d</code> directory and a 
new <code>/var/aegir/config/server_master/ssl.d</code> directory.
</li></ol></p>

<p>The <code>/var/aegir/config/ssl.d</code> directory is where you will be able to manipulate SSL keys and certificates, for example by importing commercial SSL certificates or generating a new key. Do <em>not</em> manually edit the <code>/var/aegir/config/server_master/ssl.d</code> directory as changes to that directory will be overwritten when the server or site are verified.</p>

<h3>Configure Your Aegir Site</h3>

<p><OL>
<LI>You must enable SSL on your sites that are on those platforms associated with the server.  Browse to aegir.example.com/hosting/c/example.com
</li><LI>Click Edit to change the site configuration
</li><LI>Choose the type of Encryption required and the Encryption key (see the explanatory notes below each option). <img src="../sites/community.aegirproject.org/files/site-ssl-configuration_0/index.png" alt="configuring an Aegir site for SSL" /> <em>NOTE:,</em> Alternatively, you may specify a directory under /var/aegir/config/server_master/ssl.d where your own certificate and key is to be stored (see Apache notes below).
</li><LI>Click Save.  Aegir will then generate a certificate and private key for your web site and insert these into a new VirtualHost directive in your vhost file.  (This file is typically at /config/server_master/apache/vhost.d/example.com).
</li><LI>If all goes well the VirtualHost directive will now have these important elements:</li></ol></p>

<p><div class="codeblock"><code>&lt;VirtualHost xx.xx.xx.xx:443&gt; # &lt;-- where xx.xx.xx.xx is an IP address dedicated for SSL access to your site and 443 is the port number<br />&nbsp;&nbsp;&nbsp; ....<br /><br />&nbsp;&nbsp;&nbsp; # Enable SSL handling.<br />&nbsp;&nbsp;&nbsp; SSLEngine on<br /><br />&nbsp;&nbsp;&nbsp; SSLCertificateFile /var/aegir/config/server_master/ssl.d/example.com/openssl.crt<br />&nbsp;&nbsp;&nbsp; SSLCertificateKeyFile /var/aegir/config/server_master/ssl.d/example.com/openssl.key</code></div></p>

<p>Now, when you navigate to <a href="https://example.com/" title="https://example.com">https://example.com</a> you should see that your site is SSL enabled. It will, however, generate warnings in your browsers because it is a self-signed certificates. See below for how to use commercial certificates to remove this warning.
</p>

<h2>Notes for Apache users with Commercial Certificate File(s)</h2>

<p>If you wish to use your own commercial certificate and key you will need to do the following:</p>

<p><OL>
<LI>Follow the directions above, using the "Generate new encryption key" option and using your site's domain name for the "New encryption key". This will create a site directory under <code>/var/aegir/config/ssl.d/example.com</code>. With this step, you have created a self-signed certificate, and your site is now configured to use it.
</li><LI>This generated a 2048 bit RSA key for you along with a CSR (Certificate Signing Request). If you prefer to generate your own RSA key, replace the files (<code>openssl.key</code> and <code>openssl.csr</code>) in the <code>/var/aegir/config/ssl.d/example.com</code> directory with your RSA key and associated CSR.
</li><LI>Copy and paste the <code>.csr</code> file into the form for the issuing Certificate 
Authority (CA) to create your certificate.
</li><LI>When your certificate has been generated, download the files from the issuing authority and place in your temporary folder on your PC. You may have more than one .crt files, in this case you have a "bundle" or what we call a "certificate chain" that you need to add in aegir (see below).
</li><LI>Transfer all the files to /var/aegir/config/ssl.d/example.com. Rename the site .crt file to openssl.crt. If you have a certificate chain, install it in <code>openssl_chain.crt</code>. You should have at least three files in the directory (<code>openssl.crt</code>, <code>openssl.key</code>, <code>openssl.csr</code>, and optionnally <code>openssl_chain.crt</code>).
</li></ol></p>

<h3>Verify your site from aegir's frontend.</h3>

<p>You should now be able to access your site via https:// using your commercial certificate.</p>

<h2>Notes for Nginx users:</h2>

<p>It is recommended to allow Aegir to create a default self-signed certificate and key first, and then replace the contents of both files (not the files itself) with your real key and certificate. Any chained certificates (bundles) should be included in the same file, directly below your own certificate - there is no need for extra files/lines like it is for Apache configuration.</p><div class="itu-attachments"><table class="itu-attachment-list withoutstats sticky-enabled" id="attachments">
 <thead><tr><th class="preview">Preview</th><th class="file">Attachment</th><th class="size">Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td class="mime mime-png"><div  class="form-item" id="">
    <div class="itu-attachment-thumb"><a href="../sites/community.aegirproject.org/files/site-ssl-configuration_0_0/index.png" title="site-ssl-configuration_0.png"><img src="../sites/community.aegirproject.org/files/imagecache/AttachmentThumbnail/site-ssl-configuration_0_0/index.png" alt="site-ssl-configuration_0.png" title="site-ssl-configuration_0.png" width="60" height="60" class="imagecache imagecache-AttachmentThumbnail"/></a></div>  </div>
</td><td class="file"><a href="../sites/community.aegirproject.org/files/site-ssl-configuration_0_0/index.png">site-ssl-configuration_0.png</a></td><td class="size">26.91 KB</td> </tr>
</tbody>
</table>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/29/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-38" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="dns/index.html">DNS</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h1> Debian/Ubuntu</h1>

<p>There is preliminary support for DNS in Aegir's backend that allows it to manage zonefiles dynamically when sites are created. There are still a few major bits missing (described in <a href="http://drupal.org/node/922280">this meta-ticket</a>) so we generally recommend people use the <a href="../dnswildcard/index.html">wildcard approach</a> for now.</p>

<p>That said, while perhaps not yet ready for production use, Aegir's DNS functionality can be quite useful for local development environments. If you run Aegir locally, you're probably in the habit of hacking <em>/etc/hosts</em> regularly, or if you're more adventurous, you've set up a local DNS forwarder, such as dnsmasq. With Aegir's DNS feature, you can avoid this hassle, and let Aegir handle it transparently.</p>

<p>While Aegir supports both BIND and dnsmasq, this documentation will focus on the former. The first step is to install BIND. On Debian-based distros, this will look like:
<div class="codeblock"><code>apt-get install bind9</code></div></p>

<p>Next we need to allow the <em>aegir</em> user to run <strong>rndc</strong> (the name server control utility). On recent Debian systems, this will involve editing <em>/etc/sudoers.d/aegir</em>, whereas on older releases this would be <em>/etc/sudoers</em>. Modify the aegir line to read:
<div class="codeblock"><code>aegir ALL=NOPASSWD: /usr/sbin/apache2ctl, /usr/sbin/rndc</code></div></p>

<p>Then we need to make sure the <em>bind</em> user has access to read Aegir's files, so we'll add <em>bind</em> to the <em>aegir</em> group:
<div class="codeblock"><code>adduser bind aegir</code></div></p>

<p>We're now ready to activate the feature in Aegir's frontend. Go to Hosting &gt;&gt; Features (<em>admin/hosting/features</em>) and select "DNS Support" under the "Experimental" fieldset, and save the configuration.</p>

<p>Finally, we need to activate DNS on the Aegir server. Visit the server node (<em>hosting/c/server_master</em>) and click the edit tab (which should bring you to <em>node/2/edit</em>). Then under "DNS Service", select "Bind" and then save.</p>

<p>This should trigger a verify of the server (and then probably the platforms on it too), after which Aegir will be managing your local BIND server, and it's zonefile(s). If you have installed Aegir in /var/aegir, put this line in the file <em>/etc/bind/named.conf.local</em>:
<div class="codeblock"><code>include &quot;/var/aegir/config/bind.conf&quot;;</code></div></p>

<p>Aegir is now a full-fledged DNS server that you can use to resolve addresses locally. This can be accomplished on Debian-like systems by editing <em>/etc/resolv.conf</em> to include "nameserver 127.0.0.1". If you're running Aegir in a VM, you can just point this to the address of the virtual machine.</p>

<h1>CentOS/RHEL</h1>

<p>You need to have a working DNS/bind/named server for AEgir to take control of. What follows is rough documentation to reach that stage. It is currently <em>UNTESTED</em> in a production environment.
<div class="codeblock"><code>yum -y install bind-chroot bind-utils bind-libs bind<br />chkconfig named on<br />ln -s /var/named/chroot/var/named/named.conf /etc/named.conf<br />cat &gt;&gt; /etc/named.conf &lt;&lt; EOF<br />controls {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inet 127.0.0.1 allow {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; localnets;<br />} keys {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rndckey;<br />};<br />};<br />options {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listen-on port 53 { any; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listen-on-v6 port 53 { ::1; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; directory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;/var/named&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dump-file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;/var/named/data/cache_dump.db&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; statistics-file &quot;/var/named/data/named_stats.txt&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Those options should be used carefully because they disable port<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // randomization<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // query-source&nbsp;&nbsp;&nbsp; port 53;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // query-source-v6 port 53;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; forwarders { 192.168.122.1; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; forward only;<br />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allow-query&nbsp;&nbsp;&nbsp;&nbsp; { localhost; };<br />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allow-query-cache { localhost; };<br />};<br /><br />logging {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel default_debug {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file &quot;data/named.run&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; severity dynamic;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br />};<br /><br />view localhost_resolver {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; match-clients&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { any; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; match-destinations { any; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recursion yes;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include &quot;/etc/named.rfc1912.zones&quot;;<br /><br />&nbsp;&nbsp;&nbsp; // Add local zone definitions here.<br /><br />&nbsp;&nbsp;&nbsp; include &quot;/var/aegir/config/bind.conf&quot;;<br />};<br /><br />include &quot;/etc/rndc.key&quot;;<br />EOF<br />service named start</code></div></p>

<h1>Additional Notes</h1>

<p>Additional documentation can be found in the Provision DNS module: <a href="http://drupalcode.org/project/provision.git/blob/HEAD:/dns/NOTES" title="http://drupalcode.org/project/provision.git/blob/HEAD:/dns/NOTES">http://drupalcode.org/project/provision.git/blob/HEAD:/dns/NOTES</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/38/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-285" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../dnswildcard/index.html">DNS Wildcard Configuration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <h4>Why run a wildcard DNS server?</h4>

<p>A wildcard DNS setup lets you automatically have subdomains for a given domain. For example, say you own the domain widgets.com and you want to setup an unlimited number of subdomains like dev.widgets.com, test.widgets.com, customers.widgets.com, etc.... Typically you would have to set these all up individually. A wildcard DNS can let you bypass a lot of configuration.  In a development environment it can let you setup any number of test/development sites very quickly and easily.  Drupal developers in particular can leverage Drupal's multisite installation feature to setup lots of sites for development or production very quickly.</p>

<h4>Creating a DNS wildcard with hosted DNS</h4>

<p>Many of the popular domain registration companies allow you to manage your DNS records through a web interface. If you have access to such a facility, adding a DNS wildcard is easy: you just create an A record called '*', pointing to your server's IP address.</p>

<p>For convenience, here are instructions for some popular hosting providers: <a href="http://community.godaddy.com/groups/domains-management-and-services/forum/topic/dns-wildcards/">GoDaddy</a>, <a href="http://www.hosting.com/support/cpanel/dns/wildcard">hosting.com</a> (which uses the popular cPanel system) and <a href="http://www.123-support.co.uk/support/answers/how-do-i-change-my-dns-settings-279/">123-reg.co.uk</a>. It is likely that your host will have a similar system to one of these.</p>

<h4>How to configure DNS wildcards on your own server</h4>

<h4><a href="#debian">  Ubuntu/Debian  </a></h4>

<h4><a href="#osx"> OS X Snow Leopard </a></h4>

<h3 id="debian">Setting up a Wildcard DNS configuration on Ubuntu/Debian</h3>

<h4>Overview of Steps on Ubuntu/Debian</h4>

<p>I. Install Bind 9
II. Add a zone to /etc/bind/named.conf.local. Check the syntax  of named.conf.local with named-checkconf
III. Add a zone file &amp; Check the syntax  of  your zone files for errors with named-checkzone
IV.  Edit /etc/resolv.conf
V. Start up Bind 
VI.  Check setup with dig 
VII. Troubleshoot if needed</p>

<h4>I. Install Bind 9</h4>

<p><div class="codeblock"><code>$ sudo apt-get install bind9</code></div></p>

<h4>II. Edit /etc/bind/named.conf.local to add a zone.</h4>

<p> We need to add a zone to /etc/bind/named.conf.local. A zone is a record for a domain. In this case we'll use a fake domain for development purposes. Our domain can be called  anything. Let's call it mydev. (I was really tempted to call the domain bullshit - would have been great for screencasts). So at a shell prompt do:</p>

<p><div class="codeblock"><code>$ sudo nano /etc/bind/named.conf.local</code></div></p>

<p> Add this to the end of the file:</p>

<p><div class="codeblock"><code>zone &quot;mydev&quot; {<br /> type master;<br />&nbsp;&nbsp; file &quot;/etc/bind/db.mydev&quot;;<br />};</code></div></p>

<p> Save the file with Control - O  and enter.  Exit from nano with Control X.</p>

<p>Check the syntax of the file as follows: </p>

<p><div class="codeblock"><code>$ named-checkconf /etc/bind/named.conf.local </code></div></p>

<p> If the file is syntactically correct the shell prompt will return nothing. If there is an error - make sure you did not miss a quote or semicolon and recheck the file.</p>

<h4>III. Add a zone file  &amp;  Check the syntax  of  your zone files for errors with named-checkzone </h4>

<p><div class="codeblock"><code>$ sudo nano /etc/bind/db.mydev</code></div></p>

<p>Add this to the file replacing 10.0.2.15 with your IP address</p>

<p><div class="codeblock"><code>mydev. 86400 IN SOA mydev. hostmaster.mydev. (<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20091028 ; serial yyyy-mm-dd<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10800; refresh every 15 min<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3600; retry every hour<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3600000; expire after 1 month +<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400 ); min ttl of 1 day<br />&nbsp; IN NS mydev. <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN MX 10 mydev.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN A 10.0.2.15<br />*.mydev. IN A 10.0.2.15</code></div></p>

<p> Save the file with Control - O  and enter.  Exit from nano with Control X. Check the syntax with the following:</p>

<p><div class="codeblock"><code>$ named-checkzone mydev /etc/bind/db.mydev </code></div></p>

<p> If the syntax of the file is correct you should see something like: </p>

<p><div class="codeblock"><code>zone mydev/IN: loaded serial 20091028<br />OK</code></div></p>

<p> If not review the file for errors. In particular whenever referring to a domain, it must end in a  .  , thus  mydev.  </p>

<h4>IV.  Edit /etc/resolv.conf</h4>

<p>resolv.conf tells applications like browsers where to look for DNS info. By default it may have your ISPs info. We need to tell it to check our local DNS server first then the ISP. </p>

<p><div class="codeblock"><code>$ sudo nano /etc/resolv.conf</code></div></p>

<p>Add/change the following</p>

<p><div class="codeblock"><code>domain mydev<br />search mydev<br />nameserver 127.0.0.1<br />nameserver (your isp nameserver or open dns)</code></div></p>

<p>If you are receiving an IP address via DHCP then you need to edit /etc/dhcp3/dhclient.conf too. </p>

<p><div class="codeblock"><code>$ sudo nano&nbsp; /etc/dhcp3/dhclient.conf</code></div></p>

<p>Look for the lines send host-name,  supersede domain-name,  and prepend domain-name-servers  and set them as follows (and make sure they are uncommented ) :</p>

<p><div class="codeblock"><code>send host-name &quot;mydev&quot;;<br />supersede domain-name &quot;mydev&quot;;<br />prepend domain-name-servers 127.0.0.1;</code></div>
<div class="codeblock"><code>sudo dhclient</code></div></p>

<p>Whew! Almost there.</p>

<h4>V. Start up Bind (or Restart) </h4>

<p><div class="codeblock"><code>$ sudo /etc/init.d/bind9 restart </code></div></p>

<h4> VI.  Check setup with ping and dig </h4>

<p><div class="codeblock"><code>$&nbsp; ping testing.mydev<br />PING testing.mydev (10.0.2.15) 56(84) bytes of data.<br />64 bytes from ubuntu.local (10.0.2.15): icmp_seq=1 ttl=64 time=0.041 ms<br />64 bytes from ubuntu.local (10.0.2.15): icmp_seq=2 ttl=64 time=0.039 ms<br />64 bytes from ubuntu.local (10.0.2.15): icmp_seq=3 ttl=64 time=0.0</code></div></p>

<p> If ping works then you should be good to go.  If not try dig and part V. To stop the ping action press [Ctrl]+[c].</p>

<h4>VII. Troubleshoot  </h4>

<p>I found the section on Troubleshooting Bind in O'Reilly's  "Linux System Administration" helpful. Fortunately, this part of the book is viewable on Google books as of this writing (10/29/2009): <a href="http://books.google.com/books?id=-jYe2k1p5tIC&amp;lpg=PP1&amp;dq=Linux%20System%20Administration&amp;pg=PA66#v=onepage&amp;q=&amp;f=false" title="http://books.google.com/books?id=-jYe2k1p5tIC&amp;lpg=PP1&amp;dq=Linux%20System%20Administration&amp;pg=PA66#v=onepage&amp;q=&amp;f=false">http://books.google.com/books?id=-jYe2k1p5tIC&amp;lpg=PP1&amp;dq=Linux%20System%...</a> .  See page 66 </p>

<h3 id="osx">Getting a Wildcard DNS running on OSX Snow Leopard</h3>

<p>Note: it took me several tries to get this working. If you are new to DNS be patient with yourself - you'll get it, but may take a few tries. </p>

<p>In this example I will concentrate on setting a development environment with OSX using wildcard DNS</p>

<h3>Overview of Steps</h3>

<p>I. Edit /etc/named.conf to add a zone.<br />
II. Add a zone file at /var/named/
III. Check the syntax  of named.conf and your zone files for errors
IV.  Edit /etc/resolv.conf
V. Set your computers network settings to use 127.0.0.1 as a name server
VI. Start up Bind 
VII.  Check setup with dig 
VIII. Reboot if needed</p>

<h4>Before we start a few more notes.  </h4>

<p>I tend to use the nano text editor to edit Unix configuration files you could use Emacs, VI, Textmate, BBEdit or the editor of your choice.  </p>

<p>Backup all these files we are editing so you can start over if you mess up. I didn't do this and it added more time to the project.
For example to backup /etc/named.conf  do:</p>

<p><div class="codeblock"><code>$ sudo cp /etc/named.conf /etc/named.conf.bck </code></div></p>

<p>Last, most of the files we need to edit are owned by root so you will need to use sudo to edit these files. If you get tired of typing sudo you can become root by doing this:</p>

<p><div class="codeblock"><code>$ sudo -s </code></div></p>

<p>Be careful when working as root or using sudo. You can mess up your system so make sure to backup. All example here are run as root.  </p>

<h4>I. Edit /etc/named.conf to add a zone</h4>

<p>We need to edit named.conf to add our zone.</p>

<p><div class="codeblock"><code>$ nano /etc/named.conf</code></div></p>

<p>I called my zone vmdev so I added this to named.conf </p>

<p><div class="codeblock"><code>zone &quot;vmdev&quot; IN {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type master;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file &quot;db.vmdev&quot;;<br />};</code></div></p>

<p>I added this right before the zone  0.0.127.inaddr.apra  and saved the file. So we told Bind to look in /var/named/db.vmdev for this zone.</p>

<h4>II. Add a zone file at /var/named/</h4>

<p><div class="codeblock"><code>$ nano /var/named/db.vmdev<br />vmdev. 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SOA&nbsp;&nbsp;&nbsp;&nbsp; vmdev. root.vmdev. (<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2008031801 ;&nbsp;&nbsp;&nbsp; Serial<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Refresh every 15 minutes<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3600&nbsp;&nbsp;&nbsp; ; Retry every hour<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3000000 ; Expire after a month+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400 ) ; Minimum ttl of 1 day<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vmdev.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10 vmdev.<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199<br />*.vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199</code></div></p>

<p>You can just copy this but be sure to change 192.168.0.199 to you Mac's IP address </p>

<h4>III. Check the syntax  of named.conf and your zone files for errors</h4>

<p>Run this to check your named.conf file:</p>

<p><div class="codeblock"><code>$ named-checkconf /etc/named.conf&nbsp; </code></div></p>

<p>If it returns nothing, your named.conf file is at least syntactically correct. If there is an error, then well you have to diagnose and fix the error.</p>

<p>Now run this to check your zone file:</p>

<p><div class="codeblock"><code>$ named-checkzone vmdev /var/named/db.vmdev </code></div></p>

<p>It should return something like this:</p>

<p><div class="codeblock"><code>zone vmdev/IN: loaded serial 2008031801<br />OK</code></div></p>

<p>If there are errors then diagnose and fix them.</p>

<h4>IV.  Edit /etc/resolv.conf</h4>

<p><div class="codeblock"><code>$ nano /etc/resolv.conf<br />#<br /># Mac OS X Notice<br />#<br /># This file is not used by the host name and address resolution<br /># or the DNS query routing mechanisms used by most processes on<br /># this Mac OS X system.<br />#<br /># This file is automatically generated.<br />#<br />domain vmdev.<br />nameserver 127.0.0.1<br />nameserver 192.168.0.1</code></div></p>

<h4>V. Set your computers network settings to use 127.0.0.1 as a name server  </h4>

<p>Do this at System Preferences -&gt; Network.
You may want to use your ISPs Name server as the second name server
</p>

<h4>VI. Start up Bind </h4>

<p><div class="codeblock"><code>$ launchctl load -w /System/Library/LaunchDaemons/org.isc.named.plist</code></div></p>

<p>The -w option tells OSX to enable Bind at startup</p>

<h4>VII.  Check setup with dig  </h4>

<p><div class="codeblock"><code>$ dig faker.vmdev&nbsp; </code></div></p>

<p>Should return something like this:</p>

<p><div class="codeblock"><code>; &lt;&lt;&gt;&gt; DiG 9.6.0-APPLE-P2 &lt;&lt;&gt;&gt; faker.vmdev<br />;; global options: +cmd<br />;; Got answer:<br />;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45640<br />;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1<br /><br />;; QUESTION SECTION:<br />;faker.vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A<br /><br />;; ANSWER SECTION:<br />faker.vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199<br /><br />;; AUTHORITY SECTION:<br />vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vmdev.<br /><br />;; ADDITIONAL SECTION:<br />vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199<br /><br />;; Query time: 0 msec<br />;; SERVER: 127.0.0.1#53(127.0.0.1)<br />;; WHEN: Wed Oct 14 19:28:56 2009<br />;; MSG SIZE&nbsp; rcvd: 75 </code></div></p>

<p>The key here is  status NOERROR; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45640
If you get an error then check previous steps.</p>

<p>Now try:</p>

<p><div class="codeblock"><code>$ ping faker.vmdev</code></div></p>

<p>should return: </p>

<p><div class="codeblock"><code>PING test.vmdev (192.168.0.199): 56 data bytes<br />64 bytes from 192.168.0.199: icmp_seq=0 ttl=64 time=0.059 ms<br />64 bytes from 192.168.0.199: icmp_seq=1 ttl=64 time=0.087 ms</code></div></p>

<p>but if it does not got to VIII.</p>

<h4>VIII. Reboot if needed.</h4>

<p>I needed to reboot to get everything to take. Whoila! Have a cookie or something.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-58.html?destination=node%2F285%23comment-form">Login</a> or <a href="../user/register/index-58.html?destination=node%2F285%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-39" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/39/index.html">Hooking into Aegir (site overrides)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Because Aegir is capable of installing, deploying and moving your sites around, it has to manage the various configuration files that keep your sites running.</p>

<p>These configurations include the standard Drupal settings.php for a site, .htaccess overrides for your HTTP server, as well as HTTP 'VirtualHost' or 'vhost' configuration files that tell your HTTP server where your site is.</p>

<p>A caveat of this system is that Aegir regularly re-generates these configuration files to apply new changes that have been made to the sites or platforms, as well as doing so as a safety mechanism to ensure these files are 'sane'.</p>

<p>For example, if you make a modification to a site vhost or settings.php and it breaks your site, running a 'Verify' task on the site should restore the file back to how it was.</p>

<p>However, sometimes it is necessary to add custom configuration or overrides to these files, and you can't do that if Aegir is regularly wiping your changes.</p>

<p>Fortunately, Aegir provides a series of hooks and inclusions for overriding or injecting customisations into these files safely and persistently.</p>

<p>This chapter shows you how each of these hooks or inclusions work.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-59.html?destination=node%2F39%23comment-form">Login</a> or <a href="../user/register/index-59.html?destination=node%2F39%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-73" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/73/index.html">Injecting into server-wide vhosts</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Changing <em>maximum filesize upload</em> is common when setting up sites in Drupal. As described in <a href="../node/990/index.html">Overriding site-specific PHP values</a> you can change this value for each site created with gir by adding a .drush.inc file in /var/aegir/.drush directory. But wouldnt it be nice to be able to do it side-wide?</p>

<p>Here below is the same code from ergonlogic demonstrating how to create a <em>domainname</em>.drush.inc file using the domain name as a condition before the code injection.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">ergonlogiccom_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">== </span><span style="color: #DD0000">"ergonlogic.com"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"Overriding PHP file size values. See .drush/ergonlogiccom.drush.inc"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"php_value upload_max_filesize 100M"</span><span style="color: #007700">, </span><span style="color: #DD0000">"php_value post_max_size 200M"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>Apparently you can do this side-wide by omitting the IF statement and create a file with a .drush.inc extension.</p>

<p>For instance, you could create a file called <em>global_settings.drush.inc</em> and put in the following code:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">globalsettings_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"Overriding PHP file size values. See .drush/global_settings.drush.inc"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"php_value upload_max_filesize 100M"</span><span style="color: #007700">, </span><span style="color: #DD0000">"php_value post_max_size 200M"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; <br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
<em>* the closing ?&gt; syntax should not be used</em></p>

<p>Make sure you <strong>Verify</strong> your site after you create the file. Then scroll through the log and find the message you added in the code:</p>

<blockquote>Overriding PHP file size values. See .drush/global_settings.drush.inc</blockquote>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-60.html?destination=node%2F73%23comment-form">Login</a> or <a href="../user/register/index-60.html?destination=node%2F73%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-72" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/72/index.html">Injecting into platform-wide vhosts (.htaccess)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Using a .htaccess with an Allow Override all directive in Apache can be a major performance killer, because it requires Apache to stat each subdirectory of the codebase looking for overrides in .htaccess.</p>

<p>As a result, Aegir disables the reading of the Drupal .htaccess in the runtime environment.</p>

<p>This does not mean that the .htaccess is not needed. Instead, when you run the Verify task against a Platform, the .htaccess is studied by Aegir and its contents are copied into the platform-wide Apache vhost configuration, typically located in /var/aegir/config/server_master/apache/platform.d</p>

<p>Need to make a modification to the .htaccess? Simple: you can simply edit it in-place as you normally would, but you must re-Verify the platform in Aegir afterward, in order for those new or modified settings to be 'loaded in' to the platform vhost file.</p>

<p>The end result is improved performance for your sites, without losing any functionality, as you can still customise the .htaccess to your liking.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-61.html?destination=node%2F72%23comment-form">Login</a> or <a href="../user/register/index-61.html?destination=node%2F72%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-70" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/70/index.html">Injecting into site vhosts</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir provides some hook functions in its API, one of which allows you to inject extra configuration snippets into your Apache vhost files for sites.</p>

<h2>When would I want to do this?</h2>

<p>A good example for this is when you may need to inject a custom Rewrite rule that goes beyond what the Aegir Aliases 'redirection' feature provides.</p>

<p>Or, perhaps you have to inject some htpasswd mod_auth password protection for your site, or perhaps a CustomLog definition. The <a href="https://drupal.org/project/hosting_tasks_extra">http_basic_auth</a> module uses this. (<a href="http://drupalcode.org/project/hosting_tasks_extra.git/tree/HEAD:/http_basic_auth">code</a>)</p>

<p>Typically you'd just add what you need to the vhost file, but the problem is that Aegir manages these vhosts, and on every Verify task, will rewrite the config from a template, blowing away your changes in the process. Ouch!</p>

<p>Fortunately there is a very easy and elegant solution to this problem to save your configurations persistently across Verify tasks and the like, by means of invoking the Provision hook <code>provision_apache_vhost_config()</code>, or, if you are using Nginx, <code>provision_nginx_vhost_config()</code> (and just replace the below examples with 'nginx' instead of 'apache' where necessary). Below "mig5" is just an example, you can replace this with anything as drush looks for all *.drush.inc files in <code>~aegir/.drush</code></p>

<h2>A simple example</h2>

<p>In this example I'll inject a simple 'ErrorLog' apache definition into a vhost to save the site error logs to a file.</p>

<ol>
<li>Create a file in <code>~aegir/.drush</code> called <code>mig5.drush.inc</code>. (Choose <code>&lt;any&gt;</code> prefix for the file name <code>&lt;any&gt;.drush.inc</code>).  </li>
<li>Add this snippet of PHP to the file:
<div class="codeblock"><code> <br /> <span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">mig5_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; return </span><span style="color: #DD0000">"ErrorLog /var/aegir/" </span><span style="color: #007700">. </span><span style="color: #0000BB">$uri </span><span style="color: #007700">. </span><span style="color: #DD0000">".error.log"</span><span style="color: #007700">;<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
(Choose <code>&lt;any&gt;</code> prefix for the function name <code>&lt;any&gt;_provision_apache_vhost_config</code>).</li>
<li><code>drush cache-clear drush</code> </li>
<li>Install a site or verify an existing one</li>
</ol>

<p>Check your site's vhost config file (in <code>/var/aegir/config/server_master/apache/vhost.d/</code>) and you'll see the line has been injected into the '#Extra configuration' area of the vhost</p>

<p><div class="codeblock"><code>&lt;VirtualHost *:80&gt;<br /><br />&nbsp; DocumentRoot /var/aegir/hostmaster-HEAD <br />&nbsp;&nbsp;&nbsp; <br />&nbsp; ServerName 1.mig5-forge.net<br />&nbsp; SetEnv db_type&nbsp; mysqli<br />&nbsp; SetEnv db_name&nbsp; 1mig5forgenet<br />&nbsp; SetEnv db_user&nbsp; 1mig5forgenet<br />&nbsp; SetEnv db_passwd&nbsp; X7KzsFhxhp<br />&nbsp; SetEnv db_host&nbsp; tardis<br />&nbsp; SetEnv db_port&nbsp; 3306<br /><br /><br /><br /># Extra configuration from modules:<br />&nbsp; ErrorLog /var/aegir/1.mig5-forge.net.error.log<br />&nbsp;&nbsp;&nbsp; # Error handler for Drupal &gt; 4.6.7<br />&nbsp;&nbsp;&nbsp; &lt;Directory &quot;/var/aegir/hostmaster-HEAD/sites/1.mig5-forge.net/files&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetHandler This_is_a_Drupal_security_line_do_not_remove<br />&nbsp;&nbsp;&nbsp; &lt;/Directory&gt;<br /><br />&lt;/VirtualHost&gt;</code></div></p>

<p>It's that simple! You can see that via the hook, we pass $uri and the drush data to the function, allowing me to abstract the site url so that each site will get its own error log. You could do extra PHP conditionals to ensure certain data only gets inserted into certain sites of a specific name.</p>

<p>To inject multiple lines instead of one, use an array, i.e</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">mig5_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"ErrorLog /var/aegir/" </span><span style="color: #007700">. </span><span style="color: #0000BB">$uri </span><span style="color: #007700">. </span><span style="color: #DD0000">".error.log"</span><span style="color: #007700">, </span><span style="color: #DD0000">"LogLevel warn"</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>The key point of this is that the file <code>~aegir/.drush/mig5.drush.inc</code> file will never be touched by Aegir, so you can rest assured your changes will be respected.</p>

<p>If you want to only inject code into a specific site, wrap your code with an if statement, i.e
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">mig5_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">=== </span><span style="color: #DD0000">"&lt;site-name-in-aegir&gt;"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"ErrorLog /var/aegir/" </span><span style="color: #007700">. </span><span style="color: #0000BB">$uri </span><span style="color: #007700">. </span><span style="color: #DD0000">".error.log"</span><span style="color: #007700">, </span><span style="color: #DD0000">"LogLevel warn"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; }<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<h2>A more advanced example</h2>

<p>Managing multiple versions of a production site can be a tricky proposition, even in Aegir.  This is particularly true when you want to use the same canonical domain name to allow users to access one such site of your choosing at any given moment.  For instance, in Aegir I might have a site named <a href="http://www.example.com/" title="www.example.com">www.example.com</a> (with an alias of example.com,) and a couple of alternates with the site names of test1.example.com and test2.example.com.  If I suddenly decide that I want my primary domain to access test1.example.com, Aegir forces me into a tedious process that ultimately results in site downtime  I have to delete or migrate the existing <a href="http://www.example.com/" title="www.example.com">www.example.com</a> site to a new unused site name (or clone it to an unused site name, and delete the original) and then I have to migrate test1.example.com to the vacated site name <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  Alternatively, I could add the <a href="http://www.example.com/" title="www.example.com">www.example.com</a> and example.com aliases to test1.example.com but then my users would just be redirected to test1.example.com.</p>

<p>Given the way Aegir manages aliases, it would actually be easier to make this switch if the desired address was never used as a site name to begin with.  Instead of having the site name <a href="http://www.example.com/" title="www.example.com">www.example.com</a> alongside of the two other test sites, we might have live.example.com, with in-use aliases of <a href="http://www.example.com/" title="www.example.com">www.example.com</a> and example.com, and a rewrite instruction in the vhost that rewrites live.example.com to <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  If we could easily change the rewrite instructions in that vhost, all we would need to do is move the aliases from one site to the next in the GUI (with the requisite verify tasks executed on each site in question) in order to quickly change which site was being loaded at any given moment by <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  For example, if I wanted to move to test2.example.com, I would remove the <a href="http://www.example.com/" title="www.example.com">www.example.com</a> and example.com aliases from live.example.com and verify, add those aliases to test2.example.com and verify, and change my vhost so that test2 .example.com is rewritten as <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  Since as previously mentioned Aegir overwrites changes to the vhost during the verify process, the solution is to use the provision_apache_vhost_config hook in a drush.inc file to selectively add the rewrite information to the vhost when verifying the site that we want our canonical domain to refer to.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">aliasredirects_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// the uri to check here is the name of the site in Aegir<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #007700">if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">=== </span><span style="color: #DD0000">"test2.example.com"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"# Forces redirect to one uri"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"RewriteEngine On"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// if the host is not example.com <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"RewriteCond %{HTTP_HOST} !^example.com$ [NC]"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// rewrite to example.com with a 301 redirect<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"RewriteRule ^(.*)$ http://example.com$1 [R=301,L]"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return </span><span style="color: #0000BB">$rval</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp; }<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
When we want to switch again, say to test1.example.com, We could update the code to look for the test1.example.com uri.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/70/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-990" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/overriding-site-specific-php-values/index.html">Overriding site-specific PHP values</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Sometimes it is useful to override certain PHP values on a per-site basis, but changes to <code>php.ini</code> are generally server-wide. Depending on the value you want to override, a couple of options present themselves.</p>

<p>First, let's consider where PHP values can be changed. <a href="http://www.php.net/manual/en/ini.list.php" title="http://www.php.net/manual/en/ini.list.php">http://www.php.net/manual/en/ini.list.php</a> lists <code>php.ini</code> directives, and under the "Changeable" column, indicates <a href="http://www.php.net/manual/en/configuration.changes.modes.php">where a configuration setting may be set</a>. If your value shows either <code>PHP_INI_USER</code> or <code>PHP_INI_ALL</code>, then the easiest way to change this value would be using <code>ini_set()</code> in a <code>local.settings.php</code>:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'memory_limit'</span><span style="color: #007700">, </span><span style="color: #DD0000">'128M'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>On the other hand, if the changes mode is either <code>PHP_INI_PERDIR</code> or <code>PHP_INI_SYSTEM</code>, <code>php_ini()</code> won't work. In this case, the solution is to inject the value into the vhost. Since vhosts are managed by Aegir, manually adding an override to <code>/var/aegir/config/server_master/apache/vhost.d/&lt;uri&gt;</code> would get blown away the next time that the site is verified.</p>

<p>As described in <a href="../node/70/index.html">Injecting into site vhosts</a>, we can inject values into vhosts using a Drush hook. For example, to raise the file upload size limit on <a href="http://ergonlogic.com/" title="http://ergonlogic.com">http://ergonlogic.com</a>, I added the following code in <code>/var/aegir/.drush/ergonlogiccom.drush.inc</code>:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">ergonlogiccom_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">== </span><span style="color: #DD0000">"ergonlogic.com"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"Overriding PHP file size values. See .drush/ergonlogiccom.drush.inc"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"php_value upload_max_filesize 100M"</span><span style="color: #007700">, </span><span style="color: #DD0000">"php_value post_max_size 200M"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>This results in the insertion of the following lines into <code>/var/aegir/config/server_master/apache/vhost.d/ergonlogic.com</code>:
<div class="codeblock"><code>php_value upload_max_filesize 100M<br />php_value post_max_size 200M</code></div></p>

<p>Also, in the verify task log I get the following informative message:
<div class="codeblock"><code>Overriding PHP file size values. See .drush/ergonlogiccom.drush.inc</code></div></p>

<p>One challenge this technique may present is inspecting the values of the parameters passed into this function. It appears that the Hostmaster site doesn't get bootstrapped, and so common debugging tools (such as devel.module's <a href="http://api.drupal.org/api/devel/devel.module/function/dd/6">dd()</a>) aren't available. However <a href="http://api.drush.ws/api/function/drush_log/4.x">drush_log()</a> is, and when called, will push arbitrary messages back into your Aegir site's verify task log.</p>

<p>So sticking the following into the function above can help:
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp; drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$uri</span><span style="color: #DD0000">: " </span><span style="color: #007700">. </span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-62.html?destination=node%2F990%23comment-form">Login</a> or <a href="../user/register/index-62.html?destination=node%2F990%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-71" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/71/index.html">Injecting into settings.php</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h3>Introduction</h3>

<p>Every web site in an Aegir environment has a Drupal configuration file <code>settings.php</code> in /sites/example.com directory.  Web administrators often need to make changes to this file; however, the Aegir system also manages this file and any manual customizations will be lost when a site is verified.</p>

<p>Fortunately, there are two mechanisms to ensure that your customizations can be preserved.  If you look in the bottom of an Aegir <code>settings.php</code> file you will see references to two files <code>local.settings.php</code> and <code>global.inc</code>.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #FF8000"># Additional host wide configuration settings. Useful for safely specifying configuration settings.<br />&nbsp; </span><span style="color: #007700">if (</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'/var/aegir/config/includes/global.inc'</span><span style="color: #007700">)) {<br />&nbsp;&nbsp;&nbsp; include_once(</span><span style="color: #DD0000">'/var/aegir/config/includes/global.inc'</span><span style="color: #007700">);<br />&nbsp; }<br /><br />&nbsp; </span><span style="color: #FF8000"># Additional site configuration settings. Allows to override global settings.<br />&nbsp; </span><span style="color: #007700">if (</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'/var/aegir/example-platform/sites/example.com/local.settings.php'</span><span style="color: #007700">)) {<br />&nbsp;&nbsp;&nbsp; include_once(</span><span style="color: #DD0000">'/var/aegir/example-platform/sites/example.com/local.settings.php'</span><span style="color: #007700">);<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>If these files exist they are loaded at run time by Drupal.  As you can probably surmise from the paths to these files, <code>local.settings.php</code> is for site-specific customizations and <code>global.inc</code> is for Aegir-wide customization.</p>

<p>Let's look at these files in more detail.  We'll use customization of user session cookies as an example.  If you look at the <code>settings.php</code> file generated by Aegir you see that it sets more conservative php settings for cookies (<code>@ini_set(&#039;session.cookie_lifetime&#039;,&nbsp; 0);</code> i.e. cookies expire immediately) than are in the <code>default.settings.php</code> packaged with Drupal (<code>@ini_set(&#039;session.cookie_lifetime&#039;,&nbsp; 2000000);</code> i.e. 2 million seconds, which is just over 23 days).</p>

<h3>Site-specific Customization</h3>

<p>The <code>local.settings.php</code> file by default does not exist in a new Aegir site installation so you have to create it.  Continuing with our example of user session cookies, let's override the Aegir default.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #FF8000"># site-specific Drupal customization<br /><br /># override Aegir-generated cookie policy for sites - set cookies to expire after a week (604,800 seconds)<br /></span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">604800</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>Note that because <code>local.settings.php</code> is included after the variables are set in the main <code>settings.php</code> it's customizations takes precedence.</p>

<p>Now, whenever you clone a site or migrate it between platforms, Aegir moves a copy of <code>local.settings.php</code> as well.</p>

<h4>Using drush_hook_provision_drupal_config</h4>

<p>You can also use the API to add module-specific site configurations with hook_provision_drupal_config
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #007700">* </span><span style="color: #0000BB">Append PHP code to Drupal</span><span style="color: #DD0000">'s settings.php file.<br /> * <br /> * To use templating, return an include statement for the template.<br /> *<br /> * @param $uri<br /> *&nbsp;&nbsp; URI for the site.<br /> * @param $data<br /> *&nbsp;&nbsp; Associative array of data from provisionConfig_drupal_settings::data.<br /> *<br /> * @return<br /> *&nbsp;&nbsp; Lines to add to the site'</span><span style="color: #0000BB">s settings</span><span style="color: #007700">.</span><span style="color: #0000BB">php file</span><span style="color: #007700">.<br /> *<br /> * @</span><span style="color: #0000BB">see provisionConfig_drupal_settings<br /> </span><span style="color: #007700">*/<br />function </span><span style="color: #0000BB">drush_hook_provision_drupal_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$config</span><span style="color: #007700">) {<br />&nbsp; return </span><span style="color: #DD0000">'$conf[\'reverse_proxy\'] = TRUE;'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>For example it could look like this
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">drupalwiki_provision_drupal_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$config</span><span style="color: #007700">) {<br />&nbsp; </span><span style="color: #0000BB">$extra </span><span style="color: #007700">= </span><span style="color: #0000BB">drush_get_option</span><span style="color: #007700">(</span><span style="color: #DD0000">'site_extra_settings'</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">);<br />&nbsp; </span><span style="color: #FF8000">// remove window CR<br />&nbsp; </span><span style="color: #0000BB">$extra </span><span style="color: #007700">= </span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"\r"</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">,</span><span style="color: #0000BB">$extra</span><span style="color: #007700">);<br />&nbsp; return </span><span style="color: #0000BB">$extra</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>That is used to add the site settings added by the UI in the hosting backend implemented in <a href="https://github.com/EugenMayer/hosting_site_settings" title="https://github.com/EugenMayer/hosting_site_settings">https://github.com/EugenMayer/hosting_site_settings</a></p>

<h3>Aegir-wide Customization</h3>

<p>In some situations you may want to implement the same configuration settings on all your Aegir sites.  This is where <code>global.inc</code> comes in.  Note that <code>global.inc</code> is now included in <code>settings.php</code> <strong>before</strong> <code>local.settings.php</code>, so that Aegir system administrators no longer retain the ability to override configuration changes in <code>local.settings.php</code>, but instead it is possible to override global settings per site (read why this has been changed: <a href="http://drupal.org/node/1044938" title="http://drupal.org/node/1044938">http://drupal.org/node/1044938</a> - note: this change is available since 0.4-rc1 release).</p>

<p>For example, say the system administrator wanted to limit users' session lifetimes to a maximum of one day they could create a <code>global.inc</code> as follows:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #FF8000"># Aegir-wide Drupal customization<br /><br /># override Aegir-generated cookie policy for all sites - set cookies to expire after a day (86,400 seconds)<br /></span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">86400</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>You can even set more granular policy within <code>global.inc</code> (however it makes more sense to keep site-specific overrides in the local.settings.php):</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #FF8000"># Aegir-wide Drupal customization<br /><br /># override Aegir-generated cookie policy for all sites - set cookies to expire after a day (86,400 seconds)<br /></span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">86400</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000"># Make the aegir front-end server more secure by expiring cookies immediately<br /></span><span style="color: #007700">if (</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/hostmaster/"</span><span style="color: #007700">, </span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'install_profile'</span><span style="color: #007700">])) {<br />&nbsp; </span><span style="color: #FF8000"># set cookies to expire immediately on hostmaster<br />&nbsp; </span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>If you are using Aegir to manage multiple remote webservers, you will need to run the Verify task on the webserver in order to push global.inc to the remote machine.</p>

<p>Note: on some Aegir installations (e.g. alpha14) the permissions on <code>/var/aegir/config</code> are insufficent for Apache to properly include the <code>global.inc</code> file.  If you find that the configuration settings in <code>global.inc</code> are being ignored, change the permissions with <code>chmod a+x /var/aegir/config</code>.  This only has to be applied to the config directory as the sub directory and file permissions should be correct.</p>

<p>If you have other configuration examples, create a wiki and reference it here.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-63.html?destination=node%2F71%23comment-form">Login</a> or <a href="../user/register/index-63.html?destination=node%2F71%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-3007" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/injecting-drushrcphp/index.html">Injecting into drushrc.php</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>The <code>drushrc.php</code> file can be changed in two ways:</p>

<ol>
<li>by changing the templates used for the Drushrc context (see the <a href="http://api.aegirproject.org/api/aegir/provision3%21provision.api.php/function/hook_provision_config_load_templates/7.x-3.x">hook_provision_config_load_templates()</a> hook)</li>
<li>by creating a <code>local.drushrc.php</code> file in the site-specific folder (e.g. <code>sites/example.com/local.drushrc.php</code></li>
</ol>

<p>This is a stub. You can put more stuff here and it would be prettier.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-64.html?destination=node%2F3007%23comment-form">Login</a> or <a href="../user/register/index-64.html?destination=node%2F3007%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-515" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../contrib-modules/index.html">Contributed Modules</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc10">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Aegir_7.x-3.x"><span class="toc-number">1. </span>Aegir 7.x-3.x</a></li>
	<li class="toc-level-1"><a href="#Extensions_to_Hostmaster_frontend"><span class="toc-number">2. </span>Extensions to Hostmaster (frontend)</a>
<ol>
	<li class="toc-level-2"><a href="#Verified_in_Aegir_2.x"><span class="toc-number">2.1. </span>Verified in Aegir 2.x</a></li>
	<li class="toc-level-2"><a href="#Aegir_1.x"><span class="toc-number">2.2. </span>Aegir 1.x</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Extensions_to_Provision_backend"><span class="toc-number">3. </span>Extensions to Provision (backend)</a></li>
	<li class="toc-level-1"><a href="#Themes"><span class="toc-number">4. </span>Themes</a></li>
	<li class="toc-level-1"><a href="#Puppet_modules_and_Chef_cookbooks"><span class="toc-number">5. </span>Puppet modules and Chef cookbooks</a></li>
	<li class="toc-level-1"><a href="#Others"><span class="toc-number">6. </span>Others</a></li>
	<li class="toc-level-1"><a href="#Your_module_here"><span class="toc-number">7. </span>Your module here?</a></li>
</ol>
</div>
</div>

<h2 id="Aegir_7.x-3.x">1. Aegir 7.x-3.x</h2>

<p><a href="../content/contrib-modules/contribs-aegir-7x-3x/index.html">Contrib modules for the upcomming version are listed on a sub page</a></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Extensions_to_Hostmaster_frontend">2. Extensions to Hostmaster (frontend)</h2>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Verified_in_Aegir_2.x">2.1. Verified in Aegir 2.x</h3>

<dl>
<dt><a href="https://drupal.org/project/hosting_tasks_extra">Aegir HTTP basic authentication</a> (now included in hosting_tasks_extra)</dt>
<dd>This module allows you to protect sites with passwords.</dd>

<dt><a href="http://drupal.org/project/hosting_server_titles">Hosting server titles</a></dt>
<dd>This is a really simple module that allows you to change the names of servers that are displayed in lists in the Hosting frontend when choosing what server to use for something.</dd>

<dt><a href="http://drupal.org/project/hosting_site_backup_manager">Hosting site Backup Manager</a></dt>
<dd>Add a backups tab to a site node. It extends the default backup functionality with the ability to download a backup over HTTP.</dd>

<dd>Now also includes the functionality from <a href="http://drupal.org/project/hosting_backup_gc">Hosting backup garbage collection</a> and <a href="http://drupal.org/project/hosting_backup_queue">Hosting backup queue</a></dd>

<dt><a href="http://drupal.org/project/hosting_site_git">Hosting site Git</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Git pull', 'Git checkout' and 'Git clone' task for sites.</dd>

<dt><a href="http://drupal.org/project/hosting_platform_git">Hosting platform Git</a></dt>
<dd>Provides integration with Aegir that allows provisioning a platform from a git repository (also allows specifying the branch or tag name)</dd>

<dt><a href="http://drupal.org/project/hosting_tasks_extra">Hosting tasks extra</a></dt>
<dd>This module extends Aegir hostmaster (and drush/provision) with some additional tasks. Such as: cache-clear and registry-rebuild.</dd>

<dd>Now also includes the functionality from <a href="https://github.com/computerminds/aegir_http_basic">Aegir HTTP basic authentication</a></dd>

<dt><a href="http://drupal.org/project/hosting_dblogin">Hosting database login</a></dt>
<dd>Provides a link to login into a PHPMyAdmin instance (or other db management web software) configured for the current site database server. Requires dblogin to be installed on the site.</dd>

<dt><a href="http://drupal.org/project/hosting_piwik">Aegir Piwik integration</a></dt>
<dd>Makes it easy to connect an Aegir instance and a Piwik instance.  When you create a site in Aegir, the site is registered in Piwik.  When you verify the site in Aegir, new site aliases (if any) get added to Piwik.  Also adds system variables to settings.php in order to integrate properly with the <a href="http://www.drupal.org/project/piwik">Piwik</a> module.</dd>
</dl>

<p><strong>Note: There's a good chance that other Aegir 1.x contrib modules also work on 2.x</strong></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Aegir_1.x">2.2. Aegir 1.x</h3>

<dl>
<dt><a href="http://drupal.org/project/uc_hosting">Aegir Ubercart Integration</a></dt>
<dd>This module allows you to sell an gir client, with quotas and access to specific platforms, through Ubercart . It automates a number of set-up tasks from the moment the order ...</dd>

<dt><a href="https://github.com/computerminds/aegir_http_basic">Aegir HTTP basic authentication</a></dt>
<dd>This module allows you to protect sites with passwords.</dd>

<dt><a href="https://github.com/poetaster/aegir_http_basic_ldap">Aegir HTTP basic LDAP authentication</a></dt>
<dd>A fork of the above to allow you to specify an LDAP server and Require (ldap filter) string for authentication of 'sites'.</dd>

<dt><a href="http://drupal.org/project/aegir_feeds">Aegir feeds</a></dt>
<dd>This is a very basic module that provides feeds integration with Aegir . Features Provides mapping targets for Aegir site nodes, allowing you to create new sites from a feed or file upload.</dd>

<dt><a href="http://drupal.org/project/hosting_piwik">Aegir Piwik integration</a></dt>
<dd>Makes it easy to connect an Aegir instance and a Piwik instance.  When you create a site in Aegir, the site is registered in Piwik.  When you verify the site in Aegir, new site aliases (if any) get added to Piwik.  Also adds system variables to settings.php in order to integrate properly with the <a href="http://www.drupal.org/project/piwik">Piwik</a> module.</dd>

<dt><a href="http://drupal.org/project/aegir_rules">Aegir Rules</a></dt>
<dd>Aegir Rules provides Rules integration for the Aegir.</dd>

<dt><a href="https://github.com/computerminds/aegir_make_working_copy">Aegir Drush Make Platform working-copy</a></dt>
<dd>This feature allows you to specify 'working-copy' when adding a platform using a Drush makefile. Working-copy means your .git subdirectories are preserved in the platform, which may be useful for development purposes.</dd>

<dt><a href="http://mig5.net/content/aegir-subfolder-support">Aegir Subfolders</a></dt>
<dd>Support for 'example.com/subsite1' style sites in Aegir (experimental as of July 2012)</dd>

<dt><a href="http://drupal.org/project/hosting_platform_pathauto">Hosting Platform Pathauto</a></dt>
<dd>This is an add-on module for the Aegir hosting system: <a href="http://aegirproject.org/" title="http://aegirproject.org/">http://aegirproject.org/</a> This module simply makes a little time-saving tweak when creating a new platform: ...</dd>

<dt><a href="http://drupal.org/project/hosting_queue_runner">Hosting queue runner</a></dt>
<dd>This module allows the Hosting tasks queue for the Aegir project to be 'daemonized' so that tasks are run as soon as possible instead of waiting for a cron run. This makes Aegir appear much more responsive. This module was inspired by the Waiting queue project. Requirements You will need ...</dd>

<dt><a href="http://drupal.org/project/hosting_reinstall">Hosting Reinstall</a></dt>
<dd>The Hosting Reinstall module provides a frontend for the <a href="http://drupal.org/project/provision_reinstall">Provision Reinstall</a> module so that you can reinstall any sites via Hostmaster (Aegir).</dd>

<dt><a href="http://drupal.org/project/hosting_backup_gc">Hosting backup garbage collection</a></dt>
<dd>This is an add-on module for the Aegir hosting system: <a href="http://aegirproject.org/" title="http://aegirproject.org">http://aegirproject.org</a> Introduction This module allows you to specify how long Aegir should retain backups for. You can specify, ...</dd>

<dt><a href="http://drupal.org/project/hosting_backup_queue">Hosting backup queue</a></dt>
<dd>This is a simple module for the Aegir project that allows scheduling of backups. E.g. backup sites every hour, day or month. The module allows for the general settings to be applied to all sites, ...</dd>

<dt><a href="http://drupal.org/project/hosting_site_backup_manager">Hosting site Backup Manager</a></dt>
<dd>Add a backups tab to a site node. It extends the default backup functionality with the ability to download a backup over HTTP.</dd>

<dt><a href="http://drupal.org/project/hosting_site_git">Hosting site Git</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Git pull', 'Git checkout' and 'Git clone' task for sites.</dd>

<dt><a href="http://drupal.org/project/hosting_upload">Hosting upload</a></dt>
<dd>This module allows administrators to add platforms to aegir and extend platforms and sites with modules, themes, libraries without the need of ssh access.</dd>

<dt><a href="http://drupal.org/project/hosting_profile_roles">Hosting Profile Roles</a></dt>
<dd>Hosting Profile Roles extends Aegir to enable more control over what role(s) a client is assigned during site install. Since, by default, Aegir client's are given UID1 during site installs, this module also allows UID1 to be assigned to another user.</dd>

<dt><a href="http://drupal.org/project/hosting_server_titles">Hosting server titles</a></dt>
<dd>This is a really simple module that allows you to change the names of servers that are displayed in lists in the Hosting frontend when choosing what server to use for something.</dd>

<dt><a href="../node/311/index.html">Services API Support</a></dt>
<dd>Integrates the Services API framework into the Hostmaster suite of tools. It allows Aegir managers the ability to build Services API connections over any of the available servers for Services API.</dd>

<dt><a href="http://drupal.org/project/hosting_advanced_cron">Hosting Advanced Cron</a></dt>
<dd>This module allows an administrator to set the default cron interval globally and to override that interval for individual sites.</dd>

<dt><a href="http://drupal.org/project/hosting_features">Hosting Features</a></dt>
<dd>This module provides a Task to Hostmaster that provides integration with a site's Features. (In beta as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/hosting_notifications">Hosting Notifications</a></dt>
<dd>This is a module that integrates with the Notifications framework. This allows you to receive notifications about task execution in various formats.</dd>

<dt><a href="http://drupal.org/project/hosting_task_gc">Hosting Task Garbage Collection</a> (merged into Aegir 7.x-3.x)</dt>
<dd>This module will delete rows in the {hosting_task} and {hosting_task_log} tables. (In alpha as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/hosting_remote_import">Hosting Remote Import</a></dt>
<dd>This Drupal module provides a UI for fetching sites from remote Aegir servers. (In development as of June 1, 2012)</dd>

<dt><a href="http://drupal.org/project/hosting_varnish">Hosting Varnish</a></dt>
<dd>Allows the Varnish cache for Aegir-managed sites to be purged via the user interface. (In alpha as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/hosting_civicrm_cron">Hosting CivicCRM Cron</a></dt>
<dd>This module provides the ability to trigger CiviCRM cron jobs on sites hosted on the Aegir Hosting System.</dd>

<dt><a href="http://drupal.org/project/hosting_tasks_extra">Hosting tasks extra</a></dt>
<dd>This module extends Aegir hostmaster (and drush/provision) with some additional tasks. Such as: cache-clear and registry-rebuild.</dd>

<dt><a href="http://drupal.org/project/hosting_filemanager">Hosting Filemanager</a></dt>
<dd>This module provides a web file browser for viewing files under sites and platforms. (In beta as of August 29,2012)</dd>

<dt><a href="http://drupal.org/sandbox/mccrodp/1819860">Hosting Signup Settings</a></dt>
<dd>This module is dependent on hosting_signup module in the hosting package of Aegir. It allows the Signup form at /hosting/signup to be configured. (Sandbox project, October 22, 2012)</dd>

<dt><a href="https://github.com/doka/uc_hosting_client">Hosting Client Roles</a></dt>
<dd>Client Roles module integrates Aegir user roles into hosting_products as product
feature. With this module you can assign Aegir user roles to Ubercart products, and sell
them as hosting products. This module is part of the "Hosting &amp; Ubercart Integration" package, and depends on uc_hosting and uc_hosting_products modules</dd>

<dt><a href="http://drupal.org/project/hosting_solr">Hosting Solr</a></dt>
<dd>Works with <a href="http://drupal.org/project/provision_solr">Provision Solr</a> to give Aegir the ability to manage Solr servers and and gives sites a Solr database.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Extensions_to_Provision_backend">3. Extensions to Provision (backend)</h2>

<dl>
<dt><a href="http://drupal.org/project/provision_boost">Provision boost support</a></dt>
<dd>the Aegir project and therefore depends on the provision backend and expects the Aegir environment to be functional. Quickstart Download the provision_boost code into your /var/aegir/.drush/ Download ...</dd>

<dt><a href="http://drupal.org/project/provisionacl">Provision ACL support</a></dt>
<dd>This drush command aims to provide preliminary ACL support for the Aegir backend . The objective here is to allow administrators to set more granular access policies on files managed by Aegir and resolve more hairy access permissions requirements than what is usually allowed by the Aegir core. ...</dd>

<dt><a href="http://drupal.org/project/project_status">Project Status</a></dt>
<dd>Project status is an extension for drush which takes a list of drupal platforms as arguments and returns a list of modules which are not in use by any site within these platforms. It is also optionally able to list modules which are use, by platform and site.</dd>

<dt><a href="http://drupal.org/project/provision_civicrm">Provision CiviCRM</a></dt>
<dd>A Drush module to automatically setup Drupal instances with the CiviCRM Constituent Relationship Management solution. It is specifically aimed towards the Aegir project.</dd>

<dt><a href="http://drupal.org/sandbox/helmo/1283656">Provision Backup Platform</a></dt>
<dd>This hooks into deleting a platform and creates a simple tar backup.</dd>

<dt><a href="http://drupal.org/project/kplatforms">kPlatforms</a></dt>
<dd>Koumbit's "standard Drupal platforms", a set of makefiles to build and maintain development and production platforms easily.</dd>

<dt><a href="http://drupal.org/project/provision_git">Provision Git</a></dt>
<dd>Provision Git is a backend Drush module. It provides 4 drush commands. (In alpha as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/provision-mergelog">Provision Merge Log</a></dt>
<dd>This Aegir extension allows you to automate fetching and merging logs from multiple servers part of the same cluster in a single logfile for later analysis with various analysis tools</dd>

<dt><a href="http://drupal.org/project/provision_cdn">Provision CDN</a></dt>
<dd>This is a simple module and drush script for that allows you to enable CDN support per site in Aegir. (In development as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/provision_profile_settings">Provision profile settings</a></dt>
<dd>Incredibly simple extension for provision that allows install profiles to easily inject settings into settings.php for provisioned sites.</dd>

<dt><a href="http://drupal.org/project/provision_newrelic">Provision New Relic</a></dt>
<dd>This is a simple extension that exposes all sites in New Relic, so you can monitor each sites performance.</dd>

<dt><a href="http://drupal.org/project/provision_solr">Provision Solr</a></dt>
<dd>Works with <a href="http://drupal.org/project/hosting_solr">Hosting Solr</a> to give Aegir the ability to manage Solr servers and and gives sites a Solr database.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Themes">4. Themes</h2>

<ul>
<li>Koumbit has provided it's <a href="http://drupal.org/project/eldir_kt">custom Aegir theme</a> as a sample subtheme of <a href="http://drupal.org/project/eldir">Eldir</a>.</li>
<li><a href="https://www.drupal.org/project/saeven">Saeven</a>, a clone of the core theme Seven, based on Omega 4 or 5, clean, simple and responsive.</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Puppet_modules_and_Chef_cookbooks">5. Puppet modules and Chef cookbooks</h2>

<p>Those projects allow you to manage Aegir instance(s) through Puppet. Chef recipes also welcome, we don't discriminate.</p>

<ul>
<li><a href="http://drupal.org/project/puppet-aegir">Aegir Puppet module</a></li>
<li><a href="http://drupal.org/project/puppet-drush">Drush Puppet module</a></li>
<li><a href="https://supermarket.chef.io/cookbooks/aegir2">Aegir Chef cookbook</a></li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Others">6. Others</h2>

<dl>
<dt><a href="http://drupal.org/project/aegir-up">Aegir up</a></dt>
<dd>Aegir-up is a Drush extension that deploys a local instance of the Aegir Hosting System atop Vagrant and Virtualbox, for development and testing purposes.</dd>

<dt><a href="http://drupal.org/project/devshop">DevShop</a></dt>
<dd>DevShop is a Drupal Development Environment Manager built on Aegir.</dd>

<dd>
<p>DevShop creates Aegir platforms and sites automatically from Git URLs.  It tracks multiple Projects and allows multiple environments to be created for each Project, such as dev, test, and live.  It provides tools to Pull Code, Sync Data, Commit Features, and Run Tests on these environments, and provides a dashboard with useful links and information for developers.</p>
</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Your_module_here">7. Your module here?</h2>

<p><em>Developers:</em> Please add your contributed module here, and feel free to put install instructions or other documentation in a child page. If you are looking for ways of extending Aegir or have already done so and want to document the <em>internals</em> of your module, head over to the <a href="../contrib/index.html">extending Aegir</a> page.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-12.html?destination=node%2F515%23comment-form">Login</a> or <a href="../user/register/index-12.html?destination=node%2F515%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-311" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../contrib-modules/aegir-services/index.html">Aegir Services</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p><a href="http://drupal.org/project/hosting_services">Aegir Services</a> integrates the Services API framework into the Hostmaster suite of tools. It allows Aegir managers the ability to build Services API connections over any of the available servers for Services API.</p>

<p>Using Services 3.x we are aiming at full CRUD support for clients, tasks and sites, as well as read access to profiles, platforms, and eventually, packages.</p>

<p>The 2.x branch of <a href="../node/516/index.html">Aegir Ubercart Integration</a> will take advantage of this support to provide a remote storefront functionality.</p>

<p>Please report issues and request support via the <a href="http://drupal.org/project/issues/hosting_services?categories=All">issue queue on Drupal.org</a></p>

<h2>Installation</h2>

<ol>
<li>Install <a href="../installing/index.html">Aegir</a></li>
<li>Install the <strong>dev</strong> version of <a href="http://drupal.org/project/services">services 3.x</a>, including at least one server and, ideally, an authentication server.</li>
<li>Install this module.</li>
<li><a href="http://drupal.org/node/736522">Configure your endpoint, it's resources and authentication, normally</a>.</li>
<li>Optionally, test your rest server using the included bash script, <code>hosting_services.rest_test.sh</code></li>
</ol>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/311/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-12861" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/contrib-modules/contribs-aegir-7x-3x/index.html">Contribs for Aegir 7.x-3.x</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc11">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Extensions_to_Hostmaster_frontend"><span class="toc-number">1. </span>Extensions to Hostmaster (frontend)</a></li>
	<li class="toc-level-1"><a href="#Extensions_to_Provision_backend"><span class="toc-number">2. </span>Extensions to Provision (backend)</a></li>
	<li class="toc-level-1"><a href="#Themes"><span class="toc-number">3. </span>Themes</a></li>
	<li class="toc-level-1"><a href="#Puppet_modules_and_Chef_cookbooks"><span class="toc-number">4. </span>Puppet modules and Chef cookbooks</a></li>
	<li class="toc-level-1"><a href="#Others"><span class="toc-number">5. </span>Others</a></li>
	<li class="toc-level-1"><a href="#Your_module_here"><span class="toc-number">6. </span>Your module here?</a></li>
</ol>
</div>
</div>

<h2 id="Extensions_to_Hostmaster_frontend">1. Extensions to Hostmaster (frontend)</h2>

<dl>
<dt><a href="http://drupal.org/project/hosting_git">Hosting Git</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Git pull', 'Git checkout' and 'Git clone' task for sites.</dd>

<dd>The successor of Hosting site Git &amp; Hosting platform Git</dd>

<dt><a href="http://drupal.org/project/hosting_logs">Hosting Logs</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Logs' tab to sites and platforms. Showing Apache error, Git commit and watchdog logs.</dd>

<dt><a href="http://drupal.org/project/hosting_platform_pathauto">Hosting Platform Pathauto</a></dt>
<dd>This is an add-on module for the Aegir hosting system: <a href="http://aegirproject.org/" title="http://aegirproject.org/">http://aegirproject.org/</a> This module simply makes a little time-saving tweak when creating a new platform: ...</dd>

<dt><a href="https://github.com/mglaman/hosting_site_make">Hosting site make</a></dt>
<dd>Allows a site to have its modules built from a makefile in the sites directory.</dd>

<dt><a href="http://drupal.org/project/hosting_tasks_extra">Hosting tasks extra</a></dt>
<dd>This module extends Aegir hostmaster (and drush/provision) with some additional tasks. Such as: cache-clear and registry-rebuild.</dd>

<dd>Now also includes the functionality from <a href="https://github.com/computerminds/aegir_http_basic">Aegir HTTP basic authentication</a></dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Extensions_to_Provision_backend">2. Extensions to Provision (backend)</h2>

<p>Starting from Aegir 7.x-3.x the Drush component can be included in a 'drush' directory in the same git repository as the hosting module.</p>

<p>Therefore this list will be shorter then for previous versions.</p>

<dl>
<dt><a href="https://github.com/mlutfy/provision_sts">Provision STS</a></dt>
<dd>Adds the Strict Transport Security header to hosts that require SSL.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Themes">3. Themes</h2>

<ul>
<li><a href="https://www.drupal.org/project/saeven">Saeven</a></li>
<li><a href="http://drupal.org/project/eldir">Eldir</a>. (The default theme)</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Puppet_modules_and_Chef_cookbooks">4. Puppet modules and Chef cookbooks</h2>

<p>Those projects allow you to manage Aegir instance(s) through Puppet. Chef recipes also welcome, we don't discriminate.</p>

<ul>
<li><a href="http://drupal.org/project/puppet-aegir">Aegir Puppet module</a></li>
<li><a href="http://drupal.org/project/puppet-drush">Drush Puppet module</a></li>
<li><a href="https://supermarket.chef.io/cookbooks/aegir3">Aegir3 Chef Cookbook</a></li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Others">5. Others</h2>

<dl>
<dt><a href="http://drupal.org/project/aegir-up">Aegir up</a></dt>
<dd>Aegir-up is a Drush extension that deploys a local instance of the Aegir Hosting System atop Vagrant and Virtualbox, for development and testing purposes.</dd>

<dt><a href="http://drupal.org/project/devshop">DevShop</a></dt>
<dd>DevShop is a Drupal Development Environment Manager built on Aegir.</dd>

<dd>
<p>DevShop creates Aegir platforms and sites automatically from Git URLs.  It tracks multiple Projects and allows multiple environments to be created for each Project, such as dev, test, and live.  It provides tools to Pull Code, Sync Data, Commit Features, and Run Tests on these environments, and provides a dashboard with useful links and information for developers.</p>
</dd>

<dt><a href="https://github.com/Lab43/aegir-pathologic-files">Aegir Pathologic Files</a></dt>
<dd>A tiny Drupal Module to simplify file paths in content. This helps prevent broken images when the site directory name changes. Requires an apache rewrite rule to point /files to /sites/example.com/files, which Aegir provides by default.</dd>

<dd>This module is not for hostmaster, but for the sites hosted under Aegir.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Your_module_here">6. Your module here?</h2>

<p><em>Developers:</em> Please add your contributed module here, and feel free to put install instructions or other documentation in a child page. If you are looking for ways of extending Aegir or have already done so and want to document the <em>internals</em> of your module, head over to the <a href="../contrib/index.html">extending Aegir</a> page.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-65.html?destination=node%2F12861%23comment-form">Login</a> or <a href="../user/register/index-65.html?destination=node%2F12861%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2325" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/contrib-modules/devshop-provision/index.html">DevShop Provision</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Homepage: <a href="http://drupal.org/project/devshop" title="http://drupal.org/project/devshop">http://drupal.org/project/devshop</a></p>

<h1>DevShop Provision</h1>

<p>Drupal development infrastructure made easy.</p>

<p>This module provides the backend commands needed to 
deploy and manage sites using the DevShop git and features 
based development workflow.</p>

<h2>About DevShop</h2>

<p>The goals of DevShop are...</p>

<ol>
<li>to simplify management of multiple environments for multiple Drupal projects.</li>
<li>to provide web-based tools that streamline the Drupal site building workflow.</li>
<li>to provide a common, open-source infrastructure for Drupal development shops.</li>
</ol>

<h2>Installation</h2>

<p>To install devshop_provision, simply use drush:</p>

<p>$ drush dl devshop_provision</p>

<p>Or, you can download the source code to any available drush commands folder,
such as /usr/share/drush or ~/.drush</p>

<h2>Usage</h2>

<p>DevShop Provision works by providing a new Provision class called "Project".</p>

<p>To start, you must have a Project drush alias.  Using the DevShop+Hostmaster
system will make this much easier, but if you wish to only use the backend, you
can create a project alias with provision-save, for project NAME:
<div class="codeblock"><code>&nbsp; $ drush provision-save project_NAME --context_type=project --code_path=/var/aegir/projects/NAME --git_url=http://git.url/to/repo.git --base_url=NAME.server.com</code></div></p>

<p><div class="codeblock"><code>&nbsp;&nbsp;&nbsp; $ drush provision-save project_NAME --project_name=NAME --context_type=project --code_path=/var/aegir/projects/NAME --git_url=git@github.com:devudo/drupal-flat.git --base_url=NAME.server.com</code></div></p>

<h2>Commands</h2>

<p>DevShop contains a set of features that make Drupal site building within a
version-controlled code workflow quick and easy.</p>

<p>Currently you must create new platforms within a project in hostmaster.  Once created, you can execute the following commands:</p>

<h2>1. Pull Code</h2>

<p><div class="codeblock"><code>&nbsp; $ drush @project_NAME provision-devshop-pull ENVIRONMENT</code></div></p>

<p>This task runs on the dev platform for this project. It runs git pull, and
  optionally runs new updates, reverts features, and clears caches.  It is used
  to keep the dev server up to date on every commit via the devshop_pull module,
  and can be used as the deployment task.</p>

<ul>
<li>Git Pull the code for your site's platform.</li>
<li>Then, all optionally:

<ul>
<li>Run update.php.</li>
<li>Revert all Features modules</li>
<li>Clear caches</li>
</ul></li>
</ul>

<h2>2. Commit Features</h2>

<p><div class="codeblock"><code>&nbsp; $ drush @project_NAME provision-devshop-commit ENVIRONMENT --message=&quot;My Commit&quot;</code></div></p>

<p>This task integrates with Features.module to make it very easy to commit
  your changes to your features.</p>

<ul>
<li>Calls drush features-update-all</li>
<li>Commits the result, with a part automated and part customized commit message.</li>
<li>(Optionally) pushes the commits.</li>
<li>(Optionally) force-reverts after a commit.</li>
</ul>

<h2>3. Sync Content</h2>

<p><div class="codeblock"><code>&nbsp; $ drush @project_NAME provision-devshop-sync SOURCE_ENVIRONMENT DESTINATION_ENVIRONMENT</code></div></p>

<p>This task makes it easy to syncronize the database and files down from other
  environments within the project.</p>

<p>WARNING: This will DESTROY the destination site's database!</p>

<p>This task:</p>

<ul>
<li>(optionally) Pulls code</li>
<li>Drops the @destination database.</li>
<li>Creates an SQL dump from @source.</li>
<li>Copies the SQL dump to the local system (if @source is a remote).</li>
<li>Imports the SQL dump into @destination database.</li>
<li>(optionally) Runs update.php.</li>
<li>(optionally) Runs features-revert-all.</li>
<li>(optionally) Clears all caches.</li>
</ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-66.html?destination=node%2F2325%23comment-form">Login</a> or <a href="../user/register/index-66.html?destination=node%2F2325%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2326" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/content/contrib-modules/devshop-provision/commands/index.html">Commands</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h1>$ drush --filter=devshop_provision</h1>

<p><div class="codeblock"><code>All commands in devshop_provision: (devshop_provision)<br /> provision-devshop-co&nbsp; Export the site&#039;s Features and commit the result.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> mmit (pdc)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> provision-devshop-pu&nbsp; Pull &amp; verify platform code and (optionally) run update.php, clear cache, and revert features. <br /> ll (pdp)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> provision-devshop-sy&nbsp; Sync database (and files, coming soon) from a chosen source site.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> nc (pds)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> provision-devshop-te&nbsp; Run a group of SimpleTest tests.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> st (pdt)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div></p>

<h1>$ drush provision-devshop-commit --help</h1>

<p><div class="codeblock"><code>Export the site&#039;s Features and commit the result.<br /><br />Examples:<br /> drush @project_mysite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Recreates and Commits all features from the dev environment of @project_mysite with an additional commit <br /> provision-devshop-commit dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; message.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --message=&quot;changed some settings&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Arguments:<br /> environment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The name of the environment to commit from. <br /><br /><br />Options:<br /> --message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add a commit message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --revert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Force revert all features after exporting and committing. <br /><br /><br />Aliases: pdc</code></div></p>

<h1>$ drush provision-devshop-pull --help</h1>

<p><div class="codeblock"><code>Pull &amp; verify platform code and (optionally) run update.php, clear cache, and revert features.<br /><br />Examples:<br /> drush @project_mysite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Triggers a git pull and a clear cache command on @project_mysite&#039;s dev and test environments. <br /> provision-devshop-pull dev test --cache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Arguments:<br /> environments&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A list of environment names to Pull Code to. <br /><br /><br />Options:<br /> --update&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Run update.php after code pull.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --revert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Revert all features after code pull. <br /> --cache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Clear all caches after code pull.&nbsp;&nbsp;&nbsp; <br /><br /><br />Aliases: pdp</code></div></p>

<h1>$ drush provision-devshop-sync --help</h1>

<p><div class="codeblock"><code>Sync database (and files, coming soon) from a chosen source site.<br /><br />Examples:<br /> drush @project_mysite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Syncs the database from for project_mysite&#039;s live to&nbsp; project_mysite&#039;s dev server. <br /> provision-devshop-sync live dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Arguments:<br /> from&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Environment to sync from. <br /> to&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Environment to sync to.&nbsp;&nbsp; <br /><br /><br />Options:<br /> --update&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Run update.php after content sync.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --revert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Revert all features after content sync. <br /> --cache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Clear all caches after content sync.&nbsp;&nbsp;&nbsp; <br /> --files&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sync site files.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Aliases: pds</code></div></p>

<h1>$ drush provision-devshop-test --help</h1>

<p><div class="codeblock"><code>Run a group of SimpleTest tests.<br /><br />Arguments:<br /> environment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The name of the environment to run tests on. <br /><br /><br />Options:<br /> --tests-to-run&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The list of tests to run.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --sync-from-live&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sync contents from Live before running tests. <br /><br /><br />Aliases: pdt</code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-67.html?destination=node%2F2326%23comment-form">Login</a> or <a href="../user/register/index-67.html?destination=node%2F2326%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-526" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/contrib-modules/provision-acl/index.html">Provision ACL</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>This page documents the <a href="http://drupal.org/project/provisionacl">Provision ACL extension</a> to Aegir which allows more granular access control over your sites files and directories.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc12">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Install_instructions"><span class="toc-number">1. </span>Install instructions</a>
<ol>
	<li class="toc-level-2"><a href="#Download_and_install_provision"><span class="toc-number">1.1. </span>Download and install provision</a></li>
	<li class="toc-level-2"><a href="#Enable_ACLs_on_your_filesystem"><span class="toc-number">1.2. </span>Enable ACLs on your filesystem</a></li>
	<li class="toc-level-2"><a href="#Install_ACL_support_package"><span class="toc-number">1.3. </span>Install ACL support package</a></li>
	<li class="toc-level-2"><a href="#Create_a_UNIX_group"><span class="toc-number">1.4. </span>Create a UNIX group</a></li>
	<li class="toc-level-2"><a href="#Add_users_to_the_group"><span class="toc-number">1.5. </span>Add users to the group</a></li>
	<li class="toc-level-2"><a href="#Create_a_client"><span class="toc-number">1.6. </span>Create a client</a></li>
	<li class="toc-level-2"><a href="#Create_a_site"><span class="toc-number">1.7. </span>Create a site</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#What_it_does"><span class="toc-number">2. </span>What it does</a></li>
	<li class="toc-level-1"><a href="#LDAP_integration"><span class="toc-number">3. </span>LDAP integration</a></li>
	<li class="toc-level-1"><a href="#API_-_how_to_add_ACL_support_to_your_Aegir_extension"><span class="toc-number">4. </span>API - how to add ACL support to your Aegir extension</a></li>
	<li class="toc-level-1"><a href="#Caveats_ie._what_it_does_not"><span class="toc-number">5. </span>Caveats (ie. what it does not)</a></li>
	<li class="toc-level-1"><a href="#Debugging"><span class="toc-number">6. </span>Debugging</a></li>
	<li class="toc-level-1"><a href="#Notes"><span class="toc-number">7. </span>Notes</a></li>
</ol>
</div>
</div>

<h1 id="Install_instructions">1. Install instructions</h1>

<p>First, you'll need a running Aegir install (1.0-rc3 or later), see <a href="../installing/index.html" title="http://community.aegirproject.org/installing">http://community.aegirproject.org/installing</a>. Most (if not all) of these commands will have to be run as root (or using sudo, etc.)</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Download_and_install_provision">1.1. Download and install provision</h2>

<pre><code>drush dl provisionacl-6.x
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Enable_ACLs_on_your_filesystem">1.2. Enable ACLs on your filesystem</h2>

<pre><code>mount -o remount,acl /
</code></pre>

<p>Here we assume everything is under the root (<code>/</code>) filesystem here, otherwise run this command for every filesystem Aegir will work on (e.g. <code>/srv</code>, <code>/var</code> or <code>/home</code>).</p>

<p>You also need to edit your <code>/etc/fstab</code> for this configuration to survive reboots.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_ACL_support_package">1.3. Install ACL support package</h2>

<pre><code>apt-get install acl
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_a_UNIX_group">1.4. Create a UNIX group</h2>

<p>In this case we choose a group called "devs" but you can choose another name.</p>

<pre><code>groupadd devs
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Add_users_to_the_group">1.5. Add users to the group</h2>

<p>Add one or more UNIX users that you want to give access to that group. For an existing user (socrates32), this would look like:</p>

<pre><code>usermod -a -G devs socrates32
</code></pre>

<p>For a new user (ergonlogic), this would look like:</p>

<pre><code>useradd -G devs ergonlogic
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_a_client">1.6. Create a client</h2>

<p>Create a client (should be called "devs" for this example) in the frontend at /node/add/client.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_a_site">1.7. Create a site</h2>

<p>Create a site for the client in the frontend at /node/add/site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="What_it_does">2. What it does</h1>

<p>When the site is installed, members of the "devs" group will be able to write to the sites' directories (e.g. upload files and modules) and run drush commands on the site (yes, including site aliases, although see caveats below).</p>

<p>This works also for existing sites; make sure you create a group matching the internal name of the existing client and reverify the site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="LDAP_integration">3. LDAP integration</h1>

<p>Provisionacl supports LDAP groups as well. Ensure that an LDAP client is running and that the 'aegir' user can see the LDAP-provided groups:</p>

<pre><code>getent groups
</code></pre>

<p>You may need to restart the Name Service Cache Daemon (nscd):</p>

<pre><code>/etc/init.d/nscd restart
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="API_-_how_to_add_ACL_support_to_your_Aegir_extension">4. API - how to add ACL support to your Aegir extension</h1>

<p>To change ACLs on files, you should use something like this:</p>

<pre><code>if (function_exists('provisionacl_set_acl')) {
    provisionacl_files_acls(d()-&gt;site_path . '/mysettings.php');
}
</code></pre>

<p>You can optionnally pass a group as an argument, but it will guess that from the client name of the site. Also note that this will raise a drush error if setfacl fails, but just set a warning if the group doesn't exist.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Caveats_ie._what_it_does_not">5. Caveats (ie. what it does not)</h1>

<p>Giving shell access to users in Aegir is still insecure, see this upstream issue: <a href="http://drupal.org/node/762138">#762138</a>.</p>

<p>We aim to refactor this into the Aegir core in 2.x, but in the meantime this should provide a good workaround for the limitations of the existing permission system.</p>

<p>This will only work in 1.0 and above, as it needs the "client_name" field to be populated.</p>

<p>You will need to change your $HOME variable for aliases to work, because of this bug in drush: <a href="http://drupal.org/node/1104438">#1104438</a>. Example:</p>

<p><div class="codeblock"><code>env HOME=/var/aegir drush @hostmaster cc all</code></div></p>

<p>See also <a href="../node/494/index.html">this post for context and design</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Debugging">6. Debugging</h1>

<p>If for some reason you have lost the ACLs on the directories and you need to restore them, use the following commands, which is basically what the module does:</p>

<p><div class="codeblock"><code>cd sites/example.com<br />setfacl -R -m user:aegir:rwx .<br />setfacl -R -m default:user:aegir:rwx .<br />setfacl -R -m group:www-data:rwx .<br />setfacl -R -m d:group:www-data:rwx .<br />setfacl -R -m group:cl-group:rwx .<br />setfacl -R -m default:group:cl-admin:rwx .</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Notes">7. Notes</h1>

<p>This page is the reference documentation for the <a href="https://drupal.org/project/provisionacl">Provision ACL module page on Drupal.org</a> - keep this in mind when editing please.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-68.html?destination=node%2F526%23comment-form">Login</a> or <a href="../user/register/index-68.html?destination=node%2F526%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-516" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/516/index.html">Ubercart Integration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This module provides several features to ubercart products on an Aegir platform.</p>

<h2>Requirements</h2>

<ul>
<li>Hostmaster 6.x-1.0 or higher</li>
<li>Ubercart 6.x-2.4 or higher</li>
<li>Patience</li>
</ul>

<h2>Installation</h2>

<ol>
<li>Download the module and its dependencies into sites/all/modules on your hostmaster platform (<code>drush @hostmaster dl uc_hosting ubercart</code> should work)</li>
<li>Activate the clients feature for hostmaster (<code>admin/hosting/features</code>)</li>
<li>Enable the module uc_hosting_products. This should enable all dependencies (<code>drush @hostmaster en uc_hosting_products</code>)</li>
</ol>

<h2>Creating your first site product</h2>

<p><strong>N.B.</strong> A video introduction covering configuration is available from the DrupalCon London session <a href="http://london2011.drupal.org/conference/sessions/aegir-based-business-models">Aegir-based Business Models</a> (starting at 26:30).</p>

<ol>
<li>Create a product. Make sure it is not shippable. (<code>node/add/product</code>)</li>
<li>Edit the product. Go to the features tab.</li>
<li>Choose the "Create a site and adjust quotas accordingly" feature. It should use the sku of your product automatically.</li>
<li>For single-site products, make sure, on the product feature form, to check off "Force clients to create their site on purchase" if you want to be sure people create their site.</li>
<li>Now all you need is a drupal platform that any user can create sites on and you are ready to go. (<code>node/add/platform</code>)</li>
</ol>

<h2>Creating more complex offerings using product kits</h2>

<p>The method we recommend for creating complex offerings, including multiple site quotas and access to restricted platforms, is via Ubercart product kits.</p>

<ol>
<li>Enable uc_product_kit.</li>
<li>Create one or more uc_hosting products.</li>
<li>Create a product kit with these products in them in the appropriate quantities.</li>
</ol>

<h2>Support</h2>

<p>You can report bugs, request support and propose patches <a href="http://drupal.org/project/issues/uc_hosting">via our issue queue on Drupal.org</a>.</p>

<h2>Development</h2>

<p>If you would like to use uc_hosting to develop your own Aegir dependant product features, be sure to <a href="../creating-product-features-using-uchosting-1x/index.html">read the relevant documentation</a>.</p>

<p>Check out the <a href="../node/108/index.html">roadmap</a>.</p>

<h2>Other Resources</h2>

<ul>
<li><a href="../index.html">Aegir community site</a></li>
<li><a href="http://www.ubercart.org/docs">Ubercart Documentation</a></li>
<li>#aegir IRC channel on <a href="http://freenode.net/">freenode</a></li>
</ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-69.html?destination=node%2F516%23comment-form">Login</a> or <a href="../user/register/index-69.html?destination=node%2F516%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-888" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../contrib-modules/provision-civicrm/index.html">Provision CiviCRM</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p><a href="https://drupal.org/project/provision_civicrm">provision_civicrm</a> helps to manage the installation and upgrades of CiviCRM in Drupal sites managed with Aegir.</p>

<p>CiviCRM is not a typical Drupal module. It is a third-party system that integrates with Drupal, WordPress and Joomla for its front-end and permission system. CiviCRM has its own installer, upgrade system and cron. The "provision_civicrm" module helps to manage any CiviCRM+Drupal site as any other Drupal site managed in Aegir.</p>

<h3>Requirements</h3>

<ul>
<li>Aegir 2.x or 3.x</li>
<li><a href="https://drupal.org/project/hosting_civicrm">hosting_civicrm</a> must be installed in the hostmaster front-end (~/hostmaster-x-y/sites/example.org/modules).</li>
</ul>

<h3>Installation</h3>

<p>Download the provision_civicrm module as the "aegir" user:</p>

<pre><code>drush dl provision_civicrm-6.x-2.x
</code></pre>

<p>This should install the module in ~/.drush/provision_civicrm.</p>

<p>NB: provision_civicrm 6.x-2.x is a Drush module, and works with both Aegir 2 and Aegir 3. However, for Aegir 3, you must use the 7.x-3.x branch of the hosting_civicrm module.</p>

<h3>Creating a CiviCRM platform</h3>

<p>provision_civicrm assumes that if you have a CiviCRM installation in your sites/all/modules/civicrm, then this is a CiviCRM platform and CiviCRM should be installed automatically.</p>

<p>(A cleaner way, in theory, would be to have an install profile and let the user configure it through the front-end, patches welcome! -- however, you do not want any site to simply enable CiviCRM from the Drupal admin/build/modules, so having dedicated platforms for CiviCRM makes sense in any case.)</p>

<p>A sample drush makefile is provided with provision_civicrm.</p>

<p>Assuming you are running as the user 'aegir', whose $HOME is /var/aegir/, save this in a file such as ~/makefiles/drupal-6.22-civicrm-3.3.4.make</p>

<p>Then create the new platform:</p>

<pre><code>mkdir ~/platforms/drupal-6.22-civicrm-3.3.4
cd ~/platforms/drupal-6.22-civicrm-3.3.4
drush make ~/makefiles/drupal-6.22-civicrm-3.3.4.make
</code></pre>

<p>You can now add your platform in the Aegir front-end and then create new sites.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/888/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-13160" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/content/administrator/post-install-configuration/create-sudo-user-server-administration/index.html">Create a SUDO user for server administration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_602 first"><a href="../category/keywords/sudo/index.html" rel="tag" title="">sudo</a></li>
<li class="taxonomy_term_2"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
<li class="taxonomy_term_603 last"><a href="../category/keywords/users/index.html" rel="tag" title="">users</a></li>
</ul></div><p>Sometimes you will need to administer your server beyond what you can do as the Aegir user.</p>

<p>Examples include installing additional software or editing PHP configuration.</p>

<p>It's not recommended to use the <code>root</code> user for administering things as it can be easy to make mistakes that could break your system.</p>

<p>Instead of running as root, it is recommended to create a user for yourself that has sudo privileges.</p>

<h2>Create a user with SUDO privileges</h2>

<p>In ubuntu/debian systems, creating a user and giving them the ability to run commands with <code>sudo</code> is easy with the <code>adduser</code> command.</p>

<p>Think of a username and password for yourself, then run the following commands as root:</p>

<pre>
root@aegir:~# adduser bob
Adding user `bob' ...
Adding new group `bob' (1001) ...
Adding new user `bob' (1001) with group `bob' ...
Creating home directory `/home/bob' ...
Copying files from `/etc/skel' ...
Enter new UNIX password: 
Retype new UNIX password: 
passwd: password updated successfully
Changing the user information for bob
Enter the new value, or press ENTER for the default
    Full Name []: Bob
    Room Number []: 
    Work Phone []: 
    Home Phone []: 
    Other []: 
Is the information correct? [Y/n] y
root@aegir:~#
</pre>

<p>Then add them to the "sudo" user group:</p>

<pre>
root@aegir:~# adduser bob sudo
Adding user `bob' to group `sudo' ...
Adding user bob to group sudo
Done.
root@aegir:~# 
</pre>

<p>Then you can switch to the "bob" user using <code>sudo su</code>, or login via ssh with your password.</p>

<pre>
root@aegir:~# sudo su - bob
bob@aegir:~$
</pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-70.html?destination=node%2F13160%23comment-form">Login</a> or <a href="../user/register/index-70.html?destination=node%2F13160%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2799" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/content/administrator/post-install-configuration/experimental-aegir-2-ubuntu-1204-apache-php/index.html">Experimental: Aegir 2 on Ubuntu 12.04 with apache, php-fpm</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>These notes describe a possible way of installing Apache with fastcgi using php5-fpm.
The below configuration works but is experimental.</p>

<p>On a Ubuntu 12.04 box:</p>

<h2>Install Aegir2 from Debian packages</h2>

<p>Follow <a href="../installing/debian/index.html" title="http://community.aegirproject.org/installing/debian">http://community.aegirproject.org/installing/debian</a>. Below is a shortened form.</p>

<p>Add the Aegir package "Software Source" repository:
<div class="codeblock"><code>echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | sudo tee -a /etc/apt/sources.list.d/aegir-stable.list<br />wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | sudo apt-key add -</code></div></p>

<p>Install aegir2:
<div class="codeblock"><code>sudo apt-get update<br />sudo apt-get install mysql-server<br />sudo mysql_secure_installation<br />sudo apt-get install aegir2</code></div></p>

<p>If the installation fails, it might be that your FQDN is not set or your postfix is not configured.</p>

<h2>Verify your aegir site is working</h2>

<p>Navigate your browser to the FQDN of your aegir server. You need to see the "Welcome to Aegir" page.</p>

<h2>Modify the configuration to use fastcgi / php5-fpm</h2>

<p>Edit <code>/etc/apt/sources.list</code> and enable the multiverse repository (it's needed for the libapache2-mod-fastcgi package).</p>

<p>Then install php5-fpm and make apache use it:
<div class="codeblock"><code>sudo apt-get update<br />sudo apt-get install php5-fpm libapache2-mod-fastcgi<br />sudo apt-get --purge remove libapache2-mod-php5</code></div></p>

<p>Modify <code>/etc/php5/fpm/pool.d/www.conf</code>
Make it listen on socket, instead of IP:
<div class="codeblock"><code>;listen = 127.0.0.1:9000<br />listen = /var/run/php-fpm.sock</code></div></p>

<p>Create <code>/etc/apache2/conf.d/php-fpm.conf</code> with this content:
<div class="codeblock"><code>ScriptAlias /php5.fastcgi /var/www/fastcgi<br />FastCGIExternalServer /var/www/fastcgi -socket /run/php-fpm.sock<br />AddHandler php-fastcgi .php<br />Action php-fastcgi /php5.fastcgi virtual<br /><br />Options FollowSymLinks ExecCGI<br /><br />&lt;Directory /var/www/fastcgi&gt;<br />&nbsp; Options ExecCGI FollowSymLinks<br />&nbsp; SetHandler fastcgi-script<br />&nbsp; Order allow,deny<br />&nbsp; Allow from all<br />&lt;/Directory&gt;</code></div></p>

<p>Enable apache modules:
<div class="codeblock"><code>sudo a2enmod actions alias fastcgi</code></div></p>

<p>Restart php5-fpm and apache to load the new configs: 
<div class="codeblock"><code>sudo service php5-fpm restart<br />sudo service apache2 restart</code></div></p>

<h2>Verify that you can still reach your Aegir site</h2>

<p>Navigate your browser to the FQDN of your aegir server. This time, you are using php5-fpm. Verify e.g. via phpinfo().</p>

<p>--<br />
Page author: Marji Cermak <a href="mailto:marji@morpht.com">&#109;&#97;&#x72;&#x6a;&#x69;&#x40;&#x6d;&#x6f;&#x72;ph&#116;&#46;&#99;&#111;&#109;</a>, <a href="http://morpht.com/" title="http://morpht.com">http://morpht.com</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-71.html?destination=node%2F2799%23comment-form">Login</a> or <a href="../user/register/index-71.html?destination=node%2F2799%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1226" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html">Using a proxy cache to accelerate platform builds</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>While building (and re-building) platforms using makefiles and the Aegir front-end (node/add/platform) is great, it has a number of minor annoyances. They're slow, and consume lots of bandwidth, but worse still, even a small hiccup in drupal.org (or other) infrastructure can break a platform build, which requires starting from scratch each time.</p>

<p>When you maintain platforms with upwards of 300 modules, themes and libraries, such as with <a href="http://drupal.org/project/kplatforms">kPlatforms</a>, and you start to deploy these to multiple clients' <a href="http://www.koumbit.org/en/services/AegirVPS">Aegir servers</a>, those minor annoyances can become significant challenges.</p>

<p>There is good documentation on setting this up for use with Drush Make already, such as this <a href="http://reluctanthacker.rollett.org/using-squid-caching-server-drush-module-downloads">blog post</a>. However, there are some gotchas when doing so in Aegir. Most of the suggested solutions involve something like setting environment variables in ~/.bashrc, which works fine if you're running 'drush make' yourself in a login shell. However, since the Aegir is running in a non-interactive shell, there isn't a opportunity to set environment variables.</p>

<p>Thankfully, Drush Make supports curl, and opts for it automatically if it's installed. Careful reading of curl's manpage indicates that:</p>

<pre><code>[curl] always [...] checks for a default config file and uses it if found.
</code></pre>

<p>So, in the end, all that's required is a /var/aegir/.curlrc file containing:</p>

<pre><code>proxy = "http://&lt;proxy_host&gt;[:port]"
</code></pre>

<p>Thus a basic configuration on Debian would involve installing a proxy, such as Squid:</p>

<pre><code># apt-get install squid3
</code></pre>

<p>Then add an acl in /etc/squid3/squid.conf allowing access from your local network, e.g.:</p>

<pre><code>acl localnet src 192.168.0.0/16
http_access allow localnet
</code></pre>

<p>Restart Squid and you're good to go:</p>

<pre><code># /etc/init.d/squid3 restart
</code></pre>

<p>Testing that Aegir is actually using your new proxy cache, and that Squid is actually caching the makefile projects involves taking a quick look at the logs of the Squid server:</p>

<pre><code># tail -f /var/log/squid3
</code></pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/1226/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-10" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../upgrading/index.html">Upgrade Guide</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc13">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Introduction"><span class="toc-number">1. </span>Introduction</a></li>
	<li class="toc-level-1"><a href="#Upgrade_options"><span class="toc-number">2. </span>Upgrade options</a></li>
	<li class="toc-level-1"><a href="#New_release_of_Drupal_core"><span class="toc-number">3. </span>New release of Drupal core?</a></li>
</ol>
</div>
</div>

<h2 id="Introduction">1. Introduction</h2>

<p>Upgrading Aegir is designed to be as easy as it possibly can be, and regularly improves over time as the developers attempt to streamline the process for users.</p>

<p>Nonetheless, the upgrade process can seem a little daunting to users. This is mainly because some expectation arises that because Aegir is built on Drupal, and is made for managing Drupal sites, it seems reasonable to expect the upgrade process to be as straightforward as, say, upgrading a regular Drupal site.</p>

<p>Aegir is a powerful system that goes beyond a normal Drupal application by being split into two parts: a frontend (the browser-based control panel) and the backend (bits on the system in /var/aegir, such as Drush and Drush extensions), along with a system user on your server that runs command-line scripts and restarts services, and cronjobs.</p>

<p>Typically what this means is that when it comes time to upgrade Aegir, you not only have to upgrade the frontend site, but also update the components that reside in the 'backend'.</p>

<p>But don't panic! We have instructions and even a script to run, to take care of almost all of it for you, eliminating as much as possible the chance for human error.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrade_options">2. Upgrade options</h2>

<p>There are three options you can choose to upgrade your Aegir install when a new release comes up:</p>

<ul>
<li><a href="../upgrading/debian/index.html">Upgrades using Debian packages</a></li>
<li><a href="../upgrading/script/index.html">Upgrades using the upgrade.sh.txt script</a></li>
<li><a href="../upgrading/manual/index.html">Manual upgrades</a></li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="New_release_of_Drupal_core">3. New release of Drupal core?</h2>

<p>Just as you would use the Migrate task in Aegir to upgrade one of your sites to a new copy of Drupal core, you can follow the UPGRADE.txt to upgrade your actual Aegir frontend system to a new copy of Drupal core too. The upgrade process (including the script) will always fetch the latest available copy of Drupal core to place the frontend on.</p>

<p>Currently you cannot upgrade the Aegir site itself from the frontend with a Migrate task as you do for your managed sites. This may change in the future, but has not been developed yet.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-72.html?destination=node%2F10%23comment-form">Login</a> or <a href="../user/register/index-72.html?destination=node%2F10%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-429" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../upgrading/manual/index.html">Manual Upgrade</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_21 first"><a href="../taxonomy/term/21/index.html" rel="tag" title="">manual</a></li>
<li class="taxonomy_term_2"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
<li class="taxonomy_term_22 last"><a href="../taxonomy/term/22/index.html" rel="tag" title="">upgrade</a></li>
</ul></div><p>This section outlines the requirements for doing a manual upgrade of Aegir to a new release. Before going ahead with this, you probably want to read the <a href="../upgrading/path/index.html">upgrade path and version-specific notes</a>.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc14">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Conventions_and_Tips"><span class="toc-number">1. </span>Conventions &amp; Tips</a></li>
	<li class="toc-level-1"><a href="#Upgrading_Overview"><span class="toc-number">2. </span>Upgrading Overview</a>
<ol>
	<li class="toc-level-2"><a href="#Upgrading_drush"><span class="toc-number">2.1. </span>Upgrading drush</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_backend"><span class="toc-number">2.2. </span>Upgrading the backend</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_frontend"><span class="toc-number">2.3. </span>Upgrading the frontend</a></li>
	<li class="toc-level-2"><a href="#What_hostmaster-migrate_does"><span class="toc-number">2.4. </span>What hostmaster-migrate does</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Upgrading_to_AEgir_1.x"><span class="toc-number">3. </span>Upgrading to AEgir 1.x</a>
<ol>
	<li class="toc-level-2"><a href="#Upgrading_drush_and_drush_make"><span class="toc-number">3.1. </span>Upgrading drush and drush make</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_1.x_backend"><span class="toc-number">3.2. </span>Upgrading the 1.x backend</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_1.x_frontend"><span class="toc-number">3.3. </span>Upgrading the 1.x frontend</a></li>
	<li class="toc-level-2"><a href="#Special_configurations_and_troubleshooting"><span class="toc-number">3.4. </span>Special configurations and troubleshooting</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Upgrading_to_AEgir_2.x"><span class="toc-number">4. </span>Upgrading to AEgir 2.x</a>
<ol>
	<li class="toc-level-2"><a href="#Upgrading_drush-1"><span class="toc-number">4.1. </span>Upgrading drush</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_2.x_backend"><span class="toc-number">4.2. </span>Upgrading the 2.x backend</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_2.x_frontend"><span class="toc-number">4.3. </span>Upgrading the 2.x frontend</a></li>
	<li class="toc-level-2"><a href="#Special_configurations_and_troubleshooting-2"><span class="toc-number">4.4. </span>Special configurations and troubleshooting</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="Conventions_and_Tips">1. Conventions &amp; Tips</h1>

<p>All instructions and in general all commands must be run as aegir user, so all
permissions are always set correctly.</p>

<p>To become aegir user you can issue this command:</p>

<pre><code>su -s /bin/sh aegir
</code></pre>

<p>(Note you must run this as root or prefix with sudo).</p>

<p>Note that /bin/sh is an example. You may wish to instead use the shell of your
choice, i.e /bin/bash</p>

<p>A standard umask of 022 is assumed. This is the default on most systems.</p>

<p>We assume that drush is in your path, if it is installed in <code>/var/aegir/drush/drush.php</code>, replace all occurences of <code>drush</code> by <code>/var/aegir/drush/drush.php</code> in the following steps, or add the following alias:</p>

<pre><code>alias drush=/var/aegir/drush/drush.php
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Upgrading_Overview">2. Upgrading Overview</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_drush">2.1. Upgrading drush</h2>

<p>As part of your Aegir upgrade, you need to upgrade Drush to the latest stable version compatible with the target Aegir release. AEgir 1.x <em>only</em> works with version 4.5.  Versions 5 - 7 have been known to work with AEgir 2.x, however  the Drush developers recommend version 6 as the most stable.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_backend">2.2. Upgrading the backend</h2>

<p>After drush is updated, you must then proceed to upgrade the backend. The reason for upgrading the backend first before the frontend, is that the frontend upgrade process is instigated by the backend using Drush Make. Thus you need to be running the new backend first in order to successfully produce a new frontend.</p>

<p>In general, we try to keep the backend and the frontend compatible with each other during release cycles. That is: provision 1.8 and hosting 1.9 will always be able to talk to each other, but hosting 2.0 will have trouble talking to the 1.9 backend, so you need to upgrade the backend first when you do a major upgrade (for example, 1.9 -&gt; 2.0).</p>

<p>Bottomline: first you upgrade the backend, then the frontend.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_frontend">2.3. Upgrading the frontend</h2>

<p>Once your backend is upgraded, you can upgrade your frontend. Think of this as the backend fetching a new copy of Drupal core and the Hostmaster frontend application onto your server, and then moving the Aegir site's settings.php and other bits and pieces over to the new codebase.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="What_hostmaster-migrate_does">2.4. What hostmaster-migrate does</h2>

<p>The command will make sure the target directory is a valid Aegir install. If the directory does not exist, provision will use drush_make to fetch and assemble the correct version of the front end for the specific release of the backend you are running.</p>

<p><code>hostmaster-migrate</code> will also completely replace the crontab entry for the aegir user.</p>

<p>The command above will fetch the latest stable Drupal release, so it can simply be run again when a new security release of Drupal is made available.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Upgrading_to_AEgir_1.x">3. Upgrading to AEgir 1.x</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_drush_and_drush_make">3.1. Upgrading drush and drush make</h2>

<p>As part of your Aegir upgrade, you need to upgrade Drush to the latest stable version compatible with the target Aegir release. Aegir 1.x does <strong>not</strong> support Drush 5, although 2.x does.</p>

<p>If you are using the Drush Debian packages, the package should be upgraded through:</p>

<pre><code>apt-get install drush
</code></pre>

<p>Otherwise, since drush 4.x is capable of upgrading itself, you can just run:</p>

<pre><code>drush dl drush-7.x-4.5
</code></pre>

<p>If you are running a version before 4.x, use the following set of commands instead:</p>

<pre><code>pear channel-discover pear.drush.org
pear install drush/drush-4.5.0
</code></pre>

<p>Provision 0.4 has added a new dependency on drush_make, which will also need to be installed to upgrade the front end if you are upgrading from a pre-0.4 release.</p>

<p>If you are upgrading from an earlier 0.4 release, replace your copy of drush_make with the latest recommended release.</p>

<pre><code>drush dl drush_make-6.x --destination="$HOME/.drush"
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_1.x_backend">3.2. Upgrading the 1.x backend</h2>

<p>Upgrading the backend is as simple as replacing your copy of Drush, Provision, and if necessary, Drush Make, with the new versions if available. Keep a copy of the old Provision and Drush in case something goes wrong in the frontend.</p>

<pre><code>drush dl provision-6.x --destination=$HOME/.drush
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_1.x_frontend">3.3. Upgrading the 1.x frontend</h2>

<p>Before upgrading, we set a few key variables to make the process easier. You <strong>must</strong> replace the arguments those variables to match your configuration. This means replacing <code>$AEGIR_DOMAIN</code> by the URL of your Aegir install, <code>$AEGIR_VERSION</code> with the version number of the Aegir you are trying to install, and also <code>$OLD_AEGIR_DIR</code> with the path to the previous directory where Aegir was installed.</p>

<p>The directory passed to <code>hostmaster-migrate</code> must be an absolute path to where you want the new release to be stored.</p>

<pre><code>OLD_AEGIR_DIR=/var/aegir/hostmaster-6.x-1.8
AEGIR_VERSION=6.x-1.11
AEGIR_DOMAIN=aegir.example.com
</code></pre>

<p>To upgrade your frontend, run the following commands, replacing the variables as described below:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate $AEGIR_DOMAIN $HOME/hostmaster-$AEGIR_VERSION
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Special_configurations_and_troubleshooting">3.4. Special configurations and troubleshooting</h2>

<p>If the upgrade fails, try running it again with the <code>--debug</code> flag:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate aegir.example.com $HOME/hostmaster-$AEGIR_VERSION --debug
</code></pre>

<p>If you have customized your Aegir installation and are maintaining your own makefile, you can use the <code>--makefile</code> flag so the platform is created with another makefile than the default. Be warned that this may create problems if the makefile doesn't include the right Aegir modules.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Upgrading_to_AEgir_2.x">4. Upgrading to AEgir 2.x</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_drush-1">4.1. Upgrading drush</h2>

<p>Install Drush 6.x per the directions given at the <a href="https://github.com/drush-ops/drush">Drush repository</a>.  The maintainers have deprecated the PEAR installation procedure and are encouraging everyone to install Drush via the Composer dependency management tool.</p>

<p>You should also remove your copy of <code>drush_make</code> from <code>$HOME/.drush</code>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_2.x_backend">4.2. Upgrading the 2.x backend</h2>

<p>Upgrading the backend is as simple as replacing your copy of Drush &amp; Provision with the new versions if available. Keep a copy of the old Provision and Drush in case something goes wrong in the frontend.</p>

<pre><code>drush dl --destination=/var/aegir/.drush provision-6.x-2.0
</code></pre>

<p>Drush 5+ has a commandfile cache which you need to clear before installing Aegir:</p>

<pre><code>drush cache-clear drush
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_2.x_frontend">4.3. Upgrading the 2.x frontend</h2>

<p>Before upgrading, we set a few key variables to make the process easier. You <strong>must</strong> replace the arguments those variables to match your configuration. This means replacing <code>$AEGIR_DOMAIN</code> by the URL of your Aegir install, <code>$AEGIR_VERSION</code> with the version number of the Aegir you are trying to install, and also <code>$OLD_AEGIR_DIR</code> with the path to the previous directory where Aegir was installed.</p>

<p>The directory passed to <code>hostmaster-migrate</code> must be an absolute path to where you want the new release to be stored.</p>

<pre><code>OLD_AEGIR_DIR=/var/aegir/hostmaster-6.x-1.11
AEGIR_VERSION=6.x-2.0
AEGIR_DOMAIN=aegir.example.com
</code></pre>

<p>To upgrade your frontend, run the following commands, replacing the variables as described below:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate $AEGIR_DOMAIN $HOME/hostmaster-$AEGIR_VERSION
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Special_configurations_and_troubleshooting-2">4.4. Special configurations and troubleshooting</h2>

<p>Read the <a href="../upgrading/path/index.html">upgrade path notes again</a>, you <em>will</em> have missed something.</p>

<p>If the upgrade fails, try running it again with the <code>--debug</code> flag:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate aegir.example.com $HOME/hostmaster-$AEGIR_VERSION --debug
</code></pre>

<p>If you have customized your Aegir installation and are maintaining your own makefile, you can use the <code>--makefile</code> flag so the platform is created with another makefile than the default. Be warned that this may create problems if the makefile doesn't include the right Aegir modules.</p>

<p>If the update fails due to a bug in module Hosting, it will ask you to run "drush hostmaster-resume help".  That command does not exist.  Try this one instead.</p>

<pre><code>drush --debug @hostmaster hostmaster-resume /var/aegir/hostmaster-6.x-1.11 /var/aegir/hostmaster-6.x-2.0
</code></pre><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-73.html?destination=node%2F429%23comment-form">Login</a> or <a href="../user/register/index-73.html?destination=node%2F429%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-432" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../upgrading/debian/index.html">Automatic upgrades with Debian packages</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_23 first"><a href="../taxonomy/term/23/index.html" rel="tag" title="">Debian</a></li>
<li class="taxonomy_term_2"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
<li class="taxonomy_term_22 last"><a href="../taxonomy/term/22/index.html" rel="tag" title="">upgrade</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc15">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Regular_update_process"><span class="toc-number">1. </span>Regular update process</a></li>
	<li class="toc-level-1"><a href="#Upgrading_from_non-Debian_installs"><span class="toc-number">2. </span>Upgrading from non-Debian installs</a></li>
	<li class="toc-level-1"><a href="#Custom_distributions"><span class="toc-number">3. </span>Custom distributions</a>
<ol>
	<li class="toc-level-2"><a href="#Keeping_custom_distributions_up_to_date"><span class="toc-number">3.1. </span>Keeping custom distributions up to date</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Rolling_back_the_upgrade"><span class="toc-number">4. </span>Rolling back the upgrade</a></li>
	<li class="toc-level-1"><a href="#Recovering_a_Failed_Upgrade"><span class="toc-number">5. </span>Recovering a Failed Upgrade</a></li>
</ol>
</div>
</div>

<h2 id="Regular_update_process">1. Regular update process</h2>

<p>Make sure you have the Aegir repository in your sources.list, as per the <a href="../installing/debian/index.html#Adding_the_project_repositories">installation docs</a>.</p>

<p>If you are upgrading from a Debian installation whereby you used the koumbit.org repositories, you should change this entry in your sources.list to be debian.aegirproject.org as per the instructions linked to above, and run apt-get update to refresh.</p>

<p>If you want to upgrade all packages in one shot, use:</p>

<pre><code>apt-get update
apt-get install aegir
</code></pre>

<p>Note that you can upgrade Aegir in steps. Upgrading your backend to the Debian package should be as simple as running:</p>

<pre><code>apt-get install aegir-provision
</code></pre>

<p>Upgrading the frontend to the Debian package works identically:</p>

<pre><code>apt-get install aegir-hostmaster
</code></pre>

<p>As during install, you can use the DEBUG variable to run Drush in debugging mode:</p>

<pre><code>env DEBUG=yes apt-get install aegir-hostmaster
</code></pre>

<p><em>Note: the DEBUG flag is deprecated. In 1.x releases, it is accepted, but in 2.x it won't. You should use DPKG_DEBUG instead, it is usable starting from 1.1-4.</em></p>

<p><strong>2.x note</strong>: to upgrade to 2.x, use: <code>apt-get install aegir2</code>.</p>

<p><strong>Note on contrib modules</strong>: some Aegir-specific <a href="../contrib/index.html">contrib modules</a> may have been installed on your Aegir deployment. This may fail if you are doing a major upgrade. In this case, you will probably want to disable those contrib modules. Look for directories in <code>~aegir/.drush</code> or <code>/usr/share/drush/commands</code> or other components of the drush commandfiles search path, and move them out of the way. After the upgrade, download the new versions of the modules that are compatible with the new Aegir release.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_from_non-Debian_installs">2. Upgrading from non-Debian installs</h2>

<p>The Debian package supports migrating from existing installs. You will need to move /var/aegir/.drush/provision out of the way before going ahead:</p>

<pre><code>tar cfz /var/aegir/backups/provision.tgz /var/aegir/.drush/provision
rm -rf /var/aegir/.drush/provision
</code></pre>

<p>You'll also need to go through steps 1 through 3 of <a href="../installing/debian/index.html#Adding_the_Koumbit_repositories">Automatic install on Debian</a>.</p>

<p>Then just install the package as if you were installing from scratch.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Custom_distributions">3. Custom distributions</h2>

<p>If you have your own makefile, you can go ahead with the above process, but change the makefile to the one you want:</p>

<pre><code>echo debconf aegir/makefile string /var/aegir/makefiles/aegir/aegir-koumbit.make | debconf-set-selections
apt-get install aegir
</code></pre>

<p>Usually no questions are asked when upgrading - this allows you to specify the makefile path for your custom distribution of Aegir, even if you're upgrading. It's also how you can switch distributions.</p>

<p>An example aegir-koumbit.make file could look like:</p>

<p><div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />includes[aegir] = &quot;/usr/share/drush/commands/provision/aegir.make&quot;<br /><br />projects[] = module_filter</code></div></p>

<p>Note that for this to work, you will need the patch from <a href="http://drupal.org/node/1118616">this issue</a>, allowing drush_make to reference absolute system paths.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Keeping_custom_distributions_up_to_date">3.1. Keeping custom distributions up to date</h3>

<p>This section describes how to upgrade the code for custom distributions in between debian package upgrades. Here, we assume that Aegir is already installed through the debian package.</p>

<ol>
<li>Create a new Aegir makefile, or update the custom Aegir makefile. (You can use the makefile in drupal.org/project/provision as a starting point.)</li>
<li>Add modules/features/themes/libraries/whatever to the makefile. Ex:
<div class="codeblock"><code>&nbsp;&nbsp;&nbsp; projects[] = token<br />&nbsp;&nbsp;&nbsp; projects[] = views</code></div></li>
<li>Follow the manual upgrade path:

<ul>
<li>drush @hostmaster hostmaster-migrate URL /path/to/platform --makefile='/path/to/makefile'</li>
<li>Hope it's all green (no errors). If errors, fix makefile.</li>
<li>A new platform should exist, the new site should be in there, verifying. If the task is not running, check that hosting-queue-runner is running. If it's not, restart it using '/etc/init.d/hosting-queue-runner force-reload'. (Since hostmaster changed location, it is normal for hosting-queue-runner to crash at this point.)</li>
<li>When the debian package is upgraded, it should create a new hostmaster platform automatically. (You can test this with dpkg --configure.)</li>
</ul></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Rolling_back_the_upgrade">4. Rolling back the upgrade</h2>

<p>If something went wrong with the upgrade, you can rollback by deleting the hostmaster site and redeploying on the older platform:</p>

<pre><code>drush @hostmaster provision-delete
vi ~/.drush/hostmaster.alias.drushrc.php
</code></pre>

<p>...And edit the alias to make the following changes:</p>

<pre><code>1. change the platform to point to the older platform alias
2. change the platform root path
3. change the site path
</code></pre>

<p>During the upgrade, a backup was done and you need to find which backup file it was in the backups directory. Use this backup to redeploy the older platform:</p>

<pre><code>drush @hostmaster provision-deploy ~/backups/hostmaster.date.tgz
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Recovering_a_Failed_Upgrade">5. Recovering a Failed Upgrade</h2>

<p>When using the Regular Update Process and you encounter an error it leaves the debian package in a broken state.</p>

<p>First you need to figure out why it failed.  For example is there a permission problem?<br />
Once you determined the issue correct it and clean up the environment.  It could be necessary to remove the new hostmaster platform.  It is up to you to determine what state aegir is in.</p>

<p>Next you need to fix the broken package by running the fix-broken parameter:</p>

<pre><code>apt-get install -f 
</code></pre>

<p>This tells the debian package system to start through the process again.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/432/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-431" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../upgrading/script/index.html">Automatic upgrades with upgrade.sh script</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This page describes the upgrade script in the Provision repository that tries to  automate much of the upgrade process.</p>

<p><strong>NOTE:</strong> <em>At this time neither the Aegir 1.1 nor the Aegir 2.0 upgrade scripts are working for all setups.  We recommend you use the <a href="../upgrading/manual/index.html">Manual upgrades</a> instead.</em></p>

<p>It is imperative that you read the <a href="../upgrading/path/index.html">version-specific upgrade notes</a> before attempting to run the upgrade.sh script, as the script will assume you have your system set up appropriately to handle the upgrade process.</p>

<p>You can download the upgrade.sh script for Aegir 2.4 with the following command:</p>

<pre><code>wget -O upgrade.sh 'http://drupalcode.org/project/provision.git/blob_plain/refs/tags/6.x-2.4:/upgrade.sh.txt'
</code></pre>

<p>or for AEgir 3.0 with the following command:</p>

<pre><code>wget -O upgrade.sh 'http://drupalcode.org/project/provision.git/blob_plain/refs/tags/7.x-3.0:/upgrade.sh.txt'
</code></pre>

<p>Make sure you download it to somewhere that the aegir user can access in order to execute it.</p>

<p>You may need to edit the script to set any variables that are different from the defaults, for example to upgrade to a different Aegir version.</p>

<p>To do the upgrade, just run the script:</p>

<pre><code>su -s /bin/sh aegir -c "sh upgrade.sh"
</code></pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/431/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-552" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../upgrading/path/index.html"> Version-specific &amp; upgrade path information</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc16">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#General_upgrade_path_recommendations"><span class="toc-number">1. </span>General upgrade path recommendations</a></li>
	<li class="toc-level-1"><a href="#Changes_in_the_2.0_release"><span class="toc-number">2. </span>Changes in the 2.0 release</a>
<ol>
	<li class="toc-level-2"><a href="#hosting-queue-runner_renamed_hosting-queued"><span class="toc-number">2.1. </span>hosting-queue-runner renamed hosting-queued</a></li>
	<li class="toc-level-2"><a href="#queue_daemon_enabled_by_default"><span class="toc-number">2.2. </span>queue daemon enabled by default</a></li>
	<li class="toc-level-2"><a href="#hosting_platform_pathauto_module_bundled_with_Aegir"><span class="toc-number">2.3. </span>hosting_platform_pathauto module bundled with Aegir</a></li>
	<li class="toc-level-2"><a href="#hosting-task_--force"><span class="toc-number">2.4. </span>hosting-task --force</a></li>
	<li class="toc-level-2"><a href="#Deprecated_functions_removed"><span class="toc-number">2.5. </span>Deprecated functions removed</a></li>
	<li class="toc-level-2"><a href="#New_Provision_class_naming_convention"><span class="toc-number">2.6. </span>New Provision class naming convention</a></li>
	<li class="toc-level-2"><a href="#Client_node_type_changes"><span class="toc-number">2.7. </span>Client node type changes</a></li>
	<li class="toc-level-2"><a href="#SSL_and_IP_allocation_refactoring_changes"><span class="toc-number">2.8. </span>SSL and IP allocation refactoring changes</a>
<ol>
	<li class="toc-level-3"><a href="#Backend"><span class="toc-number">2.8.1. </span>Backend</a></li>
	<li class="toc-level-3"><a href="#Frontend"><span class="toc-number">2.8.2. </span>Frontend</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Debian_package_name_changed"><span class="toc-number">2.9. </span>Debian package name changed</a></li>
	<li class="toc-level-2"><a href="#Platform_drushrc.php_moved"><span class="toc-number">2.10. </span>Platform drushrc.php moved</a></li>
	<li class="toc-level-2"><a href="#Class_auto-loading"><span class="toc-number">2.11. </span>Class auto-loading</a></li>
	<li class="toc-level-2"><a href="#Other_database_changes"><span class="toc-number">2.12. </span>Other database changes</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Changes_in_the_1.0_release"><span class="toc-number">3. </span>Changes in the 1.0 release</a>
<ol>
	<li class="toc-level-2"><a href="#Git_dependency"><span class="toc-number">3.1. </span>Git dependency</a></li>
	<li class="toc-level-2"><a href="#DNS_Configuration"><span class="toc-number">3.2. </span>DNS Configuration</a></li>
	<li class="toc-level-2"><a href="#Unzip_dependency"><span class="toc-number">3.3. </span>Unzip dependency</a></li>
	<li class="toc-level-2"><a href="#Database_configuration"><span class="toc-number">3.4. </span>Database configuration</a></li>
	<li class="toc-level-2"><a href="#Apache_configuration"><span class="toc-number">3.5. </span>Apache configuration</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="General_upgrade_path_recommendations">1. General upgrade path recommendations</h1>

<p>In general, you shouldn't skip major releases. That is, if you are running 0.3, you should upgrade to 1.0 or 1.1, not 2.0. Upgrades within a stable branch (1.0 to 1.1, 2.0 to 2.1) are fully supported, and you can skip minor versions (1.0 to 1.2 should work fine), but you should always upgrade to the latest stable release if you are coming from a different release branch.</p>

<p>The rest of this page documents what version-specific changes happened that you need to make manual modifications to. If you are running the Debian packages, you probably don't need to configure anything here.</p>

<p>The <a href="../upgrading/index.html">upgrade process</a> should make this clear, but keep in mind that you need to upgrade the backend (drush, provision) before the frontend (drupal, hostmaster profile, etc).</p>

<p>Provision/Drush <strong>contrib</strong> modules might require additional attention. As there is no version checking, the safest method is probably to move the module out of your .drush folder and later add the version compatible with the new Aegir version.</p>

<p>Hosting/Drupal <strong>contrib</strong> modules should also be handled carefully. If these were installed into the hostmaster site's directory, then they should be moved automatically to the new hostmaster platform during the upgrade. On the other hand, if they were installed on the platform, you'll need to provide the hostmaster-migrate or Debian package with a custom makefile. The default makefile in Provision (aegir.make) can be used as a model for this.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Changes_in_the_2.0_release">2. Changes in the 2.0 release</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="hosting-queue-runner_renamed_hosting-queued">2.1. hosting-queue-runner renamed hosting-queued</h2>

<p>The popular module <code>hosting-queue-runner</code> has been merged in the 2.0 release. In the process, it has been renamed to the more appropriate <code>hosting-queued</code>. The init script is also now installed directly with the Debian package, and started on install or upgrade.</p>

<p>You will, however, need to manually enable to module for the daemon to work (still):</p>

<pre><code>drush @hostmaster en hosting_queued
</code></pre>

<p>Also, if you are migrating from an install using <code>hosting-queue-runner</code>, you will need to remove the old module and startup script. Enabling <code>hosting-queued</code> will already have disabled and uninstalled the module from Drupal, but you need to cleanup your filesystem:</p>

<pre><code>rm /etc/init.d/hosting-queue-runner
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="queue_daemon_enabled_by_default">2.2. queue daemon enabled by default</h2>

<p>The above queue daemon is now enabled by default by the Debian package, and is properly restarted on upgrades. It can be disabled after install if necessary using the following comamnds:</p>

<pre><code>service hosting-queued stop
su aegir -c "drush @hostmaster pm-disable hosting_queued"
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="hosting_platform_pathauto_module_bundled_with_Aegir">2.3. hosting_platform_pathauto module bundled with Aegir</h2>

<p>The popular module <code>hosting_platform_pathauto</code> has been bundled in the 2.0 release. 
If you installed it module manually then now is probably the time to remove your copy.
Aegir 2.0-alpha1 comes bundled with hosting_platform_pathauto-2.0-beta1.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="hosting-task_--force">2.4. hosting-task --force</h2>

<p>You used to be able to run <code>hosting-task &lt;nid&gt;</code> to re-run a task by its node ID. Because hosting-task now checks if the task is really queued, this can't be used to retry existing tasks directly, unless you use the <code>--force</code> argument. So this:</p>

<p><div class="codeblock"><code>drush @hostmaster hosting-task 1234</code></div></p>

<p>becomes:</p>

<p><div class="codeblock"><code>drush @hostmaster hosting-task --force 1234</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Deprecated_functions_removed">2.5. Deprecated functions removed</h2>

<p>If you are using any of those functions in your custom code, lookup in the 1.x documentation to see the replacement functions, as they have been removed from 2.x:</p>

<ul>
<li>hosting_alias_count_sites() (same as !hosting_alias_allow_domain())</li>
<li>hosting_site_exists() (same as !hosting_alias_allow_domain())</li>
<li>hosting_get_client_by_email() (use hosting_get_client() instead)</li>
<li>hosting_import_client() dropped the second argument (organization)</li>
<li>hosting_task_list_embedded() (use hosting_task_list() or hosting_task_list_table())</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="New_Provision_class_naming_convention">2.6. New Provision class naming convention</h2>

<p>Provision classes used to start with provisionConfig_ or provisionService_, but these are now Provision_Config_ and Provision_Service_ respectively.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Client_node_type_changes">2.7. Client node type changes</h2>

<ul>
<li>the email field was removed from the client, now you need a user associated with the client. this was already the case in 1.x but the existing field wasn't touched.</li>
<li>the client_email field was removed from the site object</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="SSL_and_IP_allocation_refactoring_changes">2.8. SSL and IP allocation refactoring changes</h2>

<p>The <a href="https://drupal.org/node/1126640">SSL IP allocation refactoring</a> has changed a good few things in the API and the way SSL certificates are managed.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Backend">2.8.1. Backend</h3>

<p>The following functions are gone from the backend:</p>

<ul>
<li><a href="http://api.aegirproject.org/api/Provision/http--http.ssl.inc/function/provisionService_http_ssl%3A%3Aassign_certificate_ip/6.x-1.x">provisionService_http_ssl::assign_certificate_ip</a></li>
<li><a href="http://api.aegirproject.org/api/Provision/http--http.ssl.inc/function/provisionService_http_ssl%3A%3Aget_ip_certificate/6.x-1.x">Provision_Service_http_ssl::get_ip_certificate</a> .</li>
<li><a href="http://api.aegirproject.org/api/Provision/http--http.ssl.inc/function/provisionService_http_ssl%3A%3Afree_certificate_ip/6.x-1.x">Provision_Service_http_ssl::free_certificate_ip</a></li>
<li>Provision_Service_http_ssl::clear_certs()</li>
</ul>

<p>Certificates are not tracked from the backend anymore, other than to make sure that we delete a certificate when it's not used anymore. So we still use *.receipt files, but just to mark a site to SSL certificate association, not the IP allocation. The SSL directory in <code>~/config/server_foo/ssl.d/uri/</code> is removed when no site use that directory anymore.</p>

<p>The backend now expects the frontend to send an <code>ip_address</code> field and stopped sending a <code>site_ip_addresses</code> to the frontend.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Frontend">2.8.2. Frontend</h3>

<p>The <code>hosting_ip_addresses</code> table changes. A unique key has been added and it is now only for servers. It is used by the new hosting_ssl_cert_ips table to map those server IP addresses to certificates.</p>

<p>A new field for the IP (ip_address) is sent from the frontend during site install/verify tasks. The field is not present in non-ssl sites. It is the non-resolved IP address of the server assigned to the SSL certificate and must be used by the backend to write the vhost.</p>

<p>SSL certificates are removed from the frontend when sites using it are deleted.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Debian_package_name_changed">2.9. Debian package name changed</h2>

<p>To allow both packages to coexist in the same Debian archive, the name of the packages of the 2.x series have changed.</p>

<ul>
<li><code>aegir -&gt; aegir2</code></li>
<li><code>aegir-provision -&gt; aegir2-provision</code></li>
<li><code>aegir-hostmaster -&gt; aegir2-hostmaster</code></li>
<li><code>aegir-cluster-slave -&gt; aegir2-cluster-slave</code></li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Platform_drushrc.php_moved">2.10. Platform drushrc.php moved</h2>

<p>From Drush 5 documentation:</p>

<pre><code>Drush 5 no longer looks for aliases, configs or command files in the Drupal
root folder, so if you previously used drushrc.php files in the Drupal root
you will need to move the file to sites/all/drush/drushrc.php.
</code></pre>

<p>Since Aegir 2 requires Drush 5 (or later), Provision now follows this standard, and places a platform's drushrc.php in sites/all/drush/drushrc.php.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Class_auto-loading">2.11. Class auto-loading</h2>

<p>Provision has been refactored to use class autoloading. This simplifies use of classes, as it obviates the need to explicitly include the files in which the class and it's parent classes are defined. In addition, it standardizes the placement of class definitions within a hierarchical file-system structure and will make name-spacing simpler if/when we begin to adopt Symfony components.</p>

<p>More info in the manual under <a href='../content/contrib/class-auto-loading/index.html'>Extending Aegir - Class auto-loading</a></p>

<p>This may also affect certain contrib extensions that used to have to reside in the provision directory itself. These extensions should probably be removed prior to the upgrade, and re-installed afterwards with an Aegir2-compatible version.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Other_database_changes">2.12. Other database changes</h2>

<p>The <code>release_id</code> column was dropped. This column wasn't used anywhere in the code and was present only in some installs, see <a href="https://drupal.org/node/1882708">issue #1882708</a> for details.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Changes_in_the_1.0_release">3. Changes in the 1.0 release</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Git_dependency">3.1. Git dependency</h2>

<p>If you intend on upgrading your system to the bleeding edge version of the code from our git repositories, you will need the git program installed.  On Debian, this means:</p>

<pre><code>apt-get install git-core
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="DNS_Configuration">3.2. DNS Configuration</h2>

<p>Aegir requires that the hostname returned by the <code>hostname</code> and <code>uname -n</code>
shell commands, resolves to the IP address for this server.</p>

<p>Shell commands as root:</p>

<pre><code>AEGIR_HOST=`uname -n`
resolveip $AEGIR_HOST
</code></pre>

<p>If the command returns your IP address, you are all set. If it returns
an error you will need to edit your <code>/etc/hosts</code> file.</p>

<p>(Mac OSX  notes: if you are running on OS X you will not likely have a resolveip  binary.  Just substitute 
  <code>ping $AEGIR_HOST</code>
).</p>

<p>First line of this file looks like:</p>

<p>127.0.0.1  localhost</p>

<p>Simply add all domains you want to this line. e.g:</p>

<p>127.0.0.1  localhost $AEGIR_HOST $AEGIR_DOMAIN other1 other2</p>

<p>To be clear you cannot put $AEGIR_HOST $AEGIR_DOMAIN  in your  hosts file.  Put in whatever  uname -n  returns  for $AEGIR_HOST and what ever  domain you want to use  f or  $AEGIR_DOMAIN  (real  domain or faked in hosts file).   In OS X     uname -n will return whatever you put in  System  Preferences -&gt; Sharing -&gt; Computer Name.  I added that value  (iMac 27  for me) to /etc/hosts and my faked aegir  domain  as follows:</p>

<p><code>127.0.0.1&nbsp; localhost&nbsp; iMac27&nbsp; aegir.local </code></p>

<p>If you only intend to use Aegir on a single server, it is acceptable for
the resolved IP address to be the '127.0.0.1' loopback address.</p>

<p>If you intend to manage multiple servers using Aegir, you will need to
make sure that the IP address is the public IP of this server.</p>

<p>Finally, set an $AEGIR_IP environment variable for use in the Database
configuration step below.</p>

<p>Shell commands as root::
    AEGIR_IP=<code>resolveip $AEGIR_HOST | awk {'print $6'}</code></p>

<p>(If running  OS X  or are otherwise missing  resolveip   and you just want to use Aegir on your computer use  you can do this:
AEGIR_IP=127.0.0.1</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Unzip_dependency">3.3. Unzip dependency</h2>

<p>As of the 0.4-alpha3 release, 'unzip' is a required dependency on your server
in order to successfully extract the jquery.ui library that is part of some UI
improvements. On Debian, this means:</p>

<p>Shell commands::</p>

<p>apt-get install unzip</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Database_configuration">3.4. Database configuration</h2>

<p>To make sure that the Aegir backend, and all the possible web servers can
reach your database server, you need to configure mysql to listen on all
the public IP addresses available to it.</p>

<p>/etc/mysql/my.cnf configuration line to comment out::
    bind-address    = 127.0.0.1</p>

<p>Now you need to restart mysql, to clear any caches.</p>

<p>Shell command as root::
    /etc/init.d/mysql restart</p>

<p>Because you have already installed Aegir when it was using the generic grants,
you will need to create new grants using the public IP address and hostname
of this server.</p>

<p>Shell command ::
    mysql -uroot -p mysql</p>

<p>You need to generate the following grants using the hostname returned by the
<code>uname -n</code> command, and the IP address that the <code>resolveip</code> command returns
for that hostname.</p>

<p>You need to re-use the pasword you had for the account before.</p>

<p>Shell commands::</p>

<pre><code>mysql -u root -p -e "GRANT ALL ON *.* to 'aegir_root'@'$AEGIR_HOST' IDENTIFIED BY 'xxxx' WITH GRANT OPTION;"
mysql -u root -p -e "GRANT ALL ON *.* to 'aegir_root'@'$AEGIR_IP' IDENTIFIED BY 'xxxx' WITH GRANT OPTION;"
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Apache_configuration">3.5. Apache configuration</h2>

<p>This release introduces multi-server support and required reorganizing
the Apache configuration files in ~aegir/config. Instead of having all
files in config/vhost.d, they are now split between vhost.d, platform.d
and a single apache.conf. The vhost.d directory is for virtual hosts,
platform.d is for platform-specific configuration and apache.conf is the
server-wide configuration file.</p>

<p>You will need to change the line you added to either the httpd.conf file 
or /etc/apache2/conf.d/aegir file during installation.</p>

<p>Open your httpd.conf file and modify::</p>

<pre><code>Include /var/aegir/config/vhost.d
</code></pre>

<p>To read ::</p>

<pre><code>Include /var/aegir/config/apache.conf
</code></pre>

<p>If you are upgrading from 0.4 releases between alpha8 and (including) alpha14,
you will need to rename your conf.d directory to post.d in Apache and pre.d in
Nginx. Example, in Apache::</p>

<p>mv /var/aegir/config/server_master/apache/{conf.d,post.d}</p>

<p>Now log into Aegir, and verify the hostmaster platform. This will generate
the correct apache.conf file and restart Apache.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/552/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-12" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../uninstalling/index.html">Uninstalling Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>There is no formal method for uninstalling Aegir, but there is also no real mystery either since the system tries to keep itself together in one location, typically /var/aegir.</p>

<p>Below are the steps to completely remove all traces of Aegir from your server. We also include to leave Aegir intact, but destroy its data, attempting to reset to a almost post-install setup.</p>

<p>Ideally, you would delete all sites and all platforms from the system first. That would take care of deleting all databases and users. But this can take some time and is annoying, so we provide instructions on how to destroy everything.</p>

<h1>WARNING</h1>

<p>Obviously if you have any sites and platforms currently managed by Aegir, you would want to move them out of the /var/aegir area before you delete it! Ensure you have set up your sites and platforms elsewhere, with Apache vhost files etc in their typical locations, or at least out of harm's way before attempting this.</p>

<p><strong>WARNING: Performing these steps will remove Aegir from your server and may result in loss of data. Use with caution.</strong></p>

<p>Run these commands as a privileged user (such as root). We assume your Aegir installation resides in /var/aegir.</p>

<h1>Backup</h1>

<p>You probably want to backup everything before trashing it.</p>

<p>Backup all you need to keep from the /var/aegir/ directory.</p>

<p>Backup your database server, we'll be also destroying that.</p>

<h1>Uninstall script</h1>

<p>Aegir 2.x comes with a <code>hostmaster-uninstall</code> script that allows you to automate good chunks of the steps below.</p>

<h1>Destroying the data</h1>

<p>Aegir manages three types of data:</p>

<ul>
<li>configuration files - yes, we consider those as data</li>
<li>site and platform files</li>
<li>site databases</li>
</ul>

<h2>Trashing configuration files</h2>

<p>This step is optional if you are going to remove everything anyways.</p>

<pre>
rm /var/aegir/.drush/*alias.drushrc.php
rm -r /var/aegir/config/*
</pre>

<h2>Trashing site and platform files</h2>

<p>At this point, you could still probably recover by verifying the platforms, which would recreate config files. At this point we start really destroying data.</p>

<pre>
rm -r /var/aegir/platforms/*
rm -r /var/aegir/hostmaster-*
</pre>

<h2>Drop the databases and db users</h2>

<p>There are no generic instructions for this, since every system differs. Essentially you can perform this within a MySQL shell</p>

<p><code>mysql -u root -p</code></p>

<p>Use the <code>DROP DATABASE $databasename;</code> syntax to drop databases. and <code>DROP USER $user;</code> to delete users, example:</p>

<pre><code>DROP DATABASE aegirexamplecom;
DROP USER aegirexamplecom@localhost;
</code></pre>

<p>This removes the Aegir user, assuming you have not created any site. If you did, you may want to cleanup those sites if you are going to delete them anyways. To see a list of GRANTs that Aegir has made for your database users, you can use a command like the following:</p>

<p><div class="codeblock"><code>USE mysql;<br />SELECT User,Host FROM user WHERE Host=&#039;localhost&#039; AND User &lt;&gt; &#039;root&#039; AND User &lt;&gt; &#039;debian-sys-maint&#039;;<br />SELECT Host,Db,User FROM db WHERE User &lt;&gt; &#039;&#039;;</code></div></p>

<p>In Debian, the following will remove all non-system users (which may include non-aegir users!!!).</p>

<p><strong>WARNING: DO NOT RUN THIS BEFORE CHECKING WHAT WILL BE DELETE BY RUNNING THE SELECT ABOVE!! THIS WILL DELETE ALL USERS FROM YOUR MYSQL DATABASE!!!</strong></p>

<p><div class="codeblock"><code>DELETE FROM db WHERE User &lt;&gt; &#039;&#039;;<br />DELETE FROM user WHERE Host=&#039;localhost&#039; AND User &lt;&gt; &#039;root&#039; AND User &lt;&gt; &#039;debian-sys-maint&#039;;<br />FLUSH PRIVILEGES;</code></div></p>

<p>Then you will need to <code>DROP DATABASE</code> for every database.</p>

<p>Consult the <a href="http://dev.mysql.com/doc/refman/5.1/en/grant.html">GRANT</a> and <a href="http://dev.mysql.com/doc/refman/5.1/en/drop-user.html">DROP</a> documentation from MySQL for more information.</p>

<h2>Remove the aegir user's crontab</h2>

<p><code>crontab -r -u aegir</code></p>

<h1>Removing everything</h1>

<p>At this point, we have removed all data that Aegir manages and we would be ready to reinstall the frontend. If we want to remove all traces, however, there's more work to do.</p>

<h2>Remove /var/aegir</h2>

<p><code>rm -rf /var/aegir</code></p>

<h2>Delete the aegir user</h2>

<p><code>userdel aegir</code></p>

<p>This will also remove the user from the www-data group.</p>

<h2>Remove the user from sudoers</h2>

<p><code>visudo</code></p>

<p>Remove the line that looks something like</p>

<p><code>aegir ALL=NOPASSWD: /usr/sbin/apache2ctl</code></p>

<p>Save and exit the file.</p>

<h2>Delete the symlink/include from Apache</h2>

<p>Depending on your installation and OS this may vary.</p>

<p>Generally:</p>

<pre><code>rm /etc/apache2/conf.d/aegir.conf
</code></pre>

<p>If your Include statements were contained in a global system <code>httpd.conf</code> file or similar, you will need to remove these lines manually.</p>

<p>Restart Apache when you have completed this.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-74.html?destination=node%2F12%23comment-form">Login</a> or <a href="../user/register/index-74.html?destination=node%2F12%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2753" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/administrator/extracting-drupal-site-aegir/index.html">Extracting a Drupal site from Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>You may occasionally want to take a Drupal site hosted on a server managed with Aegir and put it somewhere else. This is pretty easy, but not quite as simple as moving a normal Drupal site not managed by Aegir from one machine to another. In brief, you have to copy the site, delete the drushrc.php file, and replace settings.php with a copy of the default configuration file. More specifically:</p>

<ul>
<li>download the same copy of drupal core to the new server (and re-apply core patches, if any)</li>
<li>copy sites/all/ to the new server</li>
<li>copy the Aegir backup of your site to the new server and unzip in sites/yoursite.com/</li>
<li>create a database on the new server &amp; import the database backup</li>
<li>copy sites/community.aegirproject.org/default.settings.php to sites/yoursite.com/settings.php</li>
<li>D7: copy custom site aliases in sites/sites.php (if any) to the new server</li>
<li>D6: replicate site alias symlinks in sites/ (if any) on the new server</li>
<li>copy custom configuration in local.settings.php (if any) to settings.php</li>
<li>edit settings.php to add the database authentication details for the new server</li>
</ul>

<p>That's it!</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-75.html?destination=node%2F2753%23comment-form">Login</a> or <a href="../user/register/index-75.html?destination=node%2F2753%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-950" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/administrator/troubleshooting-aegir/index.html">Troubleshooting Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>Aegir is a complex system that depends on a number of components being properly integrated. This can obviously lead to difficulties on occasion. However, fear not! In all likelihood, any problem you can get yourself into has probably already been solved, and documented in this section. Just one of the benefits of using a popular open source system ;)</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-76.html?destination=node%2F950%23comment-form">Login</a> or <a href="../user/register/index-76.html?destination=node%2F950%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-321" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/321/index.html">How to fix a stuck task</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>It is possible a task may run longer than expected and you suspect something has gone wrong. It is even possible the task may cause a server to become unresponsive. Restarting the server will not stop the task, although it may make the server become responsive again.</p>

<p>To stop a Task, find the related task node (install: mysite.com) in the content list: /admin/content/node/overview, and delete it. This will stop Aegir from trying to run the task.</p>

<p>In the case of a site install, it may also be necessary to also delete the node for the site itself. The site may have actually installed properly. Verify the affected platform and see if Aegir imports the site. If so, you may need to reset the password to gain access to the new site. If the site doesn't import in the verify, delete any files from the sites folder on the selected platform and either try again and/or research why the task may have failed.</p>

<p>It can also be very helpful to try running tasks from the command line with drush (the entire Aegir web frontend is basically a user-friendly interface to a series of drush commands). You can see which command is being run by looking at a task node in Aegir. For example, if you are having problems verifying a site, you could run: <br />
<code>drush @mysite.com provision-verify --debug</code></p>

<p>Another option is to run the hosting task itself within the hostmaster context, which will then invoke the drush command on the applicable site. You can find the task node ID in the web frontend (look at the URL generated by Aegir to create the popup box which shows the log). If the task ID was 1234, you would then run this from the command line:  <br />
<code>drush @hostmaster hosting-task 1234 --debug</code></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-77.html?destination=node%2F321%23comment-form">Login</a> or <a href="../user/register/index-77.html?destination=node%2F321%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-751" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../debugging/index.html">Debugging Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Installation and configuration of Aegir has been greatly simplified with the release of .deb packages. However, for other operating systems, or for those installing manually, making a mistake during the installation or upgrade of Aegir or Drush is easy to do, and these tips identify some of the most common mistakes.</p>

<h3>The Aegir User</h3>

<ul>
<li>Make sure you have an aegir user (who we call the Aegir User) and that the Aegir User is properly configured on your server:

<ul>
<li><code>cat /etc/passwd</code> prints all users.  Find the line <code>aegir:x:1000:1000:,,,:/var/aegir:/bin/bash</code>.  <code>aegir</code> usually is the Aegir User.  Be cautious about using a different username, and <strong>do not</strong>use an existing user or a user that will have any other role on the server.  The Aegir User should only be used for Aegir activities.</li>
<li>Verify the Aegir install directory is the user's home.  Usually, the Aegir directory is <code>/var/aegir</code>.  Be cautious about installing Aegir in a different directory only because you are likely to get confused and nearly all the documentation assumes you have used <code>/var/aegir</code></li>
<li>Make sure that the node that defines your Aegir server (e.g., <code>www.example.com/node/2</code>) identifies the <code>Script User</code> as your Aegir User.  (You can find this node by clicking on the Servers menu tab and then clicking on the server URI shown in the list that appears of Aegir servers.)</li>
<li>All this is detailed in the install profile wizard</li>
</ul></li>
<li><strong>Do not run aegir as root!</strong> - It's an unsafe and unsupported configuration that is known to cause problems</li>
</ul>

<h3>Make Sure drush Is Installed Properly</h3>

<ul>
<li>Make sure that the node that defines your Aegir Server has the correct path to drush.

<ul>
<li>See <code>/var/aegir/drush/readme.txt</code> for install instructions</li>
</ul></li>
<li>Check your Drush setup:

<ul>
<li>Always run drush as your aegir user, and never as "root".</li>
<li>Make sure that the Provision module is in the <code>aegir/.drush/provision/</code> directory.</li>
<li>Make sure that the Hosting module is in <code>~aegir/hostmaster-0.x/profiles/hostmaster/modules/hosting</code> (substitute the platform <code>hostmaster-0.x</code> to match the directory on your system in which you have installed the Drupal code that is running your Aegir site)</li>
<li>Run "drush help" and make sure that "provision" commands appear.  "hosting" commands will not appear in the latest (after 2009/05/18) Drush versions, unless Drupal can be fully bootstrapped</li>
</ul></li>
</ul>

<h3>Apache</h3>

<ul>
<li>Make sure the Aegir User can restart Apache without a password and that the corresponding command is defined in your Aegir Server Node

<ul>
<li>As your Aegir User, run the command shown in the "Restart command" field in your Aegir Server Node to ensure that your Aegir User can restart Apache</li>
<li>On Ubuntu, it's <code>sudo /usr/sbin/apache2ctl graceful</code>.  The command should execute and return without asking for a password when run as the Aegir User</li>
</ul></li>
<li>Make sure Apache can parse its configuration 

<ul>
<li>On Ubuntu, <code>sudo apache2ctl configtest</code> should report "System Ok"</li>
</ul></li>
</ul>

<h3>Other Things</h3>

<ul>
<li>On a Linux system, check that /etc/sudoers is chmod 440 (i.e., read only for the file owner and group, which is usually root)</li>
<li>Attempt to run the cron tasks manually from the command line

<ul>
<li><code>php /var/aegir/drush/drush.php --root=/var/aegir/hostmaster-0.x --uri=http://youraegirsite.com hosting-tasks --debug</code></li>
</ul></li>
<li>Or you can retry a specific task form the command line

<ul>
<li><code>php /var/aegir/drush/drush.php --root=&#039;/var/aegir/hostmaster-0.4-alpha5&#039; --uri=&#039;youraegirsite.net&#039; hosting-task &lt;nid of the task&gt; --debug </code></li>
</ul></li>
</ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-78.html?destination=node%2F751%23comment-form">Login</a> or <a href="../user/register/index-78.html?destination=node%2F751%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-3065" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/content/administrator/troubleshooting-aegir/strict-warning-error/index.html">&quot;strict warning&quot; error</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_567 first"><a href="../category/keywords/non-static/index.html" rel="tag" title="">non-static</a></li>
<li class="taxonomy_term_566"><a href="../category/keywords/strict/index.html" rel="tag" title="">strict</a></li>
<li class="taxonomy_term_565"><a href="../category/keywords/strict-warning/index.html" rel="tag" title="">strict warning</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p><strong>Aegir 2.x returns the following error message</strong></p>

<p>strict warning: Non-static method view::load() should not be called statically in /var/aegir/hostmaster-6.x-2.1/profiles/hostmaster/modules/views/views.module on line 1113.</p>



<p><strong>Cause</strong></p>

<p>It's due to a conflict between Views 3.x and PHP 5.4. For example, your server uses PHP 5.4 or more recent. And you updated Drupal core for Aegir to Drupal 6.34 or more recent and this error message is showing on all Aegir pages.</p>



<p><strong>Solutions</strong></p>

<p>Option 1: Install "<a href="http://drupal.org/project/disable_messages">disable_messages</a>" module. And disable all messages related to:</p>

<blockquote>
<code>strict .*.</code>
</blockquote>

<p><a href="http://www.howtoeverything.net/linux/drupal/selectively-hide-strict-warning-errors-php-5.4-drupal-6.x-views">Read more here</a>, under <em>"How to hide only specific error messages to specific users"</em> section.</p>

<p>Option 2: Patch Views 3.x. Read more at <a href="https://www.drupal.org/node/780156" title="https://www.drupal.org/node/780156">https://www.drupal.org/node/780156</a> or <a href="https://www.drupal.org/node/893128#comment-4760978" title="https://www.drupal.org/node/893128#comment-4760978">https://www.drupal.org/node/893128#comment-4760978</a></p>

<p>Option 3: Turn off Strict warnings in your "php.ini" file. Read more at <a href="https://www.drupal.org/node/1833170#comment-6994142" title="https://www.drupal.org/node/1833170#comment-6994142">https://www.drupal.org/node/1833170#comment-6994142</a> or <a href="https://www.drupal.org/node/465332#comment-6533810" title="https://www.drupal.org/node/465332#comment-6533810">https://www.drupal.org/node/465332#comment-6533810</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-79.html?destination=node%2F3065%23comment-form">Login</a> or <a href="../user/register/index-79.html?destination=node%2F3065%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/administrator?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:26:22 GMT -->
</html>
