<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  
<!-- Mirrored from community.aegirproject.org/discuss/aegir-2x-nginx-install-notes by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 17:08:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
    <link type="text/css" rel="stylesheet" media="all" href="../../profiles/openatrium/modules/contrib/codefilter/codefilter/index.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/community.aegirproject.org/files/css/css_b8ca3ff360daa12eff502993554e60d0/index.css" />
<link type="text/css" rel="stylesheet" media="screen" href="../../sites/community.aegirproject.org/files/css/css_c151a4313ed94e62ccee94ea27ad58ed/index.css" />
<link type="text/css" rel="stylesheet" media="print" href="../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<style type='text/css'>
.atrium-welcome-links a:hover,
.dropdown-blocks .block-toggle li a:hover,
.dropdown-blocks .block-toggle li a:focus,
.dropdown-blocks .block-toggle ul.links li a:hover,
.dropdown-blocks .block-toggle ul.links li a:focus,
.dropdown-blocks .block-toggle .item-list li a:hover,
.dropdown-blocks .block-toggle .item-list li a:focus,
.pager li.pager-current,
.more-link a:hover,
#global,
#navigation { background-color:#143352; }

body #space-tools .block-title { background-color:#0e2339; }

body #header .block-widget .block-content,
body #header .block .block-title { background-color:#112b45; }

body .page-region .block .block-title {
  background-color:#c2c8ce;
  border-color:#b4bbc1;
  border-bottom-color:#a7adb3;
  }

.drilldown .trail a {
  border-top-color:#f3f4f6;
  border-bottom-color:#d2d4d6;
  background-color:#e3e4e6;
  }

.decay-10 .comment-title { border-color:#eeeeee; }
.decay-9 .comment-title { border-color:#d8dbde; }
.decay-8 .comment-title { border-color:#c2c8ce; }
.decay-7 .comment-title { border-color:#acb5bf; }
.decay-6 .comment-title { border-color:#96a3af; }
.decay-5 .comment-title { border-color:#8190a0; }
.decay-4 .comment-title { border-color:#6b7d90; }
.decay-3 .comment-title { border-color:#556b80; }
.decay-2 .comment-title { border-color:#3f5871; }
.decay-1 .comment-title { border-color:#294561; }
.decay-0 .comment-title { border-color:#143352; }
</style>
    <script type="text/javascript" src="../../sites/community.aegirproject.org/files/js/js_dddbfcfef882b2074d904e22eb494d08/index.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/"});
//--><!]]>
</script>
    <!--[if lte IE 8]><style type='text/css' media='screen'>@import '/profiles/openatrium/themes/ginkgo/ie.css';</style><![endif]-->    <title>Aegir 2.x nginx install notes | community.aegirproject.org</title>
  </head>
  <body  class="not-front not-logged-in page-node node-type-discussion one-sidebar sidebar-right designkit tao rubik admin-static page">

  <a id='skipnav' href='#content'>Skip navigation</a>
  <div id='global'><div class='limiter clear-block'>
          <div id='header' class='dropdown-blocks toggle-blocks clear-block'>
          

<div  id="block-atrium-account" class="block block-atrium block-widget block-notitle">
  
  
      <div class='block-content clear-block '>
      <a href="../../user/login/index.html">Log in</a>    </div>
  
  </div>


  

<div  id="block-boxes-search_issues" class="block block-boxes block-toggle">
      <div class='block-title'>
            <a href="index.html#block-boxes-search_issues" class="toggle element-invisible active">Toggle</a>LOOKING FOR HELP?    </div>
  
  
      <div class='block-content clear-block '>
      <div id='boxes-box-search_issues' class='boxes-box'><div class="boxes-box-content"><table class="prose">
<tr>
<td width="50%">
<span style="font-size:16px;width:100%">Type some keywords below and hit "enter":</span><br />
<input type="text" class="drupal-issue-redirect" style="width:100%;min-width:200px;background-color:#DDEEFF; font-size:30px;border-style:dotted;border-width:1px" />
<p>This will search the drupal.org issue queues across the various projects that make up the Aegir system. If there are no relevant results, please submit an issue there.</p></td>
<td style="padding:10px">Other support resources:
<ul>
<li><a href="irc://irc.freenode.net/aegir">#aegir on IRC</a></li>
<li><a href="../../faq/index.html">FAQ</a></li>
<li><a href="../../handbook/index.html">Aegir Handbook</a></li>
<li><a href="../../service-providers/index.html">Aegir service providers</a></li>
<li><a href="https://drupal.org/project/issues?text=&amp;projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&amp;status=Open&amp;priorities=All&amp;categories=All">All Aegir issues</a></li>
<li><a href="http://drupal.stackexchange.com/questions/tagged/aegir">Aegir tag on Drupal Stackexchange</a></li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
$("input.drupal-issue-redirect").change(function() {
  searchURL= "http://drupal.org/project/issues?text="+$(this).val()+"&projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&status=Open&priorities=All&categories=All";
  window.location = searchURL;
});
</script></div></div>    </div>
  
  </div>


      </div>
        <div class='breadcrumb'><span class='link link-0'><a href="../../index.html">Home</a></span></div>    <a href="../../index.html" class="logo" style="background-position:100% 50%; background-image:url(../%27http_/community.aegirproject.org/sites/community.aegirproject.org/files/imagecache/designkit-image-logo/logo/index.html)"></a>  </div></div>

    <div id='navigation'><div class='limiter clear-block'>
    <ul id="features-menu" class="links primary-links"><li class="menu-617 first"><a href="../../dashboard/index.html" class=" icon-dashboard"><span class='icon'></span><span class='label'>Dashboard</span></a></li>
<li class="menu-618"><a href="../../handbook/index.html" class=" icon-handbook"><span class='icon'></span><span class='label'>Documentation</span></a></li>
<li class="menu-2427 active"><a href="../../discussion/index.html" class="active icon-discussion"><span class='icon'></span><span class='label'>Discussion</span></a></li>
<li class="menu-2426"><a href="../../calendar/index.html" class="spaces-menu-editable icon-calendar"><span class='icon'></span><span class='label'>Calendar</span></a></li>
<li class="menu-823"><a href="../../reader/index.html" class=" icon-reader"><span class='icon'></span><span class='label'>Feed reader</span></a></li>
<li class="menu-2429 last"><a href="../../members/index.html" class=" icon-members"><span class='icon'></span><span class='label'>Members</span></a></li>
</ul>          <div id='space-tools'><div class='dropdown-blocks toggle-blocks clear-block'>  

<div  id="block-atrium-search" class="block block-atrium block-toggle">
      <div class='block-title'>
            <a href="index.html#block-atrium-search" class="toggle element-invisible active">Toggle</a><span class='icon'></span> Search    </div>
  
  
      <div class='block-content clear-block '>
      <form action="http://community.aegirproject.org/discuss/aegir-2x-nginx-install-notes"  accept-charset="UTF-8" method="post" id="atrium-search-form">
<div><div  class="form-item form-item-labeled" id="edit-search-wrapper">
      <label  for="edit-search">Search: <span class='form-required' title='This field is required.'>*</span></label>
    <input type="text" maxlength="128" name="search" id="edit-search" value="" class="form-text required fluid" />  </div>
<input type="submit" name="op" id="edit-submit" value="Search"  class="form-submit" />
<input type="hidden" name="form_build_id" id="form-HGQxX-Oy7FrG2XKt-ieK1MuctVD6KrXmThZnruOOi08" value="form-HGQxX-Oy7FrG2XKt-ieK1MuctVD6KrXmThZnruOOi08"  />
<input type="hidden" name="form_id" id="edit-atrium-search-form" value="atrium_search_form"  />

</div></form>
    </div>
  
  </div>


</div></div>
      </div></div>
  
  <div id='page-tools'><div class='limiter clear-block'>
    <h1  class="page-title page-title-hidden">Aegir 2.x nginx install notes</h1>    <div class='tabs clear-block'><ul class='links primary-tabs'><li class="active" ><a href="index.html" class="active">View</a></li>
<li ><a href="../../node/1560/revisions/index.html">Revisions</a></li>
</ul></div>    <a href="index.html#block-atrium-help" id="help-toggler" class="palette-toggle active">Help</a>          </div></div>

  
  
  <div id='page'><div class='limiter clear-block'>
    
<div id='content'><div class='page-region'>
      <div class='page-content content-wrapper clear-block'>

<div  id="node-1560" class="node node-discussion clear-block node-page">
      <div class='node-submitted clear-block'>
      <div class="picture">
  <a href="../../users/anarcat/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/pictures/picture-78/index.jpg" alt="anarcat&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/anarcat/index.html" class="username" title="View user profile.">anarcat</a></div><div class='date'>4:03pm Jun 6, 2012</div>    </div>
  
      <h2 class='node-title'>
            <a href="index.html">Aegir 2.x nginx install notes</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>This document summarizes issues I have found while working offline on
Aegir 2.x on june 2012. I have taken those notes instead of filing
bugs as this work is being done offline and working on websites is
difficult and painful.</p>

<h2>use sudo instead of su</h2>

<p>We should use the following instead of su aegir:</p>

<pre><code>sudo -u aegir -H /bin/bash
</code></pre>

<p>Some systems, like Ubuntu, do not have a root password by default and
therefore depend on sudo to get their credentials. Since we depend on
sudo anyways, it makes more sense to use a sudo command there. (done)</p>

<h2>install drush through PEAR</h2>

<p>We should follow Arch linux's lead and install drush through PEAR, as
it is upstream's suggestion. (done)</p>

<h2>aegir 2.x modifications</h2>

<p>Those are the deviations from the regular install directives necessary
to install Aegir 2.x:</p>

<ol>
<li>install drush 5 instead of drush 4 (should be in the docs)</li>
<li>we don't depend on drush make anymore, as it's in drush 5 core!!
make sure we change the hostmaster-install help and process at the
very least (done?)</li>
</ol>

<h2>other issues</h2>

<ul>
<li><p>we should not talk about using a makefile if the hostmaster platform
already exists, when telling the user what we do</p></li>
<li><p>the aegir config file generates this nginx error:</p>

<pre><code>nginx on localhost could not be restarted. Changes might not be available until this has been done.  [warning]
(error: Reloading nginx configuration: nginx: [emerg] "error_log" directive is duplicate in
/etc/nginx/conf.d/aegir.conf:107
</code></pre>

<p>(fixed in 2.x)</p></li>
<li><p>install error:</p>

<pre><code>The hosting_platform_pathauto module is required but was not found. Please move it into the modules  [error]
subdirectory.
</code></pre>

<p>(the module should just be merged in 2.x, i think)</p></li>
<li><p>the nginx config file is way too big, it sets policy, like hiding
headers, SSL performance, gzip compression, size limits and so
on. those do not belong in an aegir configuration file, and should
at least be optional. the fastcgi_params are also duplicate of a
file in /etc/nginx.conf</p>

<p>(work started in the dev-nginx-cleanup branch)</p></li>
<li><p>out of the box, nginx shows "bad gateway" error when following the
login link - fix:</p>

<pre><code>diff --git a/php5/fpm/pool.d/www.conf b/php5/fpm/pool.d/www.conf
index 28a0651..e6d552d 100644
--- a/php5/fpm/pool.d/www.conf
+++ b/php5/fpm/pool.d/www.conf
@@ -30,7 +30,8 @@ group = www-data
 ;                            specific port;
 ;   '/path/to/unix/socket' - to listen on a unix socket.
 ; Note: This value is mandatory.
-listen = /var/run/php5-fpm.sock
+;listen = /var/run/php5-fpm.sock
+listen = localhost:9000

 ; Set listen(2) backlog.
 ; Default Value: 128 (-1 on FreeBSD and OpenBSD)
</code></pre>

<p>not sure how to fix this</p></li>
<li><p>the nginx includes may fail on remote servers because
/var/aegir/config/includes may not be rsync'd to remote servers</p></li>
<li><p>the nginx advanced and simple configuration are almost exactly the
same minus about 10 lines of diff - they should include each other
instead of duplicating stuff</p>

<p>(fixed in cleanup branch)</p></li>
</ul>

<h2>things i forgot</h2>

<ul>
<li>forgot to clone pkg-drush (done)</li>
<li>forgot to install the nginx-doc package (done)</li>
<li>forgot to install ab or siege (crap) (done)</li>
</ul>

<h2>offline hacks</h2>

<p>I had to go through a few hoops to make this work offline. To install
drush, i worked from a previous clone I had lying around:</p>

<pre><code>sudo aegir -H git clone ~anarcat/src/drush
sudo ln -s /var/aegir/drush/drush /usr/local/bin/drush
</code></pre>

<p>And the same for provision:</p>

<pre><code>sudo aegir -H git clone ~anarcat/src/provision .drush/provision --branch 6.x-2.x
</code></pre>

<p>Then for the frontend (trickier), I had to fiddle around with also a
previously existing hostmaster platform:</p>

<pre><code>git clone ~anarcat/src/drupal hostmaster-6.x-2.x --branch 6.26
git clone ~anarcat/src/hostmaster hostmaster-6.x-2.x/profiles/hostmaster --branch 6.x-2.x
cd hostmaster-6.x-2.x/profiles/hostmaster
cp -a ~/hostmaster-6.x-1.x/profiles/hostmaster/modules/{admin_menu,install_profile_api,jquery_ui,modalframe,openidadmin} modules
</code></pre>

<h2>Summary</h2>

<p>Overall, this works, but I am concerned about the complexity of the nginx config. There are too many things in there, I feel...</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../user/login/index-415.html?destination=node%2F1560%23comment-form">Login</a> or <a href="../../user/register/index-415.html?destination=node%2F1560%23comment-form">register</a> to post comments</span></li>
<li class="print last active"><a href="index-2.html?print" class="active">Print</a></li>
</ul></div>
  </div>


</div>
    </div></div>
<div id='right'><div class='page-region'>
    

<div  id="block-boxes-search_issues" class="block block-boxes">
      <div class='block-title'>
            LOOKING FOR HELP?    </div>
  
  
      <div class='block-content clear-block '>
      <div id='boxes-box-search_issues' class='boxes-box'><div class="boxes-box-content"><table class="prose">
<tr>
<td width="50%">
<span style="font-size:16px;width:100%">Type some keywords below and hit "enter":</span><br />
<input type="text" class="drupal-issue-redirect" style="width:100%;min-width:200px;background-color:#DDEEFF; font-size:30px;border-style:dotted;border-width:1px" />
<p>This will search the drupal.org issue queues across the various projects that make up the Aegir system. If there are no relevant results, please submit an issue there.</p></td>
<td style="padding:10px">Other support resources:
<ul>
<li><a href="irc://irc.freenode.net/aegir">#aegir on IRC</a></li>
<li><a href="../../faq/index.html">FAQ</a></li>
<li><a href="../../handbook/index.html">Aegir Handbook</a></li>
<li><a href="../../service-providers/index.html">Aegir service providers</a></li>
<li><a href="https://drupal.org/project/issues?text=&amp;projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&amp;status=Open&amp;priorities=All&amp;categories=All">All Aegir issues</a></li>
<li><a href="http://drupal.stackexchange.com/questions/tagged/aegir">Aegir tag on Drupal Stackexchange</a></li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
$("input.drupal-issue-redirect").change(function() {
  searchURL= "http://drupal.org/project/issues?text="+$(this).val()+"&projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&status=Open&priorities=All&categories=All";
  window.location = searchURL;
});
</script></div></div>    </div>
  
  </div>


  

<div  id="block-views-discussion_comments-block_1" class="block block-views">
      <div class='block-title'>
            Recent comments    </div>
  
  
      <div class='block-content clear-block '>
      <div class="view view-discussion-comments view-id-discussion_comments view-display-id-block_1 view-dom-id-1">
    
  
  
      <div class="view-empty">
      <p>No recent comments found.</p>    </div>
  
  
  
  
  
  
</div>     </div>
  
  </div>


</div></div>

  </div></div>

    <div id="footer"><div class='limiter clear-block'>
        <ul class="links"><li class="atrium first last"><a href="http://www.openatrium.com/" target="_blank">OpenAtrium.com</a></li>
</ul>  </div></div>
  
  <div id='palette'>  

<div  id="block-atrium-help" class="block block-atrium">
      <div class='block-title'>
            <span class='close'></span>Need help?    </div>
  
  
      <div class='block-content clear-block '>
      

<div  id="help-text" class="path-admin-help clear-block toggleable">
  
    
  
  
  
      <div class='help-content clear-block prose'>
      <span class='icon'></span><h3>Discussion</h3><p>The discussion area lets your team communicate by posting updates and discussing issues. It is a great place for sharing progress, discussing challenges, and exploring ideas.</p>
    </div>
  
  </div>


    </div>
  
  </div>


</div>
  
  </body>

<!-- Mirrored from community.aegirproject.org/discuss/aegir-2x-nginx-install-notes by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 17:08:35 GMT -->
</html>
