<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/discuss/there-way-delete-platform-command-line?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:08:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Is there a way to delete a platform from the command line? | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-1067" class="node node-discussion clear-block node-page">
      <div class='node-submitted clear-block'>
      <div class="picture">
  <a href="../../users/drush-fan/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="drush fan&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/drush-fan/index.html" class="username" title="View user profile.">drush fan</a></div><div class='date'>3:56pm Feb 13, 2012</div>    </div>
  
      <h2 class='node-title'>
            <a href="index.html">Is there a way to delete a platform from the command line?</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>Seems like there's a command to delete a site (provision-delete) and a context by passing --delete, but not the entire platform with all the files.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
<li class="print last active"><a href="index-2.html?print" class="active">Print</a></li>
</ul></div>
  </div>


<div id="comments">
  <a id="comment-1933"></a>


<div  id="comment-1933" class="comment comment-published clear-block decay-10 decay-10">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../users/gmania/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="Gmania&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/gmania/index.html" class="username" title="View user profile.">Gmania</a></div><div class='date'>10:20am May 15, 2013</div>    </div>
  
      <h2 class='comment-title'>
            <a href="index.html#comment-1933" class="active">#1</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>Building off of comment #8,</p>

<p>here's a drush script which will automatically add a delete task to hostmaster and delete all platforms with a certain name, which are older than 2 days.</p>

<p>We use this as part of our "lite" continuous integration approach (which runs entirely using shell scripts)
<a href="../our-zero-touch-build-setup-continuous-integration-lite/index.html" title="http://community.aegirproject.org/discuss/our-zero-touch-build-setup-continuous-integration-lite">http://community.aegirproject.org/discuss/our-zero-touch-build-setup-con...</a></p>

<p>cleanup.drush
<div class="codeblock"><code>#!/usr/bin/env drush<br /><br /><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//Cleanup script to delete empty autogenerated platforms older than 2 days<br /><br />//Provide the platform location via the command line<br /></span><span style="color: #0000BB">$platform_location </span><span style="color: #007700">= </span><span style="color: #0000BB">drush_shift</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT n.nid FROM hosting_platform AS p <br />&nbsp; INNER JOIN node AS n ON (p.nid=n.nid) <br />&nbsp; LEFT JOIN hosting_site AS s ON (p.nid=s.platform) <br />&nbsp; WHERE s.platform IS NULL AND n.created &lt; (UNIX_TIMESTAMP() - 172800) AND p.publish_path LIKE '%%%s%%' AND p.status = 1;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">db_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">, </span><span style="color: #0000BB">$platform_location</span><span style="color: #007700">);<br />while (</span><span style="color: #0000BB">$row </span><span style="color: #007700">= </span><span style="color: #0000BB">db_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">)) {<br />&nbsp; </span><span style="color: #0000BB">hosting_add_task</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'nid'</span><span style="color: #007700">], </span><span style="color: #DD0000">'delete'</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>Here's how to call it from the command line (make sure you're running it from a place where the @hostmaster context is available, like /var/aegir</p>

<p><code>cleanup.drush @hostmaster PREFIX</code></p>

<p>(where "PREFIX" is whatever name prefix you give your platforms that you want to automatically delete)</p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


<a id="comment-1934"></a>


<div  id="comment-1934" class="comment comment-published clear-block decay-9 decay-9">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../users/drush-fan/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="drush fan&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/drush-fan/index.html" class="username" title="View user profile.">drush fan</a></div><div class='date'>1:36pm May 15, 2013</div>    </div>
  
      <h2 class='comment-title'>
            <a href="index.html#comment-1934" class="active">#2</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>@Gmania</p>

<p>Pretty cool, thanks</p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


<a id="comment-2096"></a>


<div  id="comment-2096" class="comment comment-published clear-block decay-7 decay-7">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../users/fmb/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="FMB&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/fmb/index.html" class="username" title="View user profile.">FMB</a></div><div class='date'>10:03pm Dec 7, 2013</div>    </div>
  
      <h2 class='comment-title'>
            <a href="index.html#comment-2096" class="active">#3</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>Thanks for sharing!</p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


<a id="comment-2393"></a>


<div  id="comment-2393" class="comment comment-published clear-block decay-1 decay-1">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../users/pol/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="Pol&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/pol/index.html" class="username" title="View user profile.">Pol</a></div><div class='date'>7:35pm Mar 27, 2015</div>    </div>
  
      <h2 class='comment-title'>
            <a href="index.html#comment-2393" class="active">#6</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>I'm using this for Aegir 7.x-3.x, here's the code:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">hosting_cron_delete_platforms_cron</span><span style="color: #007700">() {<br /><br />&nbsp; </span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT n.nid FROM hosting_platform AS p INNER JOIN node AS n ON (p.nid=n.nid) LEFT JOIN hosting_site AS s ON (p.nid=s.platform) WHERE s.platform IS NULL AND n.created &lt; (UNIX_TIMESTAMP() - 86400) AND p.status = 1;"</span><span style="color: #007700">;<br />&nbsp; </span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">db_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /><br />&nbsp; foreach(</span><span style="color: #0000BB">$result </span><span style="color: #007700">as </span><span style="color: #0000BB">$row</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">watchdog</span><span style="color: #007700">(</span><span style="color: #DD0000">'hostmaster'</span><span style="color: #007700">, </span><span style="color: #DD0000">'Platform ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$row</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nid </span><span style="color: #007700">. </span><span style="color: #DD0000">' will be deleted.'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">hosting_add_task</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nid</span><span style="color: #007700">, </span><span style="color: #DD0000">'delete'</span><span style="color: #007700">);<br />&nbsp; }<br /><br />&nbsp; </span><span style="color: #0000BB">$sql </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT * FROM hosting_site_backups WHERE timestamp &lt; (UNIX_TIMESTAMP() - 86400)"</span><span style="color: #007700">;<br />&nbsp; </span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">db_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br /><br />&nbsp; foreach(</span><span style="color: #0000BB">$result </span><span style="color: #007700">as </span><span style="color: #0000BB">$row</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; if (</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #007700">)) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">watchdog</span><span style="color: #007700">(</span><span style="color: #DD0000">'hostmaster'</span><span style="color: #007700">, </span><span style="color: #DD0000">'Site backup ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$row</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename </span><span style="color: #007700">. </span><span style="color: #DD0000">' will be deleted.'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">hosting_add_task</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">site</span><span style="color: #007700">, </span><span style="color: #DD0000">'backup-delete'</span><span style="color: #007700">, array(</span><span style="color: #0000BB">$row</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">filename</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">hosting_site_delete_backup</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bid</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>I will probably create a module with configurable options this weekend.</p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


<a id="comment-2395"></a>


<div  id="comment-2395" class="comment comment-published clear-block decay-1 decay-1">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../user/54/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/pictures/picture-54/index.png" alt="ergonlogic&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../user/54/index.html" class="username" title="View user profile.">ergonlogic</a></div><div class='date'>3:42pm Mar 27, 2015</div>    </div>
  
      <h2 class='comment-title'>
            <a href="index.html#comment-2395" class="active">#4</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>I believe <code>provision-delete</code> will work on platform aliases... It's probably just a documentation bug that it specifies only sites.</p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


<a id="comment-2396"></a>


<div  id="comment-2396" class="comment comment-published clear-block decay-1 decay-1">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../users/pol/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="Pol&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/pol/index.html" class="username" title="View user profile.">Pol</a></div><div class='date'>7:25pm Mar 27, 2015</div>    </div>
  
      <h2 class='comment-title'>
            <a href="index.html#comment-2396" class="active">#5</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>So, it's possible to make backup of platforms then ?</p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


<a id="comment-2402"></a>


<div  id="comment-2402" class="comment comment-published clear-block decay-0 decay-0">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../users/helmo/index.html" title="View user profile."><img src="../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="helmo&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../users/helmo/index.html" class="username" title="View user profile.">helmo</a></div><div class='date'>7:52am Mon Jul 13</div>    </div>
  
      <h2 class='comment-title'>
            <a href="index.html#comment-2402" class="active">#7</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>@Pol I've create a sandbox for this itch a while ago, see <a href="https://www.drupal.org/sandbox/helmo/1283656" title="https://www.drupal.org/sandbox/helmo/1283656">https://www.drupal.org/sandbox/helmo/1283656</a></p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../user/login/index-19.html?destination=node%2F1067%23comment-form">Login</a> or <a href="../../user/register/index-19.html?destination=node%2F1067%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


</div>
    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/discuss/there-way-delete-platform-command-line?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:08:47 GMT -->
</html>
