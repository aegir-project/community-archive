<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/content/release-process?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:08:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../node/546/index.html" />
<link rel="up" href="../../node/546/index.html" />
<link rel="next" href="../../debian/index.html" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Release process | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-32" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="index.html">Release process</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first last"><a href="../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
</ul></div><div id='diff-inline-32'><p><strong>This page is being moved to <a href="http://docs.aegirproject.org/en/latest/community/release-process/" title="http://docs.aegirproject.org/en/latest/community/release-process/">http://docs.aegirproject.org/en/latest/community/release-process/</a> </strong></p>

<p>This page aims to document our release process. It documents the release cycle, but also the steps required to make a release.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#The_release_cycle"><span class="toc-number">1. </span>The release cycle</a></li>
	<li class="toc-level-1"><a href="#Steps_for_a_release"><span class="toc-number">2. </span>Steps for a release</a>
<ol>
	<li class="toc-level-2"><a href="#Make_sure_Jenkins_is_all_green"><span class="toc-number">2.1. </span>Make sure Jenkins is all green</a></li>
	<li class="toc-level-2"><a href="#Verify_that_drupal-org.make_specifies_up-to-date_versions"><span class="toc-number">2.2. </span>Verify that drupal-org.make specifies up-to-date versions</a></li>
	<li class="toc-level-2"><a href="#Generating_the_release_notes"><span class="toc-number">2.3. </span>Generating the release notes</a></li>
	<li class="toc-level-2"><a href="#Running_the_release.sh_script"><span class="toc-number">2.4. </span>Running the release.sh script</a>
<ol>
	<li class="toc-level-3"><a href="#Optional:_new_Eldir_release"><span class="toc-number">2.4.1. </span>Optional: new Eldir release</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Test_the_manual_install_in_Jenkins"><span class="toc-number">2.5. </span>Test the manual install in Jenkins</a></li>
	<li class="toc-level-2"><a href="#Build_the_Debian_packages"><span class="toc-number">2.6. </span>Build the Debian packages</a></li>
	<li class="toc-level-2"><a href="#Test_the_upgrade_in_Jenkins"><span class="toc-number">2.7. </span>Test the upgrade in Jenkins</a></li>
	<li class="toc-level-2"><a href="#Creating_release_nodes_on_Drupal.org"><span class="toc-number">2.8. </span>Creating release nodes on Drupal.org</a></li>
	<li class="toc-level-2"><a href="#Build_the_release_in_Jenkins_again"><span class="toc-number">2.9. </span>Build the release in Jenkins again</a></li>
	<li class="toc-level-2"><a href="#Publish_the_Debian_packages"><span class="toc-number">2.10. </span>Publish the Debian packages</a></li>
	<li class="toc-level-2"><a href="#Publish_the_release_notes_widely"><span class="toc-number">2.11. </span>Publish the release notes widely</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="The_release_cycle">1. The release cycle</h1>

<p>In general, each major Aegir release comprises a simultaneous release of all the modules that are part of the project. We generally go through several testing releases (alphas, betas &amp; RCs) before doing the first stable release on a branch.</p>

<ul>
<li>First an <strong>alpha</strong> is released to test new functionalities and to accomplish the goals decided in the <a href="../../node/35/index.html">Project Roadmap</a> for that major version. Example: <code>0.4-alpha1</code>, <a href="../../0/index-4.html"><code>0.4-alpha15</code></a></li>
<li>When we have covered most of the functionalities outlined in the <a href="../../roadmap/index.html">roadmap</a>, we push out <strong>beta releases</strong> until no more critical issues show up. This is generally considered a <em>soft feature freeze</em>. Example: <a href="../../0/index-3.html"><code>0.4-beta1</code></a></li>
<li>Then we go into <em>full feature freeze</em> and release a <strong>first release candidate</strong> (RC). Then a stable release branch is created, and the development branch is kept opened for development for the next stable release. This is generally considered a <em>soft API freeze</em>. Release candidates are made as long as critical bugs are found. Example: <a href="../../0/index.html"><code>0.4-rc1</code></a>, <a href="../../node/360/index.html">freeze announcement</a></li>
<li>Once the development branch has no known critical bugs, the <strong>stable release</strong> is announced. From there on only critical fixes (security, critical performance and critical bugfixes) are committed to the stable branch, and stable releases are published (without alpha/beta/RC) directly on the stable branch. The stable branch is in <strong>full API freeze</strong>. New features are generally committed to the development branch.</li>
</ul>

<p>See also <a href="../branch-and-tagging-conventions/index.html">the tag and branch naming convention</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Steps_for_a_release">2. Steps for a release</h1>

<p>For the specifics of release naming conventions and the cycle, see <a href="../../node/187/index.html">the branch naming convention</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Make_sure_Jenkins_is_all_green">2.1. Make sure Jenkins is all green</h2>

<p>Look into <a href="http://ci.aegirproject.org/">Jenkins</a> to see if all tasks have been performed without errors since the last commit. If there is an error, fix it before the release.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Verify_that_drupal-org.make_specifies_up-to-date_versions">2.2. Verify that drupal-org.make specifies up-to-date versions</h2>

<p>In the hostmaster project we maintain our own drupal-org.make file.
Check that e.g. the ctools version specified is not out-dated.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Generating_the_release_notes">2.3. Generating the release notes</h2>

<p>We build complete release notes for every release. Those are made up of a summary of the release, an outline of key changes, of known issues, install and upgrade instructions and a full list of bugfixes and new features.</p>

<p>Using <a href="https://www.drupal.org/project/grn">Git Release Notes for Drush</a></p>

<p><code>drush rn 7.x-3.0-alpha1 7.x-3.0-alpha2</code></p>

<p>The developers then proceed to format/edit the list of fixes as well as list other significant information/changes for this release. These notes end up becoming the Release Notes for the release, which are also entered in the <code>debian/changelog</code> file by the script below.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Running_the_release.sh_script">2.4. Running the release.sh script</h2>

<p>Each time we make a new release, we run a script called <code>release.sh</code> in provision.</p>

<p>This script should only be used by the core dev team when doing an official release. If you are not one of those people, you probably shouldn't be running this.</p>

<p>This script does all the 'hard' work in that it doesn't forget all the very many places to edit version numbers etc of relevant documentation and other scripts. This includes install.sh.txt and upgrade.sh.txt.</p>

<p><em>note from just after 7.x-3.0-beta1</em>: It's probably a good idea to disable the Jenkins jobs named 'D_aegir-debian*'. This could prevent later troubles in the 'Publish the Debian packages' section.</p>

<p>Paraphrasing from the script itself:</p>

<p><div class="codeblock"><code>The following operations will be done:<br /> 0. prompt you for a debian/changelog entry<br /> 1. change the makefile to download tarball<br /> 2. change the upgrade.sh.txt version<br /> 3. display the resulting diff<br /> 4. commit those changes to git<br /> 5. lay down the tag<br /> 6. revert the commit<br /> 7. (optionally) push those changes<br /><br />The operation can be aborted before step 7. Don&#039;t forget that as<br />long as changes are not pushed upstream, this can all be reverted (see<br />git-reset(1) and git-revert(1) ).</code></div></p>

<p>Next, we need to add the tag in hostmaster, and push it to the d.o repos. So in short, this sums up as:</p>

<p><div class="codeblock"><code>cd provision<br />sh release.sh 1.10<br />cd ../hostmaster<br />git tag 6.x-1.10<br />git push origin 6.x-1.10</code></div></p>

<p>Notice how we just provide the Aegir release number (<code>1.10</code>) to the release script, not the Drupal branch (<code>6.x</code>), which is hardcoded in the script to remove potential confusion.</p>

<p><strong>Special, for 2.x:</strong> While we wait for core support in drush (<a href="https://drupal.org/node/1991764">issue #1991764</a>) we need to manually modify the makefiles in hostmaster, drupal-org.make and hostmaster.make to point to the tags we lay down manually in hostmaster, hosting and provision (and maybe eldir). So this ends up being:</p>

<p><div class="codeblock"><code>cd provision<br />sh release.sh 2.0<br />cd ../hostmaster<br />git pull<br />git tag 6.x-2.0<br />git push origin 6.x-2.0<br />cd ../hosting<br />git pull<br />git tag 6.x-2.0<br />git push origin 6.x-2.0</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Optional:_new_Eldir_release">2.4.1. Optional: new Eldir release</h3>

<p>If we do a major release (say a point zero release), we may want to make a new release of the theme (<a href="https://drupal.org/project/eldir">Eldir</a>). This can also be performed if there enough new changes on the theme to warrant a new release on its own.</p>

<p>To do a new release of Eldir:</p>

<ol>
<li>tag and push the tag</li>
<li>update the version to fetch in hostmaster.make</li>
<li><a href="https://drupal.org/node/add/project-release/452774">create a release node</a> for Eldir</li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Test_the_manual_install_in_Jenkins">2.5. Test the manual install in Jenkins</h2>

<p>Before making a full release, test the release in Jenkins. To do so, start a build of the  launch the <a href="http://ci.aegirproject.org/job/S_aegir_6.x-1.x_install/">S_aegir_6.x-1.x_install job</a> (or <a href="http://ci.aegirproject.org/job/S_aegir_6.x-2.x_install/">S_aegir_6.x-2.x_install job</a> for 2.x) with the following parameters:</p>

<ul>
<li>the right release as the <code>AEGIR_VERSION</code> parameter</li>
<li>the <code>DRUSH_VERSION</code> to match what is required for this release. (Currently '4.5' for Aegir 1.x)</li>
</ul>

<p>If the build fails, delete the remote tags (using <code>git push origin :6.x-1.7</code>, for example), fix the bugs and start again.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Build_the_Debian_packages">2.6. Build the Debian packages</h2>

<p>Build the package and upload to <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org/">http://debian.aegirproject.org/</a>. Jenkins can build and upload a Debian package for you with <a href="http://ci.aegirproject.org/job/S_aegir-debian-official/">the S_aegir-debian-official job</a>.</p>

<p>If you need to move the tags again, you will need to clear the testing archive using the <a href="http://ci.aegirproject.org/job/R clear repo/">R clear repo job</a>, with the testing argument.</p>

<p>You can also build and upload the package yourself as explained in these <a href="../../node/543/index.html">detailed instructions</a>. We first upload the package to the <code>testing</code> distribution, and it gets migrated down into <code>stable</code> after tests.</p>

<p><strong>Special, for 2.x</strong>: build the package manually, see <a href="../../node/543/index.html">detailed instructions</a>. It should be something like:</p>

<pre><code>./release.sh 2.0-rc5
git reset --hard 6.x-2.0-rc5
git-buildpackage <a href="mailto:-kanarcat@koumbit.org">-kanarcat@koumbit.org</a> --git-builder=debuild
dput aegir build-area/aegir2-provision_2.0~rc5_amd64.changes
</code></pre>

<p>See the <a href="../../node/543/index.html">detailed instructions</a> for the dput configuration.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Test_the_upgrade_in_Jenkins">2.7. Test the upgrade in Jenkins</h2>

<p>Once both of those tasks have executed successfully, you can test the upgrade of the Debian packages by running the following Jenkins job:</p>

<p><a href="http://ci.aegirproject.org/view/Upgrades/job/U aegir 6.x-1.x deb upgrade/" title="http://ci.aegirproject.org/view/Upgrades/job/U%20aegir%206.x-1.x%20deb%20upgrade/">http://ci.aegirproject.org/view/Upgrades/job/U%20aegir%206.x-1.x%20deb%2...</a></p>

<p>(Note that this test is currently non-functional)</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Creating_release_nodes_on_Drupal.org">2.8. Creating release nodes on Drupal.org</h2>

<p>Once the tags are pushed and release notes published, we create a release node with an excerpt of (and a link to) the release notes so that tarballs are created and issue queue versions updated.</p>

<p>This needs to be done in the <a href="https://drupal.org/node/add/project-release/195997">hostmaster</a> and <a href="https://drupal.org/node/add/project-release/196005">provision</a> (and <a href="https://drupal.org/node/add/project-release/196008">hosting</a>  and (maybe) <a href="https://drupal.org/node/add/project-release/452774">eldir</a> for 2.x) projects on Drupal.org.</p>

<p>Note: this could be <a href="http://drupal.org/node/1050618">automated</a> with the right stuff on Drupal.org.</p>

<p><strong>Special, for 2.x</strong>: make sure release nodes are created in order! The projects shipped with hostmaster (hosting, eldir, etc) need to be fully released before the hostmaster release node is created!</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Build_the_release_in_Jenkins_again">2.9. Build the release in Jenkins again</h2>

<p>At this point, it's possible that the tarballs on Drupal.org were not created properly. We want to test the real procedure, so run a your build again, but choose 'package' as the <code>AEGIR_FETCH_MODE</code>. <a href="http://ci.aegirproject.org/job/S_aegir_6.x-1.x_install/">S_aegir_6.x-1.x_install job</a></p>

<p>Note: The link provided may reference the wrong test, since there doesn't appear to be an AEGIR_FETCH_MODE parameter.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Publish_the_Debian_packages">2.10. Publish the Debian packages</h2>

<p>Finally, when the Debian packages are tested you will need to pull them into the stable release channel:</p>

<p><a href="http://ci.aegirproject.org/view/Release scripts/job/R repo pull/" title="http://ci.aegirproject.org/view/Release%20scripts/job/R%20repo%20pull/">http://ci.aegirproject.org/view/Release%20scripts/job/R%20repo%20pull/</a></p>

<p><strong>2.x note</strong>: we pull to testing (and stable since the betas), manually:</p>

<pre><code>reprepro copy testing unstable aegir2
reprepro copy testing unstable aegir2-hostmaster
reprepro copy testing unstable aegir2-provision
reprepro copy testing unstable aegir2-cluster-slave
</code></pre>

<p><strong>3.x note</strong>: we pull to stable (since the betas), manually:</p>

<pre><code>reprepro@zeus:~$ reprepro copy stable unstable aegir3
reprepro@zeus:~$ reprepro copy stable unstable aegir3-hostmaster
reprepro@zeus:~$ reprepro copy stable unstable aegir3-provision
reprepro@zeus:~$ reprepro copy stable unstable aegir3-cluster-slave
</code></pre>

<p>If Jenkins has managed to build .debs and upload them before you've have a chance to pull them into testing/stable, you can manually remove them like so:</p>

<pre><code>reprepro remove unstable aegir2-cluster-slave aegir2 aegir2-provision aegir2-hostmaster
</code></pre>

<p>This should be prevented by disabling the Jenkins jobs named 'D_aegir-debian*' before starting to push the release tags.</p>

<p>You can then re-upload the new .debs you've generated, using the '-f' (force) flag:</p>

<pre><code>dput -f aegir build-area/aegir2-provision_2.3_amd64.changes
</code></pre>

<p>After doing that, you can re-run the 'copy' commands to publish the .debs to the appropriate releases.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Publish_the_release_notes_widely">2.11. Publish the release notes widely</h2>

<p>Once all this is done and the tarballs are generated, the release notes are published in:</p>

<ul>
<li>The <a href="../../node/66/index.html">handbook</a> (this is where the release notes live!)</li>
<li>A link to the release notes on the <a href="../../index.html">frontpage block</a></li>
<li>An <a href="../../node/add/event/index.html">event in the calendar</a></li>
<li>A <a href="../../node/add/discussion/index.html">discussion post</a> (don't forget to make it 'sticky' &amp; remove stickiness from the previous announcement)</li>
<li>Update the version in the <a href="../../upgrading/script/index.html">script upgrade page</a></li>
<li>The topic of the IRC channel</li>
<li>The aegir-announce mailing list (<a href="mailto:announce@lists.aegirproject.org">announce@lists.aegirproject.org</a>.)</li>
<li>Twitter as @aegirproject</li>
</ul>

<p>Optionally, blog posts on <a href="http://koumbit.org/">koumbit.org</a>, <a href="http://mig5.net/">mig5.net</a>, and elsewhere may go into further detail about significant changes, screencasts etc.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="print first active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../../user/login/index-18.html?destination=node%2F32%23comment-form">Login</a> or <a href="../../user/register/index-18.html?destination=node%2F32%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/content/release-process?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:08:47 GMT -->
</html>
