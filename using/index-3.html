<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/using?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:05:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../node/3/index.html" />
<link rel="up" href="../content/aegir-handbook/index.html" />
<link rel="next" href="../node/19/index.html" />
<link rel="canonical" href="index.html" />
<link rel="prev" href="index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../node/43/index.html" />
<link rel="prev" href="../node/19/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../node/22/index.html" />
<link rel="prev" href="../node/43/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../node/60/index.html" />
<link rel="prev" href="../node/22/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../node/42/index.html" />
<link rel="prev" href="../node/60/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../node/23/index.html" />
<link rel="prev" href="../node/42/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../migration-tips/index.html" />
<link rel="prev" href="../node/23/index.html" />
<link rel="up" href="../node/23/index.html" />
<link rel="next" href="../content/renaming-aegir-hostmaster-site-itself/index.html" />
<link rel="prev" href="../migration-tips/index.html" />
<link rel="up" href="../node/23/index.html" />
<link rel="next" href="../node/24/index.html" />
<link rel="prev" href="../content/renaming-aegir-hostmaster-site-itself/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../node/25/index.html" />
<link rel="prev" href="../node/24/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../node/45/index.html" />
<link rel="prev" href="../node/25/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../node/26/index.html" />
<link rel="prev" href="../node/45/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../open-id-tips-and-tricks/index.html" />
<link rel="prev" href="../node/26/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../content/best-recipes-disaster-and-how-avoid-them/index.html" />
<link rel="prev" href="../open-id-tips-and-tricks/index.html" />
<link rel="up" href="../node/43/index.html" />
<link rel="next" href="../node/20/index.html" />
<link rel="prev" href="../content/best-recipes-disaster-and-how-avoid-them/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../node/44/index.html" />
<link rel="prev" href="../node/20/index.html" />
<link rel="up" href="../node/20/index.html" />
<link rel="next" href="../node/27/index.html" />
<link rel="prev" href="../node/44/index.html" />
<link rel="up" href="../node/20/index.html" />
<link rel="next" href="../node/256/index.html" />
<link rel="prev" href="../node/27/index.html" />
<link rel="up" href="../node/20/index.html" />
<link rel="next" href="../node/28/index.html" />
<link rel="prev" href="../node/256/index.html" />
<link rel="up" href="index.html" />
<link rel="next" href="../administrator/index.html" />
<link rel="shortcut icon" href="../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>User Manual | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-469" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="index.html">User Manual</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_4 first"><a href="../taxonomy/term/4/index.html" rel="tag" title="This level is for users who have access to only their sites and not able to manage all Aegir features, accounts or the server/system.">Client</a></li>
<li class="taxonomy_term_3"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><div id='diff-inline-469'><p>This section of the handbook describe how to use Aegir in the day-to-day management of sites and platforms.</p>

<p><div class="view view-book-subpages view-id-book_subpages view-display-id-default view-dom-id-1">
    
  
  
      <div class="view-content">
        <div class="views-row views-row-1 views-row-odd views-row-first">
    

  
    
                      <div class="views-field title">
                      <li><a href="../node/19/index.html">Getting to know the interface</a></li>                  </div>
      
    
  

  </div>
  <div class="views-row views-row-2 views-row-even">
    

  
    
                      <div class="views-field title">
                      <li><a href="../node/43/index.html">Your site and Aegir</a></li>                  </div>
      
    
  

  </div>
  <div class="views-row views-row-3 views-row-odd">
    

  
    
                      <div class="views-field title">
                      <li><a href="../node/20/index.html">Setting up a Platform</a></li>                  </div>
      
    
  

  </div>
  <div class="views-row views-row-4 views-row-even views-row-last">
    

  
    
                      <div class="views-field title">
                      <li><a href="../node/28/index.html">Client management and access control</a></li>                  </div>
      
    
  

  </div>
    </div>
  
  
  
  
  
  
</div> </p></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="print first active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../user/login/index-10.html?destination=node%2F469%23comment-form">Login</a> or <a href="../user/register/index-10.html?destination=node%2F469%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



<div  id="node-19" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/19/index.html">Getting to know the interface</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_4 first"><a href="../taxonomy/term/4/index.html" rel="tag" title="This level is for users who have access to only their sites and not able to manage all Aegir features, accounts or the server/system.">Client</a></li>
<li class="taxonomy_term_3"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>So you've installed Aegir, arrived at the home page of your installation and are waiting for the magic to begin. On this page we'll introduce you to Aegir and how easy it is to use.</p>

<h1>Get to know the interface</h1>

<div align="center"><a href="../sites/community.aegirproject.org/files/selection_003/index.png"><img src="../sites/community.aegirproject.org/files/selection_003_thumb/index.png" /></a></div>

<h2>Home</h2>

<p>Once you've successfully completed an Aegir installation, you'll be presented with the homepage, titled 'Home'.</p>

<p>In a standard installation there won't be any sites listed here yet, other than the main Aegir site itself, which gets imported into the system during the installation. This is normal - Aegir even recognises itself as a Drupal site on your server, and to a limited degree is capable of 'managing' itself. Skynet is here!</p>

<h2>Admin menu</h2>

<p><img src="../sites/community.aegirproject.org/files/aegir_admin_menu/index.png" />At the very top of the screen you'll see the Admin menu, which you may recognise as a popular contrib module installed on many other sites, perhaps even some of your own.</p>

<p>This gives you access to all the normal Drupal administrative functionality, which is not normally required in everyday Aegir user, but it also does provide you access to the 'Hosting' administrative settings where you can enable features that ship with Aegir and make other configuration changes.</p>

<h2>The Eldir theme</h2>

<p>The Aegir project ships with a default theme called 'Eldir' which is the classic navy blue, simplistic functional interface consistent with the overall Aegir brand. Eldir has been specifically designed for Aegir - nonetheless it is a Drupal theme like any other.</p>

<h2>Blocks</h2>

<p>Eldir has a main content section and a right sidebar. In the sidebar, several blocks are enabled by default.</p>

<h3>Queues</h3>

<p>The first is 'Queues'. 
Queues are Aegir's method of creating 'tasks' and putting them into a pool for the backend system to execute.</p>

<p>Two types of Queue exist in Aegir, though only one is enabled by default. These are</p>

<ul>
<li>the 'Task' queue (sending tasks to the backend to be executed by the 'aegir' user from the command line, such as installing, deleting, enabling, migrating sites and platforms)</li>
<li>the 'Cron' queue, which, when the Cron feature is enabled, runs cron on your site in batches.</li>
</ul>

<p><img src="../sites/community.aegirproject.org/files/aegir_queue/index.png" />The task queue that you'll see upon installation shows all the tasks that Aegir has recently run, or is about to run. It shows the last 5, but there is a link to see the full list of historical tasks.</p>

<p>After installation there will be as many as three tasks in the task queue:</p>

<ul>
<li>a Verify task for the main 'server' node, </li>
<li>the Import task of the main Aegir site itself, and </li>
<li>the Verify task of the main Aegir 'platform' that hosts the Aegir site.</li>
</ul>

<p>These tasks are kicked off during the actual Aegir installation.</p>

<p>A task is colored</p>

<ul>
<li>a neutral blue-grey if currently queued but not running yet</li>
<li>white with a spinning wheel if currently in the process of being run</li>
<li>green if completed successfully</li>
<li>red if there was an error  </li>
</ul>

<p>It's worth checking the queues regularly to see that the Task or Cron queues are being run regularly. If not you may have a problem with the cron setup on your server - see the <a href="../node/14/index.html">FAQ</a>.</p>

<h3>Navigation</h3>

<p>Underneath the Summary is the standard Navigation block in Drupal.
<img src="../sites/community.aegirproject.org/files/aegir_navigation_block/index.png" width="260px" /></p>

<h2>Content</h2>

<p>The main content body in the Aegir interface lists</p>

<ul>
<li>your sites when on the frontpage or viewing the 'Sites' tab</li>
<li>your platforms when viewing the 'Platforms' tab</li>
<li>your servers when viewing the 'Servers' tab </li>
</ul>

<p>The main content area also is where nodes are viewable or editable, such as viewing more information on a site, platform or server, or editing/creating new entities of these types.</p>

<h2>Modalframe</h2>

<p>When clicking on a task's 'Run' or 'View' buttons, a modalframe dialog is loaded in the browser. This is to provide a fluid, attractive experience for the user without requiring them to leave the current page or node to perform operations on a site. When the action is performed on the task, the modalframe will close and the user will be returned to the page they were on when they clicked that button.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/aegir_modalframe/index.png" /></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-35.html?destination=node%2F19%23comment-form">Login</a> or <a href="../user/register/index-35.html?destination=node%2F19%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-43" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/43/index.html">Your site and Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_4 first"><a href="../taxonomy/term/4/index.html" rel="tag" title="This level is for users who have access to only their sites and not able to manage all Aegir features, accounts or the server/system.">Client</a></li>
<li class="taxonomy_term_3"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>So, you've provisioned a site using Aegir, and you're poking about looking at the system and what it's done.</p>

<p>A Drupal site managed by Aegir is really mostly the same as any other Drupal site. However, there are a few very minor differences that might surprise or confuse some users.</p>

<p>None of these things adversely affect the running of your site - they are designed to actually make your life even easier.</p>

<h2>Multisite</h2>

<p>Aegir installs sites on a platform, which means it places the site directory in /var/aegir/platforms/(yourplatform)/sites/(yoursite.com). Many sites can all be installed alongside each other inside a platform's 'sites' directory. This is a standard, built-in Drupal feature known as 'multisite', and it is not unique to Aegir.</p>

<h2>Settings.php and cloaked credentials</h2>

<p>Within a multisite structure where multiple sites share the same 'Document Root' or codebase on the system, administrative users on sites that have PHP access, are capable of manipulating the server into exposing the database credentials of other sites in that codebase with reasonable ease. This is a pretty serious disclosure of sensitive information, although it is only possible if users have PHP execution privileges. Any multisite installation of Drupal (even without Aegir) has the potential for this to be a problem.</p>

<p>But security is very important to Aegir, and that's why special precautions are enabled by default to avoid this issue.</p>

<p>Essentially, when Aegir installs a site and creates the settings.php for that site, it 'masks' or 'cloaks' the database credentials, replacing them instead with environment variables fetched from the $_SERVER array in PHP.</p>

<p>The credentials are instead set in the site's Apache 'vhost' configuration file, which is stored outside the 'Document Root' or platform codebase, and is therefore safe from prying eyes by administrative users.</p>

<p>Apache/PHP is able to read the environment variables from the vhost and understand the settings.php's mask, allowing your site to work as normal.</p>

<p>If this feature confuses you or is inconvenient, you have a few options available to you:</p>

<ul>
<li>Run Nginx (which doesn't cloak the credentials)</li>
<li>Set <code>$options[&#039;provision_db_cloaking&#039;] = FALSE;</code> in the site's drushrc.php and then re-Verify the site</li>
<li>Stop worrying and enjoy the extra security Aegir provides you</li>
</ul>

<p>Also note that when you run the Backup task against a site, it actually uncloaks the credentials of the settings.php that it saves in a tarball with the rest of the site. The benefit of this is that you are able to take the backup tarball and deploy it on a non-Aegir server, using standard Drupal, and your settings.php will be in 'normal' Drupal form for that environment. This also makes it easier to 'import' sites from previous-Aegir installations, into new Aegir installations if need be.</p>

<h2>'Files' rewrite rule</h2>

<p>Everyone knows about the inconvenience of having to place an <code>img src</code> in your node that looks like this:</p>

<pre>
<code>&lt;img src=&quot;/sites/www.example.com/files/mycutecat.jpg&quot;&gt;</code>
</pre>

<p>If you ever deploy this site under a new URL or for whatever reason this path changes, those images or links will become broken on the site. That's because this information ends up stored in the database, and it can be a pain to fix up.</p>

<p>When you Migrate or Clone a site with Aegir, some paths in the database are automatically updated where they are consistent enough to be able to be scripted by Aegir (such as those in the files table).</p>

<p>However, Aegir can't fix up actual node body content, as that would be risky, and as a rule, Aegir doesn't like tampering that deeply into your data. Aegir exists to help you manage your data, but not manipulate it except where absolutely necessary.</p>

<p>Fortunately, what Aegir <em>can</em> offer is adding a '/files' redirect in the Apache vhost configurations. This pattern-matching rule allows you to enter this into your node instead:</p>

<pre>
<code>&lt;img src=&quot;/files/mycutecat.jpg&quot;&gt;</code>
</pre>

<p>and you can expect that to actually point to the same place. When you clone this site or rename it to a new URL, this path doesn't actually <em>need</em> to change, because the Rewrite rule will be modified to point to the new location, thus avoiding breakages.</p>

<p>It's not perfect, and people are often frustrated with Aegir not 'just fixing' everything like this, despite the fact the above is more than what Drupal does for you out of the box!</p>

<p>Fortunately, it's expected that Drupal 7 will improve this sort of thing altogether and things will hopefully become easier.</p>

<h2>The .htaccess</h2>

<p>Using a .htaccess with an <code>Allow Override all</code> directive in Apache can be a major performance killer, because it requires Apache to stat each subdirectory of the codebase looking for overrides in .htaccess.</p>

<p>As a result, Aegir disables the reading of the Drupal .htaccess in the runtime environment.</p>

<p>This does not mean that the .htaccess is not needed. Instead, when you run the Verify task against a Platform, the .htaccess is studied by Aegir and its contents are copied into the platform-wide Apache vhost configuration, typically located in <code>/var/aegir/config/server_master/apache/platform.d</code></p>

<p>Need to make a modification to the .htaccess? Simple: you can simply edit it in-place as you normally would, but you must re-Verify the platform in Aegir afterward, in order for those new or modified settings to be 'loaded in' to the platform vhost file.</p>

<p>The end result is improved performance for your sites, without losing any functionality, as you can still customise the .htaccess to your liking.</p>

<h2>Permissions</h2>

<p>Permissions in Aegir generally follow these rules:</p>

<ul>
<li>Everything is owned by aegir:aegir, and the 'other' bit is read-only in most cases</li>
<li>Things that need to be written to (uploads) by the web server, have the 'group' bit of 'www-data' (or whatever the relevant user/group is on your system) with the group bit writable</li>
<li>Anything that is sensitive information, such as the data in the configuration files, are owned by aegir:aegir or aegir:www-data when the web server needs to read those files, with no read access by the 'other' bit.</li>
</ul>

<p>The use of the 'aegir' user on the system is vital for normal Aegir functionality, however it can be confusing to users who wish to edit files (say, theme development on a site, or downloading new modules) as a user other than Aegir.</p>

<p>The methodology recommended in these situations is:</p>

<ul>
<li>Add a standard user to your server, say, 'john'</li>
<li>Add that 'john' user to the 'aegir' group: <code>adduser john aegir</code></li>
<li>By default, Aegir sets the 'modules', 'themes' and 'libraries' directories so they are aegir:aegir with the group bit writable. This means that any user on the system who is a member of the 'aegir' group, is then able to add, delete, or modify files within those directories.  </li>
</ul>

<h2>The drushrc.php</h2>

<p>You may have noticed a file called 'drushrc.php' on your system, stored alongside the settings.php of a site (and another in the root-level directory of your platform or Drupal core codebase). What's this about?</p>

<p>The drushrc.php is a file that contains important metadata about your site or platform. The significant portion of the file contains metadata on all 'packages' (modules, themes, install profiles and libraries) in that part of the system, including their version numbers and whether they are actually enabled or not.</p>

<p>This file is generated by Aegir whenever a platform is verified, and whenever a site is installed or verified.</p>

<p>Paradoxically, settings from the existing drushrc.php are able to be 'read in' by Aegir when performing those tasks and many others.</p>

<p>The drushrc.php generally should not be edited unless you know what you're doing. As previously discussed above, some supported configurations such as the disabling of the 'cloaking' of database credentials in a site's settings.php, are able to be set in the drushrc.php to provoke the system into modifying how that site is to be treated.</p>

<p>@TODO: Drush aliases</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/43/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-22" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/22/index.html">Installing a new website</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>Creating a new website using Aegir is really, really easy, and is probably one of the most exciting aspects of Aegir. The very idea of clicking a button and suddenly being able to visit a new site may even be the prospect that drove you to installing Aegir in the first place.</p>

<p>To create a site you must have created a Platform first, which is the codebase, typically a copy of Drupal core, on which to place your new site. Read the <a href="../node/20/index.html">Platform documentation</a> if you have not yet completed this stage.</p>

<h2>The Site form</h2>

<p>Much like your Platform, a site is represented as a node in the Aegir frontend. To create a new site, you must create a new Site node.</p>

<p>The site node is a form requiring various attributes to be filled out in order to accurately advise the Aegir system about what kind of site you wish to create. These fields commonly are:</p>

<ul>
<li>Domain name - the site name. This becomes the title of the node.</li>
<li>Client - who is the client or owner of this site. This field really only is relevant if you have enabled the Clients feature to manage segregations of sites between clients.</li>
<li>Install Profile - the install profile to use to install this site. This has a dramatic effect on the end result of your site</li>
<li>Platform - the platform to install the site on. The list of available platforms is based on what profile you choose above (in other words, which platforms support that install profile. The choice of platform also implies which web server hosts that platform, so this is why 'web server' is not a selectable option in the form.</li>
<li>Language - what language install the site with. This is dependent on the profile or platform chosen.</li>
<li>Database server - which database server to install the database on.</li>
</ul>

<p>Below is an example of the site form.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/site_form/index.png" /></div>

<h2>Installing the site</h2>

<p>Once you have filled out the site form per your requirements, click Save to submit the form. An 'Install' task is automatically spawned and added to the task queue for the dispatcher to execute.</p>

<p>The backend does the hard work of essentially completing a standard Drupal installation automatically. It creates a database and database user for the site, executes the Drupal installation procedure, populates the database, and generates a web server virtualhost configuration file for the site (Apache or NginX depending on your environment). In the event that the platform is located on a remote web server, the data is synced across from the main Aegir site to the remote server.</p>

<p>Finally, it restarts the HTTP service to load the new site's virtualhost into the HTTP service's runtime environment.</p>

<p>A traditional 'welcome' e-mail containing the one-time login link is sent to the e-mail address of the 'Client' who owns this site. As well as that, the login link is generated and displayed on the new site node view (see below).</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/site_view/index.png" /></div>

<p>As you can see above, the successful installation of the site has provided a series of tasks available to be performed against this site. This task block is similar in appearance to the Task Queue block we previously discussed, but rather than showing a list of tasks either run, queued or processing, it instead displays the list of <em>potential</em> tasks that may be run for this site only.</p>

<p>We will discuss these tasks and more in the following sections.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-36.html?destination=node%2F22%23comment-form">Login</a> or <a href="../user/register/index-36.html?destination=node%2F22%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-60" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/60/index.html">Site Aliases</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h3>Introduction</h3>

<p>Site aliases are helpful if you move content to a new domain, change domain names or simply want to make sure that <a href="http://example.com/" title="http://example.com">http://example.com</a> and <a href="http://www.example.com/" title="http://www.example.com">http://www.example.com</a> take users to the same place.  You can implement site aliases with or without <em>redirection</em>.  The differences between these two methods and how Aegir handles them is described below.</p>

<h3>Enable Alias Support in Aegir</h3>

<ol>
<li><p>You have to enable alias support in Aegir as it is off by default.  Assuming the URL of your Aegir front end is aegir.example.com, browse to aegir.example.com/admin/hosting/features 
<img src="http://groups.drupal.org/files/features-page.png" alt="how to get to the Aegir features page" /></p></li>
<li><p>Check the Site aliasing box
<img src="http://groups.drupal.org/files/site-aliasing-feature.png" alt="how to enable site aliasing on Aegir" /></p></li>
<li><p>Click Save configuration</p></li>
</ol>

<h3>Global Settings for Aliasing</h3>

<p>After you have enabled the site aliasing feature in Aegir you can navigate to aegir.example.com/admin/hosting/aliases (see the menu item that is added under Hosting in the admin menu bar).  Here you can set default site alias settings for all of your Aegir-hosted sites.</p>

<p><img src="http://groups.drupal.org/files/global-aliasing-settings.png" alt="global site aliasing settings" /></p>

<h3>Site-Specific Settings for Aliasing</h3>

<p>You can override the global settings for aliasing by configuring site-specific alias settings either when you create the site or later by editing the site settings.</p>

<p><img src="http://groups.drupal.org/files/site-specific-aliasing-settings.png" alt="site-specific aliasing settings" /></p>

<h3>Redirection Option</h3>

<p>For users, one of the main differences that occurs when redirection is turned on is that the URL that they enter in the browser address bar changes.  This reflects what the server is doing, which is in effect to redirect the request to the same site under the main URL, as opposed to serving the same site from under an alias.</p>

<h4>User navigates to my-old-domain.com with redirection off</h4>

<p><img src="http://groups.drupal.org/files/aliasing-without-redirection.png" alt="aliasing without redirection" /></p>

<h4>User navigates to my-old-domain.com with redirection on</h4>

<p><img src="http://groups.drupal.org/files/aliasing-with-redirection.png" alt="aliasing with redirection" /></p>

<h3>Aegir alias management under the hood</h3>

<p>Aegir primarily manages aliases in the virtual hosts file for each site (e.g. /var/aegir/config/server_master/apache/vhost.d/www.example.com)</p>

<p>When Aliases are in use, the virtual hosts file will have a ServerAlias directive for each site alias:</p>

<p><div class="codeblock"><code>ServerAlias example.com<br />ServerAlias www.my-old-domain.com</code></div></p>

<p>In addition to the above directives, when redirection is off, Aegir creates a symlink in the platform/sites/ folder for each alias that points to the folder associated with the primary domain</p>

<p><div class="codeblock"><code>lrwxrwxrwx 1 aegir aegir&nbsp;&nbsp; 15 Oct 31 23:25 example.com -&gt; <a href="http://www.example.com<br />drwxr-xr-x" title="www.example.com<br />drwxr-xr-x">www.example.com<br />drwxr-xr-x</a> 7 aegir aegir 4096 Oct 31 23:02 <a href="http://www.example.com<br />lrwxrwxrwx" title="www.example.com<br />lrwxrwxrwx">www.example.com<br />lrwxrwxrwx</a> 1 aegir aegir&nbsp;&nbsp; 15 Oct 31 23:25 <a href="http://www.my-old-domain.com/" title="www.my-old-domain.com">www.my-old-domain.com</a> -&gt; www.example.com</code></div></p>

<p>When redirection <strong>is</strong> enabled, Rewrite directives are added to the virtualhost to send http requests to the primary domain that the aliases are associated with:</p>

<p><div class="codeblock"><code>ServerAlias example.com<br />ServerAlias <a href="http://www.my-old-domain.com<br />RewriteEngine" title="www.my-old-domain.com<br />RewriteEngine">www.my-old-domain.com<br />RewriteEngine</a> on<br />RewriteCond %{HTTP_HOST} !^www.example.com$ [NC]<br />RewriteRule ^/<em>(.</em>)$ http://www.example.com/$1 [L,R=301]</code></div></p>

<p>The symlinks are not required in this case.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/60/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-42" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/42/index.html">Resetting site password</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>The 'Reset password' task is a simple one: it allows you to generate a new one-time login URL for a site.</p>

<p><img src="../sites/community.aegirproject.org/files/login_link/index.png" />The one-time login URL is bound to the account of the admin user (uid 1) of a site. It cannot be used to reset the password of another user on the site.</p>

<p>This can be handy in cases where the password for the admin user of a site has been forgotten. The 'Reset password' task is re-runnable and provides a convenient method of re-gaining access to a website from within Aegir.</p>

<p>In normal situations, viewing a site node shows a 'Go to' clickable link that takes the user to the site in question.</p>

<p>When the Reset password task has been run on a site, the 'Go to' link automatically gets changed to become a 'Login to' link that is the one-time login URL.</p>

<p>Once the one-time login URL has been clicked, this link returns to being a 'Go to' link.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/42/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-23" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/23/index.html">Migrating/upgrading and renaming websites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>One of the most powerful features of Aegir is the way it can help you to upgrade large numbers of websites safely.</p>

<p>For example, you may have dozens of sites hosted on a drupal 6.18 codebase. But suddenly the 6.19 release comes out with vital security fixes. Previously you'd have to go to each site, back up the files and database, upload the new codebase, run update.php, check everything worked and then onto the next site.</p>

<p>With Aegir you simply click a button in the frontend and it handles everything. This is called 'migrating' sites in Aegir terminology, because it might be used in more cases than simply upgrading the main codebase. For example you may have different 'platforms' with different mixes of contrib modules and themes and charge clients for tiers of 'basic', 'advanced' and 'gold' packages. When they choose to move from basic to advance, you simply migrate their site.</p>

<p>Other examples of using Migrate include:</p>

<ul>
<li>moving a standard Drupal site to a Pressflow platform for performance enhancements</li>
<li>renaming a site (giving it a new URL entirely)</li>
<li>the Clone feature (discussed in later chapters) is a subsidiary of Migrate, except it doesn't move but copy the site.</li>
</ul>

<h1>How to migrate a site</h1>

<h2>Enabling the feature</h2>

<p>Aegir version 2.x</p>

<ul>
<li>The "Site migration" feature is enable by default. So you don't have to enable it. </li>
</ul>

<p>Aegir version 1.x</p>

<ul>
<li>By default, Migrate is not enabled in Aegir after a fresh installation, as it is an optional feature. This means that the 'Migrate' button is not immediately present in the list of available tasks for a site.</li>
<li>To enable the Migrate feature, simply go to <code>/admin/hosting/features</code> and check the Migrate feature. Submit the form and then return to the site node, and you'll see that the Migrate task is now available.</li>
</ul>

<h2>Migrating a site - the Migrate form</h2>

<p>In the Aegir frontend, click on the website that you want to migrate. As per usual, in the 'Site view' you are presented with some summary information about the site, as well as a list of available tasks. Click the 'Run' button for the 'Migrate' task. A modalframe dialog will appear in your browser.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/migrate/index.png" /></div>

<p>The Migrate form has several options. These are:</p>

<ul>
<li><p>Domain name (this is already the domain of the existing site. If you are intending to simply rename the site (give it a new URL altogether), you can simply change this field and leave the target platform be the 'current platform'. This will make the site accessible under the new URL.</p></li>
<li><p>Platform selection. A radio selection of available platforms on the Aegir system. Certain platforms will be un-selectable. This is because they contain 'Errors' - that is, they contain versions of packages (modules, libraries or themes) that are of an older version than that of the original platform. You cannot upgrade a site to older versions of the same package.</p></li>
</ul>

<h2>Upgrades, warnings, errors?</h2>

<p>What's this about upgrades, warnings and errors on each potential platform to migrate the site to?</p>

<p>Up until now you might be forgiven for thinking that Aegir is simply automating the install of sites and creating Apache vhosts and databases.</p>

<p>The truth is, Aegir actually is a much more advanced tool than that. It keeps a running registry in its database of your Platforms and Sites and what modules, themes, libraries and install profiles are available on platforms and installed on sites.</p>

<p>Not only does it keep track of what these packages are, but it also keeps track of what version of a package is installed (say, Views 6.x-2.11), and whether it is actually an enabled module or not.</p>

<p>The Migrate task, despite its name, is the tool for upgrading your site, because the Migrate code actually invokes the command <code>drush updatedb</code> in the backend, automatically. <code>drush updatedb</code> is the equivalent of running '/update.php' in your browser against your site.</p>

<p>In this way, when the time comes (and it always does) to Migrate your site, Aegir is able to intelligently analyse the available platforms on the system and make a sane judgement on where you can upgrade your site to. The logic is as follows:</p>

<ol>
<li>Current platform has module X, schema version 6002 and 6003</li>
<li>Site module has module X, schema version 6003 installed</li>
<li>Target platform A has module X, schema version 6002. Site cannot be upgraded to an older schema version. An error.</li>
<li>Target platform B does not have module X at all. Theoretically this is still a possible upgrade, but module X will probably be disabled by Drupal's upgrade logic during the process. This is a warning.</li>
<li>Target platform C has module X, schema version 6003. Site is upgradeable, there is no change.</li>
<li>Target platform D has module X, schema version 6004. Site is upgradeable. There is a module update to be performed.</li>
</ol>

<p>In the logic laid out above, examples 4, 5 ,6, or platforms B, C and D would be listed as valid target platforms. Target platform D would actually upgrade the site's module to a newer version, which may involve database updates.</p>

<p>To view the schema differences between current and target platforms in this way, click the 'Compare platforms' link against each target platform in the form.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/compare/index.png" /></div>

<p>If your intention is to upgrade your site between versions of any package (this can include core or contrib!), you need to make sure the relevant packages are present and up to date on the platform you want to migrate to. Aegir can only try and make this judgement call based on the information you feed into the system by adding and verifying platforms with the correct components.</p>

<p>If you've had to download extra packages to the target platform to make them possible candidates for an upgrade, you may need to visit that platform node in the Aegir frontend, and run the Verify task against the site (this is a re-runnable task). This updates Aegir's registry of information about all the packages on the platform.</p>

<h2>Migrating</h2>

<p>Select the relevant target platform and click 'Migrate' to submit the form. The modalframe dialog will close and Aegir will spawn a new Migrate task into the Task queue, and process it on the next cron run.</p>

<p>The process of Migration in the backend occurs automatically, like all Aegir tasks, and is as follows:</p>

<ul>
<li>The site is placed into maintenance or 'site offline mode' as a precaution. Safety first!</li>
<li>A 'backup' task is implied silently. The site and its database are backed up into a tarball. Still safety first!</li>
<li>Depending on the settings sent to the backend (are we migrating the site under its current name, or just renaming the site, or renaming the site and migrating as well), various metadata regarding the site is updated</li>
<li>If we are moving to a new platform (upgrading, not just renaming), the backup tarball that was made earlier, is used in a silent 'provision-deploy' command, which essentially unpacks the tarball into the target platform and creates a new database and database user for the site, importing the database dump that was made in the backup</li>
<li>The deploy task above, invokes <code>drush updatedb</code>, effectively upgrading the site by calling all hook_update() functions. </li>
<li>Various bits and pieces are fixed up, such as paths to files in the 'files' table of the database.</li>
<li>Caches are cleared</li>
<li>A verify task is run, settings.php and apache vhost are updated to reflect the new path (new platform) and new database credentials, site gets brought back out of maintenance mode.</li>
<li>If all went well and nothing has fatally errored here, we remove the old copy of the site from the previous platform (it wasn't touched til now, other than backing it up)</li>
</ul>

<h2>Potential errors?</h2>

<p>If something goes wrong during all this work, the metadata reflecting where the site is located on the system (which platform it is on) and other information is reverted. The task will become 'red' in the task queue, indicating an error.</p>

<p>Aegir will attempt to restore the site's vhost and settings.php to reflect the original platform and database credentials, and bring the site out of maintenance, in an effort to return the site to a state where it was prior to the Migrate.</p>

<p>The user may be requried to manually recover from this error depending on what has occurred. Nonetheless, remember that a backup was made early on, and this can be used to restore the site easily.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/23/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-658" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../migration-tips/index.html">Migration Tips</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>In the context of sites, migration is the task of moving a site from one platform to another.  Migration is the Aegir-preferred method for applying updates to modules and certainly to core.  In other words, to upgrade core or modules, create a new platform with the upgrades, then migrate sites to the new platform.</p>

<p>Ideally, a migration requires nothing more than a mouse-click on the Migrate button on the Site node in your Aegir for the site you want to migrate.  If you've prepared your destination platform properly, a migration will be this simple.  Proper preparation, therefore, is vital.</p>

<p>To prepare a new platform to be a destination for migration, consider at least the following:</p>

<ul>
<li>The directory structure for your modules and themes must be the same on the source and destination platforms.  For example, if the modules on the source platform are in

<div class="codeblock"><code>../platform-abc/sites/all/modules/contrib</code></div>
then the destination platform must have its modules also in this directory.
</li><li>You may need to clear the Drupal cache on the source platform to avoid migration errors.  Upgrades to Aegir in the future may handle this automatically, so be aware of the version of Aegir you're running and whether it includes upgrades to address this issue.
</li></ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-37.html?destination=node%2F658%23comment-form">Login</a> or <a href="../user/register/index-37.html?destination=node%2F658%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1766" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/renaming-aegir-hostmaster-site-itself/index.html">Renaming the Aegir hostmaster site itself</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>From <a href="../node/363/index.html" title="http://community.aegirproject.org/node/363">http://community.aegirproject.org/node/363</a> :</p>

<p>WARNING: Be sure to have a good backup (which you can restore) before attempting this.</p>

<ol>
<li>manually edit the crontab for aegir to stop the periodic execution of the command 'hosting-dispatch' (the drush command 'hostmaster-pause' did not exist on my system)
</li><li>delete the hostmaster site (drush @hostmaster provision-delete)
</li><li>change the alias (drush provision-save @hostmaster --uri=hostmaster2.example.com --aliases=hostmaster.example.com)
</li><li>deploy the backup (drush @hostmaster provision-deploy /var/aegir/backup/hostmaster.example.com...tgz)
</li><li>checked that all changes appeared correct - YES
</li><li>Reneabled the hosting-dispatch task by editing the crontab again
</li><li>ran a verify task against the new hostmaster site. Noticed that the site is listed on the site page with the old domain name. The verify failed.
</li><li>Found that the verify task had created a new entry in the hostmaster-6.x-1.7/sites directory for the old domain name. I removed this created directory. I found and edited (using phpMyAdmin) the relevant entries in the node and node revision tables for the hostmaster site to update the domain name (change the title field). The hosting_site_alias table may also need to be updated if you have site aliases.
</li><li>The verify task also seemed to have regressed the @hostmaster alias file (~/.drush/hostmaster.alias.drushrc.php) as it had the URI and aliases details from the old site back in it. I edited this file to return these items to their new values.
</li><li>The verify task now completed successfully and all seems to be working correctly.
</li></ol>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/1766/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-24" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/24/index.html">Cloning sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir provides an easy method of making entire copies of a site. This includes the actual site files, modules and so on, as well as a copy of the actual database.</p>

<p>This feature is called 'Clone' in Aegir, because it is a method of duplicating a site with a new URL or 'site name'.</p>

<p>The feature is very closely linked to the <a href="../node/23/index.html">Migrate</a> feature because it is almost the same, except that rather than move the site, it leaves the existing site in place and just copies it to a new name.</p>

<p>For this reason, enabling the Clone feature also enables the Migrate feature.</p>

<h2>Enabling Clone</h2>

<p>The Clone feature is disabled by default on a fresh Aegir installation. To enable it, visit <code>/admin/hosting/features</code> in your Aegir frontend, check the 'Clone' box and submit the form.</p>

<p>Now when you visit a site node in your frontend, you'll see there's a 'Clone' button in your list of available tasks for the site.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/clone/index.png" /></div>

<h2>Cloning a site</h2>

<p>To clone a site, simply click the Clone button. A modalframe dialog will appear with a form. If you are familiar with the Migrate feature, you'll likely notice the similarities between the two forms.</p>

<p>The clone form has these options:</p>

<ul>
<li><strong>Domain name</strong> - this is the URL for the new site, which must be unique.</li>
<li><strong>Platform</strong> - this is the target platform to clone the site to. It may be the current platform or a different platform that meets the requirements for hosting this site (has all the correct or newer versions of relevant modules)</li>
<li><strong>Database server</strong> - this option is only available if you have a remote database server configured, otherwise it is implied.</li>
<li><strong>Site aliases</strong> - If you have the <a href="../node/60/index.html">Site Aliases</a> feature enabled, you are also able to set new Site Aliases for this clone at this point. If the original site also had aliases, you will have to change or remove the aliases that load in this form before you can submit it.</li>
</ul>

<div align="center"><img src="../sites/community.aegirproject.org/files/clone_form/index.png" /></div>

<p>As with the Migrate form, you can view the package comparison table between the current platform of the original site and that of a target platform, by clicking the 'Compare platforms' link. You can only clone a site to another platform if it meets the requirements for successfully hosting that site. In other words, the target platform has to contain the same or newer versions of modules. If the packages are missing on the target platform, those missing modules may be disabled.</p>

<p>Once you have made your selection and submitted the form, a 'Clone' task is spawned and added to the Task queue ready for dispatching.</p>

<h2>What Clone does</h2>

<p>The Clone task makes the following actions in the system:</p>

<ul>
<li>Makes a backup of the original site. This tarball will be used to 'deploy' a copy of the site</li>
<li>Generates a new Drush alias for the new site</li>
<li>Deploys the backup tarball to the new location as a new site</li>
<li>The new site is imported and verified into the Aegir system, and relevant configurations are saved (HTTP vhost file, etc)</li>
</ul>

<div align="center"><img src="../sites/community.aegirproject.org/files/clone_import/index.png" /></div>

<h2>When might I want to use Clone?</h2>

<p>Clone can be a very useful tool in a variety of situations. Commonly, people use Clone for:</p>

<ul>
<li>Testing what a 'Migrate' might do to a site, without migrating it. In other words, Clone can be used as a simulation tool to anticipate results of upgrading a site to a new release or build safely.</li>
<li>If you have a 'template' site, often with a custom install profile, and anticipate having to generate multiple sites that are very similar, you can use Clone to rapidly do this.</li>
<li>Cloning a live site to a 'development' version of a site, especially to a development platform residing on a remote 'development' web server, can be a useful and fast method of working on a site by ensuring the dev environment has the latest database and files from production.</li>
</ul>

<h2>Is there any relationship between the original and cloned site?</h2>

<p>Currently there is no real relationship between the original site and any of its clones.</p>

<p>In future, Aegir development is likely to develop natural relationships between these sites, which will allow for 'rules' to be established, for example</p>

<ul>
<li>being able to regularly 're-clone' a site 'over the top' of previously-made clone, or</li>
<li>automatically schedule clones after the original site has been migrated (upgraded) to keep a clone 'up to date' with the original.</li>
</ul>

<p>Other uses may develop in time.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/24/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-25" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/25/index.html">Disabling and Enabling sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir provides a method for sites to be temporarily 'disabled'. This means preventing all access to a site, but in a way that it can be re-enabled later.</p>

<p>Think of disabling a site in a similar fashion to placing a site under Maintenance mode, but that instead of a 'Site offline' message, a request to the site is redirected to a special page under the main Aegir frontend's URL, and a 'Site disabled' message is shown instead.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/disable/index.png" /></div>

<p>Aegir makes no presumptions about why you may wish to disable a site. Use this feature at your own discretion.</p>

<h2>How to Disable a site</h2>

<p>To disable a site, simply click on the site node in the Aegir frontend. In the list of available tasks for this site, click the 'Disable' button. A modalframe dialog will load, prompting you to confirm if you really wish to disable the site. Confirm and submit the form to spawn a 'Disable' task to the queue to take this site offline.</p>

<h2>How to Enable a site</h2>

<p>Once your site has been disabled, the list of available tasks has now radically changed in the site node: you now have only the option to Delete the site or Enable it again.</p>

<p>To re-enable a disabled site, simply click Enable. The site will be brought back out of hibernation and become live again.</p>

<h2>Disabling before deleting</h2>

<p>In Aegir's default configuration, you must first disable a site before you may delete it. This is meant as a precaution - if considering deleting a site, it forces you to think about whether you really want to, before accidentally clicking Delete and irreversibly removing your site.</p>

<p>But don't worry - Aegir always silently makes a backup of the site before disabling (or deleting) a site.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-38.html?destination=node%2F25%23comment-form">Login</a> or <a href="../user/register/index-38.html?destination=node%2F25%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-45" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/45/index.html">Backup and Restore</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>The Aegir system provides a convenient method of backing up sites, and restoring sites from those backups.</p>

<p>Like most other Aegir functionality, the Backup feature comes in the form of a task, aptly named 'Backup'. It is one of the core features of Aegir and thus is always available for a site, out of the box.</p>

<p>Backing up a site in Aegir is twofold: the site folder (containing the settings.php, files dir and so on) is added to a tarball along with a database dump of the site and stored in <code>/var/aegir/backups</code> on the master Aegir server.</p>

<p>In the event that the website or database is a remote server, those relevant components are synced down to the master Aegir server to be tarballed up. Only the master Aegir server stores backups of a site. (This is known as a 'spoke' model, as opposed to a 'mesh' or distributed model, and suits the Aegir system at this time).</p>

<p>The tarball generated for a site can be used for a number of things: restoring a site from that backup via the 'Restore' task, or from the command line using the <code>provision-deploy</code> command for advanced users as a method of quickly importing a site onto a system.</p>

<p>Other cases whereby a backup task is generated and its tarball used are when a site is being Migrated (upgraded) or being Cloned as a new site, but that is outside the scope of this chapter.</p>

<h2>Backing up</h2>

<p>When viewing the site node of a site in the Aegir frontend, click the 'Backup' button in the list of available tasks for this site.</p>

<p>A modalframe dialog appears, prompting for confirmation, as well as providing an editable Description field which you may fill out. This field is optional, designed only to aid you in future if you seek a reason for why a backup was made.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/backup/index.png" /></div>

<p>Once the form is submitted, a Backup task is spawned and added to the Task queue for dispatching by the backend.</p>

<p>The full output of a Backup task is viewable in the task log. Extra security precautions are built into Aegir so that the 'mysqldump' command uses file descriptors to hide exposing the database user's password in the running process and output of the task.</p>

<h2>Restoring from a backup</h2>

<p>Restoring a site from a backup is simple and follows the same pattern as backing up. Simply click the 'Restore' button from the list of available tasks for a site. A modalframe dialog will load, and the form offers a list of radio items. These are the backups that have been made for a site, in the format of 'Date/time - Reason'.</p>

<p>Where no custom reason was given for a backup, the message 'Generated on request' is shown instead.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/restore/index.png" /></div>

<p>Choose a backup to restore from and submit the form. A 'Restore' task will be spawned and added to the Task queue for dispatching by the backend.</p>

<h2>What happens during a Restore task</h2>

<p>The restore process</p>

<ul>
<li>puts the site under 'maintenance mode' temporarily (safety first!)</li>
<li>generates a new backup of the site before restoring to it (still safety first!). This new backup will be available in the list of backups if you ever re-run the Restore task, and will carry the description 'Generated before being restored to a previous version'.</li>
<li>uses the implied <code>provision-deploy</code> command in the backend to unpack the tarball, </li>
<li>create a new database and import the database dump into it, </li>
<li>create a new database user, </li>
<li>spawn a verify task silently, which will

<ul>
<li>re-write the settings.php,</li>
<li>sync the data if necessary to a remote platform, </li>
<li>re-generate the web server's vhost configuration file for this site,</li>
<li>finally reload the web server</li>
</ul></li>
</ul>

<h2>Automatic backups and purge</h2>

<p>There are contributed modules that can handle automatic creation and deletion (clean-up / purging) of backups:</p>

<ul>
<li><p>For Aegir 2.x</p>

<ul>
<li><a href="https://www.drupal.org/project/hosting_site_backup_manager">Hosting Site Backup Manager</a></li>
</ul></li>
<li><p>For Aegir 1.x</p>

<ul>
<li><a href="http://drupal.org/project/hosting_backup_queue">Hosting backup queue</a></li>
<li><a href="http://drupal.org/project/hosting_backup_gc">Hosting backup garbage collection</a>.</li>
</ul></li>
</ul>

<p>Eventually these contributed modules will be incorporated into Aegir core.</p>

<p>It is also easy to set up a cronjob to automatically run backup tasks (that can still be used to restore from) for all your sites. To do this, download and set up mig5's <a href="http://www.migueljacq.com/content/aegir-bulk-backup-script-updated">bulk backup script</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-39.html?destination=node%2F45%23comment-form">Login</a> or <a href="../user/register/index-39.html?destination=node%2F45%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-26" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/26/index.html">Deleting sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>There may come a time when you want to remove a website from your Aegir system and your server altogether. As you'd expect, Aegir handles this for you too. It ships with a 'Delete' task that is capable of removing the site from the Aegir system, as well as carrying out backend tasks to remove the site from the filesystem and web/db servers.</p>

<p>The Aegir frontend is a Drupal site in itself, and sites are represented in that system as nodes. New users that are familiar with Drupal often make the mistake of thinking that the process of deleting a site is like deleting a node in Drupal, and attempt to delete the site node (or are confused by the fact we hide the Delete button for this reason).</p>

<p>This is an incorrect method of deleting a site, and doesn't actually spawn a task to clear away the site from the server at all. Below are the steps to correctly remove a site.</p>

<h2>Method 1 (default) - Disable the site first</h2>

<p>Part of this confusion can stem from the fact that when viewing a site node in Aegir, the Delete button is not actually present in the list of available tasks by default:</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/delete_disablefirst/index.png" /></div>

<p>This is because, in the default Aegir configuration, you must run the Disable task against a site before you may Delete it. This logic is in Aegir to help users avoid accidentally deleting a site either by accidentally processing the task (despite having to confirm it first) or to prompt the user to think a little bit more on the decision before irreversibly blowing away the data.</p>

<p>The decision stems from Aegir development policy of being uncomfortable making such risky actions on your data. While it is possible to delete a site, we'd like you to really be sure that's what you want to do.</p>

<p>Once you Disable a site (<a href="../node/25/index.html">see the Disable section prior to this chapter</a>), the list of available tasks is modified to only offer an Enable or Delete button. At this point you can run the Delete task and permanently remove your site.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/delete/index.png" /></div>

<h2>Method 2 (optional) - Delete without Disabling</h2>

<p>The first method above is the default Aegir configuration. However, some users might be too confused by the lack of the Delete button altogether, which may not be ideal for your situation.</p>

<p>For this reason, Aegir also provides a configurable setting allowing a site to be Deleted without requiring a Disable first. This option makes the 'Delete' button appear in the list of available tasks, even when a site is currently in an Enabled state.</p>

<p>To activate this setting, visit <code>/admin/hosting/settings</code> on your site and uncheck the checkbox that is titled "Require site to be disabled before deletion".</p>

<p>Re-visit the site node and you'll see that the Delete button is now present and clickable, alongside the Disable button.</p>

<div align="center"><img src="../sites/community.aegirproject.org/files/delete_nodisable/index.png" /></div>

<h2>The deletion process</h2>

<p>When you click Delete and confirm your intentions in the modaldialog that loads, a 'Delete' task is spawned and added to the Task queue to await dispatch by the backend system.</p>

<p>The process runs through a series of steps to remove this site from your server. These are as follows:</p>

<ul>
<li>Make a backup of the site and its database for the last time (safety first, remember!</li>
<li>Drops the site database</li>
<li>Revokes the GRANT to that database for the database user (effectively deleting the database user)</li>
<li>Deletes the site folder and everything inside it, from the platform that the site was hosted on</li>
<li>Removes the Drush alias file for the site</li>
<li>Removes the site's web server vhost configuration file</li>
<li>Reloads the web server</li>
<li>Sets the site's status to 'Deleted' in the Aegir system. Note: it does not delete the site node from the Aegir system. This is by design: the site node is retained in the Aegir database for historical purposes (you could customise Aegir by adding the ability to run a report or a View of all deleted historical sites, for example)</li>
<li>The deleted status of the site, removes it from the list of sites in the 'Sites' page (and thus front page) of the Aegir system.</li>
<li>Historical tasks run on the site remain in the Task queue history.</li>
</ul>

<h2>Manually deleting the site</h2>

<p>Sometimes something goes wrong during an Install or a Delete task and a site doesn't install or get deleted successfully. The Delete task cannot be run or re-run on this site because Aegir has no way of knowing just how much of it got deleted (whether the files are still there but not the database, for example). Re-running the Delete task is likely to fail because some of these steps listed above will not exit successfully on completion.</p>

<p>At the time of writing, no task in Aegir exists to 'force' a removal of a site without having to bootstrap it first, so some manual steps are required on your part to remove this site.</p>

<ul>
<li>Manually remove the site files on the server if they exist (i.e /var/aegir/platforms/drupal-6.16/sites/my-failed-site.com</li>
<li>Drop the database and revoke db user privileges associated with this site if it got created before failing (check the vhost  configuration file's 'SetEnv' parameters, or the settings.php if the credentials are uncloaked, for the site's database name and user)</li>
<li>Manually remove the Apache vhost file for this site if it is still present (in /var/aegir/config/server_master/apache/vhost.d/)</li>
<li>Manually remove the Drush alias for this site if it is still present (in /var/aegir/.drush/)</li>
<li>Enter the Aegir database from mysql and set the status of the node in the <code>hosting_site</code> table to -2 (deleted). For example, if your site node was nid 83 (the 'Edit' tab of the site node will tell you this), run <code>UPDATE hosting_site SET status = &#039;-2&#039; WHERE nid = 83;</code></li>
<li>Still in the Aegir database, delete the node record in the <code>hosting_context</code> table. For example, if your site node was nid 83 (as above), run <code>DELETE FROM hosting_context WHERE nid = 83;</code></li>
<li>Alternatively, if you want to even remove the node altogether from the system (not recommended), go to /node/83/delete in your browser on the Aegir frontend and delete the node. This will remove the site node and all associated task nodes from the system, as well as remove the entry from the hosting_site table in the database.</li>
<li>If you are using the SSL feature and had Encryption enabled for this site, you may also need to manually delete the SSL certificate folder located in <code>/var/aegir/config/ssl.d/[domain of site you are deleting]</code> and/or <code>/var/aegir/config/server_master/ssl.d/[domain of site you are deleting]</code>. Additionally you may also need to delete the entry for the domain you are deleting in the <code>hosting_ssl_cert</code> table of the Aegir database.</li>
<li>If you are using the DNS feature you may also need to remove the site's entry in the zone file by running the following command: <code>drush @server_master provision-zone rr-delete example.com sub.domain A</code></li>
<li>If your site has ssl support enabled you also need to remove ssl certificate from database issuing DELETE FROM hosting_ssl_cert WHERE ssl_key = 'your.site.domain';</li>
<li>Re-verify the Platform node where the Platform is the one where your site was hosted on. This will regenerate some metadata whereby the Platform believed it still had that site contained within it.</li>
</ul>

<p>If you need to manually remove the site's platform see the instructions here: <a href="../node/27/index.html" title="http://community.aegirproject.org/node/27">http://community.aegirproject.org/node/27</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/26/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-843" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../open-id-tips-and-tricks/index.html">Open ID tips and tricks</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <h2>Allowing multiple people to access User 1</h2>

<p>This approach depends on the <a href="http://drupal.org/project/openidadmin">OpenID Admin module</a>. Here are the drush commands to download and install it, and set an openid access:</p>

<pre><code>drush dl openidadmin
drush en -y openidadmin
drush openid-add 1 <a href="https://your.openid.server/your-open-id" title="https://your.openid.server/your-open-id">https://your.openid.server/your-open-id</a>
</code></pre>

<p>This can allow you to simplify development workflow and easily control who has access to User 1, without giving away that account's username and password.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-40.html?destination=node%2F843%23comment-form">Login</a> or <a href="../user/register/index-40.html?destination=node%2F843%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1381" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../content/best-recipes-disaster-and-how-avoid-them/index.html">The best recipes for disaster and how to avoid them</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_4 first"><a href="../taxonomy/term/4/index.html" rel="tag" title="This level is for users who have access to only their sites and not able to manage all Aegir features, accounts or the server/system.">Client</a></li>
<li class="taxonomy_term_27"><a href="../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_3"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This is a short list of all those bad things you should avoid while still learning how to use Aegir system properly, compiled from many real-world issues, so you could enjoy reading about creative ways to destroy your sites or Aegir system instead of experience it.</p>

<p><strong>How to get all kinds of failed migrate or clone tasks?</strong></p>

<p>Very easy. Simply use sites/domain-name/modules space for your code. This will guarantee many half-broken migrations with duplicates of the same site existing in two platforms, with fatal errors because some required include file in some module no longer exists, or not yet exists, as all paths to sites/domain-name/modules change on the fly when either domain-name or platform used changes, so some entries in your site's system table will cause either failed and reverted tasks in Aegir or some nice WSOD, until you will repair registry with <a href="http://drupal.org/project/registry_rebuild" title="http://drupal.org/project/registry_rebuild">http://drupal.org/project/registry_rebuild</a>.</p>

<p>No, really, don't use sites/domain-name/modules for anything and save yourself headaches and frustration.</p>

<p>To help you understand this better, <a href="../node/243/index.html#comment-152" target="_blank">let's quote mig5</a> - Aegir core developer: "Aegir doesn't track site-specific modules/themes in /sites /$yoursite /(modules|themes) because it's not possible to ever upgrade those modules (they are tarballed up and moved with the site on a Migration). For this reason it's unwise to store site specific modules in this directory as you'll never be able to upgrade them if you do your upgrades properly (via Migrations, to new target platforms). To have site-specific modules not in that directory, you should learn install profiles, and store the modules/themes in /profiles /$yourprofile /(modules|themes) for a site using that install profile. (...) I don't see us ever handling the upgrades of modules in /sites/$site, since that entire dir gets tarballed up and moved across. In fact we made a deliberate design decision to literally ignore those modules in the Aegir package system." We highly recommend to <a href="../node/243/index.html" target="_blank">read all comments there</a>. There is also <a href="../node/23/index.html" target="_blank">an excellent handbook entry</a> you should read to understand this better.</p>

<p><strong>How to break the site so even the Restore task will not help?</strong></p>

<p>To make that happen you need to forget about correct upgrade workflow and good habits, use Backup task in Aegir to create a pseudo-safe copy of your site, upload new contrib modules to your new platform and then use Migrate task to move/upgrade your site to the new platform. To make it even worse, you could then try to use Restore task if anything went wrong with the migration and this will either fail completely or it will revert your database, but it will leave the site in the new platform – because Restore task will never move the site back to the old platform, so all your previous backups are immediately useless, and you are locked in the new platform without any chance to rollback automatically.</p>

<p>OK, so what is the correct workflow for sites upgrades in Aegir? It highly depends on how you manage your code, but some general rules are always valid and we will list them below:</p>

<ol>
<li>Create or choose new platform.</li>
<li>Upload all your contrib modules and themes to the new target platform.</li>
<li>Re-verify the target platform in Aegir.</li>
<li>Clone your live site with some working subdomain in the old platform.</li>
<li>Re-verify old platform and also just cloned site.</li>
<li>Migrate cloned site to the new platform.</li>
<li>Check if the cloned site works without any issues.</li>
<li>If the step 7 above works, you can safely migrate also the live site.</li>
</ol>

<p>Note: if this is a Drupal core version upgrade, it is always better to split the upgrade in two parts: first migrate to the new core, but using the same contrib modules versions, and then migrate to the final target platform with newer contrib modules. This may help if you experience failed upgrades with mysterious errors like "Call to undefined function node_types_rebuild()" without any hint on which module causes the issue.</p>

<p><strong>How to break the site and lock it in the broken state in a one step?</strong></p>

<p>This sounds frightfully, but it is really easy to do. All you need is to skip the steps with creating and testing the site’s clone in the existing platform first and simply use the Clone task to clone the site directly to the new platform. While this appears to be a handy shortcut, it is in fact one of the best recipes for disaster. Why? Because Aegir will not be able to properly check for all possible issues related to the contrib code and db updates to alert you before running the Clone+Migrate task. Yes, this kind of Clone task is in fact Clone and Migrate in a one step. It is very handy, but only when you already tested it with both old and new platform before. To stay safe, just avoid cloning the site to the different platform directly. Instead, clone it first in the existing platform, then migrate to the new platform, and finally re-verify it.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/1381/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-20" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/20/index.html">Setting up a Platform</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h2>What is a platform anyway?</h2>

<p>Platforms are a type of node in Aegir and often the source of confusion for new users. This is because the term or concept isn't really used explicitly outside of Aegir - Aegir is a system that suddenly makes Platforms 'make sense' to have.</p>

<p>The simplest definition of a Platform is a copy of Drupal core. That's really it. When you download a copy of Drupal from drupal.org, the result is what Aegir thinks of as a 'Platform'. No sites exist on it yet.</p>

<p>Before you can create a site using Aegir, you must first define the Platform. This tells Aegir where to store the site directory, settings.php etc on the system.</p>

<p>In short: first you create a Platform, and a site 'lives' on that platform, in exactly this fashion:</p>

<ul>
<li>drupal-6.19 (Platform)

<ul>
<li>/sites/yoursite.com/settings.php (site)</li>
</ul></li>
</ul>

<p>This abstraction is somewhat unique to Aegir in that it opens up a world of new opportunities for you. By managing Platforms or copies of Drupal core, and understanding what sites are on what copy of core, Aegir is capable of moving sites between platforms (which is effectively upgrading a site) - read more about this in <a href="../node/23/index.html">Migrating/upgrading and renaming sites</a>.</p>

<h2>What else could be considered a platform?</h2>

<p>Anything that is more or less a copy of Drupal core is something Aegir considers a 'platform'. This thus includes any Drupal distribution, such as <a href="http://openatrium.com/">OpenAtrium</a>, <a href="http://pressflow.org/">Pressflow</a>, <a href="http://acquia.com/products-services/acquia-drupal">Acquia Drupal</a>, <a href="http://openpublishapp.com/">OpenPublish</a>, <a href="http://managingnews.com/">ManagingNews</a>, and so on.</p>

<p>The key difference between such distributions and a standard 'vanilla' copy of Drupal core is that these distributions tend to have
  * a custom install profile in the /profiles/ directory
  * a set of contrib or custom developed modules, libraries or themes shipped with the core or profile</p>

<p>If you build a copy of Drupal core and place your custom install profile in /profiles, this could be considered a Platform.</p>

<p>If you place your custom install profile in an existing Platform and re-Verify the Platform, that profile will now be recognised as an option when creating a site on that Platform.</p>

<p>Various 'versions' of Drupal, such as Drupal 5.x, Drupal 6.x or Drupal 7.x, are all considered separate Platforms in Aegir.</p>

<p>Drupal 4.x is not supported in Aegir.</p>

<p>Is this paradigm clear? 'Sites' are managed inside 'Platforms'. 'Platforms' are managed inside 'Servers'. 'Servers' are managed by Aegir. In this sense, Aegir manages all the rest too.</p>

<h2>Getting a Platform onto your server</h2>

<p>A number of techniques exist to put a platform on a server.</p>

<p><strong>Drush</strong></p>

<p>For a standard Drupal platform, the easiest is to simply use drush:</p>

<p><div class="codeblock"><code>php /var/aegir/drush/drush.php dl drupal-6.19</code></div></p>

<p><strong>Wget</strong></p>

<p>You can simply use the 'wget' command, for example:</p>

<p><div class="codeblock"><code>wget <a href="http://launchpad.net/prosepoint/trunk/0.23/+download/prosepoint-0.23.tar.gz<br />tar" title="http://launchpad.net/prosepoint/trunk/0.23/+download/prosepoint-0.23.tar.gz<br />tar">http://launchpad.net/prosepoint/trunk/0.23/+download/prosepoint-0.23.tar...</a> -zxvf prosepoint-0.23.tar.gz</code></div></p>

<p><strong>Version control</strong></p>

<p>You could use CVS, eg:</p>

<p><div class="codeblock"><code>export CVSROOT=:pserver:anonymous:anonymous@cvs.drupal.org:/cvs/drupal <br />cvs login <br />cvs co -d aegir/drupal-6.15 -r DRUPAL-6-19 drupal </code></div></p>

<p><strong>Manually</strong></p>

<p>You could download it on your PC and scp or FTP the files up onto your server.</p>

<p><strong>Drush Make</strong></p>

<p><a href="http://drupal.org/project/drush_make">Drush Make</a> comes installed on your Aegir system by default. You can use Drush Make to 'build' a platform, which does the job of fetching core and any other contributed or custom packages that you specify in a makefile.</p>

<p>You can even specify the URL or path to a makefile in the form you are given when adding a Platform node in the Aegir frontend, and Aegir will execute the Drush Make command in the backend and build it for you!</p>

<p>Explaining how to use Drush Make is outside the scope of this document. Consult the <a href="http://drupalcode.org/project/drush_make.git/blob_plain/refs/heads/6.x-2.x:/README.txt">README.txt</a> of Drush Make to learn the makefile syntax, or use a ready-made makefile available from the web. Some distributions such as OpenAtrium <a href="https://community.openatrium.com/documentation-en/node/1420">provide an example makefile</a> for you to build the distribution with.</p>

<h2>Platforms and remote web servers</h2>

<p>Aegir has a 'spoke' model when it comes to remote servers, whereby the <em>'master' Aegir server keeps a copy of all platforms and sites</em> and syncs changes outbound to remote servers that are running those platforms or sites, on tasks such as Verify etc.</p>

<p>Because of this, all platform names and paths must be unique, even across remote servers. This means you cannot have 'Drupal 7.0' in /var/aegir/platforms/drupal-7.0 on both Server A and Server B, because it can only exist once in that location on the master Aegir server. Platforms can't share the same name 'Drupal 7.0' because Aegir uses the platform name to define a 'context' by which it can refer to that server, and there can be no conflicts.</p>

<p>The exception to the unique path rule is when using web clustering (a collection of web servers running a platform), but even then, the platform is attached to the 'cluster' server and so is still 'unique' in this sense, that path cannot be reused for another platform running on another server somewhere else.</p>

<p>So when adding platforms to your filesystem and to Aegir, make sure that the platform is unique in name and path, so that other servers cannot try and use this reserved name/path for other platforms.</p>

<p><strong>More on the platform name space</strong></p>

<p>Migrating a site to a remote server illustrates this name space issue further: as an example; given that an Aegir hostmaster has two directories representing two platforms (and remembering that aegir does not migrate platforms, only sites):</p>

<pre><code>/var/aegir/platforms/plat-local  
/var/aegir/platforms/plat-remote  
</code></pre>

<p>and the remote server also  has:</p>

<pre><code>/var/aegir/platforms/plat-remote
</code></pre>

<p>then having aegir hostmaster migrate a site from platform <em>plat-local</em> to <em>plat-remote</em> will result in the site files being:<br />
1. moved from .../plat-local to hostmaster's local <code>.../plat-remote</code> and<br />
2. rsync'd to <code>.../plat-remote</code> on the remote server.</p>

<p>It is important to understand this if you are importing a working Drupal site into Aegir's control and Aegir hostmaster is on a different server from the working Drupal site.</p>

<h2>Do I have to have multiple platforms on my Aegir?</h2>

<p>No, you can simply have one platform or copy of Drupal core and provision all your sites to sit on the one platform. However, eventually you will want to upgrade your sites to a new copy of Drupal core, and rather than replace your core files in-place, it's recommended to build a new Platform with the newer copy of core, and use the <a href="../node/23/index.html">Migrate task to move your sites (upgrade) onto the new code.</a></p>

<h2>Adding the Platform node</h2>

<p>Now that you've got your Platform on your server, or you know where and how you're going to do it (say, with Drush Make), it's time to tell Aegir about your new Platform.</p>

<p>To do so, add a new node of type 'Platform' in your Aegir frontend. Typically this is most easily done by visiting Create Content &gt; Platform in the Admin Menu.</p>

<p>The Platform node form has several fields required for giving Aegir information about your platform. These are:</p>

<ul>
<li>Name (a descriptive name for your platform. You very likely want this to be something like "Drupal 6.19".)</li>
<li>Publish Path (the path on the filesystem where the platform is, or will be when Drush Make builds it. This must be the absolute path, for instance '/var/aegir/drupal-6.19')</li>
<li>Makefile (the path on the filesystem to a makefile that will be used to create the platform.)</li>
</ul>

<p>Once you have completed entering this information, you can click the Save button. A 'Verify' task will be spawned and added to the Task queue (visible in the right sidebar). The backend will then parse this new platform and build up a registry of information about it, such as what version of Drupal it is, as well as what versions of install profiles, modules and themes are present on that platform.</p>

<p>Certain system configurations, such as Apache configurations similar to the .htaccess file that comes with Drupal, will be written to the filesystem, permissions checked and adjusted where necessary, and services restarted.</p>

<p>Now that you have a platform or codebase that Aegir is aware of, you can now proceed to install or import sites onto that platform!</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/20/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-44" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/44/index.html">Verifying servers, platforms and sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>One of the common tasks available to all three of the major entities in Aegir (Servers, Platforms and Sites) is the Verify task.</p>

<p>You can think of the Verify task as a sort of routine 'sanity check' of that specific entity, with a sort of checklist of expected behaviour with which it runs through to confirm that the entity is operating as normal.</p>

<p>The Verify task also can be used to regularly 'sync' your platform or site with the Aegir package registry, to keep it up to date on whether any modules have changed (been removed or enabled/disabled). This will aid running Migration and Clone tasks, since Aegir needs to have a precise knowledge of what modules, themes or profiles are on the system before it can accurately judge whether an upgrade is possible.</p>

<p>It is recommended to run the Verify task on your entities routinely to keep them in sync with the Aegir database, and to run a Verify of your site, current platform and target platform prior to attempting a Migration or Clone task.</p>

<h2>What happens in a Verify task?</h2>

<ol>
<li><p>Servers</p>

<ul>
<li>When you add a new server node in the Aegir frontend, a Verify task is spawned for the first time.</li>
<li>the configuration directories are created if they don't exist and set to the correct permissions, or set to the correct permissions if they already existed but were incorrectly set</li>
<li>if the server is the master server, some additional configuration and backup directories are created</li>
<li>generates or updates a Drush alias file for the server.</li>
<li>some configuration directories are synced from the master server to remote servers</li>
<li>Checks that new databases and database users can be created</li>
<li>Checks that the HTTP web server can be restarted</li>
</ul></li>
<li><p>Platforms</p>

<ul>
<li>When you add a new platform node in the Aegir frontend, a Verify task is spawned for the first time. </li>
<li>If the platform directory didn't exist on the file system and a Drush makefile was provided, Drush Make will be called to build the platform in that location</li>
<li>If the platform directory didn't exist and no Drush makefile was provided, the task will fail with the error 'Does not contain a valid Drupal installation'.</li>
<li>Checks that the permissions are correct, at least of the 'sites' folder of the platform directory (so we can create new sites here)</li>
<li>Searches for existing sites on the platform that are not yet in the system. These sites will be 'imported' into Aegir.</li>
<li>Scans the platform and builds or updates the package registry in the Aegir database. </li>
<li>Generates or updates a Drush alias for the platform, and a drushrc.php file in the platform's directory root.</li>
<li>Reads in the platform's .htaccess file into a platform-wide web server vhost configuration file.</li>
<li>Restart the web server</li>
</ul></li>
<li><p>Sites</p>

<ul>
<li>When you add a new site in the Aegir system, an Install task is spawned, This is contrasted with the above entities which spawn only Verify tasks initially.</li>
<li>Scans the site and builds or updates the package registry in the Aegir database.</li>
<li>Creates important directories in the site folder, such as 'files'. Sets or corrects the appropriate permissions </li>
<li>Manages/updates any site aliases (symlinks, redirects etc)</li>
<li>Re-generates the settings.php </li>
<li>Re-generates the site's web server vhost configuration file</li>
<li>Re-generates the site's drushrc.php and a Drush alias</li>
<li>Clears caches.</li>
</ul></li>
</ol>

<p>You can run or re-run the Verify task at any time on a server, platform or site, and it is encouraged to do so.</p>

<p>Certain tasks, such as 'deploy' when a site is being imported, automatically imply a verify of the site.</p>

<p>Each Verify task, like all tasks generated by Aegir, emit a 'task log' available for review after the task has completed (or failed).</p>

<p>If a Verify task fails, and the task log does not provide enough information to help you resolve the problem, trying running drush @example.org provision-verify --debug from the command line to find out what caused the problem. Remember to replace 'example.org' with the URL of the site you are trying to verify.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-41.html?destination=node%2F44%23comment-form">Login</a> or <a href="../user/register/index-41.html?destination=node%2F44%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-27" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/27/index.html">Locking and Deleting platforms</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Platforms, like sites, have tasks that can be performed against them, however these tasks are smaller in number and generally more simple.</p>

<p>Some tasks that are available to platforms out of the box are Lock/Unlock and Delete.</p>

<h2>Lock</h2>

<p>The lock task is simply a conceptual protection placed over a platform so that new sites can't be installed on that platform.</p>

<p>It doesn't actually modify anything on the filesystem or on the platform itself, but merely changes the status of the platform in the Aegir database. Once a platform is considered 'locked', it no longer appears in the New Site form when adding a new site.</p>

<p>You might choose to Lock a platform if there is something wrong with that platform and you want to prevent new sites from being added to it by one of your clients or users, or you want to 'hide' the platform for some other reason (perhaps awaiting a release date before allowing new sites).</p>

<h2>Unlock</h2>

<p>To unlock a platform that has been locked, simply click the Unlock button and the status of the platform will be switched back to an Enabled state.</p>

<h2>Delete</h2>

<p>The Delete task is similar to that of sites. The delete button allows you to completely remove a platform from your filesystem irreversibly.</p>

<p>This can be handy if you engage in a build management methodology that involves making regular new platforms to upgrade your site to. It is easy to amass large numbers of platforms on the filesystem, so the Delete task was born to deal with that problem.</p>

<p>A platform can only be deleted if there are no sites currently provisioned on it. The task will fail before deleting anything if it detects that there are sites in the 'sites' directory of that platform.</p>

<p>You must migrate these sites off to a valid new platform before you can delete such a platform.</p>

<p>Unlike site deletions, there is no backup made of a platform (because it's not bootstrappable by Drush), so be careful with this task: there is no going back!</p>

<p>It is recommended to make regular filesystem backups outside of Aegir altogether, and to use the Lock task to temporarily 'disable' a platform from use if you are unsure whether you want to delete it, but don't want it shown on the Aegir frontend.</p>

<h2>Manually deleting a platform</h2>

<p>Similarily to <a href="../node/26/index.html">deleting sites</a>, sometimes something goes wrong during a Delete task and the platform doesn't get completely removed. Often this is caused by permissions problems on the platform (i.e something owned by a different user that the aegir user can't remove).</p>

<p>The Delete task sometimes cannot be re-run in this situation. In which case,:</p>

<ul>
<li>Manually remove the platform files on the server if they exist (i.e /var/aegir/drupal-6.19)</li>
<li>Remove the Drush alias for this platform if it is still present (in /var/aegir/.drush/)</li>
<li>Remove the platform configuration file from /var/aegir/config/server_master/apache/platform.d (and the same for the other server_ directory if the platform was hosted on a remote webserver)</li>
<li>Go to e.g. /node/123456/delete in your browser on the Aegir frontend and delete the node. This will remove the platform node and all associated task nodes from the system, as well as remove the entry from the hosting_platform and hosting_context table in the database.</li>
</ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_comments first last"><a href="../node/27/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-256" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/256/index.html">Using drush_make to optimize workflow</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <h2>Introduction</h2>

<p>Once you understand <a href="../node/217/index.html">why Aegir is a great tool</a> for developing and managing Drupal web sites you inevitably start looking for ways to optimize workflow.  mig5's article on <a href="http://mig5.net/content/drupal-deployments-workflows-version-control-drushmake-and-aegir">Drupal deployments and workflows</a> provides great insight on managing platforms, profiles and sites using Aegir, version control and the <a href="http://drupal.org/project/drush_make">drush_make</a> project.</p>

<h2>The challenge of managing platforms and profiles</h2>

<p>Whether you are using Drupal to develop bespoke web sites or vertical web applications with hundreds of instances (sites), it is not uncommon to be managing a mix of platforms and profiles.  These comprise <a href="http://drupal.org/download">community-contributed projects</a> that, in many cases, are frequently updated.  To protect the integrity of their platforms developers like to explicitly control which version of which project they use and when.  It can be time consuming to keep everything up to date.  Many contributed projects are available in versions compatible with multiple Drupal versions so this mix of platforms and profiles can be complex.</p>

<h2>Using drush_make to manage common and disparate code bases</h2>

<p>One of the really powerful features of drush_make is that it can operate <em>recursively</em>.  You invoke the <code>drush make</code> command on a local make file but if drush_make fetches a profile or project that includes another make file then this is parsed and additional packages are fetched.</p>

<p>A typical way that developers leverage this feature is when they want to have some projects available to the entire platform and some that are specific to one or more custom profiles that are part of the platform.  They achieve this by including a different make file with each profile repository.</p>

<p>Using make files with profiles works well when you want to manage distinct code bases that are specific to a site running under that profile. Only sites using profile 'foo' can see modules, themes or libraries located in subdirectories of the foo profile's directory.  However, using the <code>includes</code> option you can also reference a make file directly using a local path or a URL. The advantage of this is that you can maintain a make file that references the projects you use on every profile on every platform (e.g. views, cck, path etc.).</p>

<p>This is illustrated schematically below:</p>

<p><img src="../files/drush-make-architecture-2011-01-14_0/index.png" /></p>

<h2>Example make files</h2>

<p>Here are some example make files that illustrate the concepts described above:</p>

<h3>&lt;namespace&gt;_&lt;platform<sub>1</sub>&gt;.make</h3>

<div class="code-block">
<div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />; drupal core<br />projects[drupal][version] = 6.20<br /><br />; platform projects<br />projects[webform][vesion] = 3.2<br />projects[workflow][version] = 1.4<br />projects[job_scheduler][version] = 1.0-beta3<br />projects[feeds][version] = 1.0-beta10<br /><br />; platform theme<br />projects[acme_theme][type] = &quot;theme&quot;<br />projects[acme_theme][download][type] = &quot;git&quot;<br />projects[acme_theme][download][url] = &quot;git@git.example.com:drupal/themes/acme_theme.git&quot;<br />projects[acme_theme][download][branch] = &quot;master&quot;<br /><br />; profile 1<br />projects[acme_profile1][type] = &quot;profile&quot;<br />projects[acme_profile1][download][type] = &quot;git&quot;<br />projects[acme_profile1][download][url] = &quot;git@git.example.com:drupal/profiles/acme_profile1.git&quot;<br />projects[acme_profile1][download][branch] = &quot;master&quot;<br /><br />; profile 2<br />projects[acme_profile2][type] = &quot;profile&quot;<br />projects[acme_profile2][download][type] = &quot;git&quot;<br />projects[acme_profile2][download][url] = &quot;git@git.example.com:drupal/profiles/acme_profile2.git&quot;<br />projects[acme_profile2][download][branch] = &quot;master&quot;<br /><br />; base make file<br />includes[acme_base] = &quot;http://example.com/acme_base.make&quot;<br /><br />; patches<br />projects[superfish][patch][] = &quot;http://example.com/superfish-add-acme-style.patch&quot;</code></div>
</div>

<h3>&lt;namespace&gt;_&lt;profile<sub>1</sub>&gt;.make </h3>

<div class="code-block">
<div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />; ecommerce<br />projects[ubercart][version] = 2.4</code></div>
</div>

<h3>&lt;namespace&gt;_&lt;profile<sub>2</sub>&gt;.make </h3>

<div class="code-block">
<div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />projects[openlayers][version] = 2.x-dev<br />projects[ldap_integration][version] = 1.0-beta2</code></div>
</div>

<h3>&lt;namespace&gt;_base.make </h3>

<div class="code-block">
<div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />; utilities<br />projects[ctools][version] = 1.8<br />projects[jquery_ui][version] = 1.4<br />projects[jquery_update][version] = 2.x-dev<br />projects[modalframe][version] = 1.7<br />projects[advanced_help][version] = 1.2<br />projects[transliteration][version] = 3.0<br />projects[token][version] = 1.15<br /><br />; content management<br />projects[imageapi][version] = 1.9<br />projects[imagecache][version] = 2.x-dev<br />projects[cck][version] = 2.9<br />projects[filefield][version] = 3.9<br />projects[imagefield][version] = 3.9<br />projects[diff][version] = 2.1<br />projects[date][version] = 2.7<br />projects[calendar][version] = 2.4<br />projects[views][version] = 3.x-dev<br />projects[views_slideshow][version] = 2.3<br />projects[content_profile][version] = 1.0<br />projects[og][version] = 2.1<br />projects[node_clone][version] = 1.2<br />projects[node_export][version] = 2.21<br />projects[node_import][version] = 1.x-dev<br />projects[nodequeue][version] = 2.9<br />projects[noderelationships][version] = 1.6<br />projects[reverse_node_reference][version] = 1.0<br />projects[nodereference_views][version] = 1.3<br />projects[page_title][version] = 2.3<br />projects[pathauto][version] = 1.5<br />projects[realname][version] = 1.3<br /><br />; ui<br />projects[wysiwyg][version] = 2.2<br />projects[imce][version] = 2.1<br />projects[imce_wysiwyg][version] = 1.1<br /><br />; site administration<br />projects[admin_menu][version] = 1.6<br />projects[devel][version] = 1.x-dev<br />projects[devel_themer][version] = 1.x-dev<br />projects[globalredirect][version] = 1.x-dev<br />projects[google_analytics][version] = 2.3<br />projects[xmlsitemap][version] = 2.0-beta1<br /><br />; site building<br />projects[rules][version] = 1.4<br />projects[features][version] = 1.0<br />projects[context][version] = 3.0<br />projects[strongarm][version] = 2.0<br />projects[purl][version] = 1.0-beta13<br />projects[spaces][version] = 3.0<br /><br />; site theming<br />projects[skinr][version] = 1.6<br />projects[superfish][version] = 1.6<br />projects[adaptivetheme][version] = 3.0-rc2<br /><br />; libraries<br /><br />; CKEditor<br />libraries[ckeditor][download][type] = &quot;get&quot;<br />libraries[ckeditor][download][url] = &quot;http://download.cksource.com/CKEditor/CKEditor/CKEditor%203.4/ckeditor_3.4.tar.gz&quot;<br />libraries[ckeditor][directory_name] = &quot;ckeditor&quot;<br />libraries[ckeditor][destination] = &quot;libraries&quot;<br /><br />; jquery ui library<br />libraries[jquery_ui][download][type] = &quot;get&quot;<br />libraries[jquery_ui][destination] = &quot;modules/jquery_ui&quot;<br />libraries[jquery_ui][download][url] = &quot;http://jquery-ui.googlecode.com/files/jquery-ui-1.7.3.zip&quot;<br />libraries[jquery_ui][directory_name] = &quot;jquery.ui&quot;</code></div>
</div><div class="itu-attachments"><table class="itu-attachment-list withoutstats sticky-enabled" id="attachments">
 <thead><tr><th class="preview">Preview</th><th class="file">Attachment</th><th class="size">Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td class="mime mime-png"><div  class="form-item" id="">
    <div class="itu-attachment-thumb"><a href="../sites/community.aegirproject.org/files/drush-make-architecture-2011-01-14_0/index.png" title="drush-make-architecture-2011-01-14.png"><img src="../sites/community.aegirproject.org/files/imagecache/AttachmentThumbnail/drush-make-architecture-2011-01-14_0/index.png" alt="drush-make-architecture-2011-01-14.png" title="drush-make-architecture-2011-01-14.png" width="60" height="60" class="imagecache imagecache-AttachmentThumbnail"/></a></div>  </div>
</td><td class="file"><a href="../sites/community.aegirproject.org/files/drush-make-architecture-2011-01-14_0/index.png">drush-make-architecture-2011-01-14.png</a></td><td class="size">20.11 KB</td> </tr>
</tbody>
</table>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-42.html?destination=node%2F256%23comment-form">Login</a> or <a href="../user/register/index-42.html?destination=node%2F256%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-28" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../node/28/index.html">Client management and access control</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>@TODO update this, it's been copied directly from GDO without modifications yet.</p>

<p>In some situations you may wish to allow different people access to Aegir, but restrict which sites they can manage.</p>

<ul>
<li><h3>Use Case 1:</h3>
As a developer you may simply wish to segregate your sites in Aegir by different clients for your own internal management reasons.</li>
<li><h3>Use Case 2:</h3>
If you have many staff working on different projects, you may wish to issue them with different logins and restrict which sites they can access on the Aegir system.</li>
<li><h3>Use Case 3:</h3>
As a drupal hosting company you might allow clients to sign up via your promotional website (using the 'Signup Form' feature in Aegir!), and then have their own account created on Aegir, with their newly provisioned site. They can then login and manage their own upgrades (by migrating to new platforms). </li>
</ul>

<p>This functionality is provided by the Client feature in Aegir. Here's a brief guide to using it...</p>

<h2>1. Enable the Clients Feature</h2>

<p>If you didn't enable this feature during installation, you can do so now by choosing the following from the menu bar at the very top of the page: Hosting &gt; Features.
On this page, click on 'Experimental' to expand these feature options. You can tick 'Clients' and click on the 'Save Configuration' button.</p>

<p><em><strong>NOTE:</strong> Experimental features are designed to be for developer preview only, although we do have reports of them being successfully used in production environments - but do so at your own risk!</em></p>

<h2>2. Configure the Client Feature Options</h2>

<p>From the top admin menu select Hosting&gt;Clients. On this page you can configure how you want this feature to operate, with the following options:</p>

<h3>Automatically Create User Accounts for New Clients</h3>

<p>If you tick this option, whenever you setup a new Client within Aegir, they will have a drupal user account created for them to be able to access their sites within the Aegir site. You will definitely want to leave this unticked for Use Case 1, perhaps also for Use Case 2, but may want to tick this for Use Case 3.</p>

<h3>Send Welcome Mail to New Clients</h3>

<p>If this setting is ticked, the client will be sent an email when you create their drupal user account allowing them access to the system.
Below this you can configure the email that will be sent.</p>

<h2>Create Clients</h2>

<p>Creating a new Client on Aegir is as simple as selecting Create Content&gt;Client. Then enter their email address (twice for confirmation), Name and Organization. Now click 'Save'.</p>

<p>Depending on the options you selected above they might also have a user account created for them at this stage by Aegir, and then be emailed with their login details.</p>

<p>Otherwise the Client record will just be stored in the database and you will be able to assign sites to this client in the future.</p>

<h2>Adding New Users to a Client</h2>

<p>Perhaps you didn't initially allow clients to access their own Client area within Aegir and just kept it for your own internal use, or perhaps you now want to add additional users to a Client on the system.</p>

<p>To do this visit the Client page and select the 'Edit' tab. You'll see a list of allowed users. You can add users to this list by typing their username in the autocomplete field, or you can remove users by tciking the box next to their username and saving the form.</p>

<p>If the user you wish to add doesn't yet have a drupal user account on the Aegir site, you can create one as normal by going to the following on the top admin menu: User Management&gt;Users&gt;Add User. Then you can return to the client page and add their username to give them access to that client's area.</p>

<h2>Clients Accessing the System</h2>

<p>If you have selected above that new Clients should also have an Aegir account setup for them, then they will be able to access the Aegir site.</p>

<p>Within Aegir they will ONLY be able to see details about their own sites.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="talk_forbidden first last"><span><a href="../user/login/index-43.html?destination=node%2F28%23comment-form">Login</a> or <a href="../user/register/index-43.html?destination=node%2F28%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/using?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 15:05:52 GMT -->
</html>
