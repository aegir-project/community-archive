<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/9/revisions/17/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 17:39:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../../administrator/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../content/installing/system-requirements/index.html" />
<link rel="prev" href="../../../../../administrator/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../content/installing/system-requirements/index.html" />
<link rel="canonical" href="index.html" />
<link rel="prev" href="../../../../../installing/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../../installing/debian/index.html" />
<link rel="prev" href="../../../../../content/installing/system-requirements/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html" />
<link rel="prev" href="../../../../../installing/debian/index.html" />
<link rel="up" href="../../../../../installing/debian/index.html" />
<link rel="next" href="../../../../../installing/manual/index.html" />
<link rel="prev" href="../../../../../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../417/index.html" />
<link rel="prev" href="../../../../../installing/manual/index.html" />
<link rel="up" href="../../../../../installing/manual/index.html" />
<link rel="next" href="../../../../../content/apache-mysql-php-aegir/index.html" />
<link rel="prev" href="../../../../417/index.html" />
<link rel="up" href="../../../../417/index.html" />
<link rel="next" href="../../../../../content/nginx-mariadb-php-aegir-memp%c3%a6/index.html" />
<link rel="prev" href="../../../../../content/apache-mysql-php-aegir/index.html" />
<link rel="up" href="../../../../417/index.html" />
<link rel="next" href="../../../../../content/installing/manual/centos-6x-aegir-install-guide/index.html" />
<link rel="prev" href="../../../../../content/nginx-mariadb-php-aegir-memp%c3%a6/index.html" />
<link rel="up" href="../../../../../installing/manual/index.html" />
<link rel="next" href="../../../../../installing/manual/manual-install-web-cluster-aegir-using-nginx/index.html" />
<link rel="prev" href="../../../../../content/installing/manual/centos-6x-aegir-install-guide/index.html" />
<link rel="up" href="../../../../../installing/manual/index.html" />
<link rel="next" href="../../../../../content/installing/manual/nginx-mariadb-php-fpm-single-server-installation/index.html" />
<link rel="prev" href="../../../../../installing/manual/manual-install-web-cluster-aegir-using-nginx/index.html" />
<link rel="up" href="../../../../../installing/manual/index.html" />
<link rel="next" href="../../../../462/index.html" />
<link rel="prev" href="../../../../../content/installing/manual/nginx-mariadb-php-fpm-single-server-installation/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html" />
<link rel="prev" href="../../../../462/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Installing Aegir from Wed, 10/27/2010 - 01:04 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-9" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../../../installing/index.html">Installing Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div id='diff-inline-9'><p>Installing Aegir</p></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-9.html?destination=node%2F9%23comment-form">Login</a> or <a href="../../../../../user/register/index-9.html?destination=node%2F9%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-9.html?destination=node%2F9%23comment-form">Login</a> or <a href="../../../../../user/register/index-9.html?destination=node%2F9%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



<div  id="node-2917" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/installing/system-requirements/index.html">System Requirements</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Note that the following System Requirements are the same for Aegir automatic or manual install</p>

<dl>
<dt><strong>A system capable of running Drupal</strong></dt>
<dd>The Aegir system is entirely Drupal based, and has the same base requirements that Drupal does (with the exception that it won't run on Windows). See more notes on Unix and LAMP/LEMP requirements below.</dd>

<dt><strong>Your own server</strong></dt>
<dd>The low level of access required to be able to configure and run this system is very far beyond what is commonly available to users with shared hosting. A VPS from any popular provider such as Linode, Rackspace, Slicehost, Amazon EC, etc. will do fine. You will need root access to the server and the server needs to be dedicated to Aegir.</dd>

<dt><strong>A Unix-based operating system</strong></dt>
<dd>Aegir must run on some flavour of UNIX, because the majority of functionality in this system occurs in the back-end, through command line scripting. There are also several features (such as symlinks), that are not available to users on Windows. There are no plans currently to add Windows support. See the <a href="../../../../../handbook/operating-system-support/index.html">operating system support page</a> for more information.</dd>

<dt><strong>Web server</strong></dt>
<dd>You will need at least one dedicated web server, running Apache. We generally work with <strong>Apache 2</strong> but we should be compatible with the 1.x series. Aegir also supports the <strong>Nginx</strong> web server, but requires at least version 0.7.66 or newer. Since Nginx doesn't provide php-cgi or php-fpm (recommended) modules, you will need to install and run php-fpm server separately. You can find useful examples and tips in the third party Barracuda installer available at <a href="http://drupal.org/project/barracuda">the barracuda project page</a>.</dd>

<dd>
<p><strong>N.B.:</strong> This third party installer is not supported by the core Aegir developers, but you can find helpful community support at <a href="http://groups.drupal.org/boa">the boa group</a>.</p>
</dd>

<dt><strong>PHP 5.2 and 5.3</strong></dt>
<dd>Aegir depends on <a href="http://drupal.org/project/drush">Drush 4.x</a>, which requires PHP 5.2 or higher. Aegir 2.x depends on a minimun of <a href="http://drupal.org/project/drush">Drush 5.10</a> (though Drush 6 is recommended), which requires PHP 5.3 or higher. You also need to have the command-line version of PHP to run Drush properly, and the MySQL extensions for PHP.</dd>

<dd>
<p>Given that <a href="http://www.php.net/archive/2010.php#id2010-07-22-1">PHP 5.2 has been deprecated since July 2010</a>, we suggest using PHP 5.3 if possible. Note that while Drupal 6.x and above support PHP 5.3, some contributed third-party modules may still have problems with this version. Most often these cause warnings that can be safely ignored. Aegir and Drush themselves have no known outstanding PHP 5.3 compatibility issues, although you could have a lot of warnings in Drupal 6 due to <a href="http://drupal.org/node/883038">ereg deprecation</a>, see <a href="http://drupal.org/node/883038">this issue</a> for details. If you need to host Drupal 5.x sites, note that Drupal 5.x is not compatible with PHP 5.3 and above, and most likely never will be. See <a href="http://drupal.org/node/360605" title="http://drupal.org/node/360605">http://drupal.org/node/360605</a> (amongst other issues) for details. As such, Aegir has dropped support for Drupal 5 in versions 2.0+.</p>
</dd>

<dt><strong>Database server</strong></dt>
<dd>You will require a database server, obviously. Aegir currently only supports MySQL and MariaDB. It is preferable to use a dedicated (not shared-hosting) server since Aegir will create database users and will require the use of a MySQL <code>root</code> user.</dd>

<dt><strong>Mail transfer agent</strong></dt>
<dd>Aegir requires an MTA (Mail Transfer Agent) installed on your webserver in order to be able to install new sites to your new platform. If you don't have an MTA, the site installation will fail with message like "could not send email". Additional messages will show that site has been removed because of this problem. To remedy the situation simply install an MTA like sendmail, postfix, or exim and do the minimal configuration.</dd>

<dt><strong>Other utilities: sudo, rsync, git and unzip</strong></dt>
<dd>Aegir installs itself via a <a href="http://drupal.org/project/drush_make">Drush Make</a> makefile that downloads via git if you want the bleeding edge code, or via wget if you want the latest official release. If you want the latest development version, and don't have the <strong>git</strong> program you will need to install it on the server.</dd>

<dd>
<p>The <strong>jQueryUI</strong> library is used in the Aegir UI, <strong>unzip</strong> is required to extract it. <strong>Sudo</strong> is required to allow the aegir user the limited privilege to restart the webserver when required.  <strong>Rsync</strong> is used to sync files to remote servers.</p>
</dd>

<dt><strong>No conflicting Control Panels</strong></dt>
<dd>Other popular control panels such as Plesk, cPanel etc, are designed to manage all aspects of Apache configuration and other areas that Aegir also is intended to be used for.</dd>

<dd>
<p>Running Aegir alongside such control panels is not supported and very likely may cause you problems or difficulties installing or running Aegir. Filing bug reports that are caused by interference by another control panel will likely be closed unless the problem can be fixed without causing problems for other Aegir users. Proceed at your own risk!</p>
</dd>

<dt><strong>System requirements of popular Drupal distributions</strong></dt>
<dd>Some Drupal distributions, such as OpenAtrium, are specialized products that may contain unique prerequisites for optimal performance. Such examples may include raising the php-cli program's memory_limit to something higher than 64M.</dd>

<dd>
<p>Please note that this is not a requirement of Aegir but of the distribution you are trying to install a site on. Thus the Aegir documentation may not officially 'require' such performance settings, but be aware that Aegir may report errors if the system was under-resourced to complete such a task.</p>
</dd>
</dl>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-45.html?destination=node%2F2917%23comment-form">Login</a> or <a href="../../../../../user/register/index-45.html?destination=node%2F2917%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-45.html?destination=node%2F2917%23comment-form">Login</a> or <a href="../../../../../user/register/index-45.html?destination=node%2F2917%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-400" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../installing/debian/index.html">Automatic install on Debian</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>These are the installation instructions that are recommended on Debian. Aegir dependencies (Apache, MySQL, PHP...) are also automatically installed. If you are managing the installation from a remote Windows computer, well-known open source tools for this task are for example <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY</a> (<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/docs.html">a SSH client for command line</a>), and <a href="http://winscp.net/eng/download.php">WinSCP</a> (<a href="http://winscp.net/eng/docs/start">a SFTP client with easy text file editing</a>).</p>

<p>If you wish to install Debian packages over an existing manual install, it's possible. See <a href="../../../../../upgrading/debian/index.html">the Debian upgrade procedures</a>.</p>

<p>Debian packages are uploaded to <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org/">http://debian.aegirproject.org/</a> shortly after a release. We eventually want to upload those packages to the official archives, but this will take some adaptation and time to sponsor the packages in.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Requirements_for_automatic_install_on_Debian"><span class="toc-number">1. </span>Requirements for automatic install on Debian</a></li>
	<li class="toc-level-1"><a href="#Adding_the_project_repositories"><span class="toc-number">2. </span>Adding the project repositories</a></li>
	<li class="toc-level-1"><a href="#Adding_the_archive_key_to_your_keyring"><span class="toc-number">3. </span>Adding the archive key to your keyring</a></li>
	<li class="toc-level-1"><a href="#Adding_backports_for_or_manually_installing_Drush"><span class="toc-number">4. </span>Adding backports for or manually installing Drush</a></li>
	<li class="toc-level-1"><a href="#DNS_configuration"><span class="toc-number">5. </span>DNS configuration</a></li>
	<li class="toc-level-1"><a href="#Manual_sudo_configuration"><span class="toc-number">6. </span>Manual sudo configuration</a></li>
	<li class="toc-level-1"><a href="#Manual_installation_of_MySQL_on_Ubuntu_12.04_LTS"><span class="toc-number">7. </span>Manual installation of MySQL (on Ubuntu 12.04 LTS)</a></li>
	<li class="toc-level-1"><a href="#Installing_Aegir"><span class="toc-number">8. </span>Installing Aegir</a></li>
	<li class="toc-level-1"><a href="#Custom_Drupal_distributions_and_make_files"><span class="toc-number">9. </span>Custom Drupal distributions and make files</a></li>
	<li class="toc-level-1"><a href="#Troubleshooting_the_install"><span class="toc-number">10. </span>Troubleshooting the install</a></li>
</ol>
</div>
</div>

<h2 id="Requirements_for_automatic_install_on_Debian">1. Requirements for automatic install on Debian</h2>

<p><strong>Basic Linux system administration skills</strong></p>

<p><strong>Root access to your server</strong></p>

<dl>
<dt><strong>An up-to-date system and applications</strong></dt>
<dd>
<p>Run the following command lines to update your system and applications.</p>
</dd>

<dd>
<p><div class="codeblock"><code>&nbsp; aptitude update<br />&nbsp; </code></div></p>
</dd>

<dd><div class="codeblock"><code>&nbsp; aptitude safe-upgrade<br />&nbsp; </code></div></dd>

<dt><strong>A configured Fully Qualified Domain Name (FQDN)</strong></dt>
<dd>
<p>Such as aegir.example.com</p>
</dd>

<dd>The <code>hostname</code> returned by the commands <code>hostname -f</code> and <code>uname -a</code> must resolve to the IP address of your server.</dd>

<dd>
<p>After setting up your FQDN you must restart your server with a <code>reboot</code> command so your changes take effect.</p>
</dd>

<dd>
<p>Note that newly created domain name usually take 24 to 48 hours to fully start working. This period, called propagation, is the projected length of time it takes for root name servers and cache records across the entire web to be updated with your website's DNS information.</p>
</dd>

<dt><strong>Other System Requirements</strong></dt>
<dd>
<p>Find <a href="../../../../../content/installing/system-requirements/index.html" title="http://community.aegirproject.org/content/installing/system-requirements">http://community.aegirproject.org/content/installing/system-requirements</a></p>
</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Adding_the_project_repositories">2. Adding the project repositories</h2>

<p>Use this command to add the Aegir package "Software Source" repository to your system:</p>

<p><div class="codeblock"><code>echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | sudo tee -a /etc/apt/sources.list.d/aegir-stable.list</code></div></p>

<p>To install a customized Debian package, see the <a href="../../../../../debian/index.html">developer instructions for the debian package</a>. Other distributions are available for courageous people that want to try development versions.</p>

<p><strong>2.x note</strong>: to install the development version of Aegir, you can use the <code>unstable</code> or <code>stable</code> distribution above.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Adding_the_archive_key_to_your_keyring">3. Adding the archive key to your keyring</h2>

<p>This repository self-signs packages uploaded to it (and packages uploaded are verified against a whitelist of trusted uploaders) using OpenPGP (GnuPG, to be more precise).</p>

<p>Use these commands to download and add the repository's PGP key, then update the package list on your system:</p>

<p><div class="codeblock"><code>wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | sudo apt-key add -<br />sudo apt-get update</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Adding_backports_for_or_manually_installing_Drush">4. Adding backports for or manually installing Drush</h2>

<p>If you are running <strong>Debian wheezy</strong> or later, or <strong>Ubuntu Natty 11.04</strong> or later, <strong>you don't need to do anything here</strong>. The Drush package you need is available from your distribution's repositories.</p>

<p>If not, you should also configure <a href="http://backports.debian.org/">backports</a> repositories for Drush. Version 4.4 of Drush is now in Debian <a href="http://packages.debian.org/sid/drush">unstable</a>, <a href="http://packages.debian.org/wheezy/drush">wheezy</a>, <a href="http://packages.debian.org/squeeze-backports/drush">squeeze-backports</a> and <a href="http://packages.ubuntu.com/natty/drush">Ubuntu Natty</a>.</p>

<p><span id="debian-backport"></span>
<strong>1.x note</strong>: if you are running <strong>Debian Squeeze 6.0</strong> or <strong>Debian Squeeze 7.0</strong>, add the following line to /etc/apt/sources.list :</p>

<p><div class="codeblock"><code>deb <a href="http://backports.debian.org/debian-backports" title="http://backports.debian.org/debian-backports">http://backports.debian.org/debian-backports</a> squeeze-backports main</code></div></p>

<p>You might also have to add a proper Pin-Priority before this works. Create a file called <strong>drush</strong> containing the following and drop it into /etc/apt/preferences.d:
<div class="codeblock"><code>Package: drush<br />Pin: release a=squeeze-backports<br />Pin-Priority: 1001</code></div></p>

<p>Alternatively, you could download and install the squeeze-backports package for Drush 4.5 directly from: <a href="http://packages.debian.org/squeeze-backports/all/drush/download" title="http://packages.debian.org/squeeze-backports/all/drush/download">http://packages.debian.org/squeeze-backports/all/drush/download</a>. Then you could install it with:</p>

<pre><code>dpkg -i drush_4.5-2~bpo60+1_all.deb
</code></pre>

<p><strong>2.x note</strong>: if you are running <strong>Debian Squeeze 6.0</strong>, to get drush-5.8.x and above, download <a href="http://ftp.debian.org/debian/pool/main/p/php-console-table/php-console-table_1.1.4-1_all.deb">php-console-table</a> manually and install it</p>

<p><div class="codeblock"><code>wget &quot;http://ftp.debian.org/debian/pool/main/p/php-console-table/php-console-table_1.1.4-1_all.deb&quot;<br />dpkg -i php-console-table_1.1.4-1_all.deb</code></div></p>

<p>You do not need to edit /etc/apt/sources.list or create /etc/apt/preferences.d/drush</p>

<p>Then run:
<div class="codeblock"><code>sudo apt-get update &amp;&amp; sudo apt-get install drush</code></div></p>

<p>If you are running <strong>Debian lenny 5.0</strong> or <strong>Ubuntu Maverick 10.10</strong> or Karmic Koala or earlier, we recommend downloading and installing the Drush package <a href="http://packages.debian.org/wheezy/all/drush/download">manually</a>.  The version of Drush in the Ubuntu Universe repository for these versions of Ubuntu is outdated.  If you are using <strong>Ubuntu Lucid LTS 10.04</strong>, you can install the Drush package manually or instead use <a href="https://launchpad.net/~brianmercer/+archive/drush">Brian Mercer's PPA</a> (Personal Package Archive) using the following command:</p>

<p><div class="codeblock"><code>sudo apt-get install python-software-properties<br />sudo add-apt-repository ppa:brianmercer/drush</code></div></p>

<p>Now run apt-get update again to refresh the apt database.</p>

<p><div class="codeblock"><code>sudo apt-get update</code></div></p>

<p><strong>N.B.</strong> Since Aegir 2 requires Drush 5, which in turn requires PHP 5.3+, Drupal 5 sites are not supported in Aegir 2.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="DNS_configuration">5. DNS configuration</h2>

<p>Aegir requires a properly configured "FQDN" (Fully Qualified Domain Name) be assigned to the machine. In practice, this means that the hostname returned by the <code>hostname -f</code> and <code>uname -n</code> shell commands should resolve to the IP address for this server, and vice versa, with the <code>resolveip</code> command (included with the mysql-server package).</p>

<p>For Ubuntu, /etc/hosts should have entries that look like:
<div class="codeblock"><code>::1 host.example.com host ip6-localhost ip6-loopback<br />127.0.0.1 host.example.com host localhost<br />123.123.123.123 host.example.com host localhost</code></div></p>

<p>To set this up in a virtual machine (e.g. Virtualbox), here are the steps:</p>

<ol>
<li>Create a new VM</li>
<li>Go to settings-&gt;network.  Enable Adapter 2, and set to "host-only"</li>
<li>Install Ubuntu.  Set hostname as FQDN during install</li>
<li>You may need to add the lines `auto eth1` and `iface eth1 inet dhcp` to /etc/network/interfaces</li>
</ol>

<p>If you have a virtual machine already setup and want to change the FDQN:</p>

<ol>
<li>change /etc/hostname using: `sudo hostname NEW_NAME`</li>
<li>change /etc/hosts using: `sudo nano /etc/hosts` and change name</li>
<li>reboot and test `hostname -f`, `uname -n`, `resolveip NEW_NAME`, `resolveip IP`</li>
<li><a href="http://www.ducea.com/2006/08/07/how-to-change-the-hostname-of-a-linux-system/">YMMV - Your Mileage May Vary</a></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Manual_sudo_configuration">6. Manual sudo configuration</h2>

<p>If you are running <strong>Debian squeeze</strong> or later, or <strong>Ubuntu Lucid 11.04</strong> or later, <strong>you don't need to do anything here</strong>. The Aegir package configures sudoers automatically.</p>

<p>If not, you will need to manually modify your /etc/sudoers file to add the following line:</p>

<p><div class="codeblock"><code>echo &quot;aegir ALL=NOPASSWD: /usr/sbin/apache2ctl&quot; | sudo tee -a /etc/sudoers</code></div></p>

<p>The line above assumes that you have created a user aegir as specified in the installation instructions.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Manual_installation_of_MySQL_on_Ubuntu_12.04_LTS">7. Manual installation of MySQL (on Ubuntu 12.04 LTS)</h2>

<p>Please note that Ubuntu 12.04 LTS installs, by default, an insecure MySQL installation that contains an anonymous user grant, allowing anyone to login without a password. This breaks Aegir functionality.</p>

<p>If you are running Ubuntu 12.04, you should install MySQL manually, and then ensure it is installed securely:</p>

<p><div class="codeblock"><code>sudo apt-get install mysql-server<br />sudo mysql_secure_installation</code></div></p>

<p>When running 'sudo mysql_secure_installation', answer 'Y' to 'Remove anonymous users?'</p>

<p><div class="codeblock"><code>By default, a MySQL installation has an anonymous user, allowing anyone<br />to log into MySQL without having to have a user account created for<br />them.&nbsp; This is intended only for testing, and to make the installation<br />go a bit smoother.&nbsp; You should remove them before moving into a<br />production environment.<br /><br />Remove anonymous users? [Y/n] Y<br /> ... Success!</code></div></p>

<p>Now you can proceed with installing Aegir below.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Installing_Aegir">8. Installing Aegir</h2>

<p>To install Aegir version 2, frontend and backend, use the following command:
<div class="codeblock"><code>sudo apt-get install aegir2</code></div></p>

<p><strong>2.x note</strong>: Aegir version 2 is now stable. Read more at <a href="../../../../../2/index-2.html" title="http://community.aegirproject.org/2.1">http://community.aegirproject.org/2.1</a></p>

<p><strong>1.x note</strong>: to install Aegir version 1, use <code>sudo apt-get install aegir</code> instead.</p>

<p>If apt-get reports that the aegir packages have unmet dependencies, then make sure that you have installed Drush (as explained above).  On a debian system, you can force the install of Drush from the squeeze-backports repository:</p>

<p><div class="codeblock"><code>sudo apt-get -t squeeze-backports install drush</code></div></p>

<p>Then install aegir using the apt-get command above.</p>

<p>This will prompt you for the required information (MySQL password, Postfix configuration...) and go ahead with the install.</p>

<p>During the Postfix configuration, the following options appear: "No configuration, Internet site, Internet with smarthost, Satellite system, Local only". That first text screen only allows to use the tab key to select "OK", and then the enter key to display a second screen where you can select one of the choices. The default is "Internet site", useful in most cases to enable the server to send email messages, for example to the admin.</p>

<p>At the end of the installation, you will receive an email message or, if the user "aegir" has been assigned with a local email account during the installation, the file /var/mail/aegir will contain the message. It will include a one-time login to your new Aegir control panel, that is a URL to copy into your browser so that you can set the password for the "admin" user.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Custom_Drupal_distributions_and_make_files">9. Custom Drupal distributions and make files</h2>

<p>If you have your own Drupal make file, you can go ahead with the above process, but change the make file to the one you want:</p>

<pre><code>echo debconf aegir/makefile string /var/aegir/makefiles/aegir/aegir-custom.make | debconf-set-selections
apt-get install aegir
</code></pre>

<p>This allows you to specify the makefile path for your custom distribution of Aegir. To maintain these customizations, you'll need to ensure you do the same when upgrading.</p>

<p>An example aegir-custom.make file could look like:</p>

<p><div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />includes[aegir] = &quot;/usr/share/drush/commands/provision/aegir.make&quot;<br /><br />projects[] = module_filter</code></div></p>

<p>Note that for this to work, you may need the patch from <a href="http://drupal.org/node/1118616">this issue</a>, allowing drush_make to reference absolute system paths.  If <code>drush make --version</code> &lt;= 2.2 you need this patch.</p>

<p>After installing Aegir, you can reinstall the front end (hostmaster), with following commands:
<div class="codeblock"><code>sudo rm -rf /var/aegir/hostmaster-&#42;.&#42;<br />sudo su -s /bin/sh aegir -c &quot;drush -y hostmaster-install --aegir_db_pass=$DB_PASSWORD --makefile=$MAKEFILE $DOMAIN&quot;</code></div>
<code>su -s /bin/sh aegir -c "some command"</code> runs <code>some command</code> in the <code>/bin/sh</code> shell as user <code>aegir</code>.  <code>sudo</code> runs the <code>su</code> command as root - prompting for your user's password instead <code>su</code> asking for aegir's password.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Troubleshooting_the_install">10. Troubleshooting the install</h2>

<p>To make the install smoother, the install command is run without much debugging information, which can make diagnostics pretty hard. For this, there's a special environment variable you can set that will trigger debugging output. Install aegir with this*:</p>

<p><div class="codeblock"><code>env DPKG_DEBUG=developer apt-get install aegir</code></div></p>

<p>You can build your own Debian packages from our repositories using <a href="../../../../543/index.html">those instructions</a>.</p>

<p><em>Note: Prior to 1.1-4.</em> the command was <code>env DEBUG=yes apt-get install aegir</code></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-296.html?destination=node%2F400%23comment-form">Login</a> or <a href="../../../../../user/register/index-296.html?destination=node%2F400%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../400/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-1080" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html">Automatic Installation on Ubuntu 11.04+ (QuickStart)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_50 first"><a href="../../../../../category/keywords/install/index.html" rel="tag" title="">Install</a></li>
<li class="taxonomy_term_70"><a href="../../../../../category/keywords/installation-ubuntu/index.html" rel="tag" title="">installation ubuntu</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Here are simplified instructions for installing Aegir on a server, quickly and easily.</p>

<p>The fastest way to install Aegir is on the latest Ubuntu Server LTS (Long Term Support). <em>Currently 12.04</em>.</p>

<h1>Command Summary</h1>

<p>Here is every command, ready to copy and paste.</p>

<p><div class="codeblock"><code>sudo su<br />echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | tee -a /etc/apt/sources.list.d/aegir-stable.list<br />wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | apt-key add -<br />apt-get update<br />apt-get install aegir</code></div></p>

<p>It is highly recommended to read through the <strong>Installation Instructions</strong> step by step to give yourself the feel for how this is done.  In addition, if you are not already familiar in Linux system administration, please read up on the subject.  Standard linux security protocols should be followed.</p>

<h1>Installation Instructions</h1>

<p>Enter all commands in <code>code boxes</code> exactly as they are written.</p>

<p>ALL commands should be entered as <code>root</code> user until these instructions are complete.  After that, you should never have to use the root user.</p>

<p>Self-installation of Ubuntu has you create an additional user in the <code>admin</code> group, which means they can sudo.  If you are using a cloud hosting service, it likely just sent you root user credentials.  <em>Server security and user management is up to you.  Don't give away access to root or the aegir user unless you know what you are doing.  Follow standard web host best practices</em></p>

<p>For a summary of all needed commands, scroll to the bottom of the page.</p>

<ol>
<li><h2>Fire up a new server</h2>

<ul>
<li>Use <strong>Ubuntu 11.04 Server Edition</strong> for the smoothest and most reliable installation experience.  </li>
<li>Make sure it has at least 1024MB, preferably 2048MB of memory.  Depending on your host you will have to configure a hostname.  It can be convenient to call this 'aegir'.</li>
<li>If you want the smoothest installation, create a brand new server.  There will be the least chance of conflicts if you start with a brand new <strong>Ubuntu 11.04</strong> server.  If you use Ubuntu Desktop, you should be able follow these instructions without any problems.</li>
<li><em>Run all commands as root.  If you are not root, enter</em>
<div class="codeblock"><code>sudo su</code></div></li>
</ul></li>
<li><h2>Add the project repositories and archive key</h2>

<p>Use this command to add the Aegir package "Software Source" repository to your system:
<div class="codeblock"><code>echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | tee -a /etc/apt/sources.list.d/aegir-stable.list</code></div>
Use this command to add the archive key to your keyring:
<div class="codeblock"><code>wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | apt-key add -</code></div>
Then, finally, update your apt repositories:
<div class="codeblock"><code>apt-get update</code></div></p></li>
<li><h2>Install configure Aegir and dependencies</h2>

<p>Once you have added the repositories, you can now fire off the standard debian installation command. For Aegir 1.x, the command is:
<div class="codeblock"><code>apt-get install aegir</code></div>
For Aegir 2.x, the command is:
<div class="codeblock"><code>apt-get install aegir2</code></div>
This fires off the installation script for AEgir, along all dependencies including Apache, MySQ and PHP.  You will be asked a number of questions about your server.</p>

<ul>
<li>You will be asked to create a <em>MySQL root user password</em>.  Make this long and random and type it down somewhere safe, you won't need it very often, but you will need it later on in the installation process.</li>
<li>In <em>Postfix Configuration</em>:  Choose Internet Site, unless you have a reason otherwise.  When asked for the <em>System mail name</em>, pick either the hostname (default) or the domain name you will be hosting this server on.</li>
<li>In <em>Configure aegir-hostmaster</em>, you will be asked to choose a "URL of the hostmaster frontend".  This should be either the hostname (default) or the domain name the server will be hosting, with "aegir" as a subdomain.  For example, "aegir.example.com".  You may want to change this to whatever you prefer, just don't forget it as it will be where you use the Aegir front-end.</li>
<li>After entering your domain, Aegir Hostmaster installation will ask you for the MySQL root password you created earlier.  You did write it down, didn't you?<br />
<strong>NOTE:</strong> The current DEB package requires you to enter the MySQL root password twice.
When this script is done, if everything went ok, after a lot of other interesting information, you should see this:
<div class="codeblock"><code>Aegir is now installed. You can visit it at <a href="http://test/user/reset/1/1329504351/eda205d9a27abde400a27cf160dff69a<br />************************************************************************<br />Aegir" title="http://test/user/reset/1/1329504351/eda205d9a27abde400a27cf160dff69a<br />************************************************************************<br />Aegir">http://test/user/reset/1/1329504351/eda205d9a27abde400a27cf160dff69a<br />***...</a> frontend bootstrap correctly, operation was a success!<br />Setting up aegir (1.6-1) ...<br />Setting up libhtml-template-perl (2.9-2) ...<br />Setting up mysql-server (5.1.54-1ubuntu4) ...<br />Setting up php5 (5.3.5-1ubuntu7.7) ...<br />Processing triggers for libc-bin ...<br />ldconfig deferred processing now taking place<br />root@test:~# </code></div></li>
</ul>

<p>At this point, everything is installed.  Visit the link the script provided you to check out the frontend.  Switch to the <code>aegir</code> user to check out the backend:
<div class="codeblock"><code>su - aegir</code></div></p>

<p>Once you are the aegir user, check out the drush site aliases  it gives you. <code>@hostmaster</code> is the alias for the new front-end you created.  You will get new site aliases for every platform and site you create.
<div class="codeblock"><code>drush site-aliases</code></div></p></li>
<li><h2>Give yourself access to the server</h2>

<p>As the "Administrators Manual" can tell you, you should only manage the Aegir server from the backend as the <code>aegir</code> user.</p>

<p>However, by default, the <code>aegir</code> user cannot sudo (except to restart apache).  The aegir user also does not have a password.  Therefor, the only way to become aegir is to <code>sudo su - aegir</code> from a user that can.</p>

<p>So, to finish the server, you should give yourself a personal account that you can use to login to the server with a password in case all of your SSH keys get lost.</p>

<p>To add yourself as a user:
<div class="codeblock"><code>adduser yourname</code></div>
Then fill out the little wizard it gives you.</p>

<p>//@TODO: Add some helpful notes about SSH keys and remote aliases.</p>

<p>Install SSH on your server, generating your SSH keys and install them on your Ubuntu server. (Directions to generate your SSH keys are assuming your PC is Ubuntu as well, Windows users look below for SSH directions)</p>

<ul>
<li>Tutorial: <a href="https://help.ubuntu.com/11.04/serverguide/C/openssh-server.html" title="https://help.ubuntu.com/11.04/serverguide/C/openssh-server.html">https://help.ubuntu.com/11.04/serverguide/C/openssh-server.html</a></li>
</ul>

<p>If using Windows, you must use Putty, PuttyGen, and PuttyPageant to generate and use your SSH keys.</p>

<ul>
<li>Tutorial #1: <a href="http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter8.html" title="http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter8.html">http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter8.html</a></li>
<li>Tutorial #2: <a href="http://www.howtoforge.com/ssh_key_based_logins_putty" title="http://www.howtoforge.com/ssh_key_based_logins_putty">http://www.howtoforge.com/ssh_key_based_logins_putty</a></li>
</ul>

<p>You will want to also be a part of the aegir and www-data groups so you can write to some of their files:
<div class="codeblock"><code>addgroup yourname aegir<br />addgroup yourname www-data</code></div></p></li>
<li><h2>Start Using!</h2>

<p>Now that aegir is installed, head to the  <a href="../../../../../using/index.html">User Manual</a> page to get your first platform and site up and running.</p></li>
</ol>

<h1>Credits</h1>

<p><em>This document was originally based on <a href="../../../../../installing/debian/index.html" title="http://community.aegirproject.org/installing/debian">http://community.aegirproject.org/installing/debian</a> but has been trimmed down to list only the steps you need to use on an Ubuntu server to get Aegir up and running as quickly and easily as possible.</em></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-391.html?destination=node%2F1080%23comment-form">Login</a> or <a href="../../../../../user/register/index-391.html?destination=node%2F1080%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../1080/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-389" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../installing/manual/index.html">Manual Installation</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This page describes to process you need to follow if Aegir doesn't have packages for your distribution. We currently provide <a href="../../../../400/index.html">Debian packages</a> and others should be coming, if you help! This manual assumes you are fairly familiar with the UNIX commandline interface, but should be possible to follow through if you copy and paste faithfully <em>all</em> steps of the procedure.</p>

<p><strong>A note on supported systems</strong></p>

<p>These instructions provide example commands for a Debian-like distribution, but should be fairly easy to adapt to other environments. This document is meant as a canonical reference that should work on every supported platform. It can also be used for people porting Aegir to new platforms or installing on alien platform for which Aegir is not yet packaged.</p>

<p>It currently contains special recommendations for CentOS, RHEL 6, Arch Linux and Solaris. Users of those platforms are also strongly encouraged to review the <a href="../../../../462/index.html">common installation problems</a> that occur on those platforms. Aegir is also known to be installable (and was developed partly on) Mac OS X, but that process is so obtuse that it has a <a href="../../../../417/index.html">separate page</a> for the first part of the manual (up to <a href="#Install_Aegir_components">Install Aegir components</a>).</p>

<p>Installing Aegir may seem daunting at first (which is why we provide automated installs through packages), but once you get around it, it's fairly simple. It follows those steps:</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc1">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Review_System_Requirements"><span class="toc-number">1. </span>Review System Requirements</a></li>
	<li class="toc-level-1"><a href="#Install_system_requirements"><span class="toc-number">2. </span>Install system requirements</a>
<ol>
	<li class="toc-level-2"><a href="#CentOS-specific_configuration"><span class="toc-number">2.1. </span>CentOS-specific configuration</a></li>
	<li class="toc-level-2"><a href="#RHEL_6_specific_configuration"><span class="toc-number">2.2. </span>RHEL 6 specific configuration</a></li>
	<li class="toc-level-2"><a href="#Solaris_specific_configuration"><span class="toc-number">2.3. </span>Solaris specific configuration</a></li>
	<li class="toc-level-2"><a href="#Arch_Linux_specific_configuration"><span class="toc-number">2.4. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Configure_system_requirements"><span class="toc-number">3. </span>Configure system requirements</a>
<ol>
	<li class="toc-level-2"><a href="#Create_the_Aegir_user"><span class="toc-number">3.1. </span>Create the Aegir user</a>
<ol>
	<li class="toc-level-3"><a href="#CentOS_specific_configuration"><span class="toc-number">3.1.1. </span>CentOS specific configuration</a></li>
	<li class="toc-level-3"><a href="#Solaris_specific_configuration-1"><span class="toc-number">3.1.2. </span>Solaris specific configuration</a></li>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-2"><span class="toc-number">3.1.3. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Webserver_configuration"><span class="toc-number">3.2. </span>Webserver configuration</a>
<ol>
	<li class="toc-level-3"><a href="#Apache_configuration"><span class="toc-number">3.2.1. </span>Apache configuration</a></li>
	<li class="toc-level-3"><a href="#Nginx_configuration"><span class="toc-number">3.2.2. </span>Nginx configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#PHP_configuration"><span class="toc-number">3.3. </span>PHP configuration</a>
<ol>
	<li class="toc-level-3"><a href="#RHEL_6_specific_configuration-3"><span class="toc-number">3.3.1. </span>RHEL 6 specific configuration</a></li>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-4"><span class="toc-number">3.3.2. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Sudo_configuration"><span class="toc-number">3.4. </span>Sudo configuration</a>
<ol>
	<li class="toc-level-3"><a href="#CentOS_Linux_specific_sudo_configuration"><span class="toc-number">3.4.1. </span>CentOS Linux specific sudo configuration</a></li>
	<li class="toc-level-3"><a href="#Nginx_specific_configuration"><span class="toc-number">3.4.2. </span>Nginx specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#DNS_configuration"><span class="toc-number">3.5. </span>DNS configuration</a></li>
	<li class="toc-level-2"><a href="#Database_configuration"><span class="toc-number">3.6. </span>Database configuration</a>
<ol>
	<li class="toc-level-3"><a href="#Ubuntu_RHEL_Arch_linux_specific_configurations"><span class="toc-number">3.6.1. </span>Ubuntu, RHEL, Arch linux specific configurations</a></li>
	<li class="toc-level-3"><a href="#RHEL_6_specific_configuration-5"><span class="toc-number">3.6.2. </span>RHEL 6 specific configuration</a></li>
</ol>
</li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Install_Aegir_components"><span class="toc-number">4. </span>Install Aegir components</a>
<ol>
	<li class="toc-level-2"><a href="#Install_drush"><span class="toc-number">4.1. </span>Install drush</a>
<ol>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-6"><span class="toc-number">4.1.1. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Stop_Now_become_the_Aegir_user"><span class="toc-number">4.2. </span>Stop! Now become the Aegir user!</a></li>
	<li class="toc-level-2"><a href="#Install_provision"><span class="toc-number">4.3. </span>Install provision</a></li>
	<li class="toc-level-2"><a href="#Running_hostmaster-install"><span class="toc-number">4.4. </span>Running hostmaster-install</a>
<ol>
	<li class="toc-level-3"><a href="#Arch_Linux_specific_configuration-7"><span class="toc-number">4.4.1. </span>Arch Linux specific configuration</a></li>
</ol>
</li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Install_the_Hosting_Queue_Daemon"><span class="toc-number">5. </span>Install the Hosting Queue Daemon</a></li>
	<li class="toc-level-1"><a href="#Checkpoint_Finished"><span class="toc-number">6. </span>Checkpoint / Finished!</a></li>
</ol>
</div>
</div>

<p>Note that these instructions setup a complete Aegir system. If you want to only setup a new remote web/db server, it should be sufficient to install the <a href="#Install_system_requirements">system requirements</a> (step 1),  <a href="#Configure_system_requirements">configure them</a> (step 2) and follow the <a href="../../../../30/index.html">Remote server how-to</a>.</p>

<h1 id="Review_System_Requirements">1. Review System Requirements</h1>

<p>Find <a href="../../../../../content/installing/system-requirements/index.html" title="http://community.aegirproject.org/content/installing/system-requirements">http://community.aegirproject.org/content/installing/system-requirements</a></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Install_system_requirements">2. Install system requirements</h1>

<p>To install the required components, run the following command as root:</p>

<pre><code>apt-get install apache2 php5 php5-cli php5-gd php5-mysql php-pear postfix sudo rsync git-core unzip
</code></pre>

<p><em>Note</em>: replace <code>apache2</code> with <code>nginx php5-fpm</code> to install nginx on Ubuntu Precise or newer. Since Debian Squeeze doesn't provide php5-fpm, you will need to follow <a href="http://www.dotdeb.org/instructions/" title="http://www.dotdeb.org/instructions/">http://www.dotdeb.org/instructions/</a> before you will be able to install php5-fpm.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS-specific_configuration">2.1. CentOS-specific configuration</h2>

<pre><code>yum install httpd php php-mysql php-cli php-gd php-process sudo rsync git postfix
</code></pre>

<p>For versions of CentOS previous to 6.0, you will need to upgrade to PHP 5.3 using <a href="http://wiki.centos.org/HowTos/PHP_5.1_To_5.2">those instructions</a>.</p>

<p>Also for Centos minimal you should install cron (for queue and drupal cron) and unzip (for jquery.ui)</p>

<pre><code>yum install cronie unzip
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="RHEL_6_specific_configuration">2.2. RHEL 6 specific configuration</h2>

<p>RHEL 6 Server needs an additional PHP package to enable POSIX support. To find the package php-process you must enable the RHEL Server Optional channel. Once enabled, download and install the php-process-5.3.2-6.el6_0.1.i686.rpm.</p>

<p>You will also need to install the php-xml package if you are planning to use Aegir to manage Drupal 7 sites.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Solaris_specific_configuration">2.3. Solaris specific configuration</h2>

<p>Solaris has this way of dealing with third party software that is... far from ideal. You will need to find the best way to install the following packages: apache2, git, sudo, mysql, PHP 5.2 and wget. unzip and sendmail should be part of the base Solaris install. The other applications should be available on the companion CDs or on <a href="http://www.sunfreeware.com/">sunfreeware.com</a>.</p>

<p>In particular, git can be compiled easily by exporting the following
environment::</p>

<pre><code>export CFLAGS="-I/usr/sfw/include -I/opt/sfw/include"
export LD_LIBRARY_PATH="/usr/sfw/lib:/opt/sfw/lib:$LD_LIBRARY_PATH"
</code></pre>

<p>Then the compile instructions bundled with git should just be followed
directly. I had trouble installing the binaries, as git expects ginstall to be
available in the <code>$PATH</code>. I ended up adding the source directory in the <code>$PATH</code>, which works fine for most uses.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Arch_Linux_specific_configuration">2.4. Arch Linux specific configuration</h2>

<p>To install the required components, run the following command as root:</p>

<pre><code>pacman -S apache php php-apache php-gd mysql postfix sudo rsync unzip git
</code></pre>

<p>Although all of the necessary apache modules and php extensions are installed at this stage, further configuration is required to enable and tweak certain features. Critically, virtual hosts are not enabled. It is worth examining the <a href="https://wiki.archlinux.org/index.php/LAMP">Arch Linux wiki page on LAMP server set up</a> and verifying that more than one named virtual host functions properly.</p>

<p>If setting up for standalone development, see this useful <a href="https://wiki.archlinux.org/index.php/Local_Mail_Delivery_with_Postfix">wiki page</a> to configuring postfix for local mail only.</p>

<p>To ensure Apache and mysql start when the machine boots, enable the httpd and mysqld daemons by adding them to the <code>/etc/rc.conf</code> file:</p>

<pre><code>DAEMONS=(... mysqld httpd ...)
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Configure_system_requirements">3. Configure system requirements</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_the_Aegir_user">3.1. Create the Aegir user</h2>

<p>The provision framework of Aegir requires that the scripts run as a non-root system account, to ensure that it can correctly set the file permissions on the hosted files.</p>

<p>Also to ensure that the file permissions of the hosted sites are always as safe as can be, and especially to make sure that the web server does not have the ability to modify the code of the site, the configured system account needs to be a member of the web server group, in order to be able to correctly set the file permissions.</p>

<p>While you can choose another username, most aegir documentation assumes the Aegir user is <code>aegir</code>, its home directory is <code>/var/aegir</code> and the webserver group is <code>www-data</code>.</p>

<p>Shell commands as root:</p>

<pre><code>adduser --system --group --home /var/aegir aegir
adduser aegir www-data    #make aegir a user of group www-data
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="CentOS_specific_configuration">3.1.1. CentOS specific configuration</h3>

<p>CentOS requires special commands to create the user, use those instead:</p>

<pre>
useradd --home-dir /var/aegir aegir
gpasswd -a aegir apache
chmod -R 755 /var/aegir
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Solaris_specific_configuration-1">3.1.2. Solaris specific configuration</h3>

<pre>
groupadd aegir
useradd -g aegir -G webservd -d /var/aegir -s /bin/bash -c "Aegir sandbox" aegir
chown aegir:aegir /var/aegir
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-2">3.1.3. Arch Linux specific configuration</h3>

<pre>
useradd --system --groups http --home /var/aegir --create-home aegir
chmod -R 755 /var/aegir
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Webserver_configuration">3.2. Webserver configuration</h2>

<p>Aegir supports two popular web servers, Apache and Nginx.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Apache_configuration">3.2.1. Apache configuration</h3>

<p>Aegir assumes a few Apache modules are available on the server, and generates its own configuration files. The way we enable this is by symlinking a single file which contains all the configuration necessary. In Debian-based systems, you should symlink this file inside <code>/etc/apache2/conf.d</code> that will be parsed on startup or alternatively you can place include that file in your apache.conf/httpd.conf. We prefer the former. In other systems there are similar ways to accomplish this. Consult your OS's documentation if unsure.</p>

<p>If you are on a <strong>Debian-based</strong> system, you will also need to enable the mod_rewrite module manually.</p>

<p>Run the following shell commands as root. First, configure Apache to enable RewriteEngine:</p>

<pre><code>a2enmod rewrite
</code></pre>

<p>Finally, create a symlink from an apache configuration file to a folder within the /var/aegir/:</p>

<pre><code>ln -s /var/aegir/config/apache.conf /etc/apache2/conf.d/aegir.conf  
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="Ubuntu_14.04_specific_Apache_configuration">3.2.1.1. Ubuntu 14.04+ specific Apache configuration</h4>

<p>Ubuntu 14.04 departs from Debian and previous Ubuntu Apache setup in that it doesn't use <code>/etc/apache2/conf.d</code> any more and better separates out <code>sites-enabled</code> from <code>conf-enabled</code> configurations. So:</p>

<pre><code>ln -s /var/aegir/config/apache.conf /etc/apache2/conf-available/aegir.conf  
a2enconf aegir
</code></pre>

<p><strong>Do not reload/restart Apache if prompted to after running these commands, it will fail.</strong></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="CentOS_specific_Apache_configuration">3.2.1.2. CentOS specific Apache configuration</h4>

<p>On <strong>CentOS</strong>, mod_rewrite is enabled by default and you can create the following symlink:</p>

<pre><code>ln -s /var/aegir/config/apache.conf /etc/httpd/conf.d/aegir.conf
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="Arch_Linux_specific_Apache_configuration">3.2.1.3. Arch Linux specific Apache configuration</h4>

<p>On <strong>Arch Linux</strong>, mod_rewrite is also enabled by default. Add the aegir apache configuration include file to the httpd.conf file:</p>

<pre><code>echo "Include /var/aegir/config/apache.conf" &gt;&gt; /etc/httpd/conf/httpd.conf
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h4 id="Other_systems-_Apache_configuration">3.2.1.4. Other systems' Apache configuration</h4>

<p>In other systems that do not have a conf.d directory, this could also work:</p>

<pre>
echo "Include /var/aegir/config/apache.conf" &gt;&gt; /etc/apache2/httpd.conf
</pre>

<p><strong>N.B.:</strong></p>

<ul>
<li>A standard umask of 022 is assumed. This is the default on most systems.</li>
<li>For more information, see the <a href="../../../../462/index.html">common installation errors</a>.</li>
<li>For all OSes, the installer script creates the configuration file referenced by the newly created symlink/or file referenced in the Apache config file.</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Nginx_configuration">3.2.2. Nginx configuration</h3>

<p>(If you just succeeded in installing Apache, please skip this section.)</p>

<p>Aegir assumes standard Nginx configuration is available on the server, and generates its own configuration files. The way we enable this is by symlinking a single file which contains all the configuration necessary. In Debian-based systems, you should symlink this file inside <code>/etc/nginx/conf.d</code> that will be parsed on startup.</p>

<p>Please make sure your nginx installation is up and running before continuing. On Ubuntu 12.04 Server, for instance, you must edit /etc/nginx/nginx.conf and uncomment the line "types_hash_max_size 2048;" in order for nginx to start successfully.</p>

<p>Shell command as root::</p>

<pre><code>ln -s /var/aegir/config/nginx.conf /etc/nginx/conf.d/aegir.conf
</code></pre>

<p><strong>Do not reload/restart Nginx after running these commands, it will fail.</strong></p>

<p>The installer script creates the configuration file referenced by the newly created symlink.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="PHP_configuration">3.3. PHP configuration</h2>

<p>Some complex installation profiles or distributions require a PHP memory limit that is higher than the default. To avoid common errors when installing sites on some distributions, the PHP command line tool should be configured to use 192Mb 
of RAM.</p>

<p>Change the memory_limit directive in /etc/php5/cli/php.ini to read:</p>

<pre><code>memory_limit = 192M      ; Maximum amount of memory a script may consume (192MB)
</code></pre>

<p>Most modern Drupal sites require around 96M or even 128M of RAM for certain operations. This is far more than what is provided by the default PHP configuration.</p>

<p>Change the memory_limit directive in /etc/php5/apache2/php.ini to read:</p>

<pre><code>memory_limit = 128M      ; Maximum amount of memory a script may consume (128MB)
</code></pre>

<p>If your distributions require more memory than these limits, then use some common sense and update it as appropriate to suit your individual needs.</p>

<p>For Aegir 3, make sure you've installed the <a href="https://www.drupal.org/requirements/php#extensions">required PHP extensions</a>, particularly the image library (php-gd).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="RHEL_6_specific_configuration-3">3.3.1. RHEL 6 specific configuration</h3>

<p>The default php.ini configuration beyond the above changes also requires that the timezone be set for your location. Otherwise, you get fun errors and warnings during the host-master install step.</p>

<ol>
<li>sudo vi /etc/php.ini</li>
<li>enter your password</li>
<li>/zone (this will bring you to the date specific timezone module area</li>
<li><p>Remove the semi colon in front of date.timezone and enter your <a href="http://www.php.net/manual/en/timezones.php">specific timezone</a>.</p>

<p><div class="codeblock"><code>[Date]<br />&nbsp; ; Defines the default timezone used by the date functions<br />&nbsp; ; <a href="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone<br />" title="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone<br />">http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone<br /></a>&nbsp; date.timezone = Your Time Zone Goes Here </code></div></p></li>
<li><p>Restart apache to compile these changes. <code> sudo httpd -k graceful </code></p></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-4">3.3.2. Arch Linux specific configuration</h3>

<p>Make the following changes to the php.ini file (<code>/etc/php/php.ini</code>):</p>

<p>Add <code>:/var/aegir/</code> to the <code>open_basedir</code> directive:</p>

<pre><code>open_basedir = /srv/http/:/home/:/tmp/:/usr/share/pear/:/var/aegir/
</code></pre>

<p>Add <code>date.timezone</code> value as per <a href="http://php.net/date.timezone">PHP's runtime configuration instructions</a> - <em>this is an example</em>:</p>

<pre><code>date.timezone = Europe/London
</code></pre>

<p>Modify the <code>memory_limit</code> directive:</p>

<pre><code>memory_limit = 192M
</code></pre>

<p>Uncomment</p>

<pre><code>extension=posix.so
extension=mysqli.so
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Sudo_configuration">3.4. Sudo configuration</h2>

<p>Next, we need to give the aegir user permission to execute the Apache2 command to restart the web server without entering a password.</p>

<p>Create a file at <code>/etc/sudoers.d/aegir</code> and add the following:</p>

<pre>
Defaults:aegir  !requiretty
aegir ALL=NOPASSWD: /usr/sbin/apache2ctl
</pre>

<p>After saving, change the permissions on the file:</p>

<pre><code>chmod 0440 /etc/sudoers.d/aegir
</code></pre>

<p><strong>Note</strong> - the path to your apache2ctl program may differ from this example. On some systems it may also be called 'apachectl' instead of apache2ctl. Adjust to suit your own requirements.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="CentOS_Linux_specific_sudo_configuration">3.4.1. CentOS Linux specific sudo configuration</h3>

<p>For CentOS apache2ctl is apachectl and you should use this instead, as root::</p>

<pre><code>visudo
</code></pre>

<p>This command opens an editor to allow you to edit the /etc/sudoers file.  Add the following to the end of the file (specific directions cannot be given since this depends on what editor you're using):</p>

<pre><code>Defaults:aegir  !requiretty
aegir ALL=NOPASSWD: /usr/sbin/apachectl
</code></pre>

<p><strong>Note</strong> - the <code>!requiretty</code> bit is to make aegir able to run sudo even though it's not attached to a terminal. By default CentOS enforces requiretty so this exception is necessary.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Nginx_specific_configuration">3.4.2. Nginx specific configuration</h3>

<p>For those using Nginx, set the sudoers line as follows</p>

<pre><code>aegir ALL=NOPASSWD: /etc/init.d/nginx
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="DNS_configuration">3.5. DNS configuration</h2>

<p>Aegir requires a properly configured "FQDN" (Fully Qualified Domain Name) be assigned to the machine. In practice, this means that the hostname returned by the <code>hostname</code> and <code>uname -n</code> shell commands should resolve to the IP address for this server, and vice versa.</p>

<p>If you only intend to use Aegir on a single server, it is acceptable for the resolved IP address to be the '127.0.0.1' loopback address.</p>

<p>If you intend to manage multiple servers using Aegir, you will need to make sure that the IP address is the public IP of this server.</p>

<p>You can add multiple entries to your /etc/hosts file for testing purposes, for example:</p>

<pre><code>127.0.0.1 aegir.example.com example.com test1.example.com test2.example.com test3.example.com
</code></pre>

<p>Then you can use test1.example.com to create your first site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Database_configuration">3.6. Database configuration</h2>

<p>Aegir supports MySQL right now. It is best to install the MySQL server using your Linux distribution's package manager.</p>

<p>Shell commands as root::</p>

<pre><code>apt-get install mysql-server
</code></pre>

<p>To make sure that the Aegir backend, and all the possible web servers can reach your database server, you need to configure mysql to listen on all the public IP addresses available to it.</p>

<p>Again, as root, edit the MySQL configuration file <code>/etc/mysql/my.cnf</code> configuration line to comment out by placing a # at the beginning of the line as follow:</p>

<p>Before</p>

<pre><code>bind-address        = 127.0.0.1
</code></pre>

<p>After</p>

<pre><code># bind-address      = 127.0.0.1
</code></pre>

<p>Without this line commented out, MySQL will listen only on localhost for database connection requests.</p>

<p>Now you need to restart mysql, to clear any caches.</p>

<p>Shell command as root:</p>

<pre><code>/etc/init.d/mysql restart
</code></pre>

<p>The installer will prompt you for your MySQL root user password. The root user will be used to make administrative tasks such as creating new databases, and granting and revoking access to those databases for sites.</p>

<p>Even though MySQL is now listening on all IP's, it will not allow invalid users to connect to the databases, without the correct user accounts configured.</p>

<p>If you are concerned about MySQL being accessible in this way, you can also configure your firewall to only allow incoming connections from certain addresses. This is outside the scope of this document however.</p>

<p>Note that Aegir will ask you for your MySQL root password. If you do not want to use your regular root password for Aegir, you will need to create another root account for Aegir using a MySQL command like:</p>

<pre><code>GRANT ALL PRIVILEGES ON *.* TO 'aegir_root'@'%' IDENTIFIED BY 'password' WITH GRANT OPTION;
</code></pre>

<p>Note: If you are running your Aegir databases on a remote DB server, you will want to create this aegir_root user. The install will often fail if you're trying to use the root user on a remote database. See <a href="http://drupal.org/node/1237112">this issue</a> for details.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Ubuntu_RHEL_Arch_linux_specific_configurations">3.6.1. Ubuntu, RHEL, Arch linux specific configurations</h3>

<p><strong>NOTE</strong>: If you are running either Ubuntu 12.04 LTS, RHEL 6 or Arch Linux, you should still install MySQL in the same way as above. However, once done, you must now  remove the anonymous, passwordless login that those platforms creates by default. To do this, run:</p>

<pre><code>sudo mysql_secure_installation
</code></pre>

<p>Otherwise, Aegir will fail to install and work at all. See <a href="../../../../../faq/index.html#Install_fails_with_-dummy_connection_failed_to_fail-_on_Ubuntu_12.04_LTS">this FAQ entry</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="RHEL_6_specific_configuration-5">3.6.2. RHEL 6 specific configuration</h3>

<p>In Red Hat, you may need to move a default configuration file from <code>/usr/share/mysql/</code> to <code>/etc/my.cnf</code> to view or modify any of the settings mentioned above.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Install_Aegir_components">4. Install Aegir components</h1>

<p>Next step is to install the Aegir software components themselves, that is: drush, provision and hostmaster.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_drush">4.1. Install drush</h2>

<p>Before installing Aegir proper, you first need to install Drush. This can be done through your operating system's package manager (Drush is shipped with <a href="http://packages.debian.org/drush">Debian</a> and <a href="http://packages.ubuntu.com/drush">Ubuntu</a> currently) or by following the <a href="http://drupalcode.org/project/drush.git/blob_plain/HEAD:/README.txt">Drush README.txt file</a> which has all the information for installing and using drush.</p>

<p><strong>Note for 1.x users</strong>: you should use Drush version 4. Aegir 1.x does <strong>not</strong> support Drush 5. Also note there is a <a href="http://drupal.org/node/1041386">bug in Drush 4.0 and 4.1</a> so you should use a version of Drush between 4.1 and 5.</p>

<pre>
pear channel-discover pear.drush.org
pear install drush/drush-4.6.0
</pre>

<p><strong>Note for 2.x users</strong>: you need to install a minimum of Drush version 5.10, though Drush 6.x is recommended. In this case, you may be able to install the regular release:</p>

<p><strong>Note for 3.x users</strong>: you need to install a minimum of Drush version 6,some time you need apt-get install 
php-console-table before you become the Aegir user:</p>

<pre>
pear channel-discover pear.drush.org
pear install drush/drush
</pre>

<p>This should install Drush system-wide, but if you follow the manual install, you may end up with Drush in a non-standard location (traditionally <code>/var/aegir/drush/drush.php</code>), in which case you will need to add that directory to your path or use the following symlink:</p>

<pre>
ln -s /var/aegir/drush/drush /usr/local/bin/drush
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-6">4.1.1. Arch Linux specific configuration</h3>

<p>It seems that Arch's PHP environment needs to be modified for Drush:</p>

<pre>
mkdir /var/aegir/.drush
cp /etc/php/php.ini /var/aegir/.drush/
</pre>

<p>Edit <code>/var/aegir/.drush/php.ini</code> to remove the values after <code>open_basedir =</code>, as this will any <code>open_basedir</code> values are likely to cause Drush to fail.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Stop_Now_become_the_Aegir_user">4.2. Stop! Now become the Aegir user!</h2>

<p>The remaining of this manual assumes you are running as the Aegir user. Things will go very wrong if you do not change your shell credentials to become that user. You can do this by running the following command as root:</p>

<pre>
su -s /bin/bash - aegir
</pre>

<p>If this fails because <code>/bin/bash</code> doesn't exist, try using <code>/bin/sh</code>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_provision">4.3. Install provision</h2>

<p>Once Drush is installed you should be able to install the latest recommended Provision release using the following drush command:</p>

<p><strong>Note for 1.x users</strong>:</p>

<pre>
drush dl --destination=/var/aegir/.drush provision-6.x
</pre>

<p><strong>Note for 2.x users</strong>:</p>

<pre>
drush dl --destination=/var/aegir/.drush provision-6.x-2.0
drush cache-clear drush
</pre>

<p><strong>Note for 3.x users</strong>:
replace provison-6.x-2.0 to provison-7.x</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Running_hostmaster-install">4.4. Running hostmaster-install</h2>

<p>Once you have downloaded drush and provision, you can just install provision in the commands directory of Drush (either ~aegir/.drush or /usr/share/drush/commands), if that's not already done. Once provision is properly installed, you can install all other aegir components using the hostmaster-install command:</p>

<pre><code>drush hostmaster-install
</code></pre>

<p>You will be prompted for the required information if not provided on the commandline. See the inline help for the available options:</p>

<pre><code>drush help hostmaster-install
</code></pre>

<p>For example, to install the frontend on Nginx, use:</p>

<pre><code>drush hostmaster-install --http_service_type=nginx
</code></pre>

<p><em>Note for 2.x users:</em> Drush 5 has a <em>commandfile cache</em> which you need to clear before installing Aegir:</p>

<pre><code>drush cache-clear drush
</code></pre>

<p>It is imperative that you provide a valid FQDN to the installer. This is used for database GRANTs. Remote web servers depend on the FQDN being resolvable in order to connect back to your Aegir master server if it is used as your database server for managed sites.</p>

<p>Upon completion of the installation, the traditional Drupal 'Welcome' e-mail will be sent to the e-mail address specified by <code>--client_email=(your e-mail)</code> or if not provided as a command line switch, the address prompted by the installer process. This e-mail address will also be used as the default e-mail address of the first user and client in Aegir, but can be changed later.</p>

<p>There are other commandline switches available, documented in <code>drush help hostmaster-install</code>, as usual.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Arch_Linux_specific_configuration-7">4.4.1. Arch Linux specific configuration</h3>

<pre>
drush hostmaster-install --web_group=http
</pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Install_the_Hosting_Queue_Daemon">5. Install the Hosting Queue Daemon</h1>

<p>For Aegir 2.x installs, using the Hosting Queued Daemon (hosting_queued) is highly recommended. For Aegir 1.x, check out <a href="http://drupal.org/project/hosting_queue_runner" title="http://drupal.org/project/hosting_queue_runner">http://drupal.org/project/hosting_queue_runner</a> instead.</p>

<p>These instructions will install the daemon to run as a regular service in /etc/init.d/. Instructions will vary according to platforms, but the following should work in Debian, running as root.</p>

<ol>
<li><p>Install the init script in place</p>

<pre><code>cp &lt;hostmaster_platform_root&gt;/profiles/hostmaster/modules/hosting/queued/init.d.example /etc/init.d/hosting-queued
</code></pre></li>
<li><p>Setup symlinks and runlevels</p>

<pre><code>update-rc.d hosting-queued defaults
</code></pre></li>
<li><p>Start the daemon</p>

<pre><code>/etc/init.d/hosting-queued
</code></pre></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Checkpoint_Finished">6. Checkpoint / Finished!</h1>

<p>At this point, you have checked out all the code and setup your basic Drupal system (Drupal core, hosting, hostmaster and eldir) that will be the Aegir frontend and the backend system (provision and drush). Your filesystem layout should look something like this:</p>

<pre>
 /var/aegir/hostmaster-1.x/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/admin_menu/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/hosting/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/install_profile_api/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/jquery_ui/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/modalframe/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/themes/eldir/
 /var/aegir/hostmaster-1.x/sites/aegir.example.com/
 /var/aegir/config/server_master/apache.conf
 /var/aegir/config/server_master/apache/conf.d/
 /var/aegir/config/server_master/apache/vhost.d/
 /var/aegir/config/server_master/apache/platform.d/
 /var/aegir/backups/
 /var/aegir/drush/drush.php
 /var/aegir/.drush/drush_make/
 /var/aegir/.drush/provision/
</pre>

<p>Variations on this are acceptable (for example, the Drush Debian package works out of <code>/usr/bin/drush</code> and that's fine), but you are better to stick with the defaults if you really want to get through this.</p>

<p>The installation will provide you with a one-time login URL to stdout or via an e-mail. Use this link to login to your new Aegir site for the first time.</p>

<p>For troubleshooting this process and resulting install, see the <a href="../../../../462/index.html">common installation problems page</a>.</p>

<p>You may also want to read on with <a href="../../../../../content/administrator/aegir-installed-now-what/index.html">what you can do with Aegir</a> now that it is installed.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-292.html?destination=node%2F389%23comment-form">Login</a> or <a href="../../../../../user/register/index-292.html?destination=node%2F389%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../389/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-417" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../417/index.html">Mac OS X installation instructions</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h2>Apache</h2>

<p>For Apache based installation hints see <a href="../../../../../content/apache-mysql-php-aegir/index.html">Apache / mySQL / PHP / Aegir</a></p>

<h2>Nginx</h2>

<p>Nginx is more performant than Apache, if you are interested in setting Aegir up using nginx <a href="https://drupal.org/user/139189">Brian Gilbert</a> from <a href="http://realityloop.com/">Realityloop</a> has created a script to install everything that you need on a clean Mac (not already running anything on port 80), see <a href="http://rl.cm/osxaegirscript">OSX Aegir Installer</a> on github.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-46.html?destination=node%2F417%23comment-form">Login</a> or <a href="../../../../../user/register/index-46.html?destination=node%2F417%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-46.html?destination=node%2F417%23comment-form">Login</a> or <a href="../../../../../user/register/index-46.html?destination=node%2F417%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-932" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/apache-mysql-php-aegir/index.html">Apache / mySQL / PHP / Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>This is a helper file to the canonical <a href="../../../../../installing/manual/index.html">manual install process</a>. It is aimed at
helping you install Aegir on Mac OS X. Since PHP and MySQL support on OS X is fairly limited and complicated, a separate documentation page was created for that part of the documentation. You should follow this page all the way through and then proceed with the regular install, <a href="../../../../389/index.html#Stop_Now_become_the_Aegir_user">step 4: becoming the aegir user</a>.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc2">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Special_software_requirements"><span class="toc-number">1. </span>Special software requirements</a></li>
	<li class="toc-level-1"><a href="#Configure_system_requirements"><span class="toc-number">2. </span>Configure system requirements</a></li>
</ol>
</div>
</div>

<h1 id="Special_software_requirements">1. Special software requirements</h1>

<p>While Mac OS X comes with Apache &amp; PHP (and even MySQL on the Server
version), the version of PHP shipped with 10.6 Snow Leopard is 5.3.x
and thus may not work with Aegir (as of the 0.4alpha-era) and various
other software. If you're running 10.5 Leopard, it may work out of the
box, but I haven't tested it.</p>

<p>There are several different ways to get Apache, PHP 5.2, and MySQL 5
onto a Mac OS X machine. I give detailed instructions for MacPorts
below, but if that's a bit more than you're ready to bite off right
now, feel free to use an alternative approach.</p>

<p>One such alternative is MAMP. There is a good but outdated HOWTO for
installing Aegir on Mac OS X 10.6 (Snow Leopard) using MAMP located
here: <a href="http://groups.drupal.org/node/30270" title="http://groups.drupal.org/node/30270">http://groups.drupal.org/node/30270</a></p>

<p>MAMP stands for Mac, Apache, MySQL, and PHP and is the Mac equivalent
of "LAMP". It is a self-contained package of all of these programs
with a nice graphical installer and control panel.  You can find it
here: <a href="http://www.mamp.info/" title="http://www.mamp.info/">http://www.mamp.info/</a></p>

<p>MAMP is pretty straightforward, but it's also not very flexible
(IMHO).  While certainly not without its own headaches, MacPorts is a
decently powerful way to sanely manage a healthy stack of open source
UNIX software on your Mac. Since this is what I use, I'm going to
assume MacPorts is in use for the rest of this HINTS file. I have also
only tested this on Mac OS X 10.6 Snow Leopard.</p>

<p>If you don't yet have MacPorts installed, go here to get it:
<a href="http://www.macports.org/install.php" title="http://www.macports.org/install.php">http://www.macports.org/install.php</a></p>

<p>Once it's installed, quit and re-launch your Terminal before
continuing.  Otherwise MacPorts won't yet be in your PATH.</p>

<p>The first two commands below are optional but recommended.</p>

<p><div class="codeblock"><code>&nbsp; sudo port selfupdate<br />&nbsp; sudo port upgrade outdated<br />&nbsp; sudo port install apache2 mysql5-server git-core unzip php52 php5-posix php5-gd php5-apc +mysql5</code></div></p>

<p>php5-apc is optional, but highly recommended as it will significantly increase
PHP performance.</p>

<p>Watch the output of the last port command carefully, as there are
usually some boring tasks for you to perform once the install is
done. You'll be wishing you were running Ubuntu/Debian and apt-get by
the time you're done.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Configure_system_requirements">2. Configure system requirements</h1>

<p>Next we'll create the aegir user and add it to the _www group. This
part is very different on Mac OS X than Linux or most other
Unices. Must be a NeXTism. The command we will use he is "dscl", which
is a short for Directory Service Command Line. In OSX 10.3 and
earlier, that command is "nicl" (short for Net Info Command Line). It is also
possible to create the user using the "Workgroup Manager" utility included with
OS X Server. To obtain Workgroup Manager for the OS X Client, download the
"Server Admin Tools" from Apple. For example, for Mac OS X 10.6, the admin tools
can be found at:</p>

<p><a href="http://support.apple.com/downloads/Server_Admin_Tools_10_6" title="http://support.apple.com/downloads/Server_Admin_Tools_10_6">http://support.apple.com/downloads/Server_Admin_Tools_10_6</a></p>

<p><div class="codeblock"><code>&nbsp; sudo dscl . -create /Users/aegir NFSHomeDirectory /var/aegir</code></div></p>

<p>Now you need to find the next spare UID to assign the user.</p>

<p>Here's how you find out on your system:</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo dsexport users.out /Local/Default dsRecTypeStandard:Users</code></div></p>

<p>Then open the file users.out in a text editor, search for the highest
5xx user ID and add 1 to it (in your brain, not in the file). So if
you find 506 but no 507, use 507. When you're done, delete users.out
to be safe.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo rm users.out</code></div></p>

<p>Now assign this UID to the aegir user, replacing "5xx" with the UID.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo dscl . -create /Users/aegir UniqueID 5xx</code></div></p>

<pre>
!! If you're running Mac OSX Lion, you also need to assign PrimaryGroupID to the aegir user.
   sudo dscl . -create /Users/aegir PrimaryGroupID XXX
</pre>

<p>Set a secure password for the aegir user, as it needs shell access.</p>

<p><div class="codeblock"><code>sudo passwd aegir</code></div></p>

<p>Create the aegir home directory and set its permissions.</p>

<p><div class="codeblock"><code>sudo mkdir /var/aegir<br />sudo chown aegir /var/aegir<br />sudo chgrp _www /var/aegir</code></div></p>

<p>Add the aegir user to the _www group. This is the group Apache runs as.</p>

<p><div class="codeblock"><code>sudo dscl . -append /Groups/_www GroupMembership aegir</code></div></p>

<p>Give the aegir user the ability to restart Apache.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; sudo mv /usr/sbin/apachectl /usr/sbin/apachectl-apple<br />&nbsp;&nbsp; sudo ln -s /opt/local/apache2/bin/apachectl /usr/sbin/apachectl<br />&nbsp;&nbsp; sudo visudo</code></div></p>

<p>Go to the last line of the file and add the following.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; aegir ALL=NOPASSWD: /usr/sbin/apachectl</code></div></p>

<p>Save the file and exit your text editor.</p>

<p>Next configure Apache to include the Aegir config.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; echo &quot;Include /var/aegir/config/apache.conf&quot; &gt;&gt; /opt/local/apache2/conf/httpd.conf</code></div></p>

<p>Configuring your MySQL database and user accounts is the same as in
the INSTALL.txt file. But you probably want to add the path to its
executables to your user's PATH and the aegir user's PATH.</p>

<p><div class="codeblock"><code>&nbsp;&nbsp; echo &#039;export PATH=/opt/local/lib/mysql5/bin:$PATH&#039; &gt;&gt; ~/.profile<br />&nbsp;&nbsp; su - aegir<br />&nbsp;&nbsp; Password: (the password you setup earlier)<br />&nbsp;&nbsp; echo &#039;export PATH=/opt/local/lib/mysql5/bin:$PATH&#039; &gt;&gt; ~/.profile<br />&nbsp;&nbsp; exit</code></div></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-393.html?destination=node%2F932%23comment-form">Login</a> or <a href="../../../../../user/register/index-393.html?destination=node%2F932%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../932/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-931" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/nginx-mariadb-php-aegir-memp%c3%a6/index.html">nginx / MariaDB / PHP / Aegir (MEMP)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p><strong>The instructions that used to be here are now outdated, instead use the <a href="http://rl.cm/osxaegirscript">OSXAegirInstaller</a> created by <a href="https://drupal.org/user/139189">Brian Gilbert</a> of <a href="http://realityloop.com/">Realityloop</a>.</strong></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-47.html?destination=node%2F931%23comment-form">Login</a> or <a href="../../../../../user/register/index-47.html?destination=node%2F931%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-47.html?destination=node%2F931%23comment-form">Login</a> or <a href="../../../../../user/register/index-47.html?destination=node%2F931%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2855" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/installing/manual/centos-6x-aegir-install-guide/index.html">Centos 6.x Aegir Install Guide</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_520 first"><a href="../../../../../category/keywords/centos-install-guide/index.html" rel="tag" title="">Centos Install Guide</a></li>
<li class="taxonomy_term_27"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>There are 2 methods of installing AEgir on CentOS both are the same but one is scripted and the other is manual and is documented below.</p>

<h2>Scripted</h2>

<p>The script can be found at <a href="https://github.com/marafa/aegir/tree/master/version2" title="https://github.com/marafa/aegir/tree/master/version2">https://github.com/marafa/aegir/tree/master/version2</a></p>

<p>NB. There is preliminary work to fix selinux at <a href="https://github.com/marafa/aegir/blob/master/aegir_selinux.sh" title="https://github.com/marafa/aegir/blob/master/aegir_selinux.sh">https://github.com/marafa/aegir/blob/master/aegir_selinux.sh</a>.
Feedback is quite welcome as well as git pulls.</p>

<h2>Explanation</h2>

<p>Connect to the server via ssh as root user.</p>

<blockquote>
  <p>ssh root@000.000.000.000</p>
</blockquote>

<h2>Install system requirements</h2>

<blockquote>
  <p>yum install httpd php php-mysql php-cli php-gd php-process php-pear php-mbstring php-xml php-soap sudo rsync git postfix tree wget cronie unzip mysql-server mlocate nmap samba samba-client samba-common vim</p>
</blockquote>

<p>Note: The following packages are not required but are very useful to include git wget mlocate nmap samba samba-client samba-common vim</p>

<h2>SElinux</h2>

<p>Make sure Security-Enhanced Linux is disabled as it creates install problems.</p>

<blockquote>
  <p>vim /etc/selinux/config
  Make sure SELINUX=disabled</p>
</blockquote>

<p>If was SELINUX=enabled then we need to restart.</p>

<blockquote>
  <p>shutdown -r now</p>
</blockquote>

<p>Note: I am not sure if it can be enabled at the end I have never tried.</p>

<h2>Create the Aegir user</h2>

<p>The provision framework of Aegir requires that the scripts run as a non-root system account, to ensure that it can correctly set the file permissions on the hosted files.</p>

<p>Also to ensure that the file permissions of the hosted sites are always as safe as can be, and especially to make sure that the web server does not have the ability to modify the code of the site, the configured system account needs to be a member of the web server group, in order to be able to correctly set the file permissions.</p>

<p>While you can choose another username, most aegir documentation assumes the Aegir user is aegir, its home directory is /var/aegir and the webserver group is www-data.</p>

<blockquote>
  <p>useradd --home-dir /var/aegir aegir</p>
  
  <p>gpasswd -a aegir apache</p>
  
  <p>chmod -R 755 /var/aegir</p>
</blockquote>

<h2>Apache configuration</h2>

<p>Start Apache</p>

<blockquote>
  <p>service httpd start</p>
</blockquote>

<p>Make apache start automatically after reboot.</p>

<blockquote>
  <p>chkconfig httpd on</p>
</blockquote>

<p>We need to create a symbolic link between aegir and apache.</p>

<blockquote>
  <p>ln -s /var/aegir/config/apache.conf /etc/httpd/conf.d/aegir.conf</p>
</blockquote>

<h2>PHP configuration</h2>

<blockquote>
  <p>vim /etc/php.ini</p>
</blockquote>

<p>Increase the memory limit as complex installation profiles or distributions require a PHP memory limit that is higher than the default (128M)</p>

<blockquote>
  <p>memory_limit = 192M</p>
</blockquote>

<p>Set Date Zone to your time zone see <a href="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone" title="http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone">http://www.php.net/manual/en/datetime.configuration.php#ini.date.timezone</a></p>

<blockquote>
  <p>date.timezone = </p>
</blockquote>

<h2>Sudo configuration</h2>

<p>Next, we need to give the aegir user permission to execute the Apache2 command to restart the web server without entering a password.</p>

<blockquote>
  <p>visudo</p>
</blockquote>

<p>Add to end of file</p>

<blockquote>
  <p>Defaults:aegir  !requiretty</p>
  
  <p>aegir ALL=NOPASSWD: /usr/sbin/apachectl</p>
</blockquote>

<h2>DNS configuration</h2>

<p>Aegir requires a properly configured "FQDN" (Fully Qualified Domain Name) be assigned to the machine. In practice, this means that the hostname returned by the hostname and uname -n shell commands should resolve to the IP address for this server, and vice versa.</p>

<p>If you only intend to use Aegir on a single server, it is acceptable for the resolved IP address to be the '127.0.0.1' loopback address.</p>

<p>If you intend to manage multiple servers using Aegir, you will need to make sure that the IP address is the public IP of this server.</p>

<p>You can add multiple entries to your /etc/hosts file for testing purposes, for example:#&gt; &gt;vim /etc/hosts
Add your ip and hostname</p>

<blockquote>
  <p>000.000.000.000 hostname</p>
</blockquote>

<h2>Database configuration</h2>

<p>Start mysql</p>

<blockquote>
  <p>service mysqld start</p>
</blockquote>

<p>Make mysql start automatically after reboot.</p>

<blockquote>
  <p>chkconfig mysqld on</p>
</blockquote>

<p>Configure Mysql</p>

<blockquote>
  <p>/usr/bin/mysql_secure_installation</p>
</blockquote>

<p>Recommended:</p>

<blockquote>
  <p>Set root Password</p>
  
  <p>Remove anonymous users? y</p>
  
  <p>Disallow root login remotely? y</p>
  
  <p>Remove test database and access to it? y</p>
  
  <p>Reload privilege tables now? y</p>
</blockquote>

<h2>Install drush</h2>

<blockquote>
  <p>pear channel-discover pear.drush.org</p>
  
  <p>pear install drush/drush-4.5.0</p>
</blockquote>

<p>Check if drush works
If you get PHP Fatal error:  Class 'Console_Table' not found then</p>

<blockquote>
  <p>pear install Console_Table</p>
</blockquote>

<h2>Stop! Now become the Aegir user!</h2>

<p>The remaining of this manual assumes you are running as the Aegir user. Things will go very wrong if you do not change your shell credentials to become that user.</p>

<blockquote>
  <p>su -s /bin/bash - aegir</p>
</blockquote>

<p>Install provision</p>

<blockquote>
  <p>drush dl --destination=/var/aegir/.drush provision-6.x</p>
</blockquote>

<p>Clear the drush cache</p>

<blockquote>
  <p>drush cache-clear drush</p>
</blockquote>

<p>Run hostmaster-install</p>

<blockquote>
  <p>drush hostmaster-install</p>
</blockquote>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-48.html?destination=node%2F2855%23comment-form">Login</a> or <a href="../../../../../user/register/index-48.html?destination=node%2F2855%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-48.html?destination=node%2F2855%23comment-form">Login</a> or <a href="../../../../../user/register/index-48.html?destination=node%2F2855%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-887" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../installing/manual/manual-install-web-cluster-aegir-using-nginx/index.html">Manual install of a web cluster aegir using nginx</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>These are some really rough notes on how to go about creating a 4 server aegir installation (aegir, mysql, web1, web2).</p>

<p>Adapted from reading through the BOA project and my own experimentation.</p>

<p>** Note -- regarding the wildcard SSL, your sites will need some configuration in your settings.php or local.settings.php to check for the X-Forwarded-Proto headers.  I can't recall if the wildcard SSL config.</p>

<p>These notes also assume the last Ubuntu LTS -- 10.04/Lucid.</p>

<pre>
aegirmysql:

sudo apt-get update
sudo apt-get upgrade
sudo apt-get install vim mysql-server


_USER="aegir"
_DOMAIN="aegir.domain.com"
_AEGIR_HOST="aegir.server.hostname"
_AEGIR_HOST_IP="123.456.789.01"
_AEGIR_PASSWORD="password"

#AEGIR_DB_USER=aegir_root
#AEGIR_DB_PASS=`echo $RANDOM:\`date\`:$AEGIR_HOST | openssl md5`

echo "[client]
user=root
password=password" &gt;&gt; .my.cnf

mysql -uroot mysql&lt;&lt;EOFMYSQL
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'$_DOMAIN' IDENTIFIED BY 'password' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'$_AEGIR_HOST' IDENTIFIED BY 'password' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'$_AEGIR_HOST_IP' IDENTIFIED BY 'password' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO '$_USER'@'localhost' IDENTIFIED BY 'password' WITH GRANT OPTION;
FLUSH PRIVILEGES;
EOFMYSQL


========================

# <a href="https://launchpad.net/~brianmercer/+archive/nginx" title="https://launchpad.net/~brianmercer/+archive/nginx">https://launchpad.net/~brianmercer/+archive/nginx</a>
# <a href="https://launchpad.net/~nginx/+archive/php5" title="https://launchpad.net/~nginx/+archive/php5">https://launchpad.net/~nginx/+archive/php5</a>

aegircontrol:

sudo apt-get update
sudo apt-get upgrade

sudo mkdir -p /var/www/nginx-default

#php5-suhosin
CATHOSTDEBDEPS="git-core git-doc mysql-client-5.1 vim nginx-custom drush postfix php5-cli php5-mysql php5-fpm php5-gd rsync unzip bzr patch curl"
sudo apt-get -V install $CATHOSTDEBDEPS

#postfix config already sorted

sudo adduser --system --group --home /var/aegir aegir
sudo adduser aegir www-data
sudo chsh -s /bin/bash aegir

#patch drush, re: ereg()

#as root:
echo "aegir ALL=NOPASSWD: /etc/init.d/nginx" &gt;&gt; /etc/sudoers

ln -s /var/aegir/config/nginx.conf /etc/nginx/conf.d/aegir.conf
#disable directives in nginx.conf:
#types_hash_max_size
#tcp_nopush
#error_log
invoke-rc.d nginx restart

#install SSL cert to:
/etc/ssl/private/domain.com.cert.pem
cd /etc/ssl/private/
ln -s domain.com.cert.pem nginx-wild-ssl.crt
ln -s domain.com.cert.pem nginx-wild-ssl.key

#install SSL config to:
/var/aegir/config/server_master/nginx/pre.d/nginx_wild_ssl.conf
#TODO: also install for /var/aegir/config/server_aegirweb{1,2}.host.name

#as aegir:
cd ~

mkdir .ssh
ssh-keygen -t rsa

ln -s /usr/share/drush /var/aegir/drush
mkdir ~/.drush
cd ~/.drush
wget -c <a href="http://ftp.drupal.org/files/projects/provision-6.x-1.3.tar.gz" title="http://ftp.drupal.org/files/projects/provision-6.x-1.3.tar.gz">http://ftp.drupal.org/files/projects/provision-6.x-1.3.tar.gz</a>
tar -zxf provision-6.x-1.3.tar.gz

#htaccess password bit
mkdir ~/tmp
cd ~/tmp
git clone --branch develop git://github.com/computerminds/aegir_http_basic.git
#must be develop branch to use crypt() and for nginx support
cp -r aegir_http_basic/provision ~/.drush/provision/aegir_http_basic
cp -r aegir_http_basic/hosting ~/hostmaster-6.x-1.3/profiles/hostmaster/modules/hosting/http_basic_auth
#set directory permissions? -- patch aegir/http_basic module to do so?

_DOMAIN="aegir.domain.com"
_USER="aegir"
#_AEGIR_HOST=`uname -n`
_AEGIR_HOST="aegir.server.hostname"
_AEGIR_HOME="$HOME"
_AEGIR_DB_PASS="password"
_AEGIR_DB_HOST="mysql.server.fqdn"
_AEGIR_VERSION="1.3"
#_AEGIR_ROOT="$_AEGIR_HOME/hostmaster-$_AEGIR_VERSION"
_ADM_EMAIL="admin@domain.com""
_WEBG=www-data
_USRG=users

#going vanilla
echo "drush hostmaster-install $_DOMAIN --aegir_host=$_AEGIR_HOST --aegir_db_user=$_USER --aegir_db_pass=$_AEGIR_DB_PASS --http_service_type=nginx --db_service_type=mysql --db_port=3306 --aegir_db_host=$_AEGIR_DB_HOST --client_email=$_ADM_EMAIL --script_user=$_USER --web_group=$_WEBG --profile=hostmaster -d -v"

drush hostmaster-install $_DOMAIN --aegir_host=$_AEGIR_HOST --aegir_db_user=$_USER --aegir_db_pass=$_AEGIR_DB_PASS --http_service_type=nginx --db_service_type=mysql --db_port=3306 --aegir_db_host=$_AEGIR_DB_HOST --client_email=$_ADM_EMAIL --script_user=$_USER --web_group=$_WEBG --profile=hostmaster -d -v

cd hostmaster-6.x-1.3
echo "alive" &gt;&gt; healthcheck

#enable aegir modules
drush @hostmaster en hosting_web_cluster
drush @hostmaster en hosting_alias
drush @hostmaster en hosting_http_basic_auth
#*** enable hosting client in features -- disabling client module cause WSOD on site add page

# setup aegirweb{1,2}
# test ssh to aegirweb{1,2}
# add to known_hosts

# NOTE: Aegir web clusters need to share the files, and private directories between web servers (also cache directory, if using boost module)
# Setup provision hook for NFS links
# <a href="http://drupal.org/node/1283738" title="http://drupal.org/node/1283738">http://drupal.org/node/1283738</a>

mkdir -p /var/lib/sitedata/aegir
chown -R aegir:www-data /var/lib/sitedata/aegir

mkdir -p /var/lib/sitedata/aegir/cache
chown -R aegir:www-data /var/lib/sitedata/aegir/cache


# add web servers
# add web cluster
#TODO: Add DR web servers to cluster
#TODO: Add WR, re: DR web servers &amp; firewall

# set date/time settings in Aegir

#TODO: Logrotate webserver logs

#TODO: Add an alias for the aegir user:
#aegir: "admin@domain.com""

========================

aegirweb{1,2}:
#TODO: Check puppeted stuff, fix, etc

sudo apt-get update
sudo apt-get upgrade

sudo mkdir -p /var/www/nginx-default

CATWEBDEBDEPS="mysql-client-5.1 vim nginx-custom drush postfix php5-cli php5-mysql php5-fpm php5-gd rsync unzip patch"
sudo apt-get -V install $CATWEBDEBDEPS


sudo adduser --system --group --home /var/aegir aegir
sudo adduser aegir www-data
sudo chsh -s /bin/bash aegir

#install SSL cert to:
/etc/ssl/private/domain.com.cert.pem
cd /etc/ssl/private/
ln -s domain.com.cert.pem nginx-wild-ssl.crt
ln -s domain.com.cert.pem nginx-wild-ssl.key

#install SSL config to:
/var/aegir/config/server_master/nginx/pre.d/nginx_wild_ssl.conf
#TODO: also install for /var/aegir/config/server_aegirweb{1,2}.host.name

#as root:
echo "aegir ALL=NOPASSWD: /etc/init.d/nginx" &gt;&gt; /etc/sudoers

#as aegir:
mkdir /var/aegir/.ssh
cat aegir.aegircontrol.id_rsa.pub &gt;&gt; /var/aegir/.ssh/authorized_keys2


#TODO: Logrotate webserver logs

==========================

</pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-49.html?destination=node%2F887%23comment-form">Login</a> or <a href="../../../../../user/register/index-49.html?destination=node%2F887%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-49.html?destination=node%2F887%23comment-form">Login</a> or <a href="../../../../../user/register/index-49.html?destination=node%2F887%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1075" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/installing/manual/nginx-mariadb-php-fpm-single-server-installation/index.html">nginx / MariaDB / PHP-FPM Single Server Installation</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc3">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Housekeeping"><span class="toc-number">1. </span>Housekeeping</a></li>
	<li class="toc-level-1"><a href="#Install_MariaDB"><span class="toc-number">2. </span>Install MariaDB</a></li>
	<li class="toc-level-1"><a href="#Install_Nginx"><span class="toc-number">3. </span>Install Nginx</a></li>
	<li class="toc-level-1"><a href="#Install_all_the_other_stuff"><span class="toc-number">4. </span>Install all the other stuff</a></li>
	<li class="toc-level-1"><a href="#Create_the_Aegir_user"><span class="toc-number">5. </span>Create the Aegir user</a></li>
	<li class="toc-level-1"><a href="#Misc_Configuration"><span class="toc-number">6. </span>Misc Configuration</a></li>
	<li class="toc-level-1"><a href="#Install_Aegir"><span class="toc-number">7. </span>Install Aegir</a></li>
	<li class="toc-level-1"><a href="#Optional_Improvements"><span class="toc-number">8. </span>Optional Improvements</a></li>
</ol>
</div>
</div>

<p>Note: This installation process assumes that you're using a fresh install of Ubuntu 14.04 x64. If you use a lower version of Ubuntu, you may have trouble with this guide.</p>

<p>On most VPS providers, you'll be logged in as root initially. The installation process below assumes that you are logged in as root. Obviously, this is not a secure long-term solution, so once you're done with this guide, I suggest setting up public key authentication, turning off root login over SSH, and creating yourself a new unprivileged user. That's out of scope for this doc page, so you're probably <a href="http://google.com/">on your own</a> for that.</p>

<p>Finally, this document assumes that you're going to be installing aegir at aegir.example.com. Any time you see example.com, replace it with your domain.</p>

<h2 id="Housekeeping">1. Housekeeping</h2>

<p>Make sure you're up to date:</p>

<pre><code>apt-get update
apt-get upgrade
</code></pre>

<p>And that you have the the python-software-properties package (we'll need it later):</p>

<pre><code>apt-get install python-software-properties
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_MariaDB">2. Install MariaDB</h2>

<p>From mariadb.org:</p>

<pre><code>MariaDB is a database server that offers drop-in replacement functionality for MySQL. 
MariaDB is built by some of the original authors of MySQL, with assistance from the
broader community of Free and open source software developers. In addition to the core
functionality of MySQL, MariaDB offers a rich set of feature enhancements including
alternate storage engines, server optimizations, and patches.
</code></pre>

<p>Install MariaDB:</p>

<pre><code>apt-get install mariadb-server
</code></pre>

<p>You'll need to set your root password for the MariaDB server</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_Nginx">3. Install Nginx</h2>

<p>Next, install Nginx and PHP-FPM:</p>

<pre><code>apt-get install nginx php5-cli php5-mysql php5-fpm php5-gd
</code></pre>

<p>Create the default docroot for Nginx as well:</p>

<pre><code>mkdir -p /var/www/nginx-default
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_all_the_other_stuff">4. Install all the other stuff</h2>

<pre><code>apt-get install git-core git-doc vim drush postfix rsync unzip bzr patch curl
</code></pre>

<p>When prompted for Postfix configuration, select "Internet Site", then use "example.com" for the System mail name.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_the_Aegir_user">5. Create the Aegir user</h2>

<p>Easy:</p>

<pre><code>adduser --system --group --home /var/aegir aegir
adduser aegir www-data
chsh -s /bin/bash aegir
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Misc_Configuration">6. Misc Configuration</h2>

<p>Make sure the Aegir user is allowed to restart Nginx:</p>

<pre><code>echo "aegir ALL=NOPASSWD: /etc/init.d/nginx" &gt;&gt; /etc/sudoers
</code></pre>

<p>Symlink Aegir's nginx configuration into place:</p>

<pre><code>ln -s /var/aegir/config/nginx.conf /etc/nginx/conf.d/aegir.conf
</code></pre>

<p>Disable duplicated directives in <code>/etc/nginx/nginx.conf</code> (the Aegir config specifies these values as well - if you do not disable them in the main nginx.conf, nginx will fail to restart). You can just remove (or comment them out with a "#") the lines that start with the following</p>

<pre><code>types_hash_max_size
tcp_nopush
error_log
</code></pre>

<p>Then, restart Nginx:</p>

<pre><code>service nginx restart
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_Aegir">7. Install Aegir</h2>

<p><strong>IMPORTANT</strong> Switch to the Aegir user now: <strong>IMPORTANT</strong></p>

<pre><code>su - aegir
cd ~/
</code></pre>

<p>Download the latest Provision release:</p>

<pre><code>mkdir ~/.drush
cd ~/.drush
wget -c <a href="http://ftp.drupal.org/files/projects/provision-6.x-2.1.tar.gz" title="http://ftp.drupal.org/files/projects/provision-6.x-2.1.tar.gz">http://ftp.drupal.org/files/projects/provision-6.x-2.1.tar.gz</a>
tar -zxf provision-6.x-2.1.tar.gz
rm provision-6.x-2.1.tar.gz
</code></pre>

<p>Start the Aegir install process:</p>

<pre><code>cd ~/
drush hostmaster-install aegir.example.com \
--aegir_host="aegir.example.com" \
--http_service_type="nginx" \
--aegir_db_user="root" \
--aegir_db_pass="[YOUR ROOT DATABASE PASSWORD]" \
--db_service_type="mysql" \
--db_port=3306 \
--aegir_db_host="localhost" \
--client_email="[YOUR EMAIL ADDRESS]" \
--script_user="aegir" \
--web_group="www-data" \
--profile=hostmaster
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Optional_Improvements">8. Optional Improvements</h2>

<p>drupal.org/project/hosting_queue_runner</p>

<p>drupal.org/project/provision_boost</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-50.html?destination=node%2F1075%23comment-form">Login</a> or <a href="../../../../../user/register/index-50.html?destination=node%2F1075%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-50.html?destination=node%2F1075%23comment-form">Login</a> or <a href="../../../../../user/register/index-50.html?destination=node%2F1075%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-462" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../462/index.html">Common installation problems</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>There are a few things that can go wrong in the install.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc4">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Verify_and_install_run_everything_through_SSH"><span class="toc-number">1. </span>Verify and install run everything through SSH</a></li>
	<li class="toc-level-1"><a href="#NameVirtualHost_:80_has_no_VirtualHosts"><span class="toc-number">2. </span>NameVirtualHost *:80 has no VirtualHosts</a></li>
	<li class="toc-level-1"><a href="#Making_sure_it_works"><span class="toc-number">3. </span>Making sure it works</a></li>
	<li class="toc-level-1"><a href="#Access_by_the_server-s_physical_IP_address"><span class="toc-number">4. </span>Access by the server's physical IP address</a></li>
	<li class="toc-level-1"><a href="#CentOS_firewall_settings"><span class="toc-number">5. </span>CentOS firewall settings</a></li>
	<li class="toc-level-1"><a href="#CentOS_cron_requires_restart"><span class="toc-number">6. </span>CentOS cron requires restart?!</a></li>
	<li class="toc-level-1"><a href="#CentOS_aegir.conf_permission_denied"><span class="toc-number">7. </span>CentOS aegir.conf permission denied</a></li>
	<li class="toc-level-1"><a href="#Solaris_cron_issues"><span class="toc-number">8. </span>Solaris cron issues</a></li>
	<li class="toc-level-1"><a href="#Drush_execution_path_issues"><span class="toc-number">9. </span>Drush execution path issues</a></li>
	<li class="toc-level-1"><a href="#APC_issues"><span class="toc-number">10. </span>APC issues</a></li>
</ol>
</div>
</div>

<h2 id="Verify_and_install_run_everything_through_SSH">1. Verify and install run everything through SSH</h2>

<p>Since Aegir has multi-server support, it is possible that you have a misconfigured "FQDN" and that aegir then tries to connect to the local server as a remote server. To check if you have a misconfigured server, run the following commands:</p>

<pre><code>resolveip `uname -n`
</code></pre>

<p>If the command returns your IP address, you are all set. If it returns an error you will need to edit your <code>/etc/hosts</code> file.</p>

<p>First line of this file looks like:</p>

<pre><code>127.0.0.1  localhost
</code></pre>

<p>Simply add all domains you want to this line. e.g:</p>

<pre><code>127.0.0.1  localhost aegir.example.com example.com
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="NameVirtualHost_:80_has_no_VirtualHosts">2. NameVirtualHost *:80 has no VirtualHosts</h2>

<p>It does not hurt anything, but it can be annoying in your logs.  This may disappear as soon as you define your first virtual site using Aegir. If it does not, you most likely have a second NameVirtualHost statement in your configuration someplace other than in the Aegir configurations.</p>

<p>If you are on a Debian system, that is usually a configuration fragment in /etc/apache2/ports.conf or in a fragment symbolically linked in /etc/apache2/sites-enabled and it is safe to comment out any NameVirtualHost statements you find there as this really is a large part of the job you have asked Aegir to do for you.</p>

<p>Once those are commented out, the message should disappear.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Making_sure_it_works">3. Making sure it works</h2>

<p>Your new Aegir server will be installed with a single site named the way you specified in your install script.  That's great, but you may have more paths to that same server.</p>

<p>When you try to browse to your server for the first time from a non-localhost browser you may get an addressing issue.  If you do, make sure that you actually have the server defined in DNS and that the DNS server was reloaded.  If it was reloaded and you use slave servers, make sure that the serial number in the zone file was incremented so that the slaves automatically reload.</p>

<p>If you already have multiple URLs in your DNS which resolve to the same Aegir, you should check them.  For instance: if your DNS resolves both aegir.example.com and sitecontrol.example.com to your new Aegir server's IP, you need to make sure that both are accommodated.  If they will both get the same physical hostmaster site, one should be set up as an alias to the other.  If they are indeed going to be separate sites you will have to create a new site node with the other name as a virtual site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Access_by_the_server-s_physical_IP_address">4. Access by the server's physical IP address</h2>

<p>Another "gotcha" that you may run into is http access using the actual IP itself.  Remember that the IP is not picked up by the site vhost and will not match a ServerName or ServerAlias - so it gets picked up by the default vhost.  This is just standard apache stuff, nothing Aegir or Drupal specific here, but quite the annoyance and a potential problem.</p>

<p>You can easily work around it by simply adding the IP as a Site Alias in the site node in either the Aegir site (or another site that you may have defined which you would prefer the IP to address).</p>

<p>You can tell if you have the IP problem by simply pointing your browser to the server by IP as <a href="http://999.999.999.999/" title="http://999.999.999.999/">http://999.999.999.999/</a> and seeing what comes up.  If you get an install screen, you have the problem.  You certainly do not want that install screen getting executed!</p>

<p>The good news is that fixing it is easy.</p>

<p>Simply log into Aegir, click on Sites, click on the site name that you want the IP to address, click on Edit and scroll down to Domain Aliases.  Put the IP into the box, click on the Redirect checkbox so that Aegir instructs Apache to do a rewrite to the real domain name, and finally click Save.</p>

<p>If you do not have the Domain Aliases entry box, you need to turn that feature on.  In that case, go to your administration menu at the top of the page, point to Hosting and then click on Features.  Click the checkbox for Site Aliasing and then Save Configuration.  The Aliases box will now appear when you edit a site.  There is excellent information about the site alias feature in this handbook at <a href="../../../../60/index.html" title="http://community.aegirproject.org/node/60">http://community.aegirproject.org/node/60</a> with much more detail.</p>

<p>After the Verify job completes you should test your server again.  Now when you address the server by it's IP address the URL should automatically change to the site you selected and the install screen never appears.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS_firewall_settings">5. CentOS firewall settings</h2>

<p>You may need to adjust CentOS's firewall settings to allow HTTP
traffic on port 80.  If you installed CentOS with a UI, enable
"Firewall settings -- WWW (HTTP)".</p>

<p>Alternatively, another solution may be to edit /etc/sysconfig/iptables 
and add a rule accepting traffic on the relevant interface on port 80.</p>

<p>Afterwards, you can restart the firewall with this command:</p>

<p>Shell commands::
<div class="codeblock"><code> service iptables restart</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS_cron_requires_restart">6. CentOS cron requires restart?!</h2>

<p>Also, in some configurations, it seems necessary to restart crond for
the user crontab changes to take effect (very bizarre). For that, use:</p>

<p>Shell commands::
<div class="codeblock"><code> service crond restart</code></div></p>

<p>See <a href="http://drupal.org/node/632308" title="http://drupal.org/node/632308">http://drupal.org/node/632308</a> if you have more information about
this issue.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="CentOS_aegir.conf_permission_denied">7. CentOS aegir.conf permission denied</h2>

<p>If you receive:
<div class="codeblock"><code>Starting httpd: httpd: Syntax error on line 209 of /etc/httpd/conf/httpd.conf: Could not open configuration file /etc/httpd/conf.d/aegir.conf: Permission denied</code></div>
when trying to restart httpd, check your SELinux settings. If enabled, you can run the following command on the aegir.conf file in /var/aegir/config/server_master directory:
<div class="codeblock"><code>chcon -t httpd_config_t apache.conf</code></div>
Alternatively, you can disable SELinux completely if you desire. Both options will result in removing the permisson denied error.</p>

<p>You can see this comment: <a href="http://drupal.org/node/1286926#comment-5028062" title="http://drupal.org/node/1286926#comment-5028062">http://drupal.org/node/1286926#comment-5028062</a> for a little more info.</p>

<p>Try the following if nothing works:</p>

<pre><code>setenforce permissive
</code></pre>

<p>See this doc to make the change permanent: <a href="http://wiki.centos.org/HowTos/SELinux" title="http://wiki.centos.org/HowTos/SELinux">http://wiki.centos.org/HowTos/SELinux</a></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Solaris_cron_issues">8. Solaris cron issues</h2>

<p>I had numerous problems setting up a proper cron job, as Solaris' crond seems
pretty anal about what it accepts. The only way I could get it to work was to
create a wrapper shell script that would be called using the simplest cron
tab.</p>

<p>Crontab entry:</p>

<p><div class="codeblock"><code>* * * * * /var/aegir/dispatch.sh</code></div></p>

<p>Content of dispatch.sh:</p>

<p><div class="codeblock"><code>#!/usr/bin/bash<br /><br />HOME=/var/aegir<br />LD_LIBRARY_PATH=/usr/lib:/usr/local/lib:/usr/lib/sparcv9:/opt/mysql/mysql/lib:/usr/sfw/lib:/usr/sfw/lib/gcc:/opt/sfw/lib<br />PATH=/usr/bin:/opt/mysql/mysql/bin:/usr/sfw/bin:/opt/sfw/bin:/opt/SUNWspro/bin:/usr/local/bin:/opt/csw/bin<br /><br />export HOME<br />export LD_LIBRARY_PATH<br />export PATH<br /><br />php &#039;/var/aegir/drush/drush.php&#039; --php=/usr/local/bin/php &#039;@hostmaster&#039; hosting-dispatch</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Drush_execution_path_issues">9. Drush execution path issues</h2>

<p>Solaris (and maybe others) suffers from the dreaded execution issues of drush:</p>

<ul>
<li><a href="http://drupal.org/node/637574" title="http://drupal.org/node/637574">http://drupal.org/node/637574</a></li>
<li><a href="http://drupal.org/node/586466" title="http://drupal.org/node/586466">http://drupal.org/node/586466</a></li>
</ul>

<p>Those can be worked around by hardcoding the --php executable on the
commandline path. Adding the proper shebang (<code>#!/usr/local/bin/php</code>, for example) header and using a proper PATH
that includes the PHP executable also helps.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="APC_issues">10. APC issues</h2>

<p>If you are having trouble running APC with Aegir, try downgrading to APC 3.1.4.  This can be achieved by the following:</p>

<p><code>sudo pecl uninstall apc</code></p>

<p><code>sudo pecl install apc-3.1.4</code></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-51.html?destination=node%2F462%23comment-form">Login</a> or <a href="../../../../../user/register/index-51.html?destination=node%2F462%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-51.html?destination=node%2F462%23comment-form">Login</a> or <a href="../../../../../user/register/index-51.html?destination=node%2F462%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-646" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html">Ubuntu 10.04 Specific : How to downgrade to php 5.2 before install</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>As explained at <a href="../../../../../installing/manual/index.html" title="http://community.aegirproject.org/installing/manual">http://community.aegirproject.org/installing/manual</a>, the recommended version of PHP is 5.3, but some users may wish to use PHP 5.2 in order to host Drupal 5.x sites or to use modules which have PHP 5.3 compatibility issues. Should you choose to do so, the following documentation may be useful. What is explained here is specific to Ubuntu 10.04. It hasn't been tested on further versions, mostly because many sysadmins prefer to use the latest Long Term Support (LTS) version of Ubuntu, currently 10.04, on their production servers.</p>

<p>Follow this procedure :</p>

<p><code>sudo apt-get install python-software-properties</code></p>

<p><code>add-apt-repository ppa:txwikinger/php5.2</code></p>

<p>Create the file /etc/apt/preferences.d/php and input the following code in it :</p>

<pre>
Package: libapache2-mod-php5
Pin: version 5.2.10*
Pin-Priority: 991

Package: libapache2-mod-php5filter
Pin: version 5.2.10*
Pin-Priority: 991

Package: php-pear
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-cgi
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-cli
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-common
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-curl
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-dbg
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-dev
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-gd
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-gmp
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-ldap
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-mhash
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-mysql
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-odbc
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-pgsql
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-pspell
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-recode
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-snmp
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-sqlite
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-sybase
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-tidy
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-xmlrpc
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-xsl
Pin: version 5.2.10*
Pin-Priority: 991

Package: php5-mcrypt
Pin: version 5.2.6*
Pin-Priority: 991

Package: php5-imap
Pin: version 5.2.6*
Pin-Priority: 991
</pre>

<p>Then proceed Aegir install as explained at <a href="../../../../../installing/debian/index.html" title="http://community.aegirproject.org/installing/debian">http://community.aegirproject.org/installing/debian</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-394.html?destination=node%2F646%23comment-form">Login</a> or <a href="../../../../../user/register/index-394.html?destination=node%2F646%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../646/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>



    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/9/revisions/17/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 17:39:50 GMT -->
</html>
