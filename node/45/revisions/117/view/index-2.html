<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/45/revisions/117/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:01:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../25/index.html" />
<link rel="up" href="../../../../43/index.html" />
<link rel="next" href="../../../../26/index.html" />
<link rel="prev" href="../../../../25/index.html" />
<link rel="up" href="../../../../43/index.html" />
<link rel="next" href="../../../../26/index.html" />
<link rel="prev" href="../../../../25/index.html" />
<link rel="up" href="../../../../43/index.html" />
<link rel="next" href="../../../../26/index.html" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Backup and Restore from Sun, 10/31/2010 - 02:40 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-45" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../index.html">Backup and Restore</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div id='diff-inline-45'><div class='diff-inline-metadata clear-block'><div class='diff-inline-byline'>Updated by <a href="../../../../../users/mig5/index.html" class="username" title="View user profile.">mig5</a> on 10/31/2010 - 02:40</div><div class='diff-inline-legend clear-block'><label>Legend</label><span class='diff-added'>Added</span><span class='diff-changed'>Changed</span><span class='diff-deleted'>Deleted</span></div></div><span class='diff-added'></span><p><span class='diff-added'>The Aegir system provides a convenient method of backing up sites, and restoring sites from those backups.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Like most other Aegir functionality, the Backup feature comes in the form of a task, aptly named 'Backup'. It is one of the core features of Aegir and thus is always available for a site, out of the box.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Backing up a site in Aegir is twofold: the site folder (containing the settings.php, files dir and so on) is added to a tarball along with a database dump of the site and stored in </span><code><span class='diff-added'>/var/aegir/backups</span></code><span class='diff-added'> on the master Aegir server.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>In the event that the website or database is a remote server, those relevant components are synced down to the master Aegir server to be tarballed up. Only the master Aegir server stores backups of a site. (This is known as a 'spoke' model, as opposed to a 'mesh' or distributed model, and suits the Aegir system at this time).</span></p><span class='diff-added'>

</span><p><span class='diff-added'>The tarball generated for a site can be used for a number of things: restoring a site from that backup via the 'Restore' task, or from the command line using the </span><code><span class='diff-added'>provision-deploy</span></code><span class='diff-added'> command for advanced users as a method of quickly importing a site onto a system.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Other cases whereby a backup task is generated and its tarball used are when a site is being Migrated (upgraded) or being Cloned as a new site, but that is outside the scope of this chapter.</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Backing up</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>When viewing the site node of a site in the Aegir frontend, click the 'Backup' button in the list of available tasks for this site.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>A modalframe dialog appears, prompting for confirmation, as well as providing an editable Description field which you may fill out. This field is optional, designed only to aid you in future if you seek a reason for why a backup was made.</span></p><span class='diff-added'>

</span><div align="center"><span class='diff-added'></span><span class='diff-added'><img src="../../../../../sites/community.aegirproject.org/files/backup/index.png" /></span><span class='diff-added'></span></div><span class='diff-added'>

</span><p><span class='diff-added'>Once the form is submitted, a Backup task is spawned and added to the Task queue for dispatching by the backend.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>The full output of a Backup task is viewable in the task log. Extra security precautions are built into Aegir so that the 'mysqldump' command uses file descriptors to hide exposing the database user's password in the running process and output of the task.</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Restoring from a backup</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>Restoring a site from a backup is simple and follows the same pattern as backing up. Simply click the 'Restore' button from the list of available tasks for a site. A modalframe dialog will load, and the form offers a list of radio items. These are the backups that have been made for a site, in the format of 'Date/time - Reason'.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Where no custom reason was given for a backup, the message 'Generated on request' is shown instead.</span></p><span class='diff-added'>

</span><div align="center"><span class='diff-added'></span><span class='diff-added'><img src="../../../../../sites/community.aegirproject.org/files/restore/index.png" /></span><span class='diff-added'></span></div><span class='diff-added'>

</span><p><span class='diff-added'>Choose a backup to restore from and submit the form. A 'Restore' task will be spawned and added to the Task queue for dispatching by the backend.</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>What happens during a Restore task</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>The restore process</span></p><span class='diff-added'>

</span><ul><span class='diff-added'>
</span><li><span class='diff-added'>puts the site under 'maintenance mode' temporarily (safety first!)</span></li><span class='diff-added'>
</span><li><span class='diff-added'>generates a new backup of the site before restoring to it (still safety first!). This new backup will be available in the list of backups if you ever re-run the Restore task, and will carry the description 'Generated before being restored to a previous version'.</span></li><span class='diff-added'>
</span><li><span class='diff-added'>uses the implied </span><code><span class='diff-added'>provision-deploy</span></code><span class='diff-added'> command in the backend to unpack the tarball, </span></li><span class='diff-added'>
</span><li><span class='diff-added'>create a new database and import the database dump into it, </span></li><span class='diff-added'>
</span><li><span class='diff-added'>create a new database user, </span></li><span class='diff-added'>
</span><li><span class='diff-added'>spawn a verify task silently, which will

</span><ul><span class='diff-added'>
</span><li><span class='diff-added'>re-write the settings.php,</span></li><span class='diff-added'>
</span><li><span class='diff-added'>sync the data if necessary to a remote platform, </span></li><span class='diff-added'>
</span><li><span class='diff-added'>re-generate the web server's vhost configuration file for this site,</span></li><span class='diff-added'>
</span><li><span class='diff-added'>finally reload the web server</span></li><span class='diff-added'>
</span></ul><span class='diff-added'></span></li><span class='diff-added'>
</span></ul></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-39.html?destination=node%2F45%23comment-form">Login</a> or <a href="../../../../../user/register/index-39.html?destination=node%2F45%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-39.html?destination=node%2F45%23comment-form">Login</a> or <a href="../../../../../user/register/index-39.html?destination=node%2F45%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/45/revisions/117/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:01:52 GMT -->
</html>
