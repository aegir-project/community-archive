<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/931/revisions/3642/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:03:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../../content/apache-mysql-php-aegir/index.html" />
<link rel="up" href="../../../../417/index.html" />
<link rel="next" href="../../../../../content/installing/manual/centos-6x-aegir-install-guide/index.html" />
<link rel="prev" href="../../../../../content/apache-mysql-php-aegir/index.html" />
<link rel="up" href="../../../../417/index.html" />
<link rel="next" href="../../../../../content/installing/manual/centos-6x-aegir-install-guide/index.html" />
<link rel="prev" href="../../../../../content/apache-mysql-php-aegir/index.html" />
<link rel="up" href="../../../../417/index.html" />
<link rel="next" href="../../../../../content/installing/manual/centos-6x-aegir-install-guide/index.html" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of nginx / MariaDB / PHP / Aegir (MEMPÆ) from Fri, 07/13/2012 - 05:45 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-931" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../../../content/nginx-mariadb-php-aegir-memp%c3%a6/index.html">nginx / MariaDB / PHP / Aegir (MEMPÆ)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div id='diff-inline-931'><div class='diff-inline-metadata clear-block'><div class='diff-inline-byline'>Updated by <a href="../../../../../users/realityloop/index.html" class="username" title="View user profile.">realityloop</a> on 07/13/2012 - 05:45</div><div class='diff-inline-legend clear-block'><label>Legend</label><span class='diff-added'>Added</span><span class='diff-changed'>Changed</span><span class='diff-deleted'>Deleted</span></div></div><p><span class='diff-deleted'>You</span><span class='diff-deleted'> </span><span class='diff-deleted'>can</span><span class='diff-deleted'> </span><span class='diff-deleted'>watch</span><span class='diff-deleted'> </span><span class='diff-deleted'>a</span><span class='diff-deleted'> </span><span class='diff-deleted'>video</span><span class='diff-deleted'> </span><span class='diff-deleted'>of</span><span class='diff-deleted'> </span><span class='diff-deleted'>this</span><span class='diff-deleted'> </span><span class='diff-deleted'>process</span><span class='diff-deleted'> </span><span class='diff-deleted'>at</span><span class='diff-deleted'> </span><span class='diff-deleted'></span><a href="http://www.youtube.com/watch?v=-b81t4bX_gE" title="http://www.youtube.com/watch?v=-b81t4bX_gE"><span class='diff-deleted'>http://www.youtube.com/watch?v=-b81t4bX_gE</span></a><span class='diff-deleted'></span></p><span class='diff-deleted'>
</span><p><span class='diff-deleted'></span><iframe width="600" height="450" src="http://www.youtube.com/embed/-b81t4bX_gE?hl=en&amp;fs=1" frameborder="0" allowfullscreen><span class='diff-deleted'></span></iframe><span class='diff-deleted'></span></p><span class='diff-deleted'>
</span><p><strong>Step 1:<span class='diff-deleted'> </span><span class='diff-deleted'>Install</span><span class='diff-deleted'> </span><span class='diff-deleted'>the</span><span class='diff-deleted'> </span><span class='diff-deleted'>requirements</span><span class='diff-deleted'> </span><span class='diff-deleted'>for</span><span class='diff-deleted'> </span><span class='diff-deleted'>this</span><span class='diff-deleted'> </span><span class='diff-deleted'>process;</span> Xcode and Homebrew</strong></p>
<p><a href="http://itunes.apple.com/au/app/xcode/id497799835?mt=12" target="_blank">XCode</a> is required for <a href="http://mxcl.github.com/homebrew/" target="_blank">Homebrew</a> to compile<span class='diff-added'> dnsmasq,</span> nginx, mariadb and php.</p>
<ul>
<li>Download and install Xcode using the Mac App Store with the link above<br />
(it's free, but will take a while to download if your Internet connection is slow)</li>
<li>Once the download has finished <span class='diff-changed'>launch Xcode and open it's preferences, goto Downloads tab and click Install on Command Line Tools.</span></li>
<li><span class='diff-changed'>Follow the </span><a href="https://github.com/mxcl/homebrew/wiki/installation" target="_blank"><span class='diff-changed'>installation instructions for Homebrew</span></a><span class='diff-changed'>, which most likley tell you</span> to <span class='diff-changed'>run this command in your terminal</span><br />
<div class="codeblock"><code><span class='diff-changed'>/usr/bin/ruby</span> -e <span class='diff-changed'>&quot;$(/usr/bin/curl</span> -fsSL <a href="https://raw.github.com/mxcl/homebrew/master/Library/Contributions/install_homebrew.rb" title="https://raw.github.com/mxcl/homebrew/master/Library/Contributions/install_homebrew.rb"><span class='diff-changed'>https://raw.github.com/mxcl/homebrew/master/Library/Contributions/instal...</span></a>)&quot;</code></div>
</li>
</ul><span class='diff-changed'>
</span><p><span class='diff-changed'></span><strong><span class='diff-changed'>Mountain Lion Fixes for Homebrew</span></strong><span class='diff-changed'></span></p><span class='diff-changed'>
</span><ul><span class='diff-changed'>
</span><li><span class='diff-changed'>Let everyone know where Xcode is</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer</span></code></div>
</li>
<li><span class='diff-changed'>Install X11: Visit </span><a href="http://xquartz.macosforge.org/trac/wiki" target="_blank"><span class='diff-changed'>http://xquartz.macosforge.org/trac/wiki</span></a><span class='diff-changed'> and download and install version 2.7.2+.</span></li><span class='diff-changed'>
</span><li><span class='diff-changed'>You will need</span> to <span class='diff-changed'>fix the symlink it makes</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>sudo ln -s /opt/X11 /usr/X11</span></code></div>
</li>
<li><span class='diff-changed'>Reinstall your brews</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code><span class='diff-changed'>$ brew list</span></code></div>
</li>
</ul>
<p><strong><span class='diff-changed'>Add directories to your path</span></strong></p>
<ul><span class='diff-changed'>
</span><li><span class='diff-changed'>Ensure /usr/local/bin occurs before /usr/bin and add /usr/local/sbin is added to your path, If you are</span> using <span class='diff-changed'>zsh, update .zshrc instead</span><br /><br />
<div class="codeblock"><code>$ <span class='diff-changed'>nano ~/.bash_profile&nbsp;&nbsp; </span><span class='diff-deleted'>the</span><span class='diff-deleted'> </span><span class='diff-deleted'>default</span><span class='diff-deleted'> </span><span class='diff-deleted'>configuration</span><br/><br /><span class='diff-changed'>or</span><br />$ <span class='diff-changed'>nano ~/.zshrc</span></code></div>
</br/><span class='diff-deleted'></span></li>
<li><span class='diff-changed'>Paste</span> the <span class='diff-changed'>following into editor then Ctrl+X</span> and <span class='diff-changed'>Y to save</span><br />
<div class="codeblock"><code><span class='diff-changed'>export PATH=~/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/X11/bin:/usr/local/git/bin:/opt/local/bin</span></code></div>
</li>
</ul>
<p><strong><span class='diff-changed'>Set up email sending</span></strong></p>
<ul>
<li><span class='diff-changed'>If you are on Mountain Lion you need to create and set</span> the <span class='diff-changed'>permissions for these directories first (for DP4 at least)</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code><span class='diff-changed'>$ sudo mkdir /Library/Server /Library/Server/Mail /Library/Server/Mail/Data /Library/Server/Mail/Data/spool /Library/Server/Mail/Data/spool/maildrop</span><br /><span class='diff-changed'>$ sudo chown _postfix:_postdrop /Library/Server/Mail/Data/spool/maildrop</span></code></div>
</li>
<li><span class='diff-changed'>I chose to set up gmail as my email relay (this may not be required for you though)</span><br /><span class='diff-deleted'>};</span></code><br />
<a href="http://realityloop.com/blog/2011/06/05/os-x-ditching-mamp-pro-part-2-gmail-email-relay"><span class='diff-added'>http://realityloop.com/blog/2011/06/05/os-x-ditching-mamp-pro-part-2-gmail-email-relay</span></a><span class='diff-added'></span></li>
<li><span class='diff-changed'>Mountain Lion appears to have a few bugs around this at the moment, I have</span> to <span class='diff-changed'>launch postfix on reboot</span><br /><br />
<div class="codeblock"><code>$ <span class='diff-changed'>sudo postfix start</span></code></div>
</li>
</ul>
<p><strong><span class='diff-changed'>Step 2: Setting up dnsmasq for local wildcard DNS</span></strong><span class='diff-changed'></span></p><span class='diff-changed'>
</span><ul><span class='diff-changed'>
</span><li><span class='diff-changed'>Install dnsmasq via homebrew</span><br /><span class='diff-changed'></span><br /><span class='diff-changed'>
</span><div class="codeblock"><span class='diff-changed'></span><code><span class='diff-changed'>$ brew install dnsmasq</span></code></div>
</li>
<li><span class='diff-changed'>Copy and edit</span> the <span class='diff-changed'>default conf example</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>mkdir /usr/local/etc</span><br /><span class='diff-changed'>$ cp /usr/local/Cellar/dnsmasq/2.61/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf</span><br />$ <span class='diff-changed'>nano /usr/local/etc/dnsmasq.conf</span></code></div>
</li>
<li><span class='diff-changed'>Update the following values</span> as <span class='diff-changed'>shown</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code><span class='diff-added'>resolv-file=/etc/resolv.dnsmasq.conf</span><br /><span class='diff-added'>address=/.ld/127.0.0.1</span><br /><span class='diff-added'>listen-address=127.0.0.1</span></code><span class='diff-added'></span></div><span class='diff-added'>
</span></li>
<li>Set <span class='diff-changed'>up downstream DNS resolver</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>sudo nano /etc/resolv.dnsmasq.conf</span></code></div>
</li>
<li><span class='diff-changed'>Paste the following and save using CTRL + X then Y</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code><span class='diff-changed'># OpenDNS IPv6:</span><br /><span class='diff-changed'>nameserver 2620:0:ccd::2</span><br /><span class='diff-changed'>nameserver 2620:0:ccc::2</span><br /><span class='diff-changed'># Google IPv6:</span><br /><span class='diff-changed'>nameserver 2001:4860:4860::8888</span><br /><span class='diff-changed'>nameserver 2001:4860:4860::8844</span><br /><span class='diff-changed'># OpenDNS:</span><br /><span class='diff-changed'>nameserver 208.67.222.222</span><br /><span class='diff-changed'>nameserver 208.67.220.220</span><br /><span class='diff-changed'># Google:</span><br /><span class='diff-changed'>nameserver 8.8.8.8</span><br /><span class='diff-changed'>nameserver 8.8.4.4</span></code><span class='diff-changed'></span></div><span class='diff-changed'>
</span></li><span class='diff-changed'>
</span><li><span class='diff-changed'>Copy the launch daemon so dnsmasq runs on startup, and launch it now</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>sudo cp /usr/local/Cellar/dnsmasq/2.61/homebrew.mxcl.dnsmasq.plist /Library/LaunchDaemons</span><br /><span class='diff-changed'>$ sudo launchctl load -w /Library/LaunchDaemons/homebrew.mxcl.dnsmasq.plist</span></code></div>
</li>
<li>Set hostname as it's required for sane default in aegir setup, <span class='diff-deleted'></span><em>we chose <span class='diff-deleted'></span><strong>rl.ld</strong><span class='diff-deleted'></span> for Realityloop Local Development you can use something else instead of <span class='diff-deleted'></span><strong>rl</strong><span class='diff-deleted'></span> but it needs to end in <span class='diff-deleted'></span><strong>.ld<br /><br />
<div class="codeblock"><code>$<span class='diff-added'> sudo</span> scutil --set HostName rl.ld</code></div>
</li>
<li><span class='diff-changed'>Open your System Preferences, then click on Network, then for each of your interfaces (Wi-Fi &amp; Ethernet), click on Advanced, click on DNS</span> and <span class='diff-changed'>finally click on the + symbol at the bottom of the left hand-side panel and set 127.0.0.1 as your only DNS Server</span></li>
</ul>
<p><strong>Step 3: Install nginx</strong></p>
<p>nginx (pronounced “engine-x”) is a Web server and a reverse proxy server for HTTP, SMTP, POP3 and IMAP protocols, with a strong focus on high concurrency, performance and low memory usage.</p>
<ul>
<li>Unless this is a fresh install of OS X you need to ensure Apache doesn't load on startup<br />
<div class="codeblock"><code>$ sudo launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist</code></div>
</li>
<li><span class='diff-changed'>We can add some 3rd party extensions here as well (this list item is optional, if you don't want these extensions just skip</span> to <span class='diff-changed'>the next list item)</span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>curl -s -L -o /tmp/nginx-upload-progress.tar.gz </span><a href="https://github.com/masterzen/nginx-upload-progress-module/tarball/v0.9.0" title="https://github.com/masterzen/nginx-upload-progress-module/tarball/v0.9.0"><span class='diff-changed'>https://github.com/masterzen/nginx-upload-progress-module/tarball/v0.9.0</span></a><span class='diff-changed'> &amp;&amp; mkdir /tmp/nginx-upload-progress &amp;&amp; tar zxpf /tmp/nginx-upload-progress.tar.gz --strip-components 1 -C /tmp/nginx-upload-progress &amp;&amp; rm /tmp/nginx-upload-progress.tar.gz</span><br /><span class='diff-changed'>$ curl -s -L -o /tmp/nginx-fair.tar.gz </span><a href="http://github.com/gnosek/nginx-upstream-fair/tarball/master" title="http://github.com/gnosek/nginx-upstream-fair/tarball/master"><span class='diff-changed'>http://github.com/gnosek/nginx-upstream-fair/tarball/master</span></a><span class='diff-changed'> &amp;&amp; mkdir /tmp/nginx-fair &amp;&amp; tar zxpf /tmp/nginx-fair.tar.gz --strip-components 1 -C /tmp/nginx-fair &amp;&amp; rm /tmp/nginx-fair.tar.gz </span></code></div>
<p><span class='diff-changed'>Now one giant</span> line <span class='diff-changed'>of sed regex that will edit</span> the <span class='diff-added'>Homebrew formula for nginx to add the additional compile options that we need. Make sure it all gets entered as one line.</span></p><span class='diff-added'>
</span><div class="codeblock"><code><span class='diff-changed'>$ sed -i &#039;-default&#039; &#039;s/\([[:space:]]*\[&#039;\&#039;&#039;--\)\(with-webdav\)\(&#039;\&#039;&#039;,[[:space:]]*&quot;\)\(Compile with support for WebDAV module\)\(&quot;\]\)/\1\2\3\4\5,%\1with-realip\3Compile with support for RealIP module\5,%\1with-gzip_static\3Compile with support for Gzip Static module\5,%\1with-uploadprogress\3Compile with support for Upload Progress module\5,%\1with-fair\3Compile with support for Fair module\5,%\1with-mp4\3Compile with support for MP4 module\5,%\1with-flv\3Compile with support for FLV module\5,%\1with-stub_status\3Compile with support for Stub Status module\5/; s/\([[:space:]]* </span>args <span class='diff-changed'>&lt;&lt; &quot;--\)\(with-http_dav_module\)\(&quot; if ARGV.include? </span><span class='diff-added'>&#039;\&#039;&#039;--with-\)\(webdav\)\(&#039;\&#039;&#039;.*\)/\1\2\3\4\5%\1with-http_realip_module\3realip\5%\1with-http_gzip_static_module\3gzip_static\5%\1add-module=\/tmp\/nginx-upload-progress\3uploadprogress\5%\1add-module=\/tmp\/nginx-fair\3fair\5%\1with-http_mp4_module\3mp4\5%\1with-http_flv_module\3flv\5%\1with-http_stub_status_module\3stub_status\5/; y/%/\n/&#039; $(brew --prefix)/Library/Formula/nginx.rb</span></code></div><span class='diff-changed'>
</span><p><span class='diff-changed'>Now we'll install Nginx with our new build options and extensions and start it.</span><br /><span class='diff-added'></span></p>
<div class="codeblock"><code><span class='diff-changed'>$ brew install nginx --with-realip --with-gzip_static --with-mp4 --with-flv --with-stub_status --with-uploadprogress --with-fair</span><br /><span class='diff-changed'>$ [ $? -eq 0 ] &amp;&amp; rm -rf /tmp/nginx-upload-progress /tmp/nginx-fair</span><br /><span class='diff-changed'>$ mkdir -vp $(brew --prefix nginx)/var/{microcache,log,run}</span></code></div>
</li>
<li><span class='diff-changed'>If you didn't use</span> the <span class='diff-changed'>above to install extra nginx extensions run this, otherwise skip this</span> command<br />
<div class="codeblock"><code>$ brew install nginx</code></div>
</li>
<li>Once nginx is compiled, backup the default nginx config<br />
<div class="codeblock"><code>$ mv /usr/local/etc/nginx/nginx.conf /usr/local/etc/nginx/nginx.conf.bak</code></div>
</li>
<li>Download our config as follows<br />
<div class="codeblock"><code>$ curl <a href="http://realityloop.com/sites/realityloop.com/files/uploads/nginx.conf_.txt" title="http://realityloop.com/sites/realityloop.com/files/uploads/nginx.conf_.txt">http://realityloop.com/sites/realityloop.com/files/uploads/nginx.conf_.txt</a> &gt; /usr/local/etc/nginx/nginx.conf</code></div>
</li>
<li>Edit the config to set your username, replace [username] on the third line with your own username, hit Ctrl+X and Y to save<br />
<div class="codeblock"><code>$ nano /usr/local/etc/nginx/nginx.conf</code></div>
</li>
<li>Make nginx log files visible in Console app<br />
<div class="codeblock"><code>$ sudo mkdir /var/log/nginx</code></div>
</li>
<li>Create the following directorty to stop “"/var/lib/nginx/speed" failed (2: No such file or directory)” error<br />
<div class="codeblock"><code>$ sudo mkdir /var/lib/nginx</code></div>
</li>
</ul>
<p><strong>Step 4: MariaDB</strong></p>
<p>MariaDB is a community-developed branch of the MySQL database, the impetus being the community maintenance of its free status under GPL, as opposed to any uncertainty of MySQL license status under its current ownership by Oracle.</p>
<p>The intent also being to maintain high fidelity with MySQL, ensuring a "drop-in" replacement capability with library binary equivalency and exacting matching with MySQL APIs and commands. It includes the XtraDB storage engine as a replacement for InnoDB.</p>
<ul>
<li>Still in the ‘Terminal app’, type the following command<br />
<div class="codeblock"><code><span class='diff-added'>$ brew install gnu-sed (to address Mountain Lion DP4 bug)</span><br />$ brew install mariadb<span class='diff-added'> --use-llvm</span></code></div>
</li>
<li>Once compilation has finished unset TMPDIR<br />
<div class="codeblock"><code>unset TMPDIR</code></div>
</li>
<li>Then mysql_install_db<br />
<div class="codeblock"><code>$ mysql_install_db</code></div>
</li>
<li><strong>but don't follow any more of the prompts just now or you will run into problems, we'll do the rest later.</strong></li>
</ul>
<p><strong>Step 5: <span class='diff-changed'>Install the homebrew version of</span> php</strong></p>
<ul>
<li><span class='diff-changed'>Execute</span> the <span class='diff-changed'>brew install process using hombrew-alt php brew file</span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>brew tap josegonzalez/homebrew-php</span><br /><span class='diff-changed'>$</span> brew install <span class='diff-changed'>php53 --with-mysql --with-fpm</span><br /><span class='diff-changed'>$</span> brew <span class='diff-changed'>install php53-xhprof</span><br /><span class='diff-deleted'>
</span><div class="codeblock"><span class='diff-deleted'></span><code>$ brew install <span class='diff-changed'>php53-xdebug</span><br /><span class='diff-changed'>$ brew install php53-uploadprogress</span></code></div>
</li>
<li><span class='diff-changed'>Edit the php.ini</span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>nano /usr/local/etc/php/5.3/php.ini</span></code></div>
<p><span class='diff-changed'>Search for the extenstions section by using CTRL + W and typing: extension=php_zip.dll</span></p><span class='diff-changed'>
</span><div class="codeblock"><span class='diff-changed'></span><code><span class='diff-changed'>extension=&quot;/usr/local/Cellar/php53-xhprof/0.9.2/xhprof.so&quot;</span><br /><span class='diff-changed'>extension=&quot;/usr/local/Cellar/php53-uploadprogress/1.0.3.1/uploadprogress.so&quot;</span><br /><span class='diff-changed'>zend_extension=&quot;/usr/local/Cellar/php53-xdebug/2.2.0/xdebug.so&quot;</span></code></div>
</li>
<li>Edit the <span class='diff-changed'>php-fpm.conf</span> file<br />
<div class="codeblock"><code>$ nano <span class='diff-changed'>/usr/local/etc/php/5.3/php-fpm.conf</span></code></div>
</li>
<li>Add the following line below <strong>;pid = run/php-fpm.pid</strong><br />
<div class="codeblock"><code>pid = /usr/local/var/run/php-fpm.pid</code></div>
</li>
<li>Update the user and group section as follows<br />
<div class="codeblock"><code>user = _www<br />group = _www</code></div>
</li>

<p>Remove the ; from the start of the following lines then save using Ctrl+X then Y</p>
<div class="codeblock"><code>pm.start_servers = <span class='diff-changed'>3</span><br />pm.min_spare_servers = <span class='diff-changed'>3</span><br />pm.max_spare_servers = <span class='diff-changed'>5</span><br />pm.max_requests = 500</code></div>

<li><span class='diff-deleted'>Create</span><span class='diff-deleted'> </span><span class='diff-deleted'>directory</span><span class='diff-deleted'> </span><span class='diff-deleted'>and</span><span class='diff-deleted'> </span><span class='diff-deleted'>file</span><span class='diff-deleted'> </span><span class='diff-deleted'>for</span><span class='diff-deleted'> </span><span class='diff-deleted'>php-fpm</span><span class='diff-deleted'> </span><span class='diff-deleted'>log</span><br /><span class='diff-deleted'>
</span><div class="codeblock"><span class='diff-deleted'></span><code><span class='diff-deleted'>$</span><span class='diff-deleted'> </span><span class='diff-deleted'>mkdir</span><span class='diff-deleted'> </span><span class='diff-deleted'>/usr/local/Cellar/php/5.3.8/var/log/</span><br /><span class='diff-deleted'>$</span><span class='diff-deleted'> </span><span class='diff-deleted'>touch</span><span class='diff-deleted'> </span><span class='diff-deleted'>/usr/local/Cellar/php/5.3.8/var/log/php-fpm.log</span></code><span class='diff-deleted'></span></div><span class='diff-deleted'>
</span></li><span class='diff-deleted'>
</span><li>Make our log file visible in Console app<br />
<div class="codeblock"><code>$ sudo ln <span class='diff-changed'>-s&nbsp; /usr/local/Cellar/php53/5.3.13/var/log/php-fpm.log</span> /var/log/nginx/php-fpm.log</code></div>
</li>
<li>Set your timezone in php.ini <a href="http://www.php.net/manual/en/timezones.php" target="_blank">http://www.php.net/manual/en/timezones.php</a><br />
<div class="codeblock"><code>$ nano <span class='diff-changed'>/usr/local/etc/php/5.3/php.ini</span></code></div>
</li>
<li>I added the follwing under the <strong>;date.timezone =</strong> line<br />
<div class="codeblock"><code>date.timezone = Australia/Melbourne</code></div>
</li>
<li>And updated the Memory limit as follows, then saved with Ctrl+X then Y<br />
<div class="codeblock"><code>memory_limit = 256M</code></div>
</li>
</ul>
<p><strong>Step 6: Service Launch Daemons</strong></p>
<p>This is so everything runs automatically on startup</p>
<ul>
<li><span class='diff-changed'>Nginx needs to run as root for port 80 so do the following</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ sudo <span class='diff-changed'>cp /usr/local/Cellar/nginx/1.2.2/homebrew.mxcl.nginx.plist /Library/LaunchDaemons/</span><br /><span class='diff-changed'>$ sudo chown root:wheel /Library/LaunchDaemons/homebrew.mxcl.nginx.plist</span></code></div>
</li>
<li><span class='diff-changed'>Edit</span> the <span class='diff-changed'>plist</span><br /><span class='diff-changed'></span><br /><span class='diff-changed'>
</span><div class="codeblock"><span class='diff-changed'></span><code><span class='diff-changed'>$ sudo nano /Library/LaunchDaemons/homebrew.mxcl.nginx.plist</span></code><span class='diff-changed'></span></div><span class='diff-changed'>
</span><p><span class='diff-changed'></span><br /><span class='diff-changed'></span><br /><span class='diff-changed'>
Remove the following 2 groups of text and save your changes using Ctrl+X then Y</span><br /><span class='diff-added'></span></p>
<div class="codeblock"><code><span class='diff-changed'>&lt;key&gt;KeepAlive&lt;/key&gt;</span><br /><span class='diff-changed'>&lt;true/&gt;
</span><p><span class='diff-changed'>&lt;key&gt;UserName&lt;/key&gt;</span><br /><span class='diff-changed'> &lt;string&gt;yourusername&lt;/string&gt;</span></p><span class='diff-changed'></span></code><span class='diff-changed'></span></div><span class='diff-changed'>
</span><p><span class='diff-changed'></span><br /><span class='diff-changed'></span><br /><span class='diff-changed'>
Start </span><span class='diff-added'>nginx</span><br /></p><span class='diff-changed'>
</span><div class="codeblock"><code><span class='diff-added'>$ </span><span class='diff-changed'>launchctl load -w /Library/LaunchDaemons/homebrew.mxcl.nginx.plist</span></code></div>
</li>
<li><span class='diff-changed'>Make a directory</span> for <span class='diff-changed'>the rest of our launch daemons</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>mkdir -p ~/Library/LaunchAgents</span></code></div>
</li>
<li>Copy the LaunchDaemon to load mariadb on boot into place<span class='diff-added'> and start it now</span><br />
<div class="codeblock"><code>$ cp <span class='diff-changed'>/usr/local/Cellar/mariadb/5.3.5/homebrew.mxcl.mariadb.plist ~/Library/LaunchAgents/</span><br /><span class='diff-changed'>$ launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.mariadb.plist</span></code></div>
</li>
<li><span class='diff-changed'>Copy php launch daemon and start </span><span class='diff-added'>it</span><br /><br /><span class='diff-changed'>
</span><div class="codeblock"><span class='diff-changed'></span><code><span class='diff-changed'>$ cp /usr/local/Cellar/php53/5.3.13/homebrew-php.josegonzalez.php53.plist ~/Library/LaunchAgents/</span><br /><span class='diff-changed'>$ launchctl load -w ~/Library/LaunchAgents/homebrew-php.josegonzalez.php53.plist</span></code></div><span class='diff-added'>
</span></li>
<li><span class='diff-changed'>Complete</span> the <span class='diff-changed'>mariaDB setup</span><br />
<div class="codeblock"><code>$ sudo <span class='diff-changed'>/usr/local/Cellar/mariadb/5.3.5/bin/mysql_secure_installation</span></code></div>
</li>
<li>Answer the prompts as follows, replace [password] with a password of your own chosing<br />
<div class="codeblock"><code>Enter current password for root (enter for none): [Enter]<br />Set root password? [Y/n] y<br />New password: [password]<br />Re-enter new password: [password]<br />Remove anonymous users? [Y/n] y<br />Disallow root login remotely? [Y/n] y<br />Remove test database and access to it? [Y/n] y<br />Reload privilege tables now? [Y/n] y</code></div>
</li>
</ul>
<p><strong>Step 7: Drush and Aegir</strong></p>
<p>Your in the home stretch now!</p>
<ul><span class='diff-added'>
</span><li><span class='diff-added'>Install wget so Drush will work properly (need to do this on Mountain Lion)</span><br /><span class='diff-added'></span><br /><span class='diff-added'>
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>$ brew install wget</span></code><span class='diff-added'></span></div><span class='diff-added'>
</span></li>
<li>Make a few small changes required for this to work properly<br />
<div class="codeblock"><code>$ sudo mkdir /var/aegir<br />$ sudo chown `whoami` /var/aegir<br />$ sudo chgrp staff /var/aegir<br />$ sudo dscl . append /Groups/_www GroupMembership `whoami`</code></div>
</li>
<li>Allow your user to restart nginx, <strong> be sure to replace [username] with your own username</strong>.<br />
<div class="codeblock"><code>$ sudo -i<br />$ echo &quot;[username] ALL=NOPASSWD: /usr/local/sbin/nginx&quot; &gt;&gt; /etc/sudoers<br />$ exit</code></div>
</li>
<li><span class='diff-changed'>Create a symbolic link to aegir configuration</span><br /><span class='diff-changed'></span><br />
<div class="codeblock"><code>$ <span class='diff-changed'>sudo ln -s /var/aegir/config/nginx.conf /usr/local/etc/nginx/aegir.conf</span></code><span class='diff-changed'></span></div><span class='diff-changed'>
</span></li><span class='diff-changed'>
</span><li><span class='diff-changed'>Manually Install Drush and Aegir components</span><br /><span class='diff-changed'></span><br /><span class='diff-changed'></span><br /><span class='diff-changed'>
If you want to use drush 4.6 (we recommend Drush 5 though)
</span><div class="codeblock"><span class='diff-changed'></span><code>$ <span class='diff-changed'>brew tap BrianGilbert/homebrew-drush</span></code></div>
<p><span class='diff-changed'></span><br /><span class='diff-changed'></span><br />
<strong><span class='diff-changed'>To install aegir with Drush 4</span></strong><code><span class='diff-deleted'>$</span><span class='diff-deleted'> </span><span class='diff-changed'>remember to replace client_email in the last command with your own email address</span><br /><span class='diff-added'></span></p>
<div class="codeblock"><code><span class='diff-added'>$ brew install drush46</span><br />$ drush dl <span class='diff-changed'>--destination=/users/`whoami`/.drush drush_make-6.x</span><br />$ drush dl<span class='diff-added'> --destination=/users/`whoami`/.drush</span> provision-6.x<br /><span class='diff-added'>$ drush hostmaster-install --aegir_root=&#039;/var/aegir&#039; --root=&#039;/var/aegir/hostmaster-6.x-1.9&#039; --http_service_type=nginx </span><span class='diff-changed'>--client_email=email@domain.com</span></code></div>
<p><span class='diff-changed'></span><strong><span class='diff-changed'>To install aegir with Drush 5</span></strong><span class='diff-changed'> remember to replace client_email in the last command with your own email address</span><br /><span class='diff-added'></span></p>
<div class="codeblock"><code>$ <span class='diff-changed'>brew install drush</span><br /><span class='diff-changed'>$ drush dl --destination=/users/`whoami`/.drush provision-6.x-2.x</span><br /><span class='diff-deleted'>
</span><div class="codeblock"><span class='diff-deleted'></span><code>$ drush hostmaster-install --aegir_root=&#039;/var/aegir&#039; <span class='diff-changed'>--root=&#039;/var/aegir/hostmaster-6.x-2.x-dev&#039;</span> --http_service_type=nginx<span class='diff-added'> --aegir_host=aegir.ld&nbsp; --client_email=email@domain.com</span></code></div>
<p><span class='diff-added'>Remember to copy the one time login link and set your aegir admin password.</span></p><span class='diff-added'></span></li>
<li>Remove the default platforms dir and create a symlink for so you can put your Platforms in ~/Sites/ directory<br />
<div class="codeblock"><code>$ mkdir /Users/`whoami`/Sites<br />$ rmdir /var/aegir/platforms<br />$ ln -s /Users/`whoami`/Sites /var/aegir/platforms</code><span class='diff-added'></span></div><span class='diff-added'>
</span></li><span class='diff-added'>
</span><li><span class='diff-added'>Disable the forced caching in aegir (this is for local dev after all!)</span><br /><span class='diff-added'>
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>$ nano /var/aegir/config/includes/global.inc</span></code><span class='diff-added'></span></div><span class='diff-added'>
</span><p><span class='diff-added'>Paste the following text at the bottom of the document and save with CTRL +X then Y and return</span><br /><span class='diff-added'></span></p><span class='diff-added'>
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>unset($conf[&#039;cache&#039;]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // disable hardcoded caching</span><br /><span class='diff-added'>unset($conf[&#039;preprocess_css&#039;]); // disable hardcoded css aggregation</span><br /><span class='diff-added'>unset($conf[&#039;preprocess_js&#039;]);&nbsp; // disable hardcoded js aggregation</span></code></div>
</li>
<li>Open your web browser and start creating platforms and sites!<br />
<a href="http://aegir.ld/">http://aegir.ld</a></li>
</ul><span class='diff-added'>
</span><p><span class='diff-added'>This document was compiled by Brian Gilbert of </span><a href="http://realityloop.com/"><span class='diff-added'>Realityloop</span></a><span class='diff-added'>, if you had any issues or would like to say thanks post it in the comments of the original blog </span><a href="http://realityloop.com/blog/2012/07/03/nginx-mariadb-php-aegir-mac-os-x-optional-drush-5-works-mountain-lion"><span class='diff-added'>nginx / MariaDB / PHP / Aegir on Mac OS X with optional Drush 5 (works on Mountain Lion!)</span></a><span class='diff-added'></span></p>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-47.html?destination=node%2F931%23comment-form">Login</a> or <a href="../../../../../user/register/index-47.html?destination=node%2F931%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-47.html?destination=node%2F931%23comment-form">Login</a> or <a href="../../../../../user/register/index-47.html?destination=node%2F931%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/931/revisions/3642/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:03:15 GMT -->
</html>
