<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/31/revisions/76/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:18:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../../developing/index.html" />
<link rel="up" href="../../../../../developing/index.html" />
<link rel="next" href="../../../../185/index.html" />
<link rel="prev" href="../../../../../developing/index.html" />
<link rel="up" href="../../../../../developing/index.html" />
<link rel="next" href="../../../../185/index.html" />
<link rel="prev" href="../../../../../developing/index.html" />
<link rel="up" href="../../../../../developing/index.html" />
<link rel="next" href="../../../../185/index.html" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Git access to the code from Wed, 10/27/2010 - 08:25 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-31" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../index.html">Git access to the code</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div id='diff-inline-31'><div class='diff-inline-metadata clear-block'><div class='diff-inline-byline'>Updated by <a href="../../../../../users/mig5/index.html" class="username" title="View user profile.">mig5</a> on 10/27/2010 - 08:25</div><div class='diff-inline-legend clear-block'><label>Legend</label><span class='diff-added'>Added</span><span class='diff-changed'>Changed</span><span class='diff-deleted'>Deleted</span></div></div><p><span class='diff-added'>The Aegir project uses </span>Git<span class='diff-added'> as a version control system for managing the project code.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Aegir is also made up of several separate components designed to work together.</span></p><span class='diff-added'>

</span><h1><span class='diff-added'>Repositories locations</span></h1><span class='diff-added'>

</span><p><span class='diff-added'>Once upon a time, these components were stored on drupal.org and managed using Drupal's CVS system. Remnants of those projects are still located on drupal.org and for historical purposes, we maintain the Issue queues in their original locations there.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>The git repositories are stored on </span><a href="http://koumbit.org/"><span class='diff-added'>Koumbit's</span></a><span class='diff-added'> servers.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>There is a web interface for your perusal at </span><a href="http://git.aegirproject.org/" title="http://git.aegirproject.org"><span class='diff-added'>http://git.aegirproject.org</span></a><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>There are the URLs you can use to pull the repositories:</span></p><span class='diff-added'>

</span><ul><span class='diff-added'>
</span><li><span class='diff-added'>Provision - </span><code><span class='diff-added'>git clone git://git.aegirproject.org/provision</span></code><span class='diff-added'></span></li><span class='diff-added'>
</span><li><span class='diff-added'></span><p><span class='diff-added'>Hostmaster - </span><code><span class='diff-added'>git://git.aegirproject.org/hostmaster</span></code><span class='diff-added'></span></p><span class='diff-added'></span></li><span class='diff-added'>
</span><li><span class='diff-added'></span><p><span class='diff-added'>Drush is also available through an unofficial repo: </span><code><span class='diff-added'>git clone git://git.koumbit.net/drupal/modules/drush</span></code><span class='diff-added'>. This repository is synced with CVS every thirty minutes.</span></p><span class='diff-added'></span></li><span class='diff-added'>
</span></ul><span class='diff-added'>

</span><p><span class='diff-added'>Developers with push</span> access to the<span class='diff-added'> repositories should pull via SSH.</span></p><span class='diff-added'>

</span><h1><span class='diff-added'>Branch naming convention</span></h1><span class='diff-added'>

</span><ul><span class='diff-added'>
</span><li><span class='diff-added'></span><code><span class='diff-added'>master</span></code><span class='diff-added'> is always the main development branch. Think of it as CVS </span><code><span class='diff-added'>HEAD</span></code><span class='diff-added'>. When you commit there, you make everyone suffer, so unless you are confident your change needs to be in the mainline, you are likely to want to use feature branches (below).</span></li><span class='diff-added'>
</span><li><span class='diff-added'></span><code><span class='diff-added'>aegir-0.x</span></code><span class='diff-added'> are stable branch releases, where </span><code><span class='diff-added'>aegir</span></code><span class='diff-added'> is the subproject name (e.g. </span><code><span class='diff-added'>provision-0.4-alpha3</span></code><span class='diff-added'>, </span><code><span class='diff-added'>hostmaster-0.4</span></code><span class='diff-added'>). We don't have that in CVS: they allow us to roll point releases on our production releases. This branch will have tags like </span><code><span class='diff-added'>aegir-0.x.1, aegir-0.x.2, aegir-0.x.y</span></code><span class='diff-added'>. Once we hit 1.0, it's exactly the same thing without the 0.: branch is </span><code><span class='diff-added'>aegir-1</span></code><span class='diff-added'> and tags are </span><code><span class='diff-added'>aegir-1.x</span></code><span class='diff-added'>. Commits to those branches should be first tested on the master branch (if possible) and then carefully tested there through alpha/beta/rc stages before a new tag is laid.</span></li><span class='diff-added'>
</span><li><span class='diff-added'>development or "feature" branches must be prefixed with "dev-" and use the issue number (if available or relevant) and a short name. So for example, there could be work on a </span><code><span class='diff-added'>dev-12345-mybug</span></code><span class='diff-added'> branch or </span><code><span class='diff-added'>dev-dns</span></code><span class='diff-added'> branch for a larger feature (DNS, in that case) which doesn't fit in a single issue.</span></li><span class='diff-added'>
</span></ul><span class='diff-added'>

</span><p><span class='diff-added'>It is important that this naming convention be followed, particularly for release tags, as the tags are used to generate the tarballs published on </span><a href="http://files.aegirproject.org/" title="http://files.aegirproject.org/"><span class='diff-added'>http://files.aegirproject.org/</span></a><span class='diff-added'>. (See </span><a href="http://git.koumbit.net/?p=tools/git-hooks/.git;a=blob;f=archive-tag"><span class='diff-added'>this script</span></a><span class='diff-added'> for details on how this works.) So if a tag named </span><code><span class='diff-added'>provision-0.4</span></code><span class='diff-added'> is pushed, the </span><code><span class='diff-added'>provision-0.4.tgz</span></code><span class='diff-added'> file will be generated.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Deprecated and/or merged branches will be moved to an eventual "attic", a clone of the main repository that will keep all dead branches. We will cleanup every major release.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>The CVS tags and branches are still accessible in git and will be kept there for posterity. They respect the traditional Drupal.org naming convention.</span></p><span class='diff-added'>

</span><h1><span class='diff-added'>CVS synchronisation</span></h1><span class='diff-added'>

</span><p><span class='diff-added'>These old instructions do not apply anymore: all of the Aegir</span> code<span class='diff-added'> is now hosted in git and not synced to CVS anymore. This documentation is kept in case we need to maintain third party CVS modules (like drush, for example).</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Get a clone of the cvs for one module</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>Sometimes you want to fetch a module and to create a local 'git-clone'.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>You need git and git-cvsimport installed.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>in a directory you want to store modules like ~/dev/git-contrib
on_your_command_line:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git cvsimport -v -d :pserver:anonymous@cvs.drupal.org:/cvs/drupal-contrib -C module_directory contributions/modules/module_directory</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>e.g. to fetch the module amplify
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git cvsimport -v -d :pserver:anonymous@cvs.drupal.org:/cvs/drupal-contrib -C amplify contributions/modules/amplify</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>Use the same command to update your local git-repository.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>git cvsimport creates on your computer the directory for the module (amplify) and the git repository (amplify/.git)
.git is a hidden directory.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>In Unix environments, use ls -la to see the .git directory.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>This is a way to fetch all modules (time consuming), but for some modules this does not work, since git cvsimport throws an error (for different reasons).</span></p><span class='diff-added'>

</span><p><span class='diff-added'>If successful, you will find in the modules directory (git working dir) the last state of development (Head).</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Check the status of the local git repository:
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git status</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>See the commit messages:
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git log</span></code><span class='diff-added'></span></div><span class='diff-added'>
check all 'releases'
git tag</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Create a new branch for your local development:
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git checkout -b &lt;new_branch_name&gt;</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Committing and sharing changes</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>So say you have some work you want to do on the provision module. You first need to clone the repository:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git clone git://git.koumbit.net/drupal/modules/provision</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>That will create a 'provision' directory with the whole history of the project, and a checkout of the "master" branch (which is the equivalent of CVS's "HEAD" in git).</span></p><span class='diff-added'>

</span><p><span class='diff-added'>You make some modifications to the code to fix a bug, and then, you make a commit. That commit will only be local for now, that's the way git works:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>vi provision.inc</span><br /><span class='diff-added'>git commit -m&quot;#12345 fix that pesky bug in provision.inc&quot; provision.inc</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>Note that contrarily to subversion or CVS, you need to explicitly mention which file(s) you want to commit. You can also use the -a flag to commit all changes.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>If you have write access to the repository, you can now push your changes straight into git. However, the git:// url above is readonly, so you will want to use SSH to push your changes. For that, you will first need to add a special "remote" repository to push your changes. You will need to do this only once (per repository):</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git remote add koumbit git.koumbit.net:/srv/git/drupal/modules/provision</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>You can now push your changes to that repository.</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git push koumbit</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>If you do </span><em><span class='diff-added'>not</span></em><span class='diff-added'> have write access to the repository, you can send me the patches by email (contact me through the contact form first) using git-send-email or git-format-patches.</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Pushing changes to CVS</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>Now pushing to koumbit above does not yet commit to CVS. We would like to fix that, but it would probably involve hosting the repositories directly on Drupal.org with access to the CVS repository.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>To commit to CVS, you need to already have a checkout of the CVS repository, logged in as a user that has write access to the repository. Then you need to run this:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git-cvsexportcommit -c -p -v -w /home/anarcat/dist/provision.cvs/ &lt;COMMIT-ID&gt;</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>The trick is to find the commit id. I have been able to sync a bunch of commits at a time using the following formula:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git-cherry origin master | sed -n &#039;s/^+ //p&#039; | xargs -l1 git-cvsexportcommit -c -p -v -w /home/anarcat/dist/provision.cvs/</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>... but it involves having the origin and master branches synced manually, which doesn't work.</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Automatically commiting on push</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>I'm working on automatically pushing the changes to CVS when pushing to the central repository. The *receive hooks get passed the commits that delimit the commits pushed, and on which branch:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>e402d8011e3e857cc2ed718246c3cfe8bfcaf045 06b337116329d0972b9bf11c0f0f07c624606285 refs/heads/master</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>The </span><code><span class='diff-added'>refs/heads/master</span></code><span class='diff-added'> part shows which branch we're on and can be used to decide where to push in CVS (HEAD/DRUPAL-N...). (In fact the git-cherry syntax is more like:</span></p><span class='diff-added'>

</span><p><span class='diff-added'>That is all we need to commit it all. We can use git-log to figure out the exact list of commits we want to push out:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>$ git log --pretty=format:%H e402d8011e3e857cc2ed718246c3cfe8bfcaf045..06b337116329d0972b9bf11c0f0f07c624606285</span><br /><span class='diff-added'>06b337116329d0972b9bf11c0f0f07c624606285</span><br /><span class='diff-added'>9dbf8f561a85e3f6a686e99037744ce2bf5df126</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>Now the only thing missing is the permissions issues.</span></p></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-419.html?destination=node%2F31%23comment-form">Login</a> or <a href="../../../../../user/register/index-419.html?destination=node%2F31%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_comments last"><a href="../../../talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>


    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/31/revisions/76/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:18:59 GMT -->
</html>
