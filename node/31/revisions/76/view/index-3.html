<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/31/revisions/76/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:18:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../../developing/index.html" />
<link rel="up" href="../../../../../developing/index.html" />
<link rel="next" href="../../../../185/index.html" />
<link rel="prev" href="../../../../../developing/index.html" />
<link rel="up" href="../../../../../developing/index.html" />
<link rel="next" href="../../../../185/index.html" />
<link rel="prev" href="../../../../../developing/index.html" />
<link rel="up" href="../../../../../developing/index.html" />
<link rel="next" href="../../../../185/index.html" />
<link rel="canonical" href="index.html" />
<link rel="prev" href="../../../index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../186/index.html" />
<link rel="prev" href="../../../../185/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../../content/branch-and-tagging-conventions/index.html" />
<link rel="prev" href="../../../../186/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../385/index.html" />
<link rel="prev" href="../../../../../content/branch-and-tagging-conventions/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../../developing/architecture/index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Git access to the code from Wed, 10/27/2010 - 08:25 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-31" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../index.html">Git access to the code</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div id='diff-inline-31'><div class='diff-inline-metadata clear-block'><div class='diff-inline-byline'>Updated by <a href="../../../../../users/mig5/index.html" class="username" title="View user profile.">mig5</a> on 10/27/2010 - 08:25</div><div class='diff-inline-legend clear-block'><label>Legend</label><span class='diff-added'>Added</span><span class='diff-changed'>Changed</span><span class='diff-deleted'>Deleted</span></div></div><p><span class='diff-added'>The Aegir project uses </span>Git<span class='diff-added'> as a version control system for managing the project code.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Aegir is also made up of several separate components designed to work together.</span></p><span class='diff-added'>

</span><h1><span class='diff-added'>Repositories locations</span></h1><span class='diff-added'>

</span><p><span class='diff-added'>Once upon a time, these components were stored on drupal.org and managed using Drupal's CVS system. Remnants of those projects are still located on drupal.org and for historical purposes, we maintain the Issue queues in their original locations there.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>The git repositories are stored on </span><a href="http://koumbit.org/"><span class='diff-added'>Koumbit's</span></a><span class='diff-added'> servers.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>There is a web interface for your perusal at </span><a href="http://git.aegirproject.org/" title="http://git.aegirproject.org"><span class='diff-added'>http://git.aegirproject.org</span></a><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>There are the URLs you can use to pull the repositories:</span></p><span class='diff-added'>

</span><ul><span class='diff-added'>
</span><li><span class='diff-added'>Provision - </span><code><span class='diff-added'>git clone git://git.aegirproject.org/provision</span></code><span class='diff-added'></span></li><span class='diff-added'>
</span><li><span class='diff-added'></span><p><span class='diff-added'>Hostmaster - </span><code><span class='diff-added'>git://git.aegirproject.org/hostmaster</span></code><span class='diff-added'></span></p><span class='diff-added'></span></li><span class='diff-added'>
</span><li><span class='diff-added'></span><p><span class='diff-added'>Drush is also available through an unofficial repo: </span><code><span class='diff-added'>git clone git://git.koumbit.net/drupal/modules/drush</span></code><span class='diff-added'>. This repository is synced with CVS every thirty minutes.</span></p><span class='diff-added'></span></li><span class='diff-added'>
</span></ul><span class='diff-added'>

</span><p><span class='diff-added'>Developers with push</span> access to the<span class='diff-added'> repositories should pull via SSH.</span></p><span class='diff-added'>

</span><h1><span class='diff-added'>Branch naming convention</span></h1><span class='diff-added'>

</span><ul><span class='diff-added'>
</span><li><span class='diff-added'></span><code><span class='diff-added'>master</span></code><span class='diff-added'> is always the main development branch. Think of it as CVS </span><code><span class='diff-added'>HEAD</span></code><span class='diff-added'>. When you commit there, you make everyone suffer, so unless you are confident your change needs to be in the mainline, you are likely to want to use feature branches (below).</span></li><span class='diff-added'>
</span><li><span class='diff-added'></span><code><span class='diff-added'>aegir-0.x</span></code><span class='diff-added'> are stable branch releases, where </span><code><span class='diff-added'>aegir</span></code><span class='diff-added'> is the subproject name (e.g. </span><code><span class='diff-added'>provision-0.4-alpha3</span></code><span class='diff-added'>, </span><code><span class='diff-added'>hostmaster-0.4</span></code><span class='diff-added'>). We don't have that in CVS: they allow us to roll point releases on our production releases. This branch will have tags like </span><code><span class='diff-added'>aegir-0.x.1, aegir-0.x.2, aegir-0.x.y</span></code><span class='diff-added'>. Once we hit 1.0, it's exactly the same thing without the 0.: branch is </span><code><span class='diff-added'>aegir-1</span></code><span class='diff-added'> and tags are </span><code><span class='diff-added'>aegir-1.x</span></code><span class='diff-added'>. Commits to those branches should be first tested on the master branch (if possible) and then carefully tested there through alpha/beta/rc stages before a new tag is laid.</span></li><span class='diff-added'>
</span><li><span class='diff-added'>development or "feature" branches must be prefixed with "dev-" and use the issue number (if available or relevant) and a short name. So for example, there could be work on a </span><code><span class='diff-added'>dev-12345-mybug</span></code><span class='diff-added'> branch or </span><code><span class='diff-added'>dev-dns</span></code><span class='diff-added'> branch for a larger feature (DNS, in that case) which doesn't fit in a single issue.</span></li><span class='diff-added'>
</span></ul><span class='diff-added'>

</span><p><span class='diff-added'>It is important that this naming convention be followed, particularly for release tags, as the tags are used to generate the tarballs published on </span><a href="http://files.aegirproject.org/" title="http://files.aegirproject.org/"><span class='diff-added'>http://files.aegirproject.org/</span></a><span class='diff-added'>. (See </span><a href="http://git.koumbit.net/?p=tools/git-hooks/.git;a=blob;f=archive-tag"><span class='diff-added'>this script</span></a><span class='diff-added'> for details on how this works.) So if a tag named </span><code><span class='diff-added'>provision-0.4</span></code><span class='diff-added'> is pushed, the </span><code><span class='diff-added'>provision-0.4.tgz</span></code><span class='diff-added'> file will be generated.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Deprecated and/or merged branches will be moved to an eventual "attic", a clone of the main repository that will keep all dead branches. We will cleanup every major release.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>The CVS tags and branches are still accessible in git and will be kept there for posterity. They respect the traditional Drupal.org naming convention.</span></p><span class='diff-added'>

</span><h1><span class='diff-added'>CVS synchronisation</span></h1><span class='diff-added'>

</span><p><span class='diff-added'>These old instructions do not apply anymore: all of the Aegir</span> code<span class='diff-added'> is now hosted in git and not synced to CVS anymore. This documentation is kept in case we need to maintain third party CVS modules (like drush, for example).</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Get a clone of the cvs for one module</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>Sometimes you want to fetch a module and to create a local 'git-clone'.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>You need git and git-cvsimport installed.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>in a directory you want to store modules like ~/dev/git-contrib
on_your_command_line:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git cvsimport -v -d :pserver:anonymous@cvs.drupal.org:/cvs/drupal-contrib -C module_directory contributions/modules/module_directory</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>e.g. to fetch the module amplify
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git cvsimport -v -d :pserver:anonymous@cvs.drupal.org:/cvs/drupal-contrib -C amplify contributions/modules/amplify</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>Use the same command to update your local git-repository.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>git cvsimport creates on your computer the directory for the module (amplify) and the git repository (amplify/.git)
.git is a hidden directory.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>In Unix environments, use ls -la to see the .git directory.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>This is a way to fetch all modules (time consuming), but for some modules this does not work, since git cvsimport throws an error (for different reasons).</span></p><span class='diff-added'>

</span><p><span class='diff-added'>If successful, you will find in the modules directory (git working dir) the last state of development (Head).</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Check the status of the local git repository:
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git status</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>See the commit messages:
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git log</span></code><span class='diff-added'></span></div><span class='diff-added'>
check all 'releases'
git tag</span></p><span class='diff-added'>

</span><p><span class='diff-added'>Create a new branch for your local development:
</span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git checkout -b &lt;new_branch_name&gt;</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Committing and sharing changes</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>So say you have some work you want to do on the provision module. You first need to clone the repository:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git clone git://git.koumbit.net/drupal/modules/provision</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>That will create a 'provision' directory with the whole history of the project, and a checkout of the "master" branch (which is the equivalent of CVS's "HEAD" in git).</span></p><span class='diff-added'>

</span><p><span class='diff-added'>You make some modifications to the code to fix a bug, and then, you make a commit. That commit will only be local for now, that's the way git works:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>vi provision.inc</span><br /><span class='diff-added'>git commit -m&quot;#12345 fix that pesky bug in provision.inc&quot; provision.inc</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>Note that contrarily to subversion or CVS, you need to explicitly mention which file(s) you want to commit. You can also use the -a flag to commit all changes.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>If you have write access to the repository, you can now push your changes straight into git. However, the git:// url above is readonly, so you will want to use SSH to push your changes. For that, you will first need to add a special "remote" repository to push your changes. You will need to do this only once (per repository):</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git remote add koumbit git.koumbit.net:/srv/git/drupal/modules/provision</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>You can now push your changes to that repository.</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git push koumbit</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>If you do </span><em><span class='diff-added'>not</span></em><span class='diff-added'> have write access to the repository, you can send me the patches by email (contact me through the contact form first) using git-send-email or git-format-patches.</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Pushing changes to CVS</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>Now pushing to koumbit above does not yet commit to CVS. We would like to fix that, but it would probably involve hosting the repositories directly on Drupal.org with access to the CVS repository.</span></p><span class='diff-added'>

</span><p><span class='diff-added'>To commit to CVS, you need to already have a checkout of the CVS repository, logged in as a user that has write access to the repository. Then you need to run this:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git-cvsexportcommit -c -p -v -w /home/anarcat/dist/provision.cvs/ &lt;COMMIT-ID&gt;</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>The trick is to find the commit id. I have been able to sync a bunch of commits at a time using the following formula:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>git-cherry origin master | sed -n &#039;s/^+ //p&#039; | xargs -l1 git-cvsexportcommit -c -p -v -w /home/anarcat/dist/provision.cvs/</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>... but it involves having the origin and master branches synced manually, which doesn't work.</span></p><span class='diff-added'>

</span><h2><span class='diff-added'>Automatically commiting on push</span></h2><span class='diff-added'>

</span><p><span class='diff-added'>I'm working on automatically pushing the changes to CVS when pushing to the central repository. The *receive hooks get passed the commits that delimit the commits pushed, and on which branch:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>e402d8011e3e857cc2ed718246c3cfe8bfcaf045 06b337116329d0972b9bf11c0f0f07c624606285 refs/heads/master</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>The </span><code><span class='diff-added'>refs/heads/master</span></code><span class='diff-added'> part shows which branch we're on and can be used to decide where to push in CVS (HEAD/DRUPAL-N...). (In fact the git-cherry syntax is more like:</span></p><span class='diff-added'>

</span><p><span class='diff-added'>That is all we need to commit it all. We can use git-log to figure out the exact list of commits we want to push out:</span></p><span class='diff-added'>

</span><p><span class='diff-added'></span><div class="codeblock"><span class='diff-added'></span><code><span class='diff-added'>$ git log --pretty=format:%H e402d8011e3e857cc2ed718246c3cfe8bfcaf045..06b337116329d0972b9bf11c0f0f07c624606285</span><br /><span class='diff-added'>06b337116329d0972b9bf11c0f0f07c624606285</span><br /><span class='diff-added'>9dbf8f561a85e3f6a686e99037744ce2bf5df126</span></code><span class='diff-added'></span></div><span class='diff-added'></span></p><span class='diff-added'>

</span><p><span class='diff-added'>Now the only thing missing is the permissions issues.</span></p></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-419.html?destination=node%2F31%23comment-form">Login</a> or <a href="../../../../../user/register/index-419.html?destination=node%2F31%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_comments last"><a href="../../../talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>



<div  id="node-185" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../185/index.html">A crash course in Git</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <h2>Clone a repo</h2>

<p>Let's take hostmaster:</p>

<p><div class="codeblock"><code>git clone http://git.drupalcode.org/project/hostmaster.git</code></div></p>

<p>If successful, you will have a hostmaster directory at the last state of development ('HEAD' in CVS speak, usually 'master' branch in git speak, though in our case this is <a href="../../../../524/index.html">now 6.x-1.x</a>).</p>

<h2>Check the status of the local git repository:</h2>

<p><div class="codeblock"><code>git status</code></div></p>

<h2>See the commit messages:</h2>

<p><div class="codeblock"><code>git log</code></div></p>

<h2>Check all 'releases'</h2>

<p><div class="codeblock"><code>git tag</code></div></p>

<h2>Create a new branch for your local development:</h2>

<p><div class="codeblock"><code>git checkout -b &lt;new_branch_name&gt;</code></div></p>

<h2>Create a new branch for development, based on an existing remote branch or tag</h2>

<p><div class="codeblock"><code>git checkout -b &lt;new_branch_name&gt; origin/&lt;branch_name&gt;</code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-194.html?destination=node%2F185%23comment-form">Login</a> or <a href="../../../../../user/register/index-194.html?destination=node%2F185%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-194.html?destination=node%2F185%23comment-form">Login</a> or <a href="../../../../../user/register/index-194.html?destination=node%2F185%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-186" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../186/index.html">Basic git workflow: committing and pushing</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>So say you have some work you want to do on the hostmaster module. You first need to clone the repository:</p>

<p><div class="codeblock"><code>git clone http://git.drupal.org/project/hostmaster.git</code></div></p>

<p>That will create a <code>hostmaster</code> directory with the whole history of the project, and a checkout of the "master" branch (which is the equivalent of CVS's "HEAD" in git).</p>

<p>You make some modifications to the code to fix a bug, and then, you make a commit. That commit will only be local for now, that's the way git works:</p>

<p><div class="codeblock"><code>vi hostmaster.profile<br />git commit -m &quot;#12345 fix the install profile to do X&quot; hostmaster.profile</code></div></p>

<p>Note that contrarily to subversion or CVS, you need to explicitly mention which file(s) you want to commit. You can also use the -a flag to commit all changes.</p>

<p>If you have write access to the repository, you can now push your changes straight into git. However, the git:// url above is readonly, so you will want to use SSH to push your changes. For that, we will have had to add your SSH public key to our repositories. You may also want to add a special "remote" repository to push your changes. You will need to do this only once (per repository):</p>

<p><div class="codeblock"><code>git remote add drupalorg ssh://[username]@git.drupal.org/project/hostmaster.git</code></div></p>

<p>You can now push your changes to that repository.</p>

<p><div class="codeblock"><code>git push drupalorg</code></div></p>

<p>If you do <em>not</em> have write access to the repository, you can send the Aegir developers patches by submitting them for review in the <a href="http://drupal.org/project/issues?text=&amp;projects=hosting,+provision,+eldir,+Hostmaster+(Aegir)&amp;status=Open&amp;priorities=All&amp;categories=All">Issue queues</a> (see the <a href="http://drupal.org/node/1054616">patch contributor guide on drupal.org</a> for more details) or by uploading them to your <a href="http://drupal.org/node/1053378">personnal sandbox</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-420.html?destination=node%2F186%23comment-form">Login</a> or <a href="../../../../../user/register/index-420.html?destination=node%2F186%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../186/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-187" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/branch-and-tagging-conventions/index.html">Branch and tagging conventions</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>Aegir development makes a heavy use of branches to keep development stable. We use feature branches to do large development work and have release branches to keep stable releases maintained while development happen on the development branches.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Summary"><span class="toc-number">1. </span>Summary</a></li>
	<li class="toc-level-1"><a href="#Branch_naming_conventions"><span class="toc-number">2. </span>Branch naming conventions</a>
<ol>
	<li class="toc-level-2"><a href="#Main_development_branch"><span class="toc-number">2.1. </span>Main development branch</a></li>
	<li class="toc-level-2"><a href="#Stable_release_branches"><span class="toc-number">2.2. </span>Stable release branches</a></li>
	<li class="toc-level-2"><a href="#Feature_branches"><span class="toc-number">2.3. </span>Feature branches</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Tag_naming_convention"><span class="toc-number">3. </span>Tag naming convention</a></li>
	<li class="toc-level-1"><a href="#CVS_and_git_history"><span class="toc-number">4. </span>CVS and git history</a></li>
</ol>
</div>
</div>

<h1 id="Summary">1. Summary</h1>

<ul>
<li>The current <strong>development branch</strong> is: 7.x-3.x</li>
<li>The current <strong>stable branch</strong> is: 6.x-2.x</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Branch_naming_conventions">2. Branch naming conventions</h1>

<p>All branches are either development branches, stable branches or feature branches. Development and stable branches have the same naming convention:  <code>6.x-2.x</code> or <code>7.x-3.x</code>. The only different between the two is that a stable branch is the branch where stable releases are published from.</p>

<p><em>Note</em>: since the <a href="../../../../385/index.html">great git.drupal.org migration</a>, we are back on Drupal.org and have been forced to change some of our naming convention, especially to include the core release number in the tag (so <code>6.x-2.x</code>), which is a source of confusion for our <code>provision</code> module which supports any Drupal core version.  See <a href="http://drupal.org/node/322626#comment-4116688">this issue on drupal.org</a> for followup.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Main_development_branch">2.1. Main development branch</h2>

<p>The main development branch is created after a fully stable release is published. For example, the <code>6.x-2.x</code> branch has been created when the 1.0 release was published. It is  a development branch until it is considered feature-complete and goes through the alpha/beta/rc release cycle, at which point it will be declared a stable branch and a new development branch will be created (<code>7.x-3.x</code> at that point).</p>

<p>The development branch is <strong>not stable</strong> and should <strong>not be used in production environments</strong>.</p>

<p><em>Note that we have <a href="../../../../524/index.html">dropped the master branch</a> as it is not well supported on Drupal.org for releases.</em></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Stable_release_branches">2.2. Stable release branches</h2>

<p>Stable releases are performed from stable release branches. A branch is declared stable only after it went through the complete alpha/beta/rc release cycle, as detailed above..</p>

<p>Once the branch is declared stable, new releases are quickly done as "hotfixes", without intervening alpha/beta/rc releases. So for example, <code>6.x-1.0</code> will come after <code>6.x-1.0-alpha1</code>, <code>6.x-1.0-beta1</code>, <code>6.x-1.0-rc1</code> <em>at least</em>, and then be followed directly by <code>6.x-1.1</code>.</p>

<p>Releases on the same stable branch are API-compatible with each other (so <code>1.1</code> is compatible with <code>1.0</code>). The upgrade path is supported between major stable releases (so you can upgrade from <code>1.0</code> to <code>1.1</code> or <code>2.0</code>).</p>

<p><strong>Special case</strong>: during the 0.x release cycle, releases were not API-compatible with each other, ie. 0.4 was <em>not</em> compatible with 0.3, and you could barely upgrade from 0.3 to 0.4.</p>

<p>Only one stable branch is maintained at a time.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Feature_branches">2.3. Feature branches</h2>

<p>More complex development goes into development or "feature" branches, to avoid making <code>master</code> too unstable. Feature branches must be prefixed with "dev-" and use the issue number (if available or relevant) and a short name. So for example, there could be work on a <code>dev-12345-mybug</code> branch or <code>dev-dns</code> branch for a larger feature (DNS, in that case) which doesn't fit in a single issue.</p>

<p>Feature branches should be based of a known stable baseline as much as possible. For example, you should branch off the last alpha release if you want to make merging with other dev branches and master easier. See <a href="http://developers.slashdot.org/story/10/11/30/1649231/Linus-On-Branching-Practices">this article</a> for a thorough discussion on this practice</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Tag_naming_convention">3. Tag naming convention</h1>

<p>Every release is tagged with a <code>6.x-x.y</code> tag (e.g. <code>6.x-0.4</code>, <code>6.x-0.4-alpha15</code> or <code>6.x-1.0</code>). Those tags are usually laid on the stable branches, except for alpha/beta/rc releases which are laid on the development branch.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="CVS_and_git_history">4. CVS and git history</h1>

<p>The CVS tags and branches are still accessible in git and will be kept there for posterity. They respect the traditional Drupal.org naming convention.</p>

<p>They have also been converted to the new git.drupal.org conventions during the <a href="../../../../385/index.html">great git.drupal.org migration</a>.</p>

<p>Since that migration (february 2011), history has been rewritten to clean up the authors in the history.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-195.html?destination=node%2F187%23comment-form">Login</a> or <a href="../../../../../user/register/index-195.html?destination=node%2F187%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-195.html?destination=node%2F187%23comment-form">Login</a> or <a href="../../../../../user/register/index-195.html?destination=node%2F187%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-385" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../385/index.html">The great git.drupal.org migration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>After <a href="../../../../369/index.html">thorough discussions</a> where we weighted the pros and cons of profiting from the <a href="http://drupal.org/project/great_git_migration">Great Git Migration</a>, I think it's pretty clear that we have a great opportunity to migrate our source repositories back to Drupal.org. We will get:</p>

<ul>
<li>more visibility - people will find us through drupal.org easily</li>
<li>more consistency - versions in the issue queue matching the real releases</li>
<li>even more consistency - people will find the source better from drupal.org</li>
<li>and then more consistency - usage stats will work again!</li>
</ul>

<p>We will be able to:</p>

<ul>
<li>host our module and theme within the install profile - the major reason why we migrated away back then</li>
<li>use whatever naming convention we want for tags and branches - although only some will be used for releases for now, see <a href="http://drupal.org/node/322626#comment-4116688">this issue</a> for follow-up</li>
<li>keep our history - the <a href="http://groups.drupal.org/drupal-org-git-migration-team">git team</a> was nice enough to clone directly from our repositories (although see below, we're taking the opportunity of the migration to clean up our history)</li>
</ul>

<h1>What it means for you</h1>

<p>This does have an impact on your existing repositories. Since we migrated to git.drupal.org, the repositories have changed location. The other thing is that the commit IDs have changed, and you will need to clone new checkouts before you can work with them effectively.</p>

<p>So in short:</p>

<ul>
<li>repos will move to git.drupal.org</li>
<li>you need to clone again</li>
<li>make sure your identity is set correctly</li>
</ul>

<h1>URL changes</h1>

<p>So the repositories have moved. Everyone has to fetch the source code from <a href="http://git.drupal.org/">git.drupal.org</a> now. At some point in the future, <a href="http://koumbit.org/">Koumbit</a> will close <a href="../git.aegirproject/index.html">git.aegirproject.org</a>. Concretely, Koumbit will keep the mirror running readonly for a while just to be on the safe side, but you shouldn't expect git.aegirproject.org to work and should switch URLs, as detailed below.</p>

<p>This documentation is taken from the <a href="http://drupal.org/node/1054594">Drupal.org git workflows documentation</a>.</p>

<h2>Readonly repositories URL change</h2>

<p>The readonly access will change from:</p>

<p><div class="codeblock"><code>git://git.aegirproject.org/provision.git<br />git://git.aegirproject.org/hostmaster.git</code></div></p>

<p>to:</p>

<p><div class="codeblock"><code>http://git.drupal.org/project/provision.git<br />http://git.drupal.org/project/hostmaster.git</code></div></p>

<p>See also the <a href="http://drupal.org/node/1054616">git patch maintainer guide</a>.</p>

<h2>Core committers repositories URL change</h2>

<p>The read/write access will change from:</p>

<p><div class="codeblock"><code>ssh://gitosis@git.aegirproject.org/provision.git<br />ssh://gitosis@git.aegirproject.org/hostmaster.git</code></div></p>

<p>to:</p>

<p><div class="codeblock"><code>ssh://[username]@git.drupal.org/project/provision.git<br />ssh://[username]@git.drupal.org/project/hostmaster.git</code></div></p>

<p>... notice how you will need to set your Drupal.org username in the URL. Drupal.org has good documentation on <a href="http://drupal.org/node/1027094">how  authentication works on git.drupal.org</a>. See also <a href="http://drupal.org/node/1059322">the project maintainer git guide</a>.</p>

<h2>Sandboxes</h2>

<p>The migration to Drupal.org also introduces sandboxes, something we didn't have before, and which allows you to host your own branches of our modules (even if you're not a core committer) or contrib/test modules, directly on Drupal.org. See the <a href="http://drupal.org/node/1053378">sandbox collaboration guide</a> for more information on that.</p>

<h2>What if I pull/push from/to the wrong one?</h2>

<p>It could happen before/during/after the migration that you pull or push from or to the wrong repository. git can rebase with the new repository, but unfortunately, the old commits will be mingled with the new ones.</p>

<p>To be able to push to the new repositories, you will need to follow instructions below to cleanup your repositories.</p>

<h1>Rewriting history</h1>

<p>I have taken the liberty of rewriting our collective history. There were a lot of commits with inconsistent authors: some had invalid emails, some had no real names, some had multiple different email addresses for the same person. I narrowed the list down, through extensive detective work, to a complete list of 14 distinct authors.</p>

<p>I have rewritten all commit authors that didn't seem right to follow a consistent pattern:</p>

<p><div class="codeblock"><code>Firstname Lastname &lt;email&gt;</code></div></p>

<p>The firstname/lastname is the combination you have used in certain commits. It's not the most popular way (ie. most commits had the nickname instead of first/last), but it seems the most logical one.</p>

<p>The email was your most often used email or the one you have registered as such at drupal.org, if you didn't have an email address specified (in case you committed your code back in the days of CVS). (There are 6 commits from someone with a box at ovh.net that I could track, and that I can only guess are Miguel's, but I'm not sure so I have let those one fly. :)</p>

<p>You <strong>should</strong> make sure you have your <a href="http://drupal.org/node/1022156">identity set straight in your git configuration</a>, especially your email address, if you want your contributions to be properly credited in the future on Drupal.org. In short, this means:</p>

<p><div class="codeblock"><code>git config --global user.name &quot;User Name&quot;<br />git config --global user.email user@example.com</code></div></p>

<p>Again, see <a href="http://drupal.org/node/1022156">the manual</a> for more information, especially how this maps to your Drupal.org account.</p>

<h1>A fresh clone is necessary!!!!</h1>

<p>Note that, because we rewrote history, you will <strong>need</strong> to clone your repository from new remote. So yes, contrarily to what was documented here before, you will need to clone from scratch.</p>

<p>We understand this may be annoying if you work on a bunch of branches or have local branches you want to keep. Unfortunately, our original tests didn't cover all use cases and were misleading in thinking we could just rebase existing repositories.</p>

<h1>Other documentation</h1>

<p>People unfamiliar with git or specifically git on Drupal.org should read the <a href="http://drupal.org/documentation/git">growing git handbook</a> on Drupal.org.</p>

<p>People that <em>are</em> familiar with git should <em>contribute</em> to that manual. :)</p>

<h1>Under the hood</h1>

<p>The history rewrite was performed through git-fast-export and git-fast-import magic, with a fairly simple perl script of my own. I have cloned the current repo, filtered it and published a new version for git.drupal.org to pull. You can see the results here:</p>

<p><div class="codeblock"><code>http://git.aegirproject.org/?p=export/provision.git<br />http://git.aegirproject.org/?p=export/hostmaster.git</code></div></p>

<p>The exact calling sequence is this:</p>

<pre>
mkdir export orig
cd export
git init --bare hostmaster.git
cd ../orig
git clone --bare git://git.aegirproject.org/hostmaster
cd hostmaster.git
# look at the authors in the original repo
git fast-export --all |  grep -a '^author [^&lt;]* &lt;[^&gt;]*&gt; [0-9][0-9]* [+-][0-9][0-9][0-9][0-9]$' | sed 's/[0-9][0-9]* [+-][0-9][0-9][0-9][0-9]$//' | sort | uniq -c
git fast-export --all | perl /home/anarcat/bin/rewrite_authors.pl | ( cd ../../export/hostmaster.git ; git fast-import )
cd ../../export/hostmaster.git
# look at the authors in the new repo
git fast-export --all |  grep -a '^author [^&lt;]* &lt;[^&gt;]*&gt; [0-9][0-9]* [+-][0-9][0-9][0-9][0-9]$' | sed 's/[0-9][0-9]* [+-][0-9][0-9][0-9][0-9]$//' | sort | uniq -c
# rinse, repeat until the mapping is right
# push repositories online
git remote add origin ssh://gitosis@git.aegirproject.org/export/hostmaster.git
git push --all
git push --tags
# repeat with provision
</pre>

<p>This is the script source, without all the mappings:</p>

<pre>
#! /usr/bin/perl -w

%authors = ( 
    'anarcat ' =&gt; 'Antoine Beaupr√© ',
   # ... 
);

sub remap {
    my $a = shift;
    if ($authors{$a}) {
        return $authors{$a};
    } else {
        return $a;
    }
}

while (&lt;&gt;) {
    s#^author ([^&lt;]+ &lt;[^&gt;]+&gt;) ([0-9]+ [+-][0-9][0-9][0-9][0-9])$#'author ' . remap($1) . ' ' . $2#e;
    print;
}
</pre>

<h2>Migration checklist</h2>

<ol>
<li>serve exported repositories to migration team <strong>done!</strong></li>
<li>update the repositories with change authors <strong>done!</strong></li>
<li><a href="http://drupal.org/project/great_git_migration">the great git migration</a> <strong>done!</strong> git.aegirproject.org is now readonly, commits are pushed to git.drupal.org and releases are performed on drupal.org</li>
<li>update documentation in <a href="../../../../../handbook/index.html">handbook</a> <em>in progress!</em>

<ul>
<li><a href="../../../index.html">repositories locations</a> <strong>done</strong></li>
<li><a href="../../../../185/index.html">crash course</a> <strong>done</strong></li>
<li><a href="../../../../186/index.html">basic workflow</a> <strong>done</strong></li>
<li><a href="../../../../32/index.html">release process</a> <strong>needs review</strong> - updated for release nodes stuff, will check workflow during the next release</li>
<li><a href="../../../../187/index.html">advanced workflow: branch naming conventions</a> <strong>in progress</strong> - see <a href="http://drupal.org/node/1074876">0.4-rc2 release coordination</a></li>
<li><a href="../../../../377/index.html">migration of the install docs into the handbook work</a> <strong>in progress</strong></li>
</ul></li>
<li>update the <a href="http://www.aegirproject.org/">home page links</a> <strong>done</strong> - I have changed the link in the body from git.aegirproject.org to drupal.org provision/hostmaster project pages, and pointed the "Get the source" link in the bottom to the install manual instead</li>
<li>update makefiles and files in docs/* in provision to fetch from git.drupal.org <strong>done!</strong></li>
<li>make at least one other release <strong>done</strong> - <a href="http://drupal.org/node/1074876">0.4-rc2 release coordination</a></li>
<li>turn off git.aegirproject.org <strong>done</strong></li>
</ol>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-196.html?destination=node%2F385%23comment-form">Login</a> or <a href="../../../../../user/register/index-196.html?destination=node%2F385%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-196.html?destination=node%2F385%23comment-form">Login</a> or <a href="../../../../../user/register/index-196.html?destination=node%2F385%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/31/revisions/76/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:19:00 GMT -->
</html>
