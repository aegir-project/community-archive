<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/43/revisions/103/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:01:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../19/index.html" />
<link rel="up" href="../../../../../using/index.html" />
<link rel="next" href="../../../../22/index.html" />
<link rel="prev" href="../../../../19/index.html" />
<link rel="up" href="../../../../../using/index.html" />
<link rel="next" href="../../../../22/index.html" />
<link rel="canonical" href="index.html" />
<link rel="prev" href="../../../index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../60/index.html" />
<link rel="prev" href="../../../../22/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../42/index.html" />
<link rel="prev" href="../../../../60/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../23/index.html" />
<link rel="prev" href="../../../../42/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../../migration-tips/index.html" />
<link rel="prev" href="../../../../23/index.html" />
<link rel="up" href="../../../../23/index.html" />
<link rel="next" href="../../../../../content/renaming-aegir-hostmaster-site-itself/index.html" />
<link rel="prev" href="../../../../../migration-tips/index.html" />
<link rel="up" href="../../../../23/index.html" />
<link rel="next" href="../../../../24/index.html" />
<link rel="prev" href="../../../../../content/renaming-aegir-hostmaster-site-itself/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../25/index.html" />
<link rel="prev" href="../../../../24/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../45/index.html" />
<link rel="prev" href="../../../../25/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../26/index.html" />
<link rel="prev" href="../../../../45/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../../open-id-tips-and-tricks/index.html" />
<link rel="prev" href="../../../../26/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../../content/best-recipes-disaster-and-how-avoid-them/index.html" />
<link rel="prev" href="../../../../../open-id-tips-and-tricks/index.html" />
<link rel="up" href="../../../index.html" />
<link rel="next" href="../../../../20/index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Your site and Aegir from Fri, 10/29/2010 - 22:50 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-43" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../index.html">Your site and Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div id='diff-inline-43'><p>@TODO:</p>

<p>Explain some of the unique features of Aegir in how it manages a site, from a backend perspective:</p>

<ul>
<li>/files/ alias, to avoid images breaking on migrate/clone</li>
<li>the cloaked credentials in settings.php for security</li>
<li>permissions on files and directories</li>
<li>.htaccess and why it is ignored / how to read-in changes of a .htaccess into the platform vhost</li>
<li>the drushrc.php</li>
</ul></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-386.html?destination=node%2F43%23comment-form">Login</a> or <a href="../../../../../user/register/index-386.html?destination=node%2F43%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_comments last"><a href="../../../talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>



<div  id="node-22" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../22/index.html">Installing a new website</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>Creating a new website using Aegir is really, really easy, and is probably one of the most exciting aspects of Aegir. The very idea of clicking a button and suddenly being able to visit a new site may even be the prospect that drove you to installing Aegir in the first place.</p>

<p>To create a site you must have created a Platform first, which is the codebase, typically a copy of Drupal core, on which to place your new site. Read the <a href="../../../../20/index.html">Platform documentation</a> if you have not yet completed this stage.</p>

<h2>The Site form</h2>

<p>Much like your Platform, a site is represented as a node in the Aegir frontend. To create a new site, you must create a new Site node.</p>

<p>The site node is a form requiring various attributes to be filled out in order to accurately advise the Aegir system about what kind of site you wish to create. These fields commonly are:</p>

<ul>
<li>Domain name - the site name. This becomes the title of the node.</li>
<li>Client - who is the client or owner of this site. This field really only is relevant if you have enabled the Clients feature to manage segregations of sites between clients.</li>
<li>Install Profile - the install profile to use to install this site. This has a dramatic effect on the end result of your site</li>
<li>Platform - the platform to install the site on. The list of available platforms is based on what profile you choose above (in other words, which platforms support that install profile. The choice of platform also implies which web server hosts that platform, so this is why 'web server' is not a selectable option in the form.</li>
<li>Language - what language install the site with. This is dependent on the profile or platform chosen.</li>
<li>Database server - which database server to install the database on.</li>
</ul>

<p>Below is an example of the site form.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/site_form/index.png" /></div>

<h2>Installing the site</h2>

<p>Once you have filled out the site form per your requirements, click Save to submit the form. An 'Install' task is automatically spawned and added to the task queue for the dispatcher to execute.</p>

<p>The backend does the hard work of essentially completing a standard Drupal installation automatically. It creates a database and database user for the site, executes the Drupal installation procedure, populates the database, and generates a web server virtualhost configuration file for the site (Apache or NginX depending on your environment). In the event that the platform is located on a remote web server, the data is synced across from the main Aegir site to the remote server.</p>

<p>Finally, it restarts the HTTP service to load the new site's virtualhost into the HTTP service's runtime environment.</p>

<p>A traditional 'welcome' e-mail containing the one-time login link is sent to the e-mail address of the 'Client' who owns this site. As well as that, the login link is generated and displayed on the new site node view (see below).</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/site_view/index.png" /></div>

<p>As you can see above, the successful installation of the site has provided a series of tasks available to be performed against this site. This task block is similar in appearance to the Task Queue block we previously discussed, but rather than showing a list of tasks either run, queued or processing, it instead displays the list of <em>potential</em> tasks that may be run for this site only.</p>

<p>We will discuss these tasks and more in the following sections.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-36.html?destination=node%2F22%23comment-form">Login</a> or <a href="../../../../../user/register/index-36.html?destination=node%2F22%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-36.html?destination=node%2F22%23comment-form">Login</a> or <a href="../../../../../user/register/index-36.html?destination=node%2F22%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-60" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../60/index.html">Site Aliases</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h3>Introduction</h3>

<p>Site aliases are helpful if you move content to a new domain, change domain names or simply want to make sure that <a href="http://example.com/" title="http://example.com">http://example.com</a> and <a href="http://www.example.com/" title="http://www.example.com">http://www.example.com</a> take users to the same place.  You can implement site aliases with or without <em>redirection</em>.  The differences between these two methods and how Aegir handles them is described below.</p>

<h3>Enable Alias Support in Aegir</h3>

<ol>
<li><p>You have to enable alias support in Aegir as it is off by default.  Assuming the URL of your Aegir front end is aegir.example.com, browse to aegir.example.com/admin/hosting/features 
<img src="http://groups.drupal.org/files/features-page.png" alt="how to get to the Aegir features page" /></p></li>
<li><p>Check the Site aliasing box
<img src="http://groups.drupal.org/files/site-aliasing-feature.png" alt="how to enable site aliasing on Aegir" /></p></li>
<li><p>Click Save configuration</p></li>
</ol>

<h3>Global Settings for Aliasing</h3>

<p>After you have enabled the site aliasing feature in Aegir you can navigate to aegir.example.com/admin/hosting/aliases (see the menu item that is added under Hosting in the admin menu bar).  Here you can set default site alias settings for all of your Aegir-hosted sites.</p>

<p><img src="http://groups.drupal.org/files/global-aliasing-settings.png" alt="global site aliasing settings" /></p>

<h3>Site-Specific Settings for Aliasing</h3>

<p>You can override the global settings for aliasing by configuring site-specific alias settings either when you create the site or later by editing the site settings.</p>

<p><img src="http://groups.drupal.org/files/site-specific-aliasing-settings.png" alt="site-specific aliasing settings" /></p>

<h3>Redirection Option</h3>

<p>For users, one of the main differences that occurs when redirection is turned on is that the URL that they enter in the browser address bar changes.  This reflects what the server is doing, which is in effect to redirect the request to the same site under the main URL, as opposed to serving the same site from under an alias.</p>

<h4>User navigates to my-old-domain.com with redirection off</h4>

<p><img src="http://groups.drupal.org/files/aliasing-without-redirection.png" alt="aliasing without redirection" /></p>

<h4>User navigates to my-old-domain.com with redirection on</h4>

<p><img src="http://groups.drupal.org/files/aliasing-with-redirection.png" alt="aliasing with redirection" /></p>

<h3>Aegir alias management under the hood</h3>

<p>Aegir primarily manages aliases in the virtual hosts file for each site (e.g. /var/aegir/config/server_master/apache/vhost.d/www.example.com)</p>

<p>When Aliases are in use, the virtual hosts file will have a ServerAlias directive for each site alias:</p>

<p><div class="codeblock"><code>ServerAlias example.com<br />ServerAlias www.my-old-domain.com</code></div></p>

<p>In addition to the above directives, when redirection is off, Aegir creates a symlink in the platform/sites/ folder for each alias that points to the folder associated with the primary domain</p>

<p><div class="codeblock"><code>lrwxrwxrwx 1 aegir aegir&nbsp;&nbsp; 15 Oct 31 23:25 example.com -&gt; <a href="http://www.example.com<br />drwxr-xr-x" title="www.example.com<br />drwxr-xr-x">www.example.com<br />drwxr-xr-x</a> 7 aegir aegir 4096 Oct 31 23:02 <a href="http://www.example.com<br />lrwxrwxrwx" title="www.example.com<br />lrwxrwxrwx">www.example.com<br />lrwxrwxrwx</a> 1 aegir aegir&nbsp;&nbsp; 15 Oct 31 23:25 <a href="http://www.my-old-domain.com/" title="www.my-old-domain.com">www.my-old-domain.com</a> -&gt; www.example.com</code></div></p>

<p>When redirection <strong>is</strong> enabled, Rewrite directives are added to the virtualhost to send http requests to the primary domain that the aliases are associated with:</p>

<p><div class="codeblock"><code>ServerAlias example.com<br />ServerAlias <a href="http://www.my-old-domain.com<br />RewriteEngine" title="www.my-old-domain.com<br />RewriteEngine">www.my-old-domain.com<br />RewriteEngine</a> on<br />RewriteCond %{HTTP_HOST} !^www.example.com$ [NC]<br />RewriteRule ^/<em>(.</em>)$ http://www.example.com/$1 [L,R=301]</code></div></p>

<p>The symlinks are not required in this case.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-385.html?destination=node%2F60%23comment-form">Login</a> or <a href="../../../../../user/register/index-385.html?destination=node%2F60%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../60/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-42" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../42/index.html">Resetting site password</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>The 'Reset password' task is a simple one: it allows you to generate a new one-time login URL for a site.</p>

<p><img src="../../../../../sites/community.aegirproject.org/files/login_link/index.png" />The one-time login URL is bound to the account of the admin user (uid 1) of a site. It cannot be used to reset the password of another user on the site.</p>

<p>This can be handy in cases where the password for the admin user of a site has been forgotten. The 'Reset password' task is re-runnable and provides a convenient method of re-gaining access to a website from within Aegir.</p>

<p>In normal situations, viewing a site node shows a 'Go to' clickable link that takes the user to the site in question.</p>

<p>When the Reset password task has been run on a site, the 'Go to' link automatically gets changed to become a 'Login to' link that is the one-time login URL.</p>

<p>Once the one-time login URL has been clicked, this link returns to being a 'Go to' link.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-387.html?destination=node%2F42%23comment-form">Login</a> or <a href="../../../../../user/register/index-387.html?destination=node%2F42%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../42/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-23" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../23/index.html">Migrating/upgrading and renaming websites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>One of the most powerful features of Aegir is the way it can help you to upgrade large numbers of websites safely.</p>

<p>For example, you may have dozens of sites hosted on a drupal 6.18 codebase. But suddenly the 6.19 release comes out with vital security fixes. Previously you'd have to go to each site, back up the files and database, upload the new codebase, run update.php, check everything worked and then onto the next site.</p>

<p>With Aegir you simply click a button in the frontend and it handles everything. This is called 'migrating' sites in Aegir terminology, because it might be used in more cases than simply upgrading the main codebase. For example you may have different 'platforms' with different mixes of contrib modules and themes and charge clients for tiers of 'basic', 'advanced' and 'gold' packages. When they choose to move from basic to advance, you simply migrate their site.</p>

<p>Other examples of using Migrate include:</p>

<ul>
<li>moving a standard Drupal site to a Pressflow platform for performance enhancements</li>
<li>renaming a site (giving it a new URL entirely)</li>
<li>the Clone feature (discussed in later chapters) is a subsidiary of Migrate, except it doesn't move but copy the site.</li>
</ul>

<h1>How to migrate a site</h1>

<h2>Enabling the feature</h2>

<p>Aegir version 2.x</p>

<ul>
<li>The "Site migration" feature is enable by default. So you don't have to enable it. </li>
</ul>

<p>Aegir version 1.x</p>

<ul>
<li>By default, Migrate is not enabled in Aegir after a fresh installation, as it is an optional feature. This means that the 'Migrate' button is not immediately present in the list of available tasks for a site.</li>
<li>To enable the Migrate feature, simply go to <code>/admin/hosting/features</code> and check the Migrate feature. Submit the form and then return to the site node, and you'll see that the Migrate task is now available.</li>
</ul>

<h2>Migrating a site - the Migrate form</h2>

<p>In the Aegir frontend, click on the website that you want to migrate. As per usual, in the 'Site view' you are presented with some summary information about the site, as well as a list of available tasks. Click the 'Run' button for the 'Migrate' task. A modalframe dialog will appear in your browser.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/migrate/index.png" /></div>

<p>The Migrate form has several options. These are:</p>

<ul>
<li><p>Domain name (this is already the domain of the existing site. If you are intending to simply rename the site (give it a new URL altogether), you can simply change this field and leave the target platform be the 'current platform'. This will make the site accessible under the new URL.</p></li>
<li><p>Platform selection. A radio selection of available platforms on the Aegir system. Certain platforms will be un-selectable. This is because they contain 'Errors' - that is, they contain versions of packages (modules, libraries or themes) that are of an older version than that of the original platform. You cannot upgrade a site to older versions of the same package.</p></li>
</ul>

<h2>Upgrades, warnings, errors?</h2>

<p>What's this about upgrades, warnings and errors on each potential platform to migrate the site to?</p>

<p>Up until now you might be forgiven for thinking that Aegir is simply automating the install of sites and creating Apache vhosts and databases.</p>

<p>The truth is, Aegir actually is a much more advanced tool than that. It keeps a running registry in its database of your Platforms and Sites and what modules, themes, libraries and install profiles are available on platforms and installed on sites.</p>

<p>Not only does it keep track of what these packages are, but it also keeps track of what version of a package is installed (say, Views 6.x-2.11), and whether it is actually an enabled module or not.</p>

<p>The Migrate task, despite its name, is the tool for upgrading your site, because the Migrate code actually invokes the command <code>drush updatedb</code> in the backend, automatically. <code>drush updatedb</code> is the equivalent of running '/update.php' in your browser against your site.</p>

<p>In this way, when the time comes (and it always does) to Migrate your site, Aegir is able to intelligently analyse the available platforms on the system and make a sane judgement on where you can upgrade your site to. The logic is as follows:</p>

<ol>
<li>Current platform has module X, schema version 6002 and 6003</li>
<li>Site module has module X, schema version 6003 installed</li>
<li>Target platform A has module X, schema version 6002. Site cannot be upgraded to an older schema version. An error.</li>
<li>Target platform B does not have module X at all. Theoretically this is still a possible upgrade, but module X will probably be disabled by Drupal's upgrade logic during the process. This is a warning.</li>
<li>Target platform C has module X, schema version 6003. Site is upgradeable, there is no change.</li>
<li>Target platform D has module X, schema version 6004. Site is upgradeable. There is a module update to be performed.</li>
</ol>

<p>In the logic laid out above, examples 4, 5 ,6, or platforms B, C and D would be listed as valid target platforms. Target platform D would actually upgrade the site's module to a newer version, which may involve database updates.</p>

<p>To view the schema differences between current and target platforms in this way, click the 'Compare platforms' link against each target platform in the form.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/compare/index.png" /></div>

<p>If your intention is to upgrade your site between versions of any package (this can include core or contrib!), you need to make sure the relevant packages are present and up to date on the platform you want to migrate to. Aegir can only try and make this judgement call based on the information you feed into the system by adding and verifying platforms with the correct components.</p>

<p>If you've had to download extra packages to the target platform to make them possible candidates for an upgrade, you may need to visit that platform node in the Aegir frontend, and run the Verify task against the site (this is a re-runnable task). This updates Aegir's registry of information about all the packages on the platform.</p>

<h2>Migrating</h2>

<p>Select the relevant target platform and click 'Migrate' to submit the form. The modalframe dialog will close and Aegir will spawn a new Migrate task into the Task queue, and process it on the next cron run.</p>

<p>The process of Migration in the backend occurs automatically, like all Aegir tasks, and is as follows:</p>

<ul>
<li>The site is placed into maintenance or 'site offline mode' as a precaution. Safety first!</li>
<li>A 'backup' task is implied silently. The site and its database are backed up into a tarball. Still safety first!</li>
<li>Depending on the settings sent to the backend (are we migrating the site under its current name, or just renaming the site, or renaming the site and migrating as well), various metadata regarding the site is updated</li>
<li>If we are moving to a new platform (upgrading, not just renaming), the backup tarball that was made earlier, is used in a silent 'provision-deploy' command, which essentially unpacks the tarball into the target platform and creates a new database and database user for the site, importing the database dump that was made in the backup</li>
<li>The deploy task above, invokes <code>drush updatedb</code>, effectively upgrading the site by calling all hook_update() functions. </li>
<li>Various bits and pieces are fixed up, such as paths to files in the 'files' table of the database.</li>
<li>Caches are cleared</li>
<li>A verify task is run, settings.php and apache vhost are updated to reflect the new path (new platform) and new database credentials, site gets brought back out of maintenance mode.</li>
<li>If all went well and nothing has fatally errored here, we remove the old copy of the site from the previous platform (it wasn't touched til now, other than backing it up)</li>
</ul>

<h2>Potential errors?</h2>

<p>If something goes wrong during all this work, the metadata reflecting where the site is located on the system (which platform it is on) and other information is reverted. The task will become 'red' in the task queue, indicating an error.</p>

<p>Aegir will attempt to restore the site's vhost and settings.php to reflect the original platform and database credentials, and bring the site out of maintenance, in an effort to return the site to a state where it was prior to the Migrate.</p>

<p>The user may be requried to manually recover from this error depending on what has occurred. Nonetheless, remember that a backup was made early on, and this can be used to restore the site easily.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-298.html?destination=node%2F23%23comment-form">Login</a> or <a href="../../../../../user/register/index-298.html?destination=node%2F23%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../23/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-658" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../migration-tips/index.html">Migration Tips</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>In the context of sites, migration is the task of moving a site from one platform to another.  Migration is the Aegir-preferred method for applying updates to modules and certainly to core.  In other words, to upgrade core or modules, create a new platform with the upgrades, then migrate sites to the new platform.</p>

<p>Ideally, a migration requires nothing more than a mouse-click on the Migrate button on the Site node in your Aegir for the site you want to migrate.  If you've prepared your destination platform properly, a migration will be this simple.  Proper preparation, therefore, is vital.</p>

<p>To prepare a new platform to be a destination for migration, consider at least the following:</p>

<ul>
<li>The directory structure for your modules and themes must be the same on the source and destination platforms.  For example, if the modules on the source platform are in

<div class="codeblock"><code>../platform-abc/sites/all/modules/contrib</code></div>
then the destination platform must have its modules also in this directory.
</li><li>You may need to clear the Drupal cache on the source platform to avoid migration errors.  Upgrades to Aegir in the future may handle this automatically, so be aware of the version of Aegir you're running and whether it includes upgrades to address this issue.
</li></ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-37.html?destination=node%2F658%23comment-form">Login</a> or <a href="../../../../../user/register/index-37.html?destination=node%2F658%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-37.html?destination=node%2F658%23comment-form">Login</a> or <a href="../../../../../user/register/index-37.html?destination=node%2F658%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1766" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/renaming-aegir-hostmaster-site-itself/index.html">Renaming the Aegir hostmaster site itself</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>From <a href="../../../../363/index.html" title="http://community.aegirproject.org/node/363">http://community.aegirproject.org/node/363</a> :</p>

<p>WARNING: Be sure to have a good backup (which you can restore) before attempting this.</p>

<ol>
<li>manually edit the crontab for aegir to stop the periodic execution of the command 'hosting-dispatch' (the drush command 'hostmaster-pause' did not exist on my system)
</li><li>delete the hostmaster site (drush @hostmaster provision-delete)
</li><li>change the alias (drush provision-save @hostmaster --uri=hostmaster2.example.com --aliases=hostmaster.example.com)
</li><li>deploy the backup (drush @hostmaster provision-deploy /var/aegir/backup/hostmaster.example.com...tgz)
</li><li>checked that all changes appeared correct - YES
</li><li>Reneabled the hosting-dispatch task by editing the crontab again
</li><li>ran a verify task against the new hostmaster site. Noticed that the site is listed on the site page with the old domain name. The verify failed.
</li><li>Found that the verify task had created a new entry in the hostmaster-6.x-1.7/sites directory for the old domain name. I removed this created directory. I found and edited (using phpMyAdmin) the relevant entries in the node and node revision tables for the hostmaster site to update the domain name (change the title field). The hosting_site_alias table may also need to be updated if you have site aliases.
</li><li>The verify task also seemed to have regressed the @hostmaster alias file (~/.drush/hostmaster.alias.drushrc.php) as it had the URI and aliases details from the old site back in it. I edited this file to return these items to their new values.
</li><li>The verify task now completed successfully and all seems to be working correctly.
</li></ol>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-388.html?destination=node%2F1766%23comment-form">Login</a> or <a href="../../../../../user/register/index-388.html?destination=node%2F1766%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../1766/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-24" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../24/index.html">Cloning sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir provides an easy method of making entire copies of a site. This includes the actual site files, modules and so on, as well as a copy of the actual database.</p>

<p>This feature is called 'Clone' in Aegir, because it is a method of duplicating a site with a new URL or 'site name'.</p>

<p>The feature is very closely linked to the <a href="../../../../23/index.html">Migrate</a> feature because it is almost the same, except that rather than move the site, it leaves the existing site in place and just copies it to a new name.</p>

<p>For this reason, enabling the Clone feature also enables the Migrate feature.</p>

<h2>Enabling Clone</h2>

<p>The Clone feature is disabled by default on a fresh Aegir installation. To enable it, visit <code>/admin/hosting/features</code> in your Aegir frontend, check the 'Clone' box and submit the form.</p>

<p>Now when you visit a site node in your frontend, you'll see there's a 'Clone' button in your list of available tasks for the site.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/clone/index.png" /></div>

<h2>Cloning a site</h2>

<p>To clone a site, simply click the Clone button. A modalframe dialog will appear with a form. If you are familiar with the Migrate feature, you'll likely notice the similarities between the two forms.</p>

<p>The clone form has these options:</p>

<ul>
<li><strong>Domain name</strong> - this is the URL for the new site, which must be unique.</li>
<li><strong>Platform</strong> - this is the target platform to clone the site to. It may be the current platform or a different platform that meets the requirements for hosting this site (has all the correct or newer versions of relevant modules)</li>
<li><strong>Database server</strong> - this option is only available if you have a remote database server configured, otherwise it is implied.</li>
<li><strong>Site aliases</strong> - If you have the <a href="../../../../60/index.html">Site Aliases</a> feature enabled, you are also able to set new Site Aliases for this clone at this point. If the original site also had aliases, you will have to change or remove the aliases that load in this form before you can submit it.</li>
</ul>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/clone_form/index.png" /></div>

<p>As with the Migrate form, you can view the package comparison table between the current platform of the original site and that of a target platform, by clicking the 'Compare platforms' link. You can only clone a site to another platform if it meets the requirements for successfully hosting that site. In other words, the target platform has to contain the same or newer versions of modules. If the packages are missing on the target platform, those missing modules may be disabled.</p>

<p>Once you have made your selection and submitted the form, a 'Clone' task is spawned and added to the Task queue ready for dispatching.</p>

<h2>What Clone does</h2>

<p>The Clone task makes the following actions in the system:</p>

<ul>
<li>Makes a backup of the original site. This tarball will be used to 'deploy' a copy of the site</li>
<li>Generates a new Drush alias for the new site</li>
<li>Deploys the backup tarball to the new location as a new site</li>
<li>The new site is imported and verified into the Aegir system, and relevant configurations are saved (HTTP vhost file, etc)</li>
</ul>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/clone_import/index.png" /></div>

<h2>When might I want to use Clone?</h2>

<p>Clone can be a very useful tool in a variety of situations. Commonly, people use Clone for:</p>

<ul>
<li>Testing what a 'Migrate' might do to a site, without migrating it. In other words, Clone can be used as a simulation tool to anticipate results of upgrading a site to a new release or build safely.</li>
<li>If you have a 'template' site, often with a custom install profile, and anticipate having to generate multiple sites that are very similar, you can use Clone to rapidly do this.</li>
<li>Cloning a live site to a 'development' version of a site, especially to a development platform residing on a remote 'development' web server, can be a useful and fast method of working on a site by ensuring the dev environment has the latest database and files from production.</li>
</ul>

<h2>Is there any relationship between the original and cloned site?</h2>

<p>Currently there is no real relationship between the original site and any of its clones.</p>

<p>In future, Aegir development is likely to develop natural relationships between these sites, which will allow for 'rules' to be established, for example</p>

<ul>
<li>being able to regularly 're-clone' a site 'over the top' of previously-made clone, or</li>
<li>automatically schedule clones after the original site has been migrated (upgraded) to keep a clone 'up to date' with the original.</li>
</ul>

<p>Other uses may develop in time.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-302.html?destination=node%2F24%23comment-form">Login</a> or <a href="../../../../../user/register/index-302.html?destination=node%2F24%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../24/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-25" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../25/index.html">Disabling and Enabling sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir provides a method for sites to be temporarily 'disabled'. This means preventing all access to a site, but in a way that it can be re-enabled later.</p>

<p>Think of disabling a site in a similar fashion to placing a site under Maintenance mode, but that instead of a 'Site offline' message, a request to the site is redirected to a special page under the main Aegir frontend's URL, and a 'Site disabled' message is shown instead.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/disable/index.png" /></div>

<p>Aegir makes no presumptions about why you may wish to disable a site. Use this feature at your own discretion.</p>

<h2>How to Disable a site</h2>

<p>To disable a site, simply click on the site node in the Aegir frontend. In the list of available tasks for this site, click the 'Disable' button. A modalframe dialog will load, prompting you to confirm if you really wish to disable the site. Confirm and submit the form to spawn a 'Disable' task to the queue to take this site offline.</p>

<h2>How to Enable a site</h2>

<p>Once your site has been disabled, the list of available tasks has now radically changed in the site node: you now have only the option to Delete the site or Enable it again.</p>

<p>To re-enable a disabled site, simply click Enable. The site will be brought back out of hibernation and become live again.</p>

<h2>Disabling before deleting</h2>

<p>In Aegir's default configuration, you must first disable a site before you may delete it. This is meant as a precaution - if considering deleting a site, it forces you to think about whether you really want to, before accidentally clicking Delete and irreversibly removing your site.</p>

<p>But don't worry - Aegir always silently makes a backup of the site before disabling (or deleting) a site.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-38.html?destination=node%2F25%23comment-form">Login</a> or <a href="../../../../../user/register/index-38.html?destination=node%2F25%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-38.html?destination=node%2F25%23comment-form">Login</a> or <a href="../../../../../user/register/index-38.html?destination=node%2F25%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-45" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../45/index.html">Backup and Restore</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>The Aegir system provides a convenient method of backing up sites, and restoring sites from those backups.</p>

<p>Like most other Aegir functionality, the Backup feature comes in the form of a task, aptly named 'Backup'. It is one of the core features of Aegir and thus is always available for a site, out of the box.</p>

<p>Backing up a site in Aegir is twofold: the site folder (containing the settings.php, files dir and so on) is added to a tarball along with a database dump of the site and stored in <code>/var/aegir/backups</code> on the master Aegir server.</p>

<p>In the event that the website or database is a remote server, those relevant components are synced down to the master Aegir server to be tarballed up. Only the master Aegir server stores backups of a site. (This is known as a 'spoke' model, as opposed to a 'mesh' or distributed model, and suits the Aegir system at this time).</p>

<p>The tarball generated for a site can be used for a number of things: restoring a site from that backup via the 'Restore' task, or from the command line using the <code>provision-deploy</code> command for advanced users as a method of quickly importing a site onto a system.</p>

<p>Other cases whereby a backup task is generated and its tarball used are when a site is being Migrated (upgraded) or being Cloned as a new site, but that is outside the scope of this chapter.</p>

<h2>Backing up</h2>

<p>When viewing the site node of a site in the Aegir frontend, click the 'Backup' button in the list of available tasks for this site.</p>

<p>A modalframe dialog appears, prompting for confirmation, as well as providing an editable Description field which you may fill out. This field is optional, designed only to aid you in future if you seek a reason for why a backup was made.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/backup/index.png" /></div>

<p>Once the form is submitted, a Backup task is spawned and added to the Task queue for dispatching by the backend.</p>

<p>The full output of a Backup task is viewable in the task log. Extra security precautions are built into Aegir so that the 'mysqldump' command uses file descriptors to hide exposing the database user's password in the running process and output of the task.</p>

<h2>Restoring from a backup</h2>

<p>Restoring a site from a backup is simple and follows the same pattern as backing up. Simply click the 'Restore' button from the list of available tasks for a site. A modalframe dialog will load, and the form offers a list of radio items. These are the backups that have been made for a site, in the format of 'Date/time - Reason'.</p>

<p>Where no custom reason was given for a backup, the message 'Generated on request' is shown instead.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/restore/index.png" /></div>

<p>Choose a backup to restore from and submit the form. A 'Restore' task will be spawned and added to the Task queue for dispatching by the backend.</p>

<h2>What happens during a Restore task</h2>

<p>The restore process</p>

<ul>
<li>puts the site under 'maintenance mode' temporarily (safety first!)</li>
<li>generates a new backup of the site before restoring to it (still safety first!). This new backup will be available in the list of backups if you ever re-run the Restore task, and will carry the description 'Generated before being restored to a previous version'.</li>
<li>uses the implied <code>provision-deploy</code> command in the backend to unpack the tarball, </li>
<li>create a new database and import the database dump into it, </li>
<li>create a new database user, </li>
<li>spawn a verify task silently, which will

<ul>
<li>re-write the settings.php,</li>
<li>sync the data if necessary to a remote platform, </li>
<li>re-generate the web server's vhost configuration file for this site,</li>
<li>finally reload the web server</li>
</ul></li>
</ul>

<h2>Automatic backups and purge</h2>

<p>There are contributed modules that can handle automatic creation and deletion (clean-up / purging) of backups:</p>

<ul>
<li><p>For Aegir 2.x</p>

<ul>
<li><a href="https://www.drupal.org/project/hosting_site_backup_manager">Hosting Site Backup Manager</a></li>
</ul></li>
<li><p>For Aegir 1.x</p>

<ul>
<li><a href="http://drupal.org/project/hosting_backup_queue">Hosting backup queue</a></li>
<li><a href="http://drupal.org/project/hosting_backup_gc">Hosting backup garbage collection</a>.</li>
</ul></li>
</ul>

<p>Eventually these contributed modules will be incorporated into Aegir core.</p>

<p>It is also easy to set up a cronjob to automatically run backup tasks (that can still be used to restore from) for all your sites. To do this, download and set up mig5's <a href="http://www.migueljacq.com/content/aegir-bulk-backup-script-updated">bulk backup script</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-39.html?destination=node%2F45%23comment-form">Login</a> or <a href="../../../../../user/register/index-39.html?destination=node%2F45%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-39.html?destination=node%2F45%23comment-form">Login</a> or <a href="../../../../../user/register/index-39.html?destination=node%2F45%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-26" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../26/index.html">Deleting sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>There may come a time when you want to remove a website from your Aegir system and your server altogether. As you'd expect, Aegir handles this for you too. It ships with a 'Delete' task that is capable of removing the site from the Aegir system, as well as carrying out backend tasks to remove the site from the filesystem and web/db servers.</p>

<p>The Aegir frontend is a Drupal site in itself, and sites are represented in that system as nodes. New users that are familiar with Drupal often make the mistake of thinking that the process of deleting a site is like deleting a node in Drupal, and attempt to delete the site node (or are confused by the fact we hide the Delete button for this reason).</p>

<p>This is an incorrect method of deleting a site, and doesn't actually spawn a task to clear away the site from the server at all. Below are the steps to correctly remove a site.</p>

<h2>Method 1 (default) - Disable the site first</h2>

<p>Part of this confusion can stem from the fact that when viewing a site node in Aegir, the Delete button is not actually present in the list of available tasks by default:</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/delete_disablefirst/index.png" /></div>

<p>This is because, in the default Aegir configuration, you must run the Disable task against a site before you may Delete it. This logic is in Aegir to help users avoid accidentally deleting a site either by accidentally processing the task (despite having to confirm it first) or to prompt the user to think a little bit more on the decision before irreversibly blowing away the data.</p>

<p>The decision stems from Aegir development policy of being uncomfortable making such risky actions on your data. While it is possible to delete a site, we'd like you to really be sure that's what you want to do.</p>

<p>Once you Disable a site (<a href="../../../../25/index.html">see the Disable section prior to this chapter</a>), the list of available tasks is modified to only offer an Enable or Delete button. At this point you can run the Delete task and permanently remove your site.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/delete/index.png" /></div>

<h2>Method 2 (optional) - Delete without Disabling</h2>

<p>The first method above is the default Aegir configuration. However, some users might be too confused by the lack of the Delete button altogether, which may not be ideal for your situation.</p>

<p>For this reason, Aegir also provides a configurable setting allowing a site to be Deleted without requiring a Disable first. This option makes the 'Delete' button appear in the list of available tasks, even when a site is currently in an Enabled state.</p>

<p>To activate this setting, visit <code>/admin/hosting/settings</code> on your site and uncheck the checkbox that is titled "Require site to be disabled before deletion".</p>

<p>Re-visit the site node and you'll see that the Delete button is now present and clickable, alongside the Disable button.</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/delete_nodisable/index.png" /></div>

<h2>The deletion process</h2>

<p>When you click Delete and confirm your intentions in the modaldialog that loads, a 'Delete' task is spawned and added to the Task queue to await dispatch by the backend system.</p>

<p>The process runs through a series of steps to remove this site from your server. These are as follows:</p>

<ul>
<li>Make a backup of the site and its database for the last time (safety first, remember!</li>
<li>Drops the site database</li>
<li>Revokes the GRANT to that database for the database user (effectively deleting the database user)</li>
<li>Deletes the site folder and everything inside it, from the platform that the site was hosted on</li>
<li>Removes the Drush alias file for the site</li>
<li>Removes the site's web server vhost configuration file</li>
<li>Reloads the web server</li>
<li>Sets the site's status to 'Deleted' in the Aegir system. Note: it does not delete the site node from the Aegir system. This is by design: the site node is retained in the Aegir database for historical purposes (you could customise Aegir by adding the ability to run a report or a View of all deleted historical sites, for example)</li>
<li>The deleted status of the site, removes it from the list of sites in the 'Sites' page (and thus front page) of the Aegir system.</li>
<li>Historical tasks run on the site remain in the Task queue history.</li>
</ul>

<h2>Manually deleting the site</h2>

<p>Sometimes something goes wrong during an Install or a Delete task and a site doesn't install or get deleted successfully. The Delete task cannot be run or re-run on this site because Aegir has no way of knowing just how much of it got deleted (whether the files are still there but not the database, for example). Re-running the Delete task is likely to fail because some of these steps listed above will not exit successfully on completion.</p>

<p>At the time of writing, no task in Aegir exists to 'force' a removal of a site without having to bootstrap it first, so some manual steps are required on your part to remove this site.</p>

<ul>
<li>Manually remove the site files on the server if they exist (i.e /var/aegir/platforms/drupal-6.16/sites/my-failed-site.com</li>
<li>Drop the database and revoke db user privileges associated with this site if it got created before failing (check the vhost  configuration file's 'SetEnv' parameters, or the settings.php if the credentials are uncloaked, for the site's database name and user)</li>
<li>Manually remove the Apache vhost file for this site if it is still present (in /var/aegir/config/server_master/apache/vhost.d/)</li>
<li>Manually remove the Drush alias for this site if it is still present (in /var/aegir/.drush/)</li>
<li>Enter the Aegir database from mysql and set the status of the node in the <code>hosting_site</code> table to -2 (deleted). For example, if your site node was nid 83 (the 'Edit' tab of the site node will tell you this), run <code>UPDATE hosting_site SET status = &#039;-2&#039; WHERE nid = 83;</code></li>
<li>Still in the Aegir database, delete the node record in the <code>hosting_context</code> table. For example, if your site node was nid 83 (as above), run <code>DELETE FROM hosting_context WHERE nid = 83;</code></li>
<li>Alternatively, if you want to even remove the node altogether from the system (not recommended), go to /node/83/delete in your browser on the Aegir frontend and delete the node. This will remove the site node and all associated task nodes from the system, as well as remove the entry from the hosting_site table in the database.</li>
<li>If you are using the SSL feature and had Encryption enabled for this site, you may also need to manually delete the SSL certificate folder located in <code>/var/aegir/config/ssl.d/[domain of site you are deleting]</code> and/or <code>/var/aegir/config/server_master/ssl.d/[domain of site you are deleting]</code>. Additionally you may also need to delete the entry for the domain you are deleting in the <code>hosting_ssl_cert</code> table of the Aegir database.</li>
<li>If you are using the DNS feature you may also need to remove the site's entry in the zone file by running the following command: <code>drush @server_master provision-zone rr-delete example.com sub.domain A</code></li>
<li>If your site has ssl support enabled you also need to remove ssl certificate from database issuing DELETE FROM hosting_ssl_cert WHERE ssl_key = 'your.site.domain';</li>
<li>Re-verify the Platform node where the Platform is the one where your site was hosted on. This will regenerate some metadata whereby the Platform believed it still had that site contained within it.</li>
</ul>

<p>If you need to manually remove the site's platform see the instructions here: <a href="../../../../27/index.html" title="http://community.aegirproject.org/node/27">http://community.aegirproject.org/node/27</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-384.html?destination=node%2F26%23comment-form">Login</a> or <a href="../../../../../user/register/index-384.html?destination=node%2F26%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../26/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-843" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../open-id-tips-and-tricks/index.html">Open ID tips and tricks</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <h2>Allowing multiple people to access User 1</h2>

<p>This approach depends on the <a href="http://drupal.org/project/openidadmin">OpenID Admin module</a>. Here are the drush commands to download and install it, and set an openid access:</p>

<pre><code>drush dl openidadmin
drush en -y openidadmin
drush openid-add 1 <a href="https://your.openid.server/your-open-id" title="https://your.openid.server/your-open-id">https://your.openid.server/your-open-id</a>
</code></pre>

<p>This can allow you to simplify development workflow and easily control who has access to User 1, without giving away that account's username and password.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-40.html?destination=node%2F843%23comment-form">Login</a> or <a href="../../../../../user/register/index-40.html?destination=node%2F843%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-40.html?destination=node%2F843%23comment-form">Login</a> or <a href="../../../../../user/register/index-40.html?destination=node%2F843%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1381" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/best-recipes-disaster-and-how-avoid-them/index.html">The best recipes for disaster and how to avoid them</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_4 first"><a href="../../../../../taxonomy/term/4/index.html" rel="tag" title="This level is for users who have access to only their sites and not able to manage all Aegir features, accounts or the server/system.">Client</a></li>
<li class="taxonomy_term_27"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_3"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This is a short list of all those bad things you should avoid while still learning how to use Aegir system properly, compiled from many real-world issues, so you could enjoy reading about creative ways to destroy your sites or Aegir system instead of experience it.</p>

<p><strong>How to get all kinds of failed migrate or clone tasks?</strong></p>

<p>Very easy. Simply use sites/domain-name/modules space for your code. This will guarantee many half-broken migrations with duplicates of the same site existing in two platforms, with fatal errors because some required include file in some module no longer exists, or not yet exists, as all paths to sites/domain-name/modules change on the fly when either domain-name or platform used changes, so some entries in your site's system table will cause either failed and reverted tasks in Aegir or some nice WSOD, until you will repair registry with <a href="http://drupal.org/project/registry_rebuild" title="http://drupal.org/project/registry_rebuild">http://drupal.org/project/registry_rebuild</a>.</p>

<p>No, really, don't use sites/domain-name/modules for anything and save yourself headaches and frustration.</p>

<p>To help you understand this better, <a href="../../../../243/index.html#comment-152" target="_blank">let's quote mig5</a> - Aegir core developer: "Aegir doesn't track site-specific modules/themes in /sites /$yoursite /(modules|themes) because it's not possible to ever upgrade those modules (they are tarballed up and moved with the site on a Migration). For this reason it's unwise to store site specific modules in this directory as you'll never be able to upgrade them if you do your upgrades properly (via Migrations, to new target platforms). To have site-specific modules not in that directory, you should learn install profiles, and store the modules/themes in /profiles /$yourprofile /(modules|themes) for a site using that install profile. (...) I don't see us ever handling the upgrades of modules in /sites/$site, since that entire dir gets tarballed up and moved across. In fact we made a deliberate design decision to literally ignore those modules in the Aegir package system." We highly recommend to <a href="../../../../243/index.html" target="_blank">read all comments there</a>. There is also <a href="../../../../23/index.html" target="_blank">an excellent handbook entry</a> you should read to understand this better.</p>

<p><strong>How to break the site so even the Restore task will not help?</strong></p>

<p>To make that happen you need to forget about correct upgrade workflow and good habits, use Backup task in Aegir to create a pseudo-safe copy of your site, upload new contrib modules to your new platform and then use Migrate task to move/upgrade your site to the new platform. To make it even worse, you could then try to use Restore task if anything went wrong with the migration and this will either fail completely or it will revert your database, but it will leave the site in the new platform  because Restore task will never move the site back to the old platform, so all your previous backups are immediately useless, and you are locked in the new platform without any chance to rollback automatically.</p>

<p>OK, so what is the correct workflow for sites upgrades in Aegir? It highly depends on how you manage your code, but some general rules are always valid and we will list them below:</p>

<ol>
<li>Create or choose new platform.</li>
<li>Upload all your contrib modules and themes to the new target platform.</li>
<li>Re-verify the target platform in Aegir.</li>
<li>Clone your live site with some working subdomain in the old platform.</li>
<li>Re-verify old platform and also just cloned site.</li>
<li>Migrate cloned site to the new platform.</li>
<li>Check if the cloned site works without any issues.</li>
<li>If the step 7 above works, you can safely migrate also the live site.</li>
</ol>

<p>Note: if this is a Drupal core version upgrade, it is always better to split the upgrade in two parts: first migrate to the new core, but using the same contrib modules versions, and then migrate to the final target platform with newer contrib modules. This may help if you experience failed upgrades with mysterious errors like "Call to undefined function node_types_rebuild()" without any hint on which module causes the issue.</p>

<p><strong>How to break the site and lock it in the broken state in a one step?</strong></p>

<p>This sounds frightfully, but it is really easy to do. All you need is to skip the steps with creating and testing the sites clone in the existing platform first and simply use the Clone task to clone the site directly to the new platform. While this appears to be a handy shortcut, it is in fact one of the best recipes for disaster. Why? Because Aegir will not be able to properly check for all possible issues related to the contrib code and db updates to alert you before running the Clone+Migrate task. Yes, this kind of Clone task is in fact Clone and Migrate in a one step. It is very handy, but only when you already tested it with both old and new platform before. To stay safe, just avoid cloning the site to the different platform directly. Instead, clone it first in the existing platform, then migrate to the new platform, and finally re-verify it.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-389.html?destination=node%2F1381%23comment-form">Login</a> or <a href="../../../../../user/register/index-389.html?destination=node%2F1381%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../1381/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>



    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/43/revisions/103/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:01:29 GMT -->
</html>
