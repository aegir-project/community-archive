<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  
<!-- Mirrored from community.aegirproject.org/node/1681/revisions/3682/view by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:15:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
    <link type="text/css" rel="stylesheet" media="all" href="../../../../../profiles/openatrium/modules/contrib/codefilter/codefilter/index.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_b8ca3ff360daa12eff502993554e60d0/index.css" />
<link type="text/css" rel="stylesheet" media="screen" href="../../../../../sites/community.aegirproject.org/files/css/css_c151a4313ed94e62ccee94ea27ad58ed/index.css" />
<link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<style type='text/css'>
.atrium-welcome-links a:hover,
.dropdown-blocks .block-toggle li a:hover,
.dropdown-blocks .block-toggle li a:focus,
.dropdown-blocks .block-toggle ul.links li a:hover,
.dropdown-blocks .block-toggle ul.links li a:focus,
.dropdown-blocks .block-toggle .item-list li a:hover,
.dropdown-blocks .block-toggle .item-list li a:focus,
.pager li.pager-current,
.more-link a:hover,
#global,
#navigation { background-color:#143352; }

body #space-tools .block-title { background-color:#0e2339; }

body #header .block-widget .block-content,
body #header .block .block-title { background-color:#112b45; }

body .page-region .block .block-title {
  background-color:#c2c8ce;
  border-color:#b4bbc1;
  border-bottom-color:#a7adb3;
  }

.drilldown .trail a {
  border-top-color:#f3f4f6;
  border-bottom-color:#d2d4d6;
  background-color:#e3e4e6;
  }

.decay-10 .comment-title { border-color:#eeeeee; }
.decay-9 .comment-title { border-color:#d8dbde; }
.decay-8 .comment-title { border-color:#c2c8ce; }
.decay-7 .comment-title { border-color:#acb5bf; }
.decay-6 .comment-title { border-color:#96a3af; }
.decay-5 .comment-title { border-color:#8190a0; }
.decay-4 .comment-title { border-color:#6b7d90; }
.decay-3 .comment-title { border-color:#556b80; }
.decay-2 .comment-title { border-color:#3f5871; }
.decay-1 .comment-title { border-color:#294561; }
.decay-0 .comment-title { border-color:#143352; }
</style>
    <script type="text/javascript" src="../../../../../sites/community.aegirproject.org/files/js/js_dddbfcfef882b2074d904e22eb494d08/index.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/"});
//--><!]]>
</script>
    <!--[if lte IE 8]><style type='text/css' media='screen'>@import '/profiles/openatrium/themes/ginkgo/ie.css';</style><![endif]-->    <title>Revision of first quarterly report of Aegir funding work from Thu, 07/26/2012 - 21:34 | community.aegirproject.org</title>
  </head>
  <body  class="not-front not-logged-in page-node node-type-discussion one-sidebar sidebar-right designkit tao rubik admin-static page">

  <a id='skipnav' href='#content'>Skip navigation</a>
  <div id='global'><div class='limiter clear-block'>
          <div id='header' class='dropdown-blocks toggle-blocks clear-block'>
          

<div  id="block-atrium-account" class="block block-atrium block-widget block-notitle">
  
  
      <div class='block-content clear-block '>
          </div>
  
  </div>


  

<div  id="block-boxes-search_issues" class="block block-boxes block-toggle">
      <div class='block-title'>
            <a href="index.html#block-boxes-search_issues" class="toggle element-invisible active">Toggle</a>LOOKING FOR HELP?    </div>
  
  
      <div class='block-content clear-block '>
      <div id='boxes-box-search_issues' class='boxes-box'><div class="boxes-box-content"><table class="prose">
<tr>
<td width="50%">
<span style="font-size:16px;width:100%">Type some keywords below and hit "enter":</span><br />
<input type="text" class="drupal-issue-redirect" style="width:100%;min-width:200px;background-color:#DDEEFF; font-size:30px;border-style:dotted;border-width:1px" />
<p>This will search the drupal.org issue queues across the various projects that make up the Aegir system. If there are no relevant results, please submit an issue there.</p></td>
<td style="padding:10px">Other support resources:
<ul>
<li><a href="irc://irc.freenode.net/aegir">#aegir on IRC</a></li>
<li><a href="../../../../../faq/index.html">FAQ</a></li>
<li><a href="../../../../../handbook/index.html">Aegir Handbook</a></li>
<li><a href="../../../../../service-providers/index.html">Aegir service providers</a></li>
<li><a href="https://drupal.org/project/issues?text=&amp;projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&amp;status=Open&amp;priorities=All&amp;categories=All">All Aegir issues</a></li>
<li><a href="http://drupal.stackexchange.com/questions/tagged/aegir">Aegir tag on Drupal Stackexchange</a></li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
$("input.drupal-issue-redirect").change(function() {
  searchURL= "http://drupal.org/project/issues?text="+$(this).val()+"&projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&status=Open&priorities=All&categories=All";
  window.location = searchURL;
});
</script></div></div>    </div>
  
  </div>


      </div>
        <div class='breadcrumb'><span class='link link-0'><a href="../../../../../index.html">Home</a></span></div>    <a href="../../../../../index.html" class="logo" style="background-position:100% 50%; background-image:url(../%27http_/community.aegirproject.org/sites/community.aegirproject.org/files/imagecache/designkit-image-logo/logo/index.html)"></a>  </div></div>

    <div id='navigation'><div class='limiter clear-block'>
    <ul id="features-menu" class="links primary-links"><li class="menu-617 first"><a href="../../../../../dashboard/index.html" class=" icon-dashboard"><span class='icon'></span><span class='label'>Dashboard</span></a></li>
<li class="menu-618"><a href="../../../../../handbook/index.html" class=" icon-handbook"><span class='icon'></span><span class='label'>Documentation</span></a></li>
<li class="menu-2427 active"><a href="../../../../../discussion/index.html" class="active icon-discussion"><span class='icon'></span><span class='label'>Discussion</span></a></li>
<li class="menu-2426"><a href="../../../../../calendar/index.html" class="spaces-menu-editable icon-calendar"><span class='icon'></span><span class='label'>Calendar</span></a></li>
<li class="menu-823"><a href="../../../../../reader/index.html" class=" icon-reader"><span class='icon'></span><span class='label'>Feed reader</span></a></li>
<li class="menu-2429 last"><a href="../../../../../members/index.html" class=" icon-members"><span class='icon'></span><span class='label'>Members</span></a></li>
</ul>          <div id='space-tools'><div class='dropdown-blocks toggle-blocks clear-block'>  

<div  id="block-atrium-search" class="block block-atrium block-toggle">
      <div class='block-title'>
            </div>
  
  
      <div class='block-content clear-block '>
      <form action="http://community.aegirproject.org/node/1681/revisions/3682/view"  accept-charset="UTF-8" method="post" id="atrium-search-form">
<div><div  class="form-item form-item-labeled" id="edit-search-wrapper">
      <label  for="edit-search">Search: <span class='form-required' title='This field is required.'>*</span></label>
    <input type="text" maxlength="128" name="search" id="edit-search" value="" class="form-text required fluid" />  </div>
<input type="submit" name="op" id="edit-submit" value="Search"  class="form-submit" />
<input type="hidden" name="form_build_id" id="form-AKdvq2ebuig6Yza9hAAYi0cWSSblB9Ny0KVBYLDz1O0" value="form-AKdvq2ebuig6Yza9hAAYi0cWSSblB9Ny0KVBYLDz1O0"  />
<input type="hidden" name="form_id" id="edit-atrium-search-form" value="atrium_search_form"  />

</div></form>
    </div>
  
  </div>


</div></div>
      </div></div>
  
  <div id='page-tools'><div class='limiter clear-block'>
    <h1  class="page-title page-title-hidden">Revision of <em>first quarterly report of Aegir funding work</em> from <em>Thu, 07/26/2012 - 21:34</em></h1>        <a href="index.html#block-atrium-help" id="help-toggler" class="palette-toggle active">Help</a>          </div></div>

  
  
  <div id='page'><div class='limiter clear-block'>
    
<div id='content'><div class='page-region'>
      <div class='page-content content-wrapper clear-block'>

<div  id="node-1681" class="node node-discussion clear-block node-page">
      <div class='node-submitted clear-block'>
      <div class="picture">
  <a href="../../../../../users/anarcat/index.html" title="View user profile."><img src="../../../../../sites/community.aegirproject.org/files/imagecache/user-s/pictures/picture-78/index.jpg" alt="anarcat&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../../../../users/anarcat/index.html" class="username" title="View user profile.">anarcat</a></div><div class='date'>9:34pm Jul 26, 2012</div>    </div>
  
      <h2 class='node-title'>
            <a href="../../../../../discuss/first-quarterly-report-aegir-funding-work/index.html">first quarterly report of Aegir funding work</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_149 first"><a href="../../../../../category/keywords/koumbit/index.html" rel="tag" title="">koumbit</a></li>
<li class="taxonomy_term_148"><a href="../../../../../category/keywords/omega8cc/index.html" rel="tag" title="">omega8cc</a></li>
<li class="taxonomy_term_146"><a href="../../../../../category/keywords/quaterly/index.html" rel="tag" title="">quaterly</a></li>
<li class="taxonomy_term_147 last"><a href="../../../../../category/keywords/report/index.html" rel="tag" title="">report</a></li>
</ul></div><p>Since may 15th, I have been working one full day a week on Aegir development thanks to monthly funding of Aegir development, sponsored jointly by <a href="http://omega8.cc/">Omega8cc</a> and <a href="http://koumbit.org/">Koumbit.org</a>. Rather than fixing random (and usually urgent) issues that prop up in our regular use of Aegir, that funding has allowed me to concentrate on actual development. We have now agreed to publish a work log every two months of the results of the sponsorship.</p>

<p>Here is the first report.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Executive_summary"><span class="toc-number">1. </span>Executive summary</a></li>
	<li class="toc-level-1"><a href="#Notable_accomplishments"><span class="toc-number">2. </span>Notable accomplishments</a>
<ol>
	<li class="toc-level-2"><a href="#Issue_tracking_and_queue_support"><span class="toc-number">2.1. </span>Issue tracking and queue support</a></li>
	<li class="toc-level-2"><a href="#The_Drush_sql_credentials_leak"><span class="toc-number">2.2. </span>The Drush sql credentials leak</a></li>
	<li class="toc-level-2"><a href="#Drush_5_debian_package"><span class="toc-number">2.3. </span>Drush 5 debian package</a></li>
	<li class="toc-level-2"><a href="#Provision_ACL_release"><span class="toc-number">2.4. </span>Provision ACL release</a></li>
	<li class="toc-level-2"><a href="#Provision_mergelog_published"><span class="toc-number">2.5. </span>Provision mergelog published</a></li>
	<li class="toc-level-2"><a href="#SSL_and_IP_allocation_work"><span class="toc-number">2.6. </span>SSL and IP allocation work</a></li>
	<li class="toc-level-2"><a href="#Hosting_queue_runner_merged"><span class="toc-number">2.7. </span>Hosting_queue_runner merged!</a></li>
	<li class="toc-level-2"><a href="#Aegir_core_completely_ported_to_Drush_5"><span class="toc-number">2.8. </span>Aegir core completely ported to Drush 5</a></li>
	<li class="toc-level-2"><a href="#Retiring_the_drush_make_package"><span class="toc-number">2.9. </span>Retiring the drush_make package</a></li>
	<li class="toc-level-2"><a href="#Aegir_2.x_upgrade_path_assured"><span class="toc-number">2.10. </span>Aegir 2.x upgrade path assured</a></li>
	<li class="toc-level-2"><a href="#Nginx_testing_and_cleanup"><span class="toc-number">2.11. </span>Nginx testing and cleanup</a></li>
	<li class="toc-level-2"><a href="#Provision_backup_and_migrate_optimizations"><span class="toc-number">2.12. </span>Provision backup and migrate optimizations</a></li>
	<li class="toc-level-2"><a href="#Fix_syncing_problems_with_files"><span class="toc-number">2.13. </span>Fix syncing problems with files/</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Upcoming_work"><span class="toc-number">3. </span>Upcoming work</a>
<ol>
	<li class="toc-level-2"><a href="#Publish_the_2.x_Debian_package"><span class="toc-number">3.1. </span>Publish the 2.x Debian package</a></li>
	<li class="toc-level-2"><a href="#x_redesign"><span class="toc-number">3.2. </span>2.x redesign</a></li>
	<li class="toc-level-2"><a href="#Moving_intelligence_to_the_spokes"><span class="toc-number">3.3. </span>Moving intelligence to the spokes</a></li>
	<li class="toc-level-2"><a href="#Nginx_cleanup"><span class="toc-number">3.4. </span>Nginx cleanup</a></li>
	<li class="toc-level-2"><a href="#Fix_security_issues_in_Drush"><span class="toc-number">3.5. </span>Fix security issues in Drush</a></li>
	<li class="toc-level-2"><a href="#Merge_the_platform_auto_code"><span class="toc-number">3.6. </span>Merge the platform auto code</a></li>
	<li class="toc-level-2"><a href="#Subsite_support"><span class="toc-number">3.7. </span>Subsite support</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="Executive_summary">1. Executive summary</h1>

<p>Koumbit has spent around 48 hours of raw work (excluding breaks and
overhead). It is roughly equivalent to 6 hours a week. That is all work
where I have been siting in front of a computer or a piece of paper
hacking at Aegir. So that's already a huge gain over the previous
situation where I didn't have time to work on the project, and is in
line with the objectives Koumbit had planned for this project, which is
to allow me to work freely around one day a week on Aegir.</p>

<p>After reviewing the work, I am quite satisfied with the results. I have
been able to push significant changes in the 2.x codebase, brought the
hosting-queue-runner in core and made everything work with Drush 5
properly. I was also able to provide support to the community, something
which was lacking in recent times although I have had trouble doing this
in the last month because of offline traveling.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Notable_accomplishments">2. Notable accomplishments</h1>

<p>Most of my work has been to contribute code, comments and ideas back to
the community, publicly on Drupal.org and community.aegirproject.org.</p>

<p>All the gory details are on my tracker here:</p>

<p><a href="https://drupal.org/user/1274/track" title="https://drupal.org/user/1274/track">https://drupal.org/user/1274/track</a>
<a href="../../../../../user/78/index.html" title="http://community.aegirproject.org/user/78">http://community.aegirproject.org/user/78</a></p>

<p>Here's an outline of significant contributions.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Issue_tracking_and_queue_support">2.1. Issue tracking and queue support</h2>

<p>I have tried to start the issue queue review I had been doing in the
past. I have reviewed, closed and responded to a lot of issues. Since
the beginning of the sponsorship, I have tried to read all issue
updates, although since my travel in June, I have a huge backlog of
issues to catch up with, which I will try to do in the coming weeks.</p>

<p>Nevertheless, in that first month of followup, I have been able to
participate in over 50 issues on Drupal.org. I have also made around 50
commits to the Aegir and Drush projects over that period.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="The_Drush_sql_credentials_leak">2.2. The Drush sql credentials leak</h2>

<p><a href="https://drupal.org/node/671906" title="https://drupal.org/node/671906">https://drupal.org/node/671906</a></p>

<p>I have tried (again) to resolve the serious security issue with the way
Drush calls mysql, which leaks the mysql password. I have been able to
create an exploit that actually works and demonstrates the problem. We
(with ergonlogic) have also found that the <code>archive-dump</code> command is
also vulnerable (#1600782).</p>

<p>I have provided a patch to the drush folks, but it was reverted as it
was breaking sql-sync and similar remote commands (#1605998). I have
tried to fix the patch to workaround that problem, but came to the
conclusion that this code is too tangled to be fixed without a
significant refactoring.</p>

<p>In other words, I have currently given up on this, out of frustration,
but I will try to get back to it as this seems like a really critical
issue to fix.</p>

<p>On top of the <code>archive-dump</code> issue, this research also allowed me to
discover several more issues with drush:</p>

<ul>
<li>interruptions should launch rollbacks (#590634)</li>
<li>Drush doesn't clean up temporary files if interrupted (#1589108)</li>
<li>can't create two temporary files (#1603744, needs review)</li>
<li>the drush test suites pops up a terminal (#1603688)</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Drush_5_debian_package">2.3. Drush 5 debian package</h2>

<p><a href="https://drupal.org/node/1611934" title="https://drupal.org/node/1611934">https://drupal.org/node/1611934</a></p>

<p>I have uploaded the Drush 5 Debian package into the Debian archive. I
have removed the <code>debian</code> from the main drush git repository on
Drupal.org to move it to "alioth", the collaborative maintenance server
for Debian packages:</p>

<p>git://git.debian.org/git/collab-maint/drush.git
<a href="http://git.debian.org/git/collab-maint/drush.git" title="http://git.debian.org/git/collab-maint/drush.git">http://git.debian.org/git/collab-maint/drush.git</a></p>

<p>That way, people not part of the Drush core team can participate in
packaging, see the following for more information:</p>

<p><a href="http://wiki.debian.org/Alioth/PackagingProject" title="http://wiki.debian.org/Alioth/PackagingProject">http://wiki.debian.org/Alioth/PackagingProject</a></p>

<p>The main reason for the move, however, was to separate the
Debian-specific files from the main repository, allowing me to have
different branches for the different Drush releases. Before, there was a
special "debian" branch in the drush git repository, which made it
difficult to maintain different versions of the package.</p>

<p>Right now, there are two branches in that new repository: the <code>4.x</code> and
<code>master</code> branch, the latter following the upstream <code>master</code> releases
(which are currently 5.x).</p>

<p>Now the git repository for the Debian package only contains the <code>debian</code>
repository, in what is called a "overlay" setup: the directory is simply
deployed over the upstream source, instead of having the git repository
contain all the upstream history. This make upgrades trivial, as we do
not need to pull and merge the upstream code in our repository.</p>

<p>Since this was done before the Wheezy freeze, this means that Drush 5
will be the first official Drush release to be officially shipped with a
Debian release, hurray!</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Provision_ACL_release">2.4. Provision ACL release</h2>

<p><a href="https://drupal.org/node/1585664" title="https://drupal.org/node/1585664">https://drupal.org/node/1585664</a></p>

<p>I have done a minor release of the Provision ACL module, which fixes
ACLs for the webserver, which was a key blocker for the Koumbit
infrastructure.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Provision_mergelog_published">2.5. Provision mergelog published</h2>

<p><a href="https://drupal.org/project/provision-mergelog" title="https://drupal.org/project/provision-mergelog">https://drupal.org/project/provision-mergelog</a></p>

<p>I have also taken the time to share with the community the code for our
"provision mergelog" implementation. To quote the homepage:</p>

<p>"""
This Aegir extension allows you to automate fetching and merging logs
From multiple servers part of the same cluster in a single logfile for
later analysis with various analysis tools (awstats, webalizer, piwik,
etc). It is aimed to be a simple tool that does one thing well.
"""</p>

<p>The code was originally written by Koumbit.org before the subsidy, but
the publishing work was done during sponsored time.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="SSL_and_IP_allocation_work">2.6. SSL and IP allocation work</h2>

<p><a href="https://drupal.org/node/1126640" title="https://drupal.org/node/1126640">https://drupal.org/node/1126640</a> and related</p>

<p>I dug my head in the ugly SSL and IP allocation code. I have mostly
reviewed the proposed patches and issues, and provided a workaround for
bug #1603722 (deleting a site doesn't delete its SSL certificate) and
reported #1603702 (allows creation of SSL site even if there are no IPs
available).</p>

<p>It seems most of our problem revolve around being stuck with the IP
allocation system in the backend. To quote the issue:</p>

<p>"""The IP allocation is done by touching files in the backend now, and
From what I understand, there is no good reason for that. This mechanism
should be removed and recreated in the frontend, which should pass the
allocated IP to the backend, which should add it to the vhost.</p>

<p>This should also be made to support IP-less allocation, for example by
allowing "*" to be passed as an IP. We can assume the frontend sends us
proper data and just inject this in the vhost"""</p>

<p>And actually, the "receipt files" in the backend, which are the current
allocation system for IPs/certificates, is a duplicate of a
<code>hosting_ip_addresses</code> table that exists in the frontend. We therefore
need to do some refactoring there to cleanup this stuff.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Hosting_queue_runner_merged">2.7. Hosting_queue_runner merged!</h2>

<p><a href="https://drupal.org/node/1189556" title="https://drupal.org/node/1189556">https://drupal.org/node/1189556</a></p>

<p>I have spent a significant amount of time to improve the third-party
module <code>hosting_queue_runner</code>. It is now fully integrated in the 2.x
series, as <code>hosting_queued</code>. I have update the upgrade path information
accordingly:</p>

<p><a href="../../../../../upgrading/path/index.html" title="http://community.aegirproject.org/upgrading/path">http://community.aegirproject.org/upgrading/path</a></p>

<p>This also involved porting the daemon to Drush 5 (#1548490)</p>

<p>Thanks to the Debian package, the init script is also installed
automatically on install, which is a nice improvement. The script was
also improved to have its "status" argument actually work, which
improves interoperability with configuration management tools like
Puppet. Those improvements should also resolve the problems with the
daemon stalling on upgrade (#1261800). The daemon also now has a
"reload" command that just reloads the daemon without stopping it by
sending a signal. The daemon is also "niced" by default which should
help with the load on Aegir servers.</p>

<p>By shipping a specific init.d script for the Debian package, we are now
able to ship a different init.d script, more platform-neutral, for other
platforms along with the code. This will improve support for
CentOS and Arch Linux, which both had patches waiting to be supported
properly  (#1335776 and #1493300).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Aegir_core_completely_ported_to_Drush_5">2.8. Aegir core completely ported to Drush 5</h2>

<p><a href="https://drupal.org/node/1612042" title="https://drupal.org/node/1612042">https://drupal.org/node/1612042</a></p>

<p>Thanks to the hard work of tstoeckler, darthsteven and greg.1.anderson,
Aegir was already working pretty well with Drush 5, so I didn't really
have much work to do here. On top of the port of hosting-queue-runner to
Drush 5, I had to work with a verbosity issue with hosting-dispatch that
was flooding the terminal, and we can now consider Aegir 2.x to be fully
compatible with Drush 5, although we are probably not taking full
advantage of the new features of that release.</p>

<p>Things that would need to be pushed forward for better Drush 5
compatibility:</p>

<ul>
<li>declare the options to our drush commands</li>
<li>more code reuse (<code>site-install</code>, <code>archive-dump</code>, etc)</li>
</ul>

<p>This, however, seems to be a lower priority.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Retiring_the_drush_make_package">2.9. Retiring the drush_make package</h2>

<p>With the arrival of Drush 5, the <code>drush_make</code> Debian package became
irrelevant, and was therefore removed from the official Debian
archive. The package should survive in the squeeze-backports archive,
but will not be shipped with wheezy, as it is now part of Drush 5.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Aegir_2.x_upgrade_path_assured">2.10. Aegir 2.x upgrade path assured</h2>

<p><a href="../../../../../discuss/upgrade-report-17-2x/index.html" title="http://community.aegirproject.org/discuss/upgrade-report-17-2x">http://community.aegirproject.org/discuss/upgrade-report-17-2x</a></p>

<p>I have worked on making sure we can upgrade from the 1.x branch to
2.x. This required some patches to provision-migrate due to new Drush 5
idiosyncrasies (drush now has a commandfile cache that needs to be
flushed, see #1612044).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Nginx_testing_and_cleanup">2.11. Nginx testing and cleanup</h2>

<p><a href="../../../../../discuss/aegir-2x-nginx-install-notes/index.html" title="http://community.aegirproject.org/discuss/aegir-2x-nginx-install-notes">http://community.aegirproject.org/discuss/aegir-2x-nginx-install-notes</a></p>

<p>For the first time, I have spent some time to try out the Nginx code on
my Debian Wheezy laptop. I have noticed some issues with the way the
nginx configuration is managed that depart from the current practices in
the project ("tools not policy" and minimal configurations). I have
filed a few bug reports about this and provided patches for this on a
separate branch (<code>dev-nginx-cleanup</code>) out of the respect for the
maintainer of the Nginx code. The issues are:</p>

<ul>
<li>Nginx config include files should be merged into one (#1622846, needs
review)</li>
<li>remove unused config file (#1635552, needs review)</li>
<li>remove duplicate nginx fastcgi params (#1635586, needs review)</li>
<li>nginx: do not decide the policy for users (#1635596, needs work)</li>
<li>default nginx config doesn't talk to the default php-fpm config in
Debian Wheezy and sid (#1635622)</li>
</ul>

<p>Most of those issues have fixes in the dev-nginx-cleanup branch and are
awaiting review.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Provision_backup_and_migrate_optimizations">2.12. Provision backup and migrate optimizations</h2>

<p><a href="https://drupal.org/node/1484214" title="https://drupal.org/node/1484214">https://drupal.org/node/1484214</a></p>

<p>My last trip on the train allowed me to spend some time looking at
some optimization work for the provision-migrate i had been postponing
for a while. My idea was to move files out of the sites directory, and
make provision-backup follow symlinks (or not) depending on whether we
are doing a real backup/clone (or a migrate), which would make migrate
much faster as it wouldn't copy the files directory.</p>

<p>Unfortunately, this introduced a serious security issue (a symlinks
traversal) that would allow a user to hijack the data of any other
site in the aegir site. I have reported my findings and solutions in
the above issue, but I believe the proper fix is to rewrite
<code>provision-migrate</code> significantly so that it doesn't use backup and
deploy. This may involve quite a lot of work, so I have postponed this
work for now.</p>

<p>I am still looking at how to move files out of the sites directory to
facilitate SFTP account management, and this may yet allow migrate
optimizations, especially if we rewire the backup system to use zip
files, which can be incrementally updated, so would allow backups to
be performed from multiple locations.</p>

<p>We should also obviously look at how <code>drush archive-dump</code> does its
magic before going to far here.</p>

<p>See also <a href="https://drupal.org/node/1205458" title="https://drupal.org/node/1205458">https://drupal.org/node/1205458</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Fix_syncing_problems_with_files">2.13. Fix syncing problems with files/</h2>

<p><a href="https://drupal.org/node/1083366" title="https://drupal.org/node/1083366">https://drupal.org/node/1083366</a></p>

<p>I have had the privilege of sitting down with an Aegir contributor
(jmcclelland) that actually sent meaningful patches to fix the files/
sync problems with remote servers. Since he is using those patches in
production, I figured it was worthwhile to take extra time to look at
those patches with him.</p>

<p>The result is that he rerolled a new patch based on my feedback that
fixes all the concerns I had with the patch. I have therefore asked the
core team to approve an exception to the API freeze to fix this bug that
is plaguing remote server support.</p>

<p>I am waiting for feedback from the community (for tests) and for the
core team (for the exception) before merging this in.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Upcoming_work">3. Upcoming work</h1>

<p>This is the work I will be looking at doing in the coming months as
part of the sponsorship project.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Publish_the_2.x_Debian_package">3.1. Publish the 2.x Debian package</h2>

<p><a href="https://drupal.org/node/1599606" title="https://drupal.org/node/1599606">https://drupal.org/node/1599606</a></p>

<p>I have been wanting to do this forever, and we are pretty much ready to
do this, we are only missing a separate Debian archive for publishing
that code. Since we are reconfiguring the Jenkins server, I figured it
was worth waiting a while before setting this up however.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="x_redesign">3.2. 2.x redesign</h2>

<p><a href="../../../../../discuss/2x-redesign-notes/index.html" title="http://community.aegirproject.org/discuss/2x-redesign-notes">http://community.aegirproject.org/discuss/2x-redesign-notes</a></p>

<p>During my work on the above issues, I had some time to reflect on
possible refactoring and redesign of the Aegir core, and ended up
formulating a few recommendations. The above document has extensive
reflections on the internals of the provision backend and the queuing
systems.</p>

<p>I need to basically take a look at this again and figure out the way
forward and start pounding out patches for this quite abstract
problem.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Moving_intelligence_to_the_spokes">3.3. Moving intelligence to the spokes</h2>

<p>I'm quite eager to start moving more logic down to the spokes, now that
we have Debian packages in order. This goes in hand with the 2.x
redesign analysis, but it is a practical issue that could be adressed
right now, which would be to start looking at having one queue per
server, and having those servers run those queues locally instead of
having the hub do everything.</p>

<p>The first step for this is the above issue with the files/ directory
which should be fixed shortly. The next steps are to move the dispatcher
to the backend and start maintaining aliases on each server.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Nginx_cleanup">3.4. Nginx cleanup</h2>

<p>I would very much like to finish the work I started on this and start
merging those patches in. I am waiting for feedback on those issues,
so please let me know how those things can be improved!</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Fix_security_issues_in_Drush">3.5. Fix security issues in Drush</h2>

<p>This is still a priority for me, and so I will look again at the
credentials leak in the Drush IPC code.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Merge_the_platform_auto_code">3.6. Merge the platform auto code</h2>

<p>One of the things we have in 2.x is a reference to the "platform auto"
module which gets pulled in during the drush_make process. However, I
feel that we shouldn't depend on contrib modules in the core makefile,
so we should either remove that from the makefile or merge that
code. I think we should just merge it. :)</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Subsite_support">3.7. Subsite support</h2>

<p>I really need to take a look at the work mig5 has done to support subdirectory sites, here: <a href="https://drupal.org/node/705026#comment-6219872" title="https://drupal.org/node/705026#comment-6219872">https://drupal.org/node/705026#comment-6219872</a></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-330.html?destination=node%2F1681%23comment-form">Login</a> or <a href="../../../../../user/register/index-330.html?destination=node%2F1681%23comment-form">register</a> to post comments</span></li>
<li class="print last active"><a href="index-2.html?print" class="active">Print</a></li>
</ul></div>
  </div>


</div>
    </div></div>
<div id='right'><div class='page-region'>
    

<div  id="block-boxes-search_issues" class="block block-boxes">
      <div class='block-title'>
            LOOKING FOR HELP?    </div>
  
  
      <div class='block-content clear-block '>
      <div id='boxes-box-search_issues' class='boxes-box'><div class="boxes-box-content"><table class="prose">
<tr>
<td width="50%">
<span style="font-size:16px;width:100%">Type some keywords below and hit "enter":</span><br />
<input type="text" class="drupal-issue-redirect" style="width:100%;min-width:200px;background-color:#DDEEFF; font-size:30px;border-style:dotted;border-width:1px" />
<p>This will search the drupal.org issue queues across the various projects that make up the Aegir system. If there are no relevant results, please submit an issue there.</p></td>
<td style="padding:10px">Other support resources:
<ul>
<li><a href="irc://irc.freenode.net/aegir">#aegir on IRC</a></li>
<li><a href="../../../../../faq/index.html">FAQ</a></li>
<li><a href="../../../../../handbook/index.html">Aegir Handbook</a></li>
<li><a href="../../../../../service-providers/index.html">Aegir service providers</a></li>
<li><a href="https://drupal.org/project/issues?text=&amp;projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&amp;status=Open&amp;priorities=All&amp;categories=All">All Aegir issues</a></li>
<li><a href="http://drupal.stackexchange.com/questions/tagged/aegir">Aegir tag on Drupal Stackexchange</a></li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
$("input.drupal-issue-redirect").change(function() {
  searchURL= "http://drupal.org/project/issues?text="+$(this).val()+"&projects=provision,+hosting,+hostslave,+eldir,+Hostmaster+(Aegir),Hosting+Platform+Pathauto&status=Open&priorities=All&categories=All";
  window.location = searchURL;
});
</script></div></div>    </div>
  
  </div>


  

<div  id="block-views-discussion_comments-block_1" class="block block-views">
      <div class='block-title'>
            Recent comments    </div>
  
  
      <div class='block-content clear-block '>
      <div class="view view-discussion-comments view-id-discussion_comments view-display-id-block_1 view-dom-id-1">
    
  
  
      <div class="view-empty">
      <p>No recent comments found.</p>    </div>
  
  
  
  
  
  
</div>     </div>
  
  </div>


</div></div>

  </div></div>

    <div id="footer"><div class='limiter clear-block'>
        <ul class="links"><li class="atrium first last"><a href="http://www.openatrium.com/" target="_blank">OpenAtrium.com</a></li>
</ul>  </div></div>
  
  <div id='palette'>  

<div  id="block-atrium-help" class="block block-atrium">
      <div class='block-title'>
            <span class='close'></span>Need help?    </div>
  
  
      <div class='block-content clear-block '>
      

<div  id="help-text" class="path-admin-help clear-block toggleable">
  
    
  
  
  
      <div class='help-content clear-block prose'>
      <span class='icon'></span><p>The revisions let you track differences between multiple versions of a post.</p>
<h3>Discussion</h3><p>The discussion area lets your team communicate by posting updates and discussing issues. It is a great place for sharing progress, discussing challenges, and exploring ideas.</p>
    </div>
  
  </div>


    </div>
  
  </div>


</div>
  
  </body>

<!-- Mirrored from community.aegirproject.org/node/1681/revisions/3682/view by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:15:24 GMT -->
</html>
