<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/389/revisions/1342/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:36:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../417/index.html" />
<link rel="prev" href="../../../../../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../417/index.html" />
<link rel="prev" href="../../../../../content/installing/debian/automatic-installation-ubuntu-1104-quickstart/index.html" />
<link rel="up" href="../../../../../installing/index.html" />
<link rel="next" href="../../../../417/index.html" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Manual Installation from Fri, 04/01/2011 - 04:51 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-389" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../../../installing/manual/index.html">Manual Installation</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><div id='diff-inline-389'><div class='diff-inline-metadata clear-block'><div class='diff-inline-byline'>Updated by <a href="../../../../../user/54/index.html" class="username" title="View user profile.">ergonlogic</a> on 04/01/2011 - 04:51</div><div class='diff-inline-legend clear-block'><label>Legend</label><span class='diff-added'>Added</span><span class='diff-changed'>Changed</span><span class='diff-deleted'>Deleted</span></div></div><h1><span class='diff-deleted'>Introduction</span></h1><span class='diff-deleted'>

</span><p><span class='diff-added'>This page describes to process you need to follow if </span>Aegir <span class='diff-changed'>doesn't have packages for your distribution. We currently provide </span><a href="../../../../400/index.html"><span class='diff-changed'>Debian packages</span></a><span class='diff-changed'> but more could be coming. This manual assumes you are fairly familiar with the UNIX commandline interface, but should be possible to follow through if you copy and paste faithfully </span><em><span class='diff-changed'>all</span></em><span class='diff-changed'> steps of the procedure.</span></p><span class='diff-changed'>

</span><p><span class='diff-changed'>This process can also be useful for porters to create their own packages or for paranoid sysadmins that want to make sure they know exactly what's going on during the install.</span></p><span class='diff-changed'>

</span><p><span class='diff-changed'>This may seem</span> difficult at first, but once you get around it, it's fairly simple. <span class='diff-changed'>It follows those steps:</span></p><span class='diff-added'>

</span><script type="text/javascript"><span class='diff-added'>toc_collapse=0;</span></script><span class='diff-added'></span><div class="toc" id="toc1"><span class='diff-added'>
</span><div class="toc-title"><span class='diff-added'>Table of Contents</span><span class="toc-toggle-message"><span class='diff-added'>&nbsp;</span></span><span class='diff-added'></span></div><span class='diff-added'>
</span><div class="toc-list"><span class='diff-added'>
</span><ol><span class='diff-added'>
	</span><li class="toc-level-1"><span class='diff-added'></span><a href="#Review_System_Requirements"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>1. </span></span><span class='diff-added'>Review System Requirements</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-1"><span class='diff-added'></span><a href="#Install_system_requirements"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>2. </span></span><span class='diff-added'>Install system requirements</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-1"><span class='diff-added'></span><a href="#Configure_system_requirements"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>3. </span></span><span class='diff-added'>Configure system requirements</span></a><span class='diff-added'>
</span><ol><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#Webserver_configuration"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>3.1. </span></span><span class='diff-added'>Webserver configuration</span></a><span class='diff-added'>
</span><ol><span class='diff-added'>
	</span><li class="toc-level-3"><span class='diff-added'></span><a href="#Apache_configuration"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>3.1.1. </span></span><span class='diff-added'>Apache configuration</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-3"><span class='diff-added'></span><a href="#Nginx_configuration"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>3.1.2. </span></span><span class='diff-added'>Nginx configuration</span></a><span class='diff-added'></span></li><span class='diff-added'>
</span></ol><span class='diff-added'>
</span></li><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#DNS_configuration"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>3.2. </span></span><span class='diff-added'>DNS configuration</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#PHP_configuration"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>3.3. </span></span><span class='diff-added'>PHP configuration</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#Database_configuration"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>3.4. </span></span><span class='diff-added'>Database configuration</span></a><span class='diff-added'></span></li><span class='diff-added'>
</span></ol><span class='diff-added'>
</span></li><span class='diff-added'>
	</span><li class="toc-level-1"><span class='diff-added'></span><a href="#Create_the_Aegir_user"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>4. </span></span><span class='diff-added'>Create the Aegir user</span></a><span class='diff-added'>
</span><ol><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#Sudo_access"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>4.1. </span></span><span class='diff-added'>Sudo access</span></a><span class='diff-added'></span></li><span class='diff-added'>
</span></ol><span class='diff-added'>
</span></li><span class='diff-added'>
	</span><li class="toc-level-1"><span class='diff-added'></span><a href="#Stop_Now_become_the_Aegir_user"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>5. </span></span><span class='diff-added'>Stop! Now become the Aegir user!</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-1"><span class='diff-added'></span><a href="#Install_Aegir_components"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>6. </span></span><span class='diff-added'>Install Aegir components</span></a><span class='diff-added'>
</span><ol><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#Install_drush"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>6.1. </span></span><span class='diff-added'>Install drush</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#Install_provision"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>6.2. </span></span><span class='diff-added'>Install provision</span></a><span class='diff-added'></span></li><span class='diff-added'>
	</span><li class="toc-level-2"><span class='diff-added'></span><a href="#Running_hostmaster-install"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>6.3. </span></span><span class='diff-added'>Running hostmaster-install</span></a><span class='diff-added'></span></li><span class='diff-added'>
</span></ol><span class='diff-added'>
</span></li><span class='diff-added'>
	</span><li class="toc-level-1"><span class='diff-added'></span><a href="#Checkpoint_Finished"><span class='diff-added'></span><span class="toc-number"><span class='diff-added'>7. </span></span><span class='diff-added'>Checkpoint / Finished!</span></a><span class='diff-added'></span></li><span class='diff-added'>
</span></ol><span class='diff-added'>
</span></div><span class='diff-added'>
</span></div>

<ol>
<li><a href="#Install_system_requirements">Install system requirements</a></li>
<li><a href="#Configure_system_requirements">Configure system requirements</a>, which include:

<ul>
<li>configure the <a href="#Webserver_configuration">webserver</a>, <a href="#Database_configuration">database</a>, <a href="#DNS_configuration">DNS</a>, <a href="#PHP_configuration">PHP</a>, etc</li>
</ul></li>
<li><a href="#Create_the_Aegir_user">Create the Aegir user</a>,</li>
<li>Install the backend (<a href="http://drupal.org/project/drush">Drush</a> &amp; <a href="http://drupal.org/project/provision">Provision</a>) and the frontend (with <code>hostmaster-install</code>) <a href="#Install_with_install.sh">with install.sh</a>.</li>
</ol>

<p>Note that these instructions setup a complete Aegir system. If you want to only setup a new remote web/db server, it should be sufficient to install the <a href="#Install_system_requirements">system requirements</a> (step 1),  <a href="#Configure_system_requirements">configure them</a> (step 2) and follow the <a href="../../../../30/index.html">Remote server how-to</a>.</p>

<p>These instructions provide example commands for a Debian-like distribution, but should be fairly easy to adapt to other environments. In fact, this document is meant as a canonical reference that should work on every platform and that can be used for people porting Aegir to new platforms or installing on alien platform for which Aegir is not yet packaged.</p>

<h1 id="Review_System_Requirements"><span class='diff-changed'>1. Review </span>System Requirements</h1><span class='diff-deleted'>

</span><h2><span class='diff-deleted'>Overview</span></h2>

<dl>
<dt><strong>A system capable of running Drupal</strong></dt>
<dd>The Aegir system is entirely Drupal based, and has the same base requirements that Drupal does (with the exception that it won't run on Windows). See more notes on Unix and LAMP/LEMP requirements below.</dd>

<dt><strong>Your own server</strong></dt>
<dd>The low level of access required to be able to configure and run this system is very far beyond what is commonly available to users with shared hosting. A VPS from any popular provider such as Linode, Rackspace, Slicehost, Amazon EC, etc. will do fine.</dd>

<dt><strong>LAMP / LEMP</strong></dt>
<dd>LAMP / LEMP are used to run Aegir and provide the frontend interface, as well as provide those same tools to your managed sites. These components are further detailed in the following sections. While you can install Aegir alongside an existing LAMP installation, it is generally considered easier (and thus recommended) to start with a fresh server.</dd>

<dd>
<p><strong>N.B.:</strong> If you do install Aegir alongside an existing server with LAMP/LEMP already configured, be aware that you will have to make configuration changes to Apache and MySQL where necessary, so that Aegir can work with your system.</p>
</dd>

<dt><strong>A Unix-based operating system</strong></dt>
<dd>Aegir must run on some flavour of UNIX, because the majority of functionality in this system occurs in the back-end, through command line scripting. There are also several features (such as symlinks), that are not available to users on Windows. There are no plans currently to add Windows support.</dd>

<dt><strong>Web server</strong></dt>
<dd>You will need at least one dedicated web server, running Apache. We generally work with Apache 2 but we should be compatible with the 1.x series. You will need root access to that server and the server must be reserved for
Aegir. Sharing the server with other control panels such as Cpanel, Plesk or AlternC will very likely create problems and is not supported.</dd>

<dd>
<p>Aegir also supports Nginx web server, but requires at least version 0.7.27 or newer. Since Nginx doesn't provide php-cgi or php-fpm (recommended) modules, you will need to install and run php-fpm server separately. You can find useful examples and tips in the third party Barracuda installer available at <a href="http://gitorious.org/aegir/barracuda-octopus" title="http://gitorious.org/aegir/barracuda-octopus">http://gitorious.org/aegir/barracuda-octopus</a>.</p>
</dd>

<dd>
<p><strong>N.B.:</strong> This third party installer is not supported by the core Aegir developers, but you can find helpful community support at <a href="../../../../../index.html" title="http://community.aegirproject.org">http://community.aegirproject.org</a>.</p>
</dd>

<dt><strong>Database server</strong></dt>
<dd>You will require a database server, obviously. Aegir currently only supports MySQL and MariaDB. It is preferable to use a dedicated (not shared-hosting) server since Aegir will create database users and will require the use of the MySQL 'root' user.</dd>

<dt><strong>PHP 5.2</strong></dt>
<dd>PHP 5.2 and above is required to run Aegir because Aegir depends on <a href="http://drupal.org/project/drush">Drush</a>, which has this requirement. You also need to have the command-line version of PHP to run Drush properly and the MySQL extensions.</dd>

<dd>
<p>Note that Drupal's support for PHP 5.3 is still under development. Currently, using PHP 5.3 will cause (innocuous) warnings on every page load. As a result, we suggest using PHP 5.2 for the time-being.</p>
</dd>

<dd>
<p>See <a href="http://drupal.org/node/360605" title="http://drupal.org/node/360605">http://drupal.org/node/360605</a> (amongst other issues) for details.</p>
</dd>

<dt><strong>Mail transfer agent</strong></dt>
<dd>Aegir requires an MTA (Mail Transfer Agent) installed on your webserver in order to be able to install new sites to your new platform. If you don't have an MTA, the site installation will fail with message like "could not send email". Additional messages will show that site has been removed because of this problem. To remedy the situation simply install an MTA like sendmail, postfix, or exim and do the minimal configuration.</dd>

<dt><strong>Other utilities: sudo, rsync, git and unzip</strong></dt>
<dd>Aegir installs itself via a <a href="http://drupal.org/project/drush_make">Drush Make</a> makefile that downloads via git if you want the bleeding edge code, or via wget if you want the latest official release. If you want the latest development version, and don't have the git program you
will need to install it on the server.</dd>

<dd>
<p>The jQueryUI library is used in the Aegir UI, unzip is required to extract it. Sudo is required to allow the aegir user the limited privilege to restart the webserver when required.  Rsync is used to sync files to remote servers.</p>
</dd>

<dt><strong>No conflicting Control Panels</strong></dt>
<dd>Other popular control panels such as Plesk, cPanel etc, are designed to manage all aspects of Apache configuration and other areas that Aegir also is intended to be used for.</dd>

<dd>
<p>Running Aegir alongside such control panels is not supported and very likely may cause you problems or difficulties installing or running Aegir. This is not recommended. Filing bug reports that are caused by interference by another control panel may not get results. Proceed at your own risk / frustration!</p>
</dd>

<dt><strong>System requirements of popular Drupal distributions</strong></dt>
<dd>Some Drupal distributions, such as OpenAtrium, are specialised products that may contain unique prerequisites for optimal performance. Such examples may include raising the php-cli program's memory_limit to something higher than 64M.</dd>

<dd>
<p>Please note that this is not a requirement of Aegir but of the distribution you are trying to install a site on. Thus the Aegir documentation may not officially 'require' such performance settings, but be aware that Aegir may report errors if the system was under-resourced to complete such a task.</p>
</dd>
</dl>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h1 id="Install_system_requirements"><span class='diff-changed'>2. </span>Install system requirements</h1>

<p>To install the required components, run the following command as root:</p>

<pre><code>apt-get install apache2 php5 php5-cli php5-gd php5-mysql postfix sudo rsync git-core unzip
</code></pre>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h1 id="Configure_system_requirements"><span class='diff-changed'>3. </span>Configure system requirements</h1>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h2 id="Webserver_configuration"><span class='diff-changed'>3.1. </span>Webserver configuration</h2>

<p>Aegir supports two popular web servers, Apache and Nginx. At this time, Apache support is more stable, and recommended for most users.</p>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h3 id="Apache_configuration"><span class='diff-changed'>3.1.1. </span>Apache configuration</h3>

<p>Aegir assumes a few Apache modules are available on the server, and generates its own configuration files. The way we enable this is by symlinking a single file which contains all the configuration necessary. In Debian-based systems, you should symlink this file inside <code>/etc/apache2/conf.d</code> that will be parsed on startup or alternatively you can place include that file in your apache.conf/httpd.conf. We prefer the former. In other systems there are similar ways to accomplish this. Consult your OS's documentation if unsure.</p>

<p>If you are on a Debian-based system, you will also need to enable the mod_rewrite module manually.</p>

<p>Run the following shell commands as root. First, configure Apache to enable RewriteEngine:</p>

<pre><code>a2enmod rewrite
</code></pre>

<p>Finally, create a symlink from an apache configuration file to a folder within the /var/aegir/:</p>

<pre><code>ln -s /var/aegir/config/apache.conf /etc/apache2/conf.d/aegir.conf
</code></pre>

<p><strong>Do not reload/restart Apache if prompted to after running these commands, it will fail.</strong></p>

<p>The installer script creates the configuration file referenced by the newly created symlink.</p>

<p><strong>N.B.:</strong></p>

<ul>
<li>A standard umask of 022 is assumed. This is the default on most systems.</li>
<li>For more information, see the <a href="../../../../462/index.html">common installation errors</a>.</li>
</ul>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h3 id="Nginx_configuration"><span class='diff-changed'>3.1.2. </span>Nginx configuration</h3>

<p>(If you just succeeded in installing Apache, please skip this section.)</p>

<p>Aegir assumes standard Nginx configuration is available on the server, and generates its own configuration files. The way we enable this is by symlinking a single file which contains all the configuration necessary. In Debian-based systems, you should symlink this file inside <code>/etc/nginx/conf.d</code> that will be parsed on startup.</p>

<p>Shell command as root::</p>

<pre><code>ln -s /var/aegir/config/nginx.conf /etc/nginx/conf.d/aegir.conf
</code></pre>

<p><strong>Do not reload/restart Nginx after running these commands, it will fail.</strong></p>

<p>The installer script creates the configuration file referenced by the newly created symlink.</p>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h2 id="DNS_configuration"><span class='diff-changed'>3.2. </span>DNS configuration</h2>

<p>Aegir requires a properly configured "FQDN" (Fully Qualified Domain Name) be assigned to the machine. In practice, this means that the hostname returned by the <code>hostname</code> and <code>uname -n</code> shell commands should resolve to the IP address for this server, and vice versa.</p>

<p>If you only intend to use Aegir on a single server, it is acceptable for the resolved IP address to be the '127.0.0.1' loopback address.</p>

<p>If you intend to manage multiple servers using Aegir, you will need to make sure that the IP address is the public IP of this server.</p>

<p>You can add multiple entries to your /etc/hosts file for testing purposes, for example:</p>

<pre><code>127.0.0.1 aegir.example.com example.com test1.example.com test2.example.com test3.example.com
</code></pre>

<p>Then you can use test1.example.com to create your first site.</p>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h2 id="PHP_configuration"><span class='diff-changed'>3.3. </span>PHP configuration</h2>

<p>Some complex installation profiles or distributions require a PHP memory limit that is higher than the default. To avoid common errors when installing sites on some distributions, the PHP command line tool should be configured to use 192Mb 
of RAM.</p>

<p>Change the memory_limit directive in /etc/php5/cli/php.ini to read:</p>

<pre><code>memory_limit = 192M      ; Maximum amount of memory a script may consume (192MB)
</code></pre>

<p>Most modern Drupal sites require around 96M or even 128M of RAM for certain operations. This is far more than what is provided by the default PHP configuration.</p>

<p>Change the memory_limit directive in /etc/php5/apache2/php.ini to read::</p>

<pre><code>memory_limit = 128M      ; Maximum amount of memory a script may consume (128MB)
</code></pre>

<p>If your distributions require more memory than these limits, then use some common sense and update it as appropriate to suit your individual needs.</p>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h2 id="Database_configuration"><span class='diff-changed'>3.4. </span>Database configuration</h2>

<p>Aegir supports MySQL right now. It is best to install the MySQL server using your Linux distribution's package manager.</p>

<p>Shell commands as root::</p>

<pre><code>apt-get install mysql-server
</code></pre>

<p>To make sure that the Aegir backend, and all the possible web servers can reach your database server, you need to configure mysql to listen on all the public IP addresses available to it.</p>

<p>Again, as root, edit the MySQL configuration file /etc/mysql/my.cnf configuration line to comment out by placing a # at the beginning of the line on which the following instruction appears::</p>

<pre><code>bind-address    = 127.0.0.1
</code></pre>

<p>Without this line commented out, MySQL will listen only on localhost for database connection requests.</p>

<p>Now you need to restart mysql, to clear any caches.</p>

<p>Shell command as <span class='diff-changed'>root:</span></p>

<pre><code>/etc/init.d/mysql restart
</code></pre>

<p>The installer will prompt you for your MySQL root user password. The root user will be used to make administrative tasks such as creating new databases, and granting and revoking access to those databases for sites.</p>

<p>Even though MySQL is now listening on all IP's, it will not allow invalid users to connect to the databases, without the correct user accounts configured.</p>

<p>If you are concerned about MySQL being accessible in this way, you can also configure your firewall to only allow incoming connections from certain addresses. This is outside the scope of this document however.</p>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h1 id="Create_the_Aegir_user"><span class='diff-changed'>4. </span>Create the Aegir user</h1>

<p>The provision framework of Aegir requires that the scripts run as a non-root system account, to ensure that it can correctly set the file permissions on the hosted files.</p>

<p>Also to ensure that the file permissions of the hosted sites are always as safe as can be, and especially to make sure that the web server does not have the ability to modify the code of the site, the configured system account needs to be a member of the web server group, in order to be able to correctly set the file permissions.</p>

<p>This document assumes the Aegir user is <code>aegir</code>, its home directory is <code>/var/aegir</code> and the webserver group is <code>www-data</code>. You can choose another username if desired.</p>

<p>In addition we will create a directory layout for Aegir configuration and backups.</p>

<p>Shell commands as <span class='diff-changed'>root:</span></p>

<pre><code>adduser --system --group --home /var/aegir aegir
adduser aegir www-data    #make aegir a user of group www-data
</code></pre>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h2 id="Sudo_access"><span class='diff-changed'>4.1. </span>Sudo access</h2>

<p>Next, we need to give the aegir user permission to execute the Apache2 command to restart the web server without entering a password.</p>

<p>For those using Apache, shell command as root::</p>

<pre><code>visudo
</code></pre>

<p>This command opens an editor (which one depends on your OS flavor) to allow you to edit the /etc/sudoers file.  Add the following to the end of the file (specific directions cannot be given since this depends on what editor you're using):</p>

<pre><code> aegir ALL=NOPASSWD: /usr/sbin/apache2ctl
</code></pre>

<p><strong>Note</strong> - the path to your apache2ctl program may differ from this example. On some systems it may also be called 'apachectl' instead of apache2ctl. Adjust to suit your own requirements.</p>

<p>For those using Nginx, set the sudoer line as follows</p>

<pre><code>aegir ALL=NOPASSWD: /etc/init.d/nginx
</code></pre>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h1 id="Stop_Now_become_the_Aegir_user"><span class='diff-changed'>5. Stop! Now become the Aegir user!</span></h1>

<p><span class='diff-changed'>The remaining of this manual assumes you are running as the</span> Aegir <span class='diff-changed'>user. Things will go very wrong if you do not change your shell credentials to become that user. You can do this by running the following command as root:</span></p>

<p><span class='diff-changed'></span><div class="codeblock"><span class='diff-changed'></span><code><span class='diff-changed'>su -s /bin/bash aegir</span></code><span class='diff-changed'></span></div><span class='diff-changed'></span></p><span class='diff-changed'>

</span><p><span class='diff-changed'>If this fails because </span><code><span class='diff-changed'>/bin/bash</span></code><span class='diff-changed'> doesn't exist, try using </span><code><span class='diff-changed'>/bin/sh</span></code><span class='diff-changed'>.</span></p><span class='diff-changed'>

</span><div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h1 id="Install_Aegir_components"><span class='diff-changed'>6. Install Aegir components</span></h1><span class='diff-changed'>

</span><p><span class='diff-changed'>Next step is to install</span> the <span class='diff-changed'>Aegir software components themselves: drush, provision</span> and <span class='diff-changed'>hostmaster.</span></p><span class='diff-changed'>

</span><div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h2 id="Install_drush"><span class='diff-changed'>6.1. Install drush</span></h2><span class='diff-changed'>

</span><p><span class='diff-changed'>Before installing Aegir proper, you first need</span> to<span class='diff-added'> install Drush. This can</span> be <span class='diff-changed'>done through your operating system's package manager (Drush is shipped with</span> <a href="http://packages.debian.org/drush"><span class='diff-changed'>Debian</span></a><span class='diff-changed'> and </span><a href="http://packages.ubuntu.com/drush"><span class='diff-changed'>Ubuntu</span></a><span class='diff-changed'> currently) or by following the </span><a href="http://drupalcode.org/project/drush.git/blob_plain/HEAD:/README.txt"><span class='diff-changed'>Drush README.txt file</span></a><span class='diff-changed'> which has all</span> the <span class='diff-changed'>information for installing and using drush.</span></p><span class='diff-changed'>

</span><p><span class='diff-changed'>Drush is usually installed</span> in <span class='diff-changed'></span><code><span class='diff-changed'>/var/aegir/drush/drush.php</span></code><span class='diff-changed'> in manual installs.</span></p><span class='diff-changed'>

</span><div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back </span><span class='diff-added'>to top</span></a></div><span class='diff-added'></span><h2 id="Install_provision"><span class='diff-added'>6.2. </span><span class='diff-changed'>Install provision</span></h2><span class='diff-changed'>

</span><p><span class='diff-changed'>Once Drush is installed you should</span> be <span class='diff-changed'>able to install</span> the <span class='diff-changed'>latest recommended Provision release using the following drush</span> command:</p>

<p><span class='diff-changed'></span><div class="codeblock"><code><span class='diff-changed'>drush dl provision</span></code></div><span class='diff-changed'></span></p>

<p><span class='diff-changed'>To download a different version of provision, use this:</span></p><span class='diff-changed'>

</span><p><span class='diff-changed'></span><div class="codeblock"><span class='diff-changed'></span><code><span class='diff-changed'>drush dl provision-6.x-1.0-rc3</span></code><span class='diff-changed'></span></div><span class='diff-changed'></span></p><span class='diff-changed'>

</span><div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h2 id="Running_hostmaster-install"><span class='diff-changed'>6.3. Running hostmaster-install</span></h2><span class='diff-changed'>

</span><p><span class='diff-changed'>Once you have</span> downloaded <span class='diff-changed'>drush and provision, you can just</span> install<span class='diff-added'> provision in</span> the <span class='diff-changed'>commands directory of Drush (either ~aegir/.drush or /usr/share/drush/commands), if that's not already done. Once provision is properly installed, you</span> can <span class='diff-changed'>install all other aegir components using the hostmaster-install command:</span></p><span class='diff-changed'>

</span><pre><span class='diff-changed'></span><code><span class='diff-changed'>drush hostmaster-install
</span></code><span class='diff-changed'></span></pre><span class='diff-changed'>

</span><p><span class='diff-changed'>You will be prompted for</span> the <span class='diff-changed'>required information if not provided on</span> the <span class='diff-changed'>commandline. See the inline help</span> for <span class='diff-changed'>the available options:</span></p>

<pre><code><span class='diff-changed'>drush help hostmaster-install
</span></code></pre>

<p><span class='diff-changed'>For example, to install the frontend on Nginx, use:</span></p>

<pre><code><span class='diff-changed'>drush hostmaster-install --http_service_type=nginx
</span></code></pre>

<p><span class='diff-changed'>It is imperative that</span> you <span class='diff-changed'>provide a valid FQDN to</span> the <span class='diff-changed'>installer. This is used for database GRANTs. Remote web servers depend on</span> the <span class='diff-changed'>FQDN being resolvable in order</span> to <span class='diff-changed'>connect back to your Aegir master server if it is used as your database server for managed sites.</span></p>

<p><span class='diff-changed'>Upon completion of the installation, the traditional Drupal 'Welcome' e-mail will</span> be <span class='diff-changed'>sent to the e-mail address specified by </span><code><span class='diff-changed'>--client_email=(your e-mail)</span></code> <span class='diff-changed'>or if not provided as a</span> command <span class='diff-changed'>line switch,</span> the <span class='diff-changed'>address prompted by the installer process. This e-mail address will also be used as</span> the <span class='diff-changed'>default e-mail address of</span> the <span class='diff-changed'>first user</span> and <span class='diff-changed'>client in Aegir, but can be changed later.</span></p>

<div class="toc-back-to-top"><span class='diff-changed'></span><a href="#toc"><span class='diff-changed'>Back to top</span></a><span class='diff-changed'></span></div><span class='diff-changed'></span><h1 id="Checkpoint_Finished"><span class='diff-changed'>7. </span>Checkpoint / Finished!</h1>

<p>At this point, you have checked out all the code and setup your basic Drupal system (Drupal core, hosting, hostmaster and eldir) that will be the Aegir frontend and the backend system (provision and drush). Your filesystem layout should look something like this:</p>

<pre>
 /var/aegir/hostmaster-1.x/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/admin_menu/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/hosting/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/install_profile_api/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/jquery_ui/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/modules/modalframe/
 /var/aegir/hostmaster-1.x/profiles/hostmaster/themes/eldir/
 /var/aegir/hostmaster-1.x/sites/aegir.example.com/
 /var/aegir/config/server_master/apache.conf
 /var/aegir/config/server_master/apache/conf.d/
 /var/aegir/config/server_master/apache/vhost.d/
 /var/aegir/config/server_master/apache/platform.d/
 /var/aegir/backups/
 /var/aegir/drush/drush.php
 /var/aegir/.drush/drush_make/
 /var/aegir/.drush/provision/
</pre>

<p>Variations on this are acceptable (for example, the Drush Debian package works out of <code>/usr/bin/drush</code> and that's fine), but you are better to stick with the defaults if you really want to get through this.</p>

<p>The installation will provide you with a one-time login URL to stdout or via an e-mail. Use this link to login to your new Aegir site for the first time.</p><span class='diff-added'>

</span><p><span class='diff-added'>For troubleshooting this process and resulting install, see the </span><a href="../../../../462/index.html"><span class='diff-added'>common installation problems page</span></a><span class='diff-added'>.</span></p><span class='diff-added'></span><div class="toc-back-to-top"><span class='diff-added'></span><a href="#toc"><span class='diff-added'>Back to top</span></a><span class='diff-added'></span></div><span class='diff-added'></span><script type="text/javascript"><span class='diff-added'>toc_scroll_back_to_top = 1;</span></script></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-292.html?destination=node%2F389%23comment-form">Login</a> or <a href="../../../../../user/register/index-292.html?destination=node%2F389%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_comments last"><a href="../../../talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>


<div id="comments">
  <a id="comment-1915"></a>


<div  id="comment-1915" class="comment comment-published clear-block decay-0 decay-0">
      <div class='comment-submitted clear-block'>
      <div class="picture">
  <a href="../../../../../users/mccrodp/index.html" title="View user profile."><img src="../../../../../sites/community.aegirproject.org/files/imagecache/user-s/profiles/openatrium/themes/ginkgo/images/user/index.png" alt="mccrodp&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../../../../users/mccrodp/index.html" class="username" title="View user profile.">mccrodp</a></div><div class='date'>1:29pm Apr 17, 2013</div>    </div>
  
      <h2 class='comment-title'>
            <a href="../../../talk/index.html#comment-1915">#1</a>    </h2>
  
      <div class='comment-content clear-block prose'>
      <p>A few points just on installing drush with RedHat 6 that I seem to run in to every time.</p>

<p>When I try to discover the pear channel as aegir user I get
<code>could not create lock file: fopen(/usr/share/pear/.lock): failed to open stream: Permission denied</code></p>

<p>I also get the following after I make the aegir user owner of the .lock file
<div class="codeblock"><code>pear channel-discover pear.drush.org<br />Discovering channel pear.drush.org over http:// failed with message: channel-add: adding Channel &quot;pear.drush.org&quot; to registry failed<br />Trying to discover channel pear.drush.org over https:// instead<br />Discovery of channel &quot;pear.drush.org&quot; failed (channel-add: Cannot open &quot;https://pear.drush.org/channel.xml&quot; (Connection to `pear.drush.org:443&#039; failed: Connection refused))</code></div></p>

<p>I can add it with root user but when installing drush I get <div class="codeblock"><code>pear install drush/drush-5.8.0<br />Cannot install, php_dir for channel &quot;pear.drush.org&quot; is not writeable by the current user</code></div></p>

<p>I always have to install drush as root and then modify ownership/permissions to aegir user. Is the documentation wrong, or am I missing something?</p>

<p>Also, for drush 5 it seems that 'http://download.pear.php.net/package/Console_Table-1.1.3.tgz' is a dependency!</p>    </div>
  
      <div class='comment-links clear-block'><ul class="links"><li class="comment_forbidden first last"><span><a href="../../../../../user/login/index-292.html?destination=node%2F389%23comment-form">Login</a> or <a href="../../../../../user/register/index-292.html?destination=node%2F389%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>


</div>
    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/389/revisions/1342/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:36:05 GMT -->
</html>
