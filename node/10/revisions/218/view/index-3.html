<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/10/revisions/218/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:07:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../upgrading/manual/index.html" />
<link rel="prev" href="../../../../../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../upgrading/manual/index.html" />
<link rel="prev" href="../../../../../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../upgrading/manual/index.html" />
<link rel="canonical" href="index.html" />
<link rel="prev" href="../../../../../upgrading/index.html" />
<link rel="up" href="../../../../../upgrading/index.html" />
<link rel="next" href="../../../../../upgrading/debian/index.html" />
<link rel="prev" href="../../../../../upgrading/manual/index.html" />
<link rel="up" href="../../../../../upgrading/index.html" />
<link rel="next" href="../../../../../upgrading/script/index.html" />
<link rel="prev" href="../../../../../upgrading/debian/index.html" />
<link rel="up" href="../../../../../upgrading/index.html" />
<link rel="next" href="../../../../../upgrading/path/index.html" />
<link rel="prev" href="../../../../../upgrading/script/index.html" />
<link rel="up" href="../../../../../upgrading/index.html" />
<link rel="next" href="../../../../../uninstalling/index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Upgrading Aegir from Fri, 11/05/2010 - 19:42 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-10" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../../../upgrading/index.html">Upgrading Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><div id='diff-inline-10'><div class='diff-inline-metadata clear-block'><div class='diff-inline-byline'>Updated by <a href="../../../../../users/mig5/index.html" class="username" title="View user profile.">mig5</a> on 11/05/2010 - 19:42</div><div class='diff-inline-legend clear-block'><label>Legend</label><span class='diff-added'>Added</span><span class='diff-changed'>Changed</span><span class='diff-deleted'>Deleted</span></div></div><p>Upgrading Aegir is designed to be as easy as it possibly can be, and regularly improves over time as the developers attempt to streamline the process for users.</p>

<p>Nonetheless, the upgrade process can seem a little daunting to users. This is mainly because some expectation arises that because Aegir is built on Drupal, and is made for managing Drupal sites, it seems reasonable to expect the upgrade process to be as straightforward as, say, upgrading a regular Drupal site.</p>

<p>Aegir is a powerful system that goes beyond a normal Drupal application by being split into two parts: a frontend (the browser-based control panel) and the backend (bits on the system in /var/aegir, such as Drush and Drush extensions), along with a system user on your server that runs command-line scripts and restarts services, and cronjobs.</p>

<p>Typically what this means is that when it comes time to upgrade Aegir, you not only have to upgrade the frontend site, but also update the components that reside in the 'backend'.</p>

<p>But don't panic! We have instructions and even a script to run, to take care of almost all of it for you, eliminating as much as possible the chance for human error.</p>

<p>This guide is not the official upgrade instructions for your system. It merely explains the purpose of UPGRADE.txt and what it actually does. You <strong>must</strong> follow the UPGRADE.txt precisely in order to upgrade your system.</p>

<h2>UPGRADE.txt</h2>

<p>In a similar fashion to the <a href="../../../../9/index.html">Install instructions</a>, the upgrade process for Aegir resides in an UPGRADE.txt that ships with each release inside the 'Provision' component.</p>

<p>It is kept in each release so that it may be versioned, as some upgrade steps may and often do differ between releases.</p>

<p>The UPGRADE.txt is stored in the 'docs' directory of the Provision component, which gets installed in /var/aegir/.drush/ on standard systems. However, the announcement for each release (published here and on the mailing lists) always contains a link to the UPGRADE.txt, so you'll probably find it's easier to fetch it from there.</p>

<p>Each time a new release of Aegir is made, there may be some 'version-specific' notes contained towards the bottom of the file. The reason for this is that sometimes a change in Aegir requires a new change or modification of some other component of your server. This might include adding, removing or changing a line in MySQL's /etc/mysql/my.cnf, or changing the location of an 'Include' path in Apache to read configurations from a new location.</p>

<p>Because these modifications typically require administrative privileges to perform, they can't be automated or run by the system 'aegir' user on your server. This is the reason these notes are included in the UPGRADE.txt.</p>

<p><strong>It is extremely important that you read the version-specific notes before following any other instructions in the UPGRADE.txt.</strong></p>

<p>If you fail to apply any of the version-specific steps and proceed with the generic upgrade process, that process is likely to fail.</p>

<h2>Upgrade process</h2>

<p>The typical upgrade process outlined at the start of the UPGRADE.txt is as follows:</p>

<ul>
<li>Read and apply the version-specific notes</li>
<li>Read the conventions and tips</li>
<li>Run the upgrade.sh.txt script, or the next three steps:</li>
<li>Set the environment variables</li>
<li>Upgrade the backend</li>
<li>Upgrade the frontend</li>
</ul>

<h2>upgrade.sh.txt</h2>

<p>An upgrade.sh.txt is mentioned in the UPGRADE.txt. This automates the last three steps listed above, including backing up old components first. The upgrade.sh.txt has to assume that you have read and completed the version-specific steps first before attempting to run it.</p>

<h2>Manually upgrading</h2>

<p>Alternatively if you don't wish to run the script, you may proceed to export the environment variables. These are just abstractions to avoid having to re-type the same URLs or version numbers of Aegir and other components, which would otherwise introduce extra potential for human error.</p>

<p>After your environment  variables are exported, you must then proceed to upgrade the backend. The reason for upgrading the backend first before the frontend, is that the frontend upgrade process (explained further below) is instigated by the backend using Drush Make. Thus you need to be running the new backend first in order to successfully produce a new frontend.</p>

<p>Upgrading the backend is as simple as replacing your copy of Drush, Provision, and if necessary, Drush Make, with the new versions if available. These manual steps are provided to you in the UPGRADE.txt; you can literally copy and paste the steps into your terminal and expect good results.</p>

<p>Once your backend is upgraded, you can upgrade your frontend. Think of this as the backend fetching a new copy of Drupal core and the Hostmaster frontend application onto your server, and then moving the Aegir site's settings.php and other bits and pieces over to the new codebase.</p>

<p>The procedure for upgrading the frontend is entering your old hostmaster directory, (say, /var/aegir/hostmaster-$old-version) and running 'drush hostmaster-migrate $youraegirdomain.com'.</p>

<p>The precise steps for performing this, just like the earlier parts, are all provided by the UPGRADE.txt. You can copy and paste the commands provided and you should get good results if you followed all the earlier steps.</p>

<p>Did we remind you to <strong>read the version-specific notes</strong> first? This is the most common pitfall for users trying to upgrade their system.</p>

<h2>New release of Drupal core?</h2>

<p>Just as you would use the Migrate task in Aegir to upgrade one of your sites to a new copy of Drupal core, you can follow the UPGRADE.txt to upgrade your actual Aegir frontend system to a new copy of Drupal core too. The upgrade process (including the script) will always fetch the latest available copy of Drupal core to place the frontend on.</p>

<p>Currently you cannot upgrade the Aegir site itself from the frontend with a Migrate task as you do for your managed sites. This may change in the future, but has not been developed yet.</p></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-72.html?destination=node%2F10%23comment-form">Login</a> or <a href="../../../../../user/register/index-72.html?destination=node%2F10%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-72.html?destination=node%2F10%23comment-form">Login</a> or <a href="../../../../../user/register/index-72.html?destination=node%2F10%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



<div  id="node-429" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../upgrading/manual/index.html">Manual Upgrade</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_21 first"><a href="../../../../../taxonomy/term/21/index.html" rel="tag" title="">manual</a></li>
<li class="taxonomy_term_2"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
<li class="taxonomy_term_22 last"><a href="../../../../../taxonomy/term/22/index.html" rel="tag" title="">upgrade</a></li>
</ul></div><p>This section outlines the requirements for doing a manual upgrade of Aegir to a new release. Before going ahead with this, you probably want to read the <a href="../../../../../upgrading/path/index.html">upgrade path and version-specific notes</a>.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Conventions_and_Tips"><span class="toc-number">1. </span>Conventions &amp; Tips</a></li>
	<li class="toc-level-1"><a href="#Upgrading_Overview"><span class="toc-number">2. </span>Upgrading Overview</a>
<ol>
	<li class="toc-level-2"><a href="#Upgrading_drush"><span class="toc-number">2.1. </span>Upgrading drush</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_backend"><span class="toc-number">2.2. </span>Upgrading the backend</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_frontend"><span class="toc-number">2.3. </span>Upgrading the frontend</a></li>
	<li class="toc-level-2"><a href="#What_hostmaster-migrate_does"><span class="toc-number">2.4. </span>What hostmaster-migrate does</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Upgrading_to_AEgir_1.x"><span class="toc-number">3. </span>Upgrading to AEgir 1.x</a>
<ol>
	<li class="toc-level-2"><a href="#Upgrading_drush_and_drush_make"><span class="toc-number">3.1. </span>Upgrading drush and drush make</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_1.x_backend"><span class="toc-number">3.2. </span>Upgrading the 1.x backend</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_1.x_frontend"><span class="toc-number">3.3. </span>Upgrading the 1.x frontend</a></li>
	<li class="toc-level-2"><a href="#Special_configurations_and_troubleshooting"><span class="toc-number">3.4. </span>Special configurations and troubleshooting</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Upgrading_to_AEgir_2.x"><span class="toc-number">4. </span>Upgrading to AEgir 2.x</a>
<ol>
	<li class="toc-level-2"><a href="#Upgrading_drush-1"><span class="toc-number">4.1. </span>Upgrading drush</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_2.x_backend"><span class="toc-number">4.2. </span>Upgrading the 2.x backend</a></li>
	<li class="toc-level-2"><a href="#Upgrading_the_2.x_frontend"><span class="toc-number">4.3. </span>Upgrading the 2.x frontend</a></li>
	<li class="toc-level-2"><a href="#Special_configurations_and_troubleshooting-2"><span class="toc-number">4.4. </span>Special configurations and troubleshooting</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="Conventions_and_Tips">1. Conventions &amp; Tips</h1>

<p>All instructions and in general all commands must be run as aegir user, so all
permissions are always set correctly.</p>

<p>To become aegir user you can issue this command:</p>

<pre><code>su -s /bin/sh aegir
</code></pre>

<p>(Note you must run this as root or prefix with sudo).</p>

<p>Note that /bin/sh is an example. You may wish to instead use the shell of your
choice, i.e /bin/bash</p>

<p>A standard umask of 022 is assumed. This is the default on most systems.</p>

<p>We assume that drush is in your path, if it is installed in <code>/var/aegir/drush/drush.php</code>, replace all occurences of <code>drush</code> by <code>/var/aegir/drush/drush.php</code> in the following steps, or add the following alias:</p>

<pre><code>alias drush=/var/aegir/drush/drush.php
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Upgrading_Overview">2. Upgrading Overview</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_drush">2.1. Upgrading drush</h2>

<p>As part of your Aegir upgrade, you need to upgrade Drush to the latest stable version compatible with the target Aegir release. AEgir 1.x <em>only</em> works with version 4.5.  Versions 5 - 7 have been known to work with AEgir 2.x, however  the Drush developers recommend version 6 as the most stable.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_backend">2.2. Upgrading the backend</h2>

<p>After drush is updated, you must then proceed to upgrade the backend. The reason for upgrading the backend first before the frontend, is that the frontend upgrade process is instigated by the backend using Drush Make. Thus you need to be running the new backend first in order to successfully produce a new frontend.</p>

<p>In general, we try to keep the backend and the frontend compatible with each other during release cycles. That is: provision 1.8 and hosting 1.9 will always be able to talk to each other, but hosting 2.0 will have trouble talking to the 1.9 backend, so you need to upgrade the backend first when you do a major upgrade (for example, 1.9 -&gt; 2.0).</p>

<p>Bottomline: first you upgrade the backend, then the frontend.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_frontend">2.3. Upgrading the frontend</h2>

<p>Once your backend is upgraded, you can upgrade your frontend. Think of this as the backend fetching a new copy of Drupal core and the Hostmaster frontend application onto your server, and then moving the Aegir site's settings.php and other bits and pieces over to the new codebase.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="What_hostmaster-migrate_does">2.4. What hostmaster-migrate does</h2>

<p>The command will make sure the target directory is a valid Aegir install. If the directory does not exist, provision will use drush_make to fetch and assemble the correct version of the front end for the specific release of the backend you are running.</p>

<p><code>hostmaster-migrate</code> will also completely replace the crontab entry for the aegir user.</p>

<p>The command above will fetch the latest stable Drupal release, so it can simply be run again when a new security release of Drupal is made available.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Upgrading_to_AEgir_1.x">3. Upgrading to AEgir 1.x</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_drush_and_drush_make">3.1. Upgrading drush and drush make</h2>

<p>As part of your Aegir upgrade, you need to upgrade Drush to the latest stable version compatible with the target Aegir release. Aegir 1.x does <strong>not</strong> support Drush 5, although 2.x does.</p>

<p>If you are using the Drush Debian packages, the package should be upgraded through:</p>

<pre><code>apt-get install drush
</code></pre>

<p>Otherwise, since drush 4.x is capable of upgrading itself, you can just run:</p>

<pre><code>drush dl drush-7.x-4.5
</code></pre>

<p>If you are running a version before 4.x, use the following set of commands instead:</p>

<pre><code>pear channel-discover pear.drush.org
pear install drush/drush-4.5.0
</code></pre>

<p>Provision 0.4 has added a new dependency on drush_make, which will also need to be installed to upgrade the front end if you are upgrading from a pre-0.4 release.</p>

<p>If you are upgrading from an earlier 0.4 release, replace your copy of drush_make with the latest recommended release.</p>

<pre><code>drush dl drush_make-6.x --destination="$HOME/.drush"
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_1.x_backend">3.2. Upgrading the 1.x backend</h2>

<p>Upgrading the backend is as simple as replacing your copy of Drush, Provision, and if necessary, Drush Make, with the new versions if available. Keep a copy of the old Provision and Drush in case something goes wrong in the frontend.</p>

<pre><code>drush dl provision-6.x --destination=$HOME/.drush
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_1.x_frontend">3.3. Upgrading the 1.x frontend</h2>

<p>Before upgrading, we set a few key variables to make the process easier. You <strong>must</strong> replace the arguments those variables to match your configuration. This means replacing <code>$AEGIR_DOMAIN</code> by the URL of your Aegir install, <code>$AEGIR_VERSION</code> with the version number of the Aegir you are trying to install, and also <code>$OLD_AEGIR_DIR</code> with the path to the previous directory where Aegir was installed.</p>

<p>The directory passed to <code>hostmaster-migrate</code> must be an absolute path to where you want the new release to be stored.</p>

<pre><code>OLD_AEGIR_DIR=/var/aegir/hostmaster-6.x-1.8
AEGIR_VERSION=6.x-1.11
AEGIR_DOMAIN=aegir.example.com
</code></pre>

<p>To upgrade your frontend, run the following commands, replacing the variables as described below:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate $AEGIR_DOMAIN $HOME/hostmaster-$AEGIR_VERSION
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Special_configurations_and_troubleshooting">3.4. Special configurations and troubleshooting</h2>

<p>If the upgrade fails, try running it again with the <code>--debug</code> flag:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate aegir.example.com $HOME/hostmaster-$AEGIR_VERSION --debug
</code></pre>

<p>If you have customized your Aegir installation and are maintaining your own makefile, you can use the <code>--makefile</code> flag so the platform is created with another makefile than the default. Be warned that this may create problems if the makefile doesn't include the right Aegir modules.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Upgrading_to_AEgir_2.x">4. Upgrading to AEgir 2.x</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_drush-1">4.1. Upgrading drush</h2>

<p>Install Drush 6.x per the directions given at the <a href="https://github.com/drush-ops/drush">Drush repository</a>.  The maintainers have deprecated the PEAR installation procedure and are encouraging everyone to install Drush via the Composer dependency management tool.</p>

<p>You should also remove your copy of <code>drush_make</code> from <code>$HOME/.drush</code>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_2.x_backend">4.2. Upgrading the 2.x backend</h2>

<p>Upgrading the backend is as simple as replacing your copy of Drush &amp; Provision with the new versions if available. Keep a copy of the old Provision and Drush in case something goes wrong in the frontend.</p>

<pre><code>drush dl --destination=/var/aegir/.drush provision-6.x-2.0
</code></pre>

<p>Drush 5+ has a commandfile cache which you need to clear before installing Aegir:</p>

<pre><code>drush cache-clear drush
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_the_2.x_frontend">4.3. Upgrading the 2.x frontend</h2>

<p>Before upgrading, we set a few key variables to make the process easier. You <strong>must</strong> replace the arguments those variables to match your configuration. This means replacing <code>$AEGIR_DOMAIN</code> by the URL of your Aegir install, <code>$AEGIR_VERSION</code> with the version number of the Aegir you are trying to install, and also <code>$OLD_AEGIR_DIR</code> with the path to the previous directory where Aegir was installed.</p>

<p>The directory passed to <code>hostmaster-migrate</code> must be an absolute path to where you want the new release to be stored.</p>

<pre><code>OLD_AEGIR_DIR=/var/aegir/hostmaster-6.x-1.11
AEGIR_VERSION=6.x-2.0
AEGIR_DOMAIN=aegir.example.com
</code></pre>

<p>To upgrade your frontend, run the following commands, replacing the variables as described below:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate $AEGIR_DOMAIN $HOME/hostmaster-$AEGIR_VERSION
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Special_configurations_and_troubleshooting-2">4.4. Special configurations and troubleshooting</h2>

<p>Read the <a href="../../../../../upgrading/path/index.html">upgrade path notes again</a>, you <em>will</em> have missed something.</p>

<p>If the upgrade fails, try running it again with the <code>--debug</code> flag:</p>

<pre><code>cd $OLD_AEGIR_DIR
drush hostmaster-migrate aegir.example.com $HOME/hostmaster-$AEGIR_VERSION --debug
</code></pre>

<p>If you have customized your Aegir installation and are maintaining your own makefile, you can use the <code>--makefile</code> flag so the platform is created with another makefile than the default. Be warned that this may create problems if the makefile doesn't include the right Aegir modules.</p>

<p>If the update fails due to a bug in module Hosting, it will ask you to run "drush hostmaster-resume help".  That command does not exist.  Try this one instead.</p>

<pre><code>drush --debug @hostmaster hostmaster-resume /var/aegir/hostmaster-6.x-1.11 /var/aegir/hostmaster-6.x-2.0
</code></pre><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-73.html?destination=node%2F429%23comment-form">Login</a> or <a href="../../../../../user/register/index-73.html?destination=node%2F429%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-73.html?destination=node%2F429%23comment-form">Login</a> or <a href="../../../../../user/register/index-73.html?destination=node%2F429%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-432" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../upgrading/debian/index.html">Automatic upgrades with Debian packages</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_23 first"><a href="../../../../../taxonomy/term/23/index.html" rel="tag" title="">Debian</a></li>
<li class="taxonomy_term_2"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
<li class="taxonomy_term_22 last"><a href="../../../../../taxonomy/term/22/index.html" rel="tag" title="">upgrade</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc1">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Regular_update_process"><span class="toc-number">1. </span>Regular update process</a></li>
	<li class="toc-level-1"><a href="#Upgrading_from_non-Debian_installs"><span class="toc-number">2. </span>Upgrading from non-Debian installs</a></li>
	<li class="toc-level-1"><a href="#Custom_distributions"><span class="toc-number">3. </span>Custom distributions</a>
<ol>
	<li class="toc-level-2"><a href="#Keeping_custom_distributions_up_to_date"><span class="toc-number">3.1. </span>Keeping custom distributions up to date</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Rolling_back_the_upgrade"><span class="toc-number">4. </span>Rolling back the upgrade</a></li>
	<li class="toc-level-1"><a href="#Recovering_a_Failed_Upgrade"><span class="toc-number">5. </span>Recovering a Failed Upgrade</a></li>
</ol>
</div>
</div>

<h2 id="Regular_update_process">1. Regular update process</h2>

<p>Make sure you have the Aegir repository in your sources.list, as per the <a href="../../../../../installing/debian/index.html#Adding_the_project_repositories">installation docs</a>.</p>

<p>If you are upgrading from a Debian installation whereby you used the koumbit.org repositories, you should change this entry in your sources.list to be debian.aegirproject.org as per the instructions linked to above, and run apt-get update to refresh.</p>

<p>If you want to upgrade all packages in one shot, use:</p>

<pre><code>apt-get update
apt-get install aegir
</code></pre>

<p>Note that you can upgrade Aegir in steps. Upgrading your backend to the Debian package should be as simple as running:</p>

<pre><code>apt-get install aegir-provision
</code></pre>

<p>Upgrading the frontend to the Debian package works identically:</p>

<pre><code>apt-get install aegir-hostmaster
</code></pre>

<p>As during install, you can use the DEBUG variable to run Drush in debugging mode:</p>

<pre><code>env DEBUG=yes apt-get install aegir-hostmaster
</code></pre>

<p><em>Note: the DEBUG flag is deprecated. In 1.x releases, it is accepted, but in 2.x it won't. You should use DPKG_DEBUG instead, it is usable starting from 1.1-4.</em></p>

<p><strong>2.x note</strong>: to upgrade to 2.x, use: <code>apt-get install aegir2</code>.</p>

<p><strong>Note on contrib modules</strong>: some Aegir-specific <a href="../../../../../contrib/index.html">contrib modules</a> may have been installed on your Aegir deployment. This may fail if you are doing a major upgrade. In this case, you will probably want to disable those contrib modules. Look for directories in <code>~aegir/.drush</code> or <code>/usr/share/drush/commands</code> or other components of the drush commandfiles search path, and move them out of the way. After the upgrade, download the new versions of the modules that are compatible with the new Aegir release.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Upgrading_from_non-Debian_installs">2. Upgrading from non-Debian installs</h2>

<p>The Debian package supports migrating from existing installs. You will need to move /var/aegir/.drush/provision out of the way before going ahead:</p>

<pre><code>tar cfz /var/aegir/backups/provision.tgz /var/aegir/.drush/provision
rm -rf /var/aegir/.drush/provision
</code></pre>

<p>You'll also need to go through steps 1 through 3 of <a href="../../../../../installing/debian/index.html#Adding_the_Koumbit_repositories">Automatic install on Debian</a>.</p>

<p>Then just install the package as if you were installing from scratch.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Custom_distributions">3. Custom distributions</h2>

<p>If you have your own makefile, you can go ahead with the above process, but change the makefile to the one you want:</p>

<pre><code>echo debconf aegir/makefile string /var/aegir/makefiles/aegir/aegir-koumbit.make | debconf-set-selections
apt-get install aegir
</code></pre>

<p>Usually no questions are asked when upgrading - this allows you to specify the makefile path for your custom distribution of Aegir, even if you're upgrading. It's also how you can switch distributions.</p>

<p>An example aegir-koumbit.make file could look like:</p>

<p><div class="codeblock"><code>core = 6.x<br />api = 2<br /><br />includes[aegir] = &quot;/usr/share/drush/commands/provision/aegir.make&quot;<br /><br />projects[] = module_filter</code></div></p>

<p>Note that for this to work, you will need the patch from <a href="http://drupal.org/node/1118616">this issue</a>, allowing drush_make to reference absolute system paths.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Keeping_custom_distributions_up_to_date">3.1. Keeping custom distributions up to date</h3>

<p>This section describes how to upgrade the code for custom distributions in between debian package upgrades. Here, we assume that Aegir is already installed through the debian package.</p>

<ol>
<li>Create a new Aegir makefile, or update the custom Aegir makefile. (You can use the makefile in drupal.org/project/provision as a starting point.)</li>
<li>Add modules/features/themes/libraries/whatever to the makefile. Ex:
<div class="codeblock"><code>&nbsp;&nbsp;&nbsp; projects[] = token<br />&nbsp;&nbsp;&nbsp; projects[] = views</code></div></li>
<li>Follow the manual upgrade path:

<ul>
<li>drush @hostmaster hostmaster-migrate URL /path/to/platform --makefile='/path/to/makefile'</li>
<li>Hope it's all green (no errors). If errors, fix makefile.</li>
<li>A new platform should exist, the new site should be in there, verifying. If the task is not running, check that hosting-queue-runner is running. If it's not, restart it using '/etc/init.d/hosting-queue-runner force-reload'. (Since hostmaster changed location, it is normal for hosting-queue-runner to crash at this point.)</li>
<li>When the debian package is upgraded, it should create a new hostmaster platform automatically. (You can test this with dpkg --configure.)</li>
</ul></li>
</ol>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Rolling_back_the_upgrade">4. Rolling back the upgrade</h2>

<p>If something went wrong with the upgrade, you can rollback by deleting the hostmaster site and redeploying on the older platform:</p>

<pre><code>drush @hostmaster provision-delete
vi ~/.drush/hostmaster.alias.drushrc.php
</code></pre>

<p>...And edit the alias to make the following changes:</p>

<pre><code>1. change the platform to point to the older platform alias
2. change the platform root path
3. change the site path
</code></pre>

<p>During the upgrade, a backup was done and you need to find which backup file it was in the backups directory. Use this backup to redeploy the older platform:</p>

<pre><code>drush @hostmaster provision-deploy ~/backups/hostmaster.date.tgz
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Recovering_a_Failed_Upgrade">5. Recovering a Failed Upgrade</h2>

<p>When using the Regular Update Process and you encounter an error it leaves the debian package in a broken state.</p>

<p>First you need to figure out why it failed.  For example is there a permission problem?<br />
Once you determined the issue correct it and clean up the environment.  It could be necessary to remove the new hostmaster platform.  It is up to you to determine what state aegir is in.</p>

<p>Next you need to fix the broken package by running the fix-broken parameter:</p>

<pre><code>apt-get install -f 
</code></pre>

<p>This tells the debian package system to start through the process again.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-311.html?destination=node%2F432%23comment-form">Login</a> or <a href="../../../../../user/register/index-311.html?destination=node%2F432%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../432/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-431" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../upgrading/script/index.html">Automatic upgrades with upgrade.sh script</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This page describes the upgrade script in the Provision repository that tries to  automate much of the upgrade process.</p>

<p><strong>NOTE:</strong> <em>At this time neither the Aegir 1.1 nor the Aegir 2.0 upgrade scripts are working for all setups.  We recommend you use the <a href="../../../../../upgrading/manual/index.html">Manual upgrades</a> instead.</em></p>

<p>It is imperative that you read the <a href="../../../../../upgrading/path/index.html">version-specific upgrade notes</a> before attempting to run the upgrade.sh script, as the script will assume you have your system set up appropriately to handle the upgrade process.</p>

<p>You can download the upgrade.sh script for Aegir 2.4 with the following command:</p>

<pre><code>wget -O upgrade.sh 'http://drupalcode.org/project/provision.git/blob_plain/refs/tags/6.x-2.4:/upgrade.sh.txt'
</code></pre>

<p>or for AEgir 3.0 with the following command:</p>

<pre><code>wget -O upgrade.sh 'http://drupalcode.org/project/provision.git/blob_plain/refs/tags/7.x-3.0:/upgrade.sh.txt'
</code></pre>

<p>Make sure you download it to somewhere that the aegir user can access in order to execute it.</p>

<p>You may need to edit the script to set any variables that are different from the defaults, for example to upgrade to a different Aegir version.</p>

<p>To do the upgrade, just run the script:</p>

<pre><code>su -s /bin/sh aegir -c "sh upgrade.sh"
</code></pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-289.html?destination=node%2F431%23comment-form">Login</a> or <a href="../../../../../user/register/index-289.html?destination=node%2F431%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../431/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-552" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../upgrading/path/index.html"> Version-specific &amp; upgrade path information</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc2">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#General_upgrade_path_recommendations"><span class="toc-number">1. </span>General upgrade path recommendations</a></li>
	<li class="toc-level-1"><a href="#Changes_in_the_2.0_release"><span class="toc-number">2. </span>Changes in the 2.0 release</a>
<ol>
	<li class="toc-level-2"><a href="#hosting-queue-runner_renamed_hosting-queued"><span class="toc-number">2.1. </span>hosting-queue-runner renamed hosting-queued</a></li>
	<li class="toc-level-2"><a href="#queue_daemon_enabled_by_default"><span class="toc-number">2.2. </span>queue daemon enabled by default</a></li>
	<li class="toc-level-2"><a href="#hosting_platform_pathauto_module_bundled_with_Aegir"><span class="toc-number">2.3. </span>hosting_platform_pathauto module bundled with Aegir</a></li>
	<li class="toc-level-2"><a href="#hosting-task_--force"><span class="toc-number">2.4. </span>hosting-task --force</a></li>
	<li class="toc-level-2"><a href="#Deprecated_functions_removed"><span class="toc-number">2.5. </span>Deprecated functions removed</a></li>
	<li class="toc-level-2"><a href="#New_Provision_class_naming_convention"><span class="toc-number">2.6. </span>New Provision class naming convention</a></li>
	<li class="toc-level-2"><a href="#Client_node_type_changes"><span class="toc-number">2.7. </span>Client node type changes</a></li>
	<li class="toc-level-2"><a href="#SSL_and_IP_allocation_refactoring_changes"><span class="toc-number">2.8. </span>SSL and IP allocation refactoring changes</a>
<ol>
	<li class="toc-level-3"><a href="#Backend"><span class="toc-number">2.8.1. </span>Backend</a></li>
	<li class="toc-level-3"><a href="#Frontend"><span class="toc-number">2.8.2. </span>Frontend</a></li>
</ol>
</li>
	<li class="toc-level-2"><a href="#Debian_package_name_changed"><span class="toc-number">2.9. </span>Debian package name changed</a></li>
	<li class="toc-level-2"><a href="#Platform_drushrc.php_moved"><span class="toc-number">2.10. </span>Platform drushrc.php moved</a></li>
	<li class="toc-level-2"><a href="#Class_auto-loading"><span class="toc-number">2.11. </span>Class auto-loading</a></li>
	<li class="toc-level-2"><a href="#Other_database_changes"><span class="toc-number">2.12. </span>Other database changes</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Changes_in_the_1.0_release"><span class="toc-number">3. </span>Changes in the 1.0 release</a>
<ol>
	<li class="toc-level-2"><a href="#Git_dependency"><span class="toc-number">3.1. </span>Git dependency</a></li>
	<li class="toc-level-2"><a href="#DNS_Configuration"><span class="toc-number">3.2. </span>DNS Configuration</a></li>
	<li class="toc-level-2"><a href="#Unzip_dependency"><span class="toc-number">3.3. </span>Unzip dependency</a></li>
	<li class="toc-level-2"><a href="#Database_configuration"><span class="toc-number">3.4. </span>Database configuration</a></li>
	<li class="toc-level-2"><a href="#Apache_configuration"><span class="toc-number">3.5. </span>Apache configuration</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="General_upgrade_path_recommendations">1. General upgrade path recommendations</h1>

<p>In general, you shouldn't skip major releases. That is, if you are running 0.3, you should upgrade to 1.0 or 1.1, not 2.0. Upgrades within a stable branch (1.0 to 1.1, 2.0 to 2.1) are fully supported, and you can skip minor versions (1.0 to 1.2 should work fine), but you should always upgrade to the latest stable release if you are coming from a different release branch.</p>

<p>The rest of this page documents what version-specific changes happened that you need to make manual modifications to. If you are running the Debian packages, you probably don't need to configure anything here.</p>

<p>The <a href="../../../../../upgrading/index.html">upgrade process</a> should make this clear, but keep in mind that you need to upgrade the backend (drush, provision) before the frontend (drupal, hostmaster profile, etc).</p>

<p>Provision/Drush <strong>contrib</strong> modules might require additional attention. As there is no version checking, the safest method is probably to move the module out of your .drush folder and later add the version compatible with the new Aegir version.</p>

<p>Hosting/Drupal <strong>contrib</strong> modules should also be handled carefully. If these were installed into the hostmaster site's directory, then they should be moved automatically to the new hostmaster platform during the upgrade. On the other hand, if they were installed on the platform, you'll need to provide the hostmaster-migrate or Debian package with a custom makefile. The default makefile in Provision (aegir.make) can be used as a model for this.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Changes_in_the_2.0_release">2. Changes in the 2.0 release</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="hosting-queue-runner_renamed_hosting-queued">2.1. hosting-queue-runner renamed hosting-queued</h2>

<p>The popular module <code>hosting-queue-runner</code> has been merged in the 2.0 release. In the process, it has been renamed to the more appropriate <code>hosting-queued</code>. The init script is also now installed directly with the Debian package, and started on install or upgrade.</p>

<p>You will, however, need to manually enable to module for the daemon to work (still):</p>

<pre><code>drush @hostmaster en hosting_queued
</code></pre>

<p>Also, if you are migrating from an install using <code>hosting-queue-runner</code>, you will need to remove the old module and startup script. Enabling <code>hosting-queued</code> will already have disabled and uninstalled the module from Drupal, but you need to cleanup your filesystem:</p>

<pre><code>rm /etc/init.d/hosting-queue-runner
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="queue_daemon_enabled_by_default">2.2. queue daemon enabled by default</h2>

<p>The above queue daemon is now enabled by default by the Debian package, and is properly restarted on upgrades. It can be disabled after install if necessary using the following comamnds:</p>

<pre><code>service hosting-queued stop
su aegir -c "drush @hostmaster pm-disable hosting_queued"
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="hosting_platform_pathauto_module_bundled_with_Aegir">2.3. hosting_platform_pathauto module bundled with Aegir</h2>

<p>The popular module <code>hosting_platform_pathauto</code> has been bundled in the 2.0 release. 
If you installed it module manually then now is probably the time to remove your copy.
Aegir 2.0-alpha1 comes bundled with hosting_platform_pathauto-2.0-beta1.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="hosting-task_--force">2.4. hosting-task --force</h2>

<p>You used to be able to run <code>hosting-task &lt;nid&gt;</code> to re-run a task by its node ID. Because hosting-task now checks if the task is really queued, this can't be used to retry existing tasks directly, unless you use the <code>--force</code> argument. So this:</p>

<p><div class="codeblock"><code>drush @hostmaster hosting-task 1234</code></div></p>

<p>becomes:</p>

<p><div class="codeblock"><code>drush @hostmaster hosting-task --force 1234</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Deprecated_functions_removed">2.5. Deprecated functions removed</h2>

<p>If you are using any of those functions in your custom code, lookup in the 1.x documentation to see the replacement functions, as they have been removed from 2.x:</p>

<ul>
<li>hosting_alias_count_sites() (same as !hosting_alias_allow_domain())</li>
<li>hosting_site_exists() (same as !hosting_alias_allow_domain())</li>
<li>hosting_get_client_by_email() (use hosting_get_client() instead)</li>
<li>hosting_import_client() dropped the second argument (organization)</li>
<li>hosting_task_list_embedded() (use hosting_task_list() or hosting_task_list_table())</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="New_Provision_class_naming_convention">2.6. New Provision class naming convention</h2>

<p>Provision classes used to start with provisionConfig_ or provisionService_, but these are now Provision_Config_ and Provision_Service_ respectively.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Client_node_type_changes">2.7. Client node type changes</h2>

<ul>
<li>the email field was removed from the client, now you need a user associated with the client. this was already the case in 1.x but the existing field wasn't touched.</li>
<li>the client_email field was removed from the site object</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="SSL_and_IP_allocation_refactoring_changes">2.8. SSL and IP allocation refactoring changes</h2>

<p>The <a href="https://drupal.org/node/1126640">SSL IP allocation refactoring</a> has changed a good few things in the API and the way SSL certificates are managed.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Backend">2.8.1. Backend</h3>

<p>The following functions are gone from the backend:</p>

<ul>
<li><a href="http://api.aegirproject.org/api/Provision/http--http.ssl.inc/function/provisionService_http_ssl%3A%3Aassign_certificate_ip/6.x-1.x">provisionService_http_ssl::assign_certificate_ip</a></li>
<li><a href="http://api.aegirproject.org/api/Provision/http--http.ssl.inc/function/provisionService_http_ssl%3A%3Aget_ip_certificate/6.x-1.x">Provision_Service_http_ssl::get_ip_certificate</a> .</li>
<li><a href="http://api.aegirproject.org/api/Provision/http--http.ssl.inc/function/provisionService_http_ssl%3A%3Afree_certificate_ip/6.x-1.x">Provision_Service_http_ssl::free_certificate_ip</a></li>
<li>Provision_Service_http_ssl::clear_certs()</li>
</ul>

<p>Certificates are not tracked from the backend anymore, other than to make sure that we delete a certificate when it's not used anymore. So we still use *.receipt files, but just to mark a site to SSL certificate association, not the IP allocation. The SSL directory in <code>~/config/server_foo/ssl.d/uri/</code> is removed when no site use that directory anymore.</p>

<p>The backend now expects the frontend to send an <code>ip_address</code> field and stopped sending a <code>site_ip_addresses</code> to the frontend.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Frontend">2.8.2. Frontend</h3>

<p>The <code>hosting_ip_addresses</code> table changes. A unique key has been added and it is now only for servers. It is used by the new hosting_ssl_cert_ips table to map those server IP addresses to certificates.</p>

<p>A new field for the IP (ip_address) is sent from the frontend during site install/verify tasks. The field is not present in non-ssl sites. It is the non-resolved IP address of the server assigned to the SSL certificate and must be used by the backend to write the vhost.</p>

<p>SSL certificates are removed from the frontend when sites using it are deleted.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Debian_package_name_changed">2.9. Debian package name changed</h2>

<p>To allow both packages to coexist in the same Debian archive, the name of the packages of the 2.x series have changed.</p>

<ul>
<li><code>aegir -&gt; aegir2</code></li>
<li><code>aegir-provision -&gt; aegir2-provision</code></li>
<li><code>aegir-hostmaster -&gt; aegir2-hostmaster</code></li>
<li><code>aegir-cluster-slave -&gt; aegir2-cluster-slave</code></li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Platform_drushrc.php_moved">2.10. Platform drushrc.php moved</h2>

<p>From Drush 5 documentation:</p>

<pre><code>Drush 5 no longer looks for aliases, configs or command files in the Drupal
root folder, so if you previously used drushrc.php files in the Drupal root
you will need to move the file to sites/all/drush/drushrc.php.
</code></pre>

<p>Since Aegir 2 requires Drush 5 (or later), Provision now follows this standard, and places a platform's drushrc.php in sites/all/drush/drushrc.php.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Class_auto-loading">2.11. Class auto-loading</h2>

<p>Provision has been refactored to use class autoloading. This simplifies use of classes, as it obviates the need to explicitly include the files in which the class and it's parent classes are defined. In addition, it standardizes the placement of class definitions within a hierarchical file-system structure and will make name-spacing simpler if/when we begin to adopt Symfony components.</p>

<p>More info in the manual under <a href='../../../../../content/contrib/class-auto-loading/index.html'>Extending Aegir - Class auto-loading</a></p>

<p>This may also affect certain contrib extensions that used to have to reside in the provision directory itself. These extensions should probably be removed prior to the upgrade, and re-installed afterwards with an Aegir2-compatible version.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Other_database_changes">2.12. Other database changes</h2>

<p>The <code>release_id</code> column was dropped. This column wasn't used anywhere in the code and was present only in some installs, see <a href="https://drupal.org/node/1882708">issue #1882708</a> for details.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Changes_in_the_1.0_release">3. Changes in the 1.0 release</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Git_dependency">3.1. Git dependency</h2>

<p>If you intend on upgrading your system to the bleeding edge version of the code from our git repositories, you will need the git program installed.  On Debian, this means:</p>

<pre><code>apt-get install git-core
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="DNS_Configuration">3.2. DNS Configuration</h2>

<p>Aegir requires that the hostname returned by the <code>hostname</code> and <code>uname -n</code>
shell commands, resolves to the IP address for this server.</p>

<p>Shell commands as root:</p>

<pre><code>AEGIR_HOST=`uname -n`
resolveip $AEGIR_HOST
</code></pre>

<p>If the command returns your IP address, you are all set. If it returns
an error you will need to edit your <code>/etc/hosts</code> file.</p>

<p>(Mac OSX  notes: if you are running on OS X you will not likely have a resolveip  binary.  Just substitute 
  <code>ping $AEGIR_HOST</code>
).</p>

<p>First line of this file looks like:</p>

<p>127.0.0.1  localhost</p>

<p>Simply add all domains you want to this line. e.g:</p>

<p>127.0.0.1  localhost $AEGIR_HOST $AEGIR_DOMAIN other1 other2</p>

<p>To be clear you cannot put $AEGIR_HOST $AEGIR_DOMAIN  in your  hosts file.  Put in whatever  uname -n  returns  for $AEGIR_HOST and what ever  domain you want to use  f or  $AEGIR_DOMAIN  (real  domain or faked in hosts file).   In OS X     uname -n will return whatever you put in  System  Preferences -&gt; Sharing -&gt; Computer Name.  I added that value  (iMac 27  for me) to /etc/hosts and my faked aegir  domain  as follows:</p>

<p><code>127.0.0.1&nbsp; localhost&nbsp; iMac27&nbsp; aegir.local </code></p>

<p>If you only intend to use Aegir on a single server, it is acceptable for
the resolved IP address to be the '127.0.0.1' loopback address.</p>

<p>If you intend to manage multiple servers using Aegir, you will need to
make sure that the IP address is the public IP of this server.</p>

<p>Finally, set an $AEGIR_IP environment variable for use in the Database
configuration step below.</p>

<p>Shell commands as root::
    AEGIR_IP=<code>resolveip $AEGIR_HOST | awk {'print $6'}</code></p>

<p>(If running  OS X  or are otherwise missing  resolveip   and you just want to use Aegir on your computer use  you can do this:
AEGIR_IP=127.0.0.1</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Unzip_dependency">3.3. Unzip dependency</h2>

<p>As of the 0.4-alpha3 release, 'unzip' is a required dependency on your server
in order to successfully extract the jquery.ui library that is part of some UI
improvements. On Debian, this means:</p>

<p>Shell commands::</p>

<p>apt-get install unzip</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Database_configuration">3.4. Database configuration</h2>

<p>To make sure that the Aegir backend, and all the possible web servers can
reach your database server, you need to configure mysql to listen on all
the public IP addresses available to it.</p>

<p>/etc/mysql/my.cnf configuration line to comment out::
    bind-address    = 127.0.0.1</p>

<p>Now you need to restart mysql, to clear any caches.</p>

<p>Shell command as root::
    /etc/init.d/mysql restart</p>

<p>Because you have already installed Aegir when it was using the generic grants,
you will need to create new grants using the public IP address and hostname
of this server.</p>

<p>Shell command ::
    mysql -uroot -p mysql</p>

<p>You need to generate the following grants using the hostname returned by the
<code>uname -n</code> command, and the IP address that the <code>resolveip</code> command returns
for that hostname.</p>

<p>You need to re-use the pasword you had for the account before.</p>

<p>Shell commands::</p>

<pre><code>mysql -u root -p -e "GRANT ALL ON *.* to 'aegir_root'@'$AEGIR_HOST' IDENTIFIED BY 'xxxx' WITH GRANT OPTION;"
mysql -u root -p -e "GRANT ALL ON *.* to 'aegir_root'@'$AEGIR_IP' IDENTIFIED BY 'xxxx' WITH GRANT OPTION;"
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Apache_configuration">3.5. Apache configuration</h2>

<p>This release introduces multi-server support and required reorganizing
the Apache configuration files in ~aegir/config. Instead of having all
files in config/vhost.d, they are now split between vhost.d, platform.d
and a single apache.conf. The vhost.d directory is for virtual hosts,
platform.d is for platform-specific configuration and apache.conf is the
server-wide configuration file.</p>

<p>You will need to change the line you added to either the httpd.conf file 
or /etc/apache2/conf.d/aegir file during installation.</p>

<p>Open your httpd.conf file and modify::</p>

<pre><code>Include /var/aegir/config/vhost.d
</code></pre>

<p>To read ::</p>

<pre><code>Include /var/aegir/config/apache.conf
</code></pre>

<p>If you are upgrading from 0.4 releases between alpha8 and (including) alpha14,
you will need to rename your conf.d directory to post.d in Apache and pre.d in
Nginx. Example, in Apache::</p>

<p>mv /var/aegir/config/server_master/apache/{conf.d,post.d}</p>

<p>Now log into Aegir, and verify the hostmaster platform. This will generate
the correct apache.conf file and restart Apache.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-312.html?destination=node%2F552%23comment-form">Login</a> or <a href="../../../../../user/register/index-312.html?destination=node%2F552%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../552/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>



    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/10/revisions/218/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:07:19 GMT -->
</html>
