<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/266/revisions/607/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:45:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="canonical" href="index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Infinite Recursion on Site Import from Fri, 01/21/2011 - 15:26 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-266" class="node node-discussion clear-block node-page">
      <div class='node-submitted clear-block'>
      <div class="picture">
  <a href="../../../../../user/65/index.html" title="View user profile."><img src="../../../../../sites/community.aegirproject.org/files/imagecache/user-s/pictures/picture-65/index.jpg" alt="Josh Benner&#039;s picture" title="View user profile." width="30" height="30" class="imagecache imagecache-user-s"/></a></div>
      <div class='byline'><a href="../../../../../user/65/index.html" class="username" title="View user profile.">Josh Benner</a></div><div class='date'>3:26pm Jan 21, 2011</div>    </div>
  
      <h2 class='node-title'>
            <a href="../../../index.html">Infinite Recursion on Site Import</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class="field field-type-nodereference field-field-referenced-book-page">
    <div class="field-items">
            <div class="field-item odd">
                      <div class="field-label-inline-first">
              Referenced Page:&nbsp;</div>
                    <a href="../../../../../content/importing-existing-aegir-backups/index.html">Importing from existing Aegir backups</a>        </div>
        </div>
</div>
<p>We have a shared dev server running Aegir 0.4-beta2, works quite well. Locally, I have Aegir HEAD (from 1/14). I build a script that creates a backup on the remote system, retrieves the backup archive, then follows the instructions found <a href="../../../../117/index.html">here</a> to import the site into my local environment.</p>

<p>This all works great. After the provision-deploy, I run a verify via the frontend on the platform onto which the site was deployed. Aegir sees the new site and queues up an import task. Upon running the import task, it fails due to what appears to be infinite recursion on every site I try to import using this method.</p>

<p>I suspect infinite recursion due to the errors I get. When I have xdebug enabled with a nesting level of 1,000 (or any value I enter), it hits the limit and Xdebug kills it. When I have Xdebug disabled, I get a segfault.</p>

<p>The recursion appears to happen during provision-save. The data visible in the frontend from the failed command is pasted below. You'll see that provisionContext-&gt;service() is calling itself with infinite recursion. I do not understand what is occurring in this code enough to try to figure out what's happening.</p>

<p>I can run the provision-save command that the import task log claims to attempt at the command line without problems.</p>

<p>Any ideas? Is this the right place to submit issues like this?</p>

<p>Thanks!</p>

<p>Import task log:</p>

<p><div class="codeblock"><code>Task starts processing<br />Running: /usr/bin/php /usr/share/php/drush-3.3/drush.php --php=/usr/bin/php --uri=&#039;example.dev&#039; provision-save &#039;@example.dev&#039; --backend<br />The external command could not be executed due to an application error.<br />Drush bootstrap phase : _drush_bootstrap_drush()<br />Found command: provision-save (commandfile=provision)<br />Initializing drush commandfile: drush_make<br />Initializing drush commandfile: drush_make_d_o<br />Initializing drush commandfile: provision<br />Load alias @self<br />Load alias @<br />Load alias @platform_Basiclegacy<br />Load alias @server_master<br />Loading mysql driver for the db service<br />Loading apache driver for the http service<br />Drush command could not be completed.<br />Output from failed command : Fatal error: Maximum function nesting level of &#039;1000&#039; reached, aborting! in /var/aegir/.drush/provision/provision.context.inc on line 23 Call Stack: 0.0006 184112 1. {main}() /usr/share/php/drush-3.3/drush.php:0 0.0151 2607624 2. drush_main() /usr/share/php/drush-3.3/drush.php:40 0.1364 10592600 3. drush_dispatch() /usr/share/php/drush-3.3/drush.php:90 0.1365 10596592 4. call_user_func_array() /usr/share/php/drush-3.3/includes/drush.inc:51 0.1365 10597368 5. drush_command() /usr/share/php/drush-3.3/includes/drush.inc:0 0.1371 10604920 6. call_user_func_array() /usr/share/php/drush-3.3/includes/command.inc:376 0.1371 10605704 7. provision_drush_init() /usr/share/php/drush-3.3/includes/command.inc:0 0.1371 10605904 8. d() /var/aegir/.drush/provision/provision.drush.inc:60 0.1390 10611768 9. provisionContext-&gt;method_invoke() /var/aegir/.drush/provision/provision.context.inc:44 0.1390 10612656 10. provision::method_invoke() /var/aegir/.drush/provision/provision.context.inc:205 0.1391 10613656 11. call_user_func_array() /var/aegir/.drush/provision/provision.inc:414 0.1391 10614416 12. provisionContext-&gt;init() /var/aegir/.drush/provision/provision.inc:0 0.1396 10620776 13. call_user_func() /var/aegir/.drush/provision/provision.context.inc:274 0.1396 10621304 14. provisionService_db::subscribe_site() /var/aegir/.drush/provision/provision.context.inc:0 0.1400 10622464 15. provisionContext-&gt;__get() /var/aegir/.drush/provision/provision.context.inc:0 0.1400 10622592 16. d() /var/aegir/.drush/provision/provision.context.inc:140 0.1435 10673176 17. provisionContext-&gt;method_invoke() /var/aegir/.drush/provision/provision.context.inc:44 0.1444 10677744 18. provisionContext-&gt;services_invoke() /var/aegir/.drush/provision/provision.context.inc:209 0.1551 10741904 19. provisionContext-&gt;service() /var/aegir/.drush/provision/provision.context.inc:359 0.1551 10742360 20. provisionContext-&gt;service() /var/aegir/.drush/provision/provision.context.inc:335 0.1551 10743584 21. provisionContext-&gt;service() /var/aegir/.drush/provision/provision.context.inc:335 0.1551 10744040 22. provisionContext-&gt;service() /var/aegir/.drush/provision/provision.context.inc:335 0.1551 10744496 23. provisionContext-&gt;service() /var/aegir/.drush/provision/provision.context.inc:335 0.1552 10744992 24. provisionContext-&gt;service() /var/aegir/.drush/provision/provision.context.inc:335<br />&lt;MANY REPEAT LINES REMOVED FOR SANITY&#039;S SAKE&gt;<br />0.1552 10745448 25. provisionContext-&gt;service() /var/aegir/.drush/provision/provision.context.inc:335 0.1715 11539640 999. d() /var/aegir/.drush/provision/provision.context.inc:335<br />Running: /usr/bin/php /usr/share/php/drush-3.3/drush.php --php=/usr/bin/php @example.dev provision-import --backend<br />Drush bootstrap phase : _drush_bootstrap_drush()<br />Load alias @example.dev<br />Loading drushrc &quot;/var/aegir/platforms/basic/sites/example.dev/drushrc.php&quot; into &quot;site&quot; scope.<br />Drush bootstrap phase : _drush_bootstrap_drupal_root()<br />Loading drushrc &quot;/var/aegir/platforms/basic/drushrc.php&quot; into &quot;drupal&quot; scope.<br />Initialized Drupal 6.20 root directory at /var/aegir/platforms/basic<br />Found command: provision-import (commandfile=provision)<br />Initializing drush commandfile: drush_make<br />Initializing drush commandfile: drush_make_d_o<br />Initializing drush commandfile: provision<br />Load alias @server_master<br />Loading mysql driver for the db service<br />Loading apache driver for the http service<br />Load alias @platform_Basiclegacy<br />Including /var/aegir/.drush/provision/platform/import.provision.inc<br />Drush bootstrap phase : _drush_bootstrap_drupal_site()<br />Initialized Drupal site example.dev at sites/example.dev<br />Loading drushrc &quot;/var/aegir/platforms/basic/sites/example.dev/drushrc.php&quot; into &quot;site&quot; scope.<br />Drush bootstrap phase : _drush_bootstrap_drupal_configuration()<br />Drush bootstrap phase : _drush_bootstrap_drupal_database()<br />Successfully connected to the Drupal database.<br />Drush bootstrap phase : _drush_bootstrap_drupal_full()<br />Template loaded: /var/aegir/.drush/provision/provision_drushrc_alias.tpl.php<br />Changed permissions of /var/aegir/.drush/example.dev.alias.drushrc.php to 600<br />Generated config Drush configuration file<br />Changed permissions of /var/aegir/.drush/example.dev.alias.drushrc.php to 400<br />Template loaded: /var/aegir/.drush/provision/provision_drushrc_site.tpl.php<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/drushrc.php to 600<br />Generated config Site Drush configuration file<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/drushrc.php to 400<br />Running: /usr/bin/php /usr/share/php/drush-3.3/drush.php --php=/usr/bin/php @example.dev provision-verify --backend<br />Drush bootstrap phase : _drush_bootstrap_drush()<br />Load alias @example.dev<br />Loading drushrc &quot;/var/aegir/platforms/basic/sites/example.dev/drushrc.php&quot; into &quot;site&quot; scope.<br />Found command: provision-verify (commandfile=provision)<br />Initializing drush commandfile: drush_make<br />Initializing drush commandfile: drush_make_d_o<br />Initializing drush commandfile: provision<br />Load alias @server_master<br />Loading mysql driver for the db service<br />Loading apache driver for the http service<br />Load alias @platform_Basiclegacy<br />Including /var/aegir/.drush/provision/dns/verify.provision.inc<br />Including /var/aegir/.drush/provision/platform/backupmigrate/verify.provision.inc<br />Including /var/aegir/.drush/provision/platform/verify.provision.inc<br />Drush bootstrap phase : _drush_bootstrap_drupal_root()<br />Loading drushrc &quot;/var/aegir/platforms/basic/drushrc.php&quot; into &quot;drupal&quot; scope.<br />Initialized Drupal 6.20 root directory at /var/aegir/platforms/basic<br />Drush bootstrap phase : _drush_bootstrap_drupal_site()<br />Initialized Drupal site example.dev at sites/example.dev<br />Loading drushrc &quot;/var/aegir/platforms/basic/sites/example.dev/drushrc.php&quot; into &quot;site&quot; scope.<br />Template loaded: /var/aegir/.drush/provision/platform/provision_drupal_settings.tpl.php<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/settings.php to 640<br />Generated config Drupal settings.php file<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/settings.php to 440<br />Change group ownership of /var/aegir/platforms/basic/sites/example.dev/settings.php to www-data<br />Drush bootstrap phase : _drush_bootstrap_drupal_configuration()<br />Drush bootstrap phase : _drush_bootstrap_drupal_database()<br />Successfully connected to the Drupal database.<br />Drush bootstrap phase : _drush_bootstrap_drupal_full()<br />Found install profile default<br />Found install profile message_agency_basic<br />Found 142 modules<br />Found 10 themes<br />Changed permissions of sites/example.dev to 755<br />Changed permissions of sites/example.dev/themes to 2775<br />Changed permissions of sites/example.dev/modules to 2775<br />Changed permissions of sites/example.dev/libraries to 2775<br />Changed permissions of sites/example.dev/files to 2770<br />Changed permissions of sites/example.dev/files/tmp to 2770<br />Changed permissions of sites/example.dev/files/images to 2770<br />Changed permissions of sites/example.dev/files/pictures to 2770<br />Changed permissions of sites/example.dev/private to 2770<br />Changed permissions of sites/example.dev/private/files to 2770<br />Changed permissions of sites/example.dev/private/temp to 2770<br />Changed group ownership of sites/example.dev/files to www-data<br />Changed group ownership of sites/example.dev/files/tmp to www-data<br />Changed group ownership of sites/example.dev/files/images to www-data<br />Changed group ownership of sites/example.dev/files/pictures to www-data<br />Changed group ownership of sites/example.dev/private to www-data<br />Changed group ownership of sites/example.dev/private/files to www-data<br />Changed group ownership of sites/example.dev/private/temp to www-data<br />Removed symlink for alias /var/aegir/platforms/basic/sites/comhar.messageagency.com<br />Created symlink for alias /var/aegir/platforms/basic/sites/comhar.messageagency.com<br />Template loaded: /var/aegir/.drush/provision/platform/provision_drupal_settings.tpl.php<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/settings.php to 640<br />Generated config Drupal settings.php file<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/settings.php to 440<br />Change group ownership of /var/aegir/platforms/basic/sites/example.dev/settings.php to www-data<br />Template loaded: /var/aegir/.drush/provision/http/apache/vhost.tpl.php<br />Generated config virtual host configuration file<br />apache on phobos has been restarted<br />Cleared all caches<br />Rebuild node type cache<br />Rebuild module cache<br />Rebuild theme cache<br />Rebuild node access cache<br />Rebuild menu cache<br />Content permissions have been rebuilt.<br />Template loaded: /var/aegir/.drush/provision/provision_drushrc_site.tpl.php<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/drushrc.php to 600<br />Generated config Site Drush configuration file<br />Changed permissions of /var/aegir/platforms/basic/sites/example.dev/drushrc.php to 400<br />Command dispatch complete<br />Peak memory usage was 116.01 MB<br />Reloading site drushrc.php from sites/example.dev/drushrc.php<br />Command dispatch complete<br />Peak memory usage was 68.62 MB<br />Output from failed command :<br />An error occurred at function : drush_hosting_task<br />Command dispatch complete<br />Peak memory usage was 31.92 MB</code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-307.html?destination=node%2F266%23comment-form">Login</a> or <a href="../../../../../user/register/index-307.html?destination=node%2F266%23comment-form">register</a> to post comments</span></li>
<li class="print last active"><a href="index-2.html?print" class="active">Print</a></li>
</ul></div>
  </div>


    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/266/revisions/607/view?print by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:45:30 GMT -->
</html>
