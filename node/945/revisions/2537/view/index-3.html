<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from community.aegirproject.org/node/945/revisions/2537/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:03:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="../../../../../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="prev" href="../../../../../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="prev" href="../../../../../installing/ubuntu-1004-specific-how-downgrade-php-52-install/index.html" />
<link rel="up" href="../../../../../administrator/index.html" />
<link rel="next" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="canonical" href="index.html" />
<link rel="prev" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../content/importing-existing-aegir-backups/index.html" />
<link rel="prev" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="up" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../../../../../content/importing-single-site-manually/index.html" />
<link rel="prev" href="../../../../../content/importing-existing-aegir-backups/index.html" />
<link rel="up" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../../../../../content/importing-complete-drupal-platform/index.html" />
<link rel="prev" href="../../../../../content/importing-single-site-manually/index.html" />
<link rel="up" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../../../../517/index.html" />
<link rel="prev" href="../../../../../content/importing-complete-drupal-platform/index.html" />
<link rel="up" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../../../../426/index.html" />
<link rel="prev" href="../../../../517/index.html" />
<link rel="up" href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html" />
<link rel="next" href="../../../../30/index.html" />
<link rel="prev" href="../../../../426/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../396/index.html" />
<link rel="prev" href="../../../../30/index.html" />
<link rel="up" href="../../../../30/index.html" />
<link rel="next" href="../../../../446/index.html" />
<link rel="prev" href="../../../../396/index.html" />
<link rel="up" href="../../../../30/index.html" />
<link rel="next" href="../../../../../content/web-clusters/index.html" />
<link rel="prev" href="../../../../446/index.html" />
<link rel="up" href="../../../../30/index.html" />
<link rel="next" href="../../../../388/index.html" />
<link rel="prev" href="../../../../../content/web-clusters/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../427/index.html" />
<link rel="prev" href="../../../../388/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../341/index.html" />
<link rel="prev" href="../../../../427/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../content/content/administrator/post-install-configuration/using-ssl/index.html" />
<link rel="prev" href="../../../../341/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../administrator/dns/index.html" />
<link rel="prev" href="../../../../../content/content/administrator/post-install-configuration/using-ssl/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../dnswildcard/index.html" />
<link rel="prev" href="../../../../../administrator/dns/index.html" />
<link rel="up" href="../../../../../administrator/dns/index.html" />
<link rel="next" href="../../../../39/index.html" />
<link rel="prev" href="../../../../../dnswildcard/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../73/index.html" />
<link rel="prev" href="../../../../39/index.html" />
<link rel="up" href="../../../../39/index.html" />
<link rel="next" href="../../../../72/index.html" />
<link rel="prev" href="../../../../73/index.html" />
<link rel="up" href="../../../../39/index.html" />
<link rel="next" href="../../../../70/index.html" />
<link rel="prev" href="../../../../72/index.html" />
<link rel="up" href="../../../../39/index.html" />
<link rel="next" href="../../../../../content/overriding-site-specific-php-values/index.html" />
<link rel="prev" href="../../../../70/index.html" />
<link rel="up" href="../../../../70/index.html" />
<link rel="next" href="../../../../71/index.html" />
<link rel="prev" href="../../../../../content/overriding-site-specific-php-values/index.html" />
<link rel="up" href="../../../../39/index.html" />
<link rel="next" href="../../../../../content/injecting-drushrcphp/index.html" />
<link rel="prev" href="../../../../71/index.html" />
<link rel="up" href="../../../../39/index.html" />
<link rel="next" href="../../../../../contrib-modules/index.html" />
<link rel="prev" href="../../../../../content/injecting-drushrcphp/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../contrib-modules/aegir-services/index.html" />
<link rel="prev" href="../../../../../contrib-modules/index.html" />
<link rel="up" href="../../../../../contrib-modules/index.html" />
<link rel="next" href="../../../../../content/contrib-modules/contribs-aegir-7x-3x/index.html" />
<link rel="prev" href="../../../../../contrib-modules/aegir-services/index.html" />
<link rel="up" href="../../../../../contrib-modules/index.html" />
<link rel="next" href="../../../../../content/contrib-modules/devshop-provision/index.html" />
<link rel="prev" href="../../../../../content/contrib-modules/contribs-aegir-7x-3x/index.html" />
<link rel="up" href="../../../../../contrib-modules/index.html" />
<link rel="next" href="../../../../../content/content/contrib-modules/devshop-provision/commands/index.html" />
<link rel="prev" href="../../../../../content/contrib-modules/devshop-provision/index.html" />
<link rel="up" href="../../../../../content/contrib-modules/devshop-provision/index.html" />
<link rel="next" href="../../../../../content/contrib-modules/provision-acl/index.html" />
<link rel="prev" href="../../../../../content/content/contrib-modules/devshop-provision/commands/index.html" />
<link rel="up" href="../../../../../contrib-modules/index.html" />
<link rel="next" href="../../../../516/index.html" />
<link rel="prev" href="../../../../../content/contrib-modules/provision-acl/index.html" />
<link rel="up" href="../../../../../contrib-modules/index.html" />
<link rel="next" href="../../../../../contrib-modules/provision-civicrm/index.html" />
<link rel="prev" href="../../../../516/index.html" />
<link rel="up" href="../../../../../contrib-modules/index.html" />
<link rel="next" href="../../../../../content/content/administrator/post-install-configuration/create-sudo-user-server-administration/index.html" />
<link rel="prev" href="../../../../../contrib-modules/provision-civicrm/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../content/content/administrator/post-install-configuration/experimental-aegir-2-ubuntu-1204-apache-php/index.html" />
<link rel="prev" href="../../../../../content/content/administrator/post-install-configuration/create-sudo-user-server-administration/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html" />
<link rel="prev" href="../../../../../content/content/administrator/post-install-configuration/experimental-aegir-2-ubuntu-1204-apache-php/index.html" />
<link rel="up" href="../../../../../content/administrator/post-install-configuration/index.html" />
<link rel="next" href="../../../../../upgrading/index.html" />
<link rel="shortcut icon" href="../../../../../sites/community.aegirproject.org/themes/up/favicon/index.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="print" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />
<link type="text/css" rel="stylesheet" media="all" href="../../../../../sites/community.aegirproject.org/files/css/css_5fa73dc3677977c016a597acd186e4e7/index.css" />

  <title>Revision of Aegir is installed, now what? from Tue, 11/08/2011 - 21:53 | community.aegirproject.org</title>
</head>

<body  class="print rubik admin-static page">
  <div class='limiter clear-block'>
    <div id='content' class='clear-block'>
      <div class='print-header'>
      <h1 class='site-name'>community.aegirproject.org</h1>
  </div>
      

<div  id="node-945" class="node node-book clear-block node-page">
  
      <h2 class='node-title'>
            <a href="../../../../../content/administrator/post-install-configuration/index.html">Aegir is installed, now what?</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div id='diff-inline-945'><div class='diff-inline-metadata clear-block'><div class='diff-inline-byline'>Updated by <a href="../../../../../users/anarcat/index.html" class="username" title="View user profile.">anarcat</a> on 11/08/2011 - 21:53</div><div class='diff-inline-legend clear-block'><label>Legend</label><span class='diff-added'>Added</span><span class='diff-changed'>Changed</span><span class='diff-deleted'>Deleted</span></div></div><p>Alright, so you have installed <span class='diff-changed'>Aegir,</span> what else is there?</p>

<p>You have a lot of things you can do now:</p>

<ul>
<li><a href="../../../../19/index.html">Get to know the interface</a></li>
<li><a href="../../../../256/index.html">Use drush make</a></li>
<li><a href="../../../../427/index.html">Work as the Aegir user</a></li>
<li><a href="../../../../../debugging/index.html">Debugging Aegir</a></li>
<li>Setup <a href="http://drupal.org/project/hosting_queue_runner">the hosting queue runner</a> for lower waiting times</li>
</ul></div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-52.html?destination=node%2F945%23comment-form">Login</a> or <a href="../../../../../user/register/index-52.html?destination=node%2F945%23comment-form">register</a> to post comments</span></li>
<li class="print active"><a href="index-2.html?print" class="active">Print</a></li>
<li class="print_recurse active"><a href="index-3.html?print&amp;book_recurse" class="active">Print entire section</a></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-52.html?destination=node%2F945%23comment-form">Login</a> or <a href="../../../../../user/register/index-52.html?destination=node%2F945%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>



<div  id="node-21" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/content/administrator/post-install-configuration/importing-sites/index.html">Importing sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>It is possible to import existing sites into the Aegir hosting system, so that they can be managed by Aegir.</p>

<p>These instructions assume you've set up a new server with Aegir on it, and you want to import sites into Aegir from another server, or even from the same server, using backups.</p>

<p>There are basically three ways of importing sites in Aegir:</p>

<ul>
<li><a href="../../../../../content/importing-existing-aegir-backups/index.html">from Aegir backups</a> - simplest and fastest, scriptable</li>
<li><a href="../../../../../content/importing-single-site-manually/index.html">from any single site, manually</a> - most reliable, can import even non-aegir sites, hard to automate</li>
<li><a href="../../../../../content/importing-complete-drupal-platform/index.html">from a complete Drupal install</a> - fairly reliable, can import non-aegir sites, could be automated but requires access to the database servers currently in use by the site</li>
</ul>

<p>This section also regroups troubleshooting and other less orthodox techniques.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-53.html?destination=node%2F21%23comment-form">Login</a> or <a href="../../../../../user/register/index-53.html?destination=node%2F21%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-53.html?destination=node%2F21%23comment-form">Login</a> or <a href="../../../../../user/register/index-53.html?destination=node%2F21%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-117" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/importing-existing-aegir-backups/index.html">Importing from existing Aegir backups</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Copy_backups"><span class="toc-number">1. </span>Copy backups</a></li>
	<li class="toc-level-1"><a href="#Create_the_site_context_and_deploy_the_backup"><span class="toc-number">2. </span>Create the site context and deploy the backup</a></li>
	<li class="toc-level-1"><a href="#Verify_the_Platform"><span class="toc-number">3. </span>Verify the Platform</a></li>
	<li class="toc-level-1"><a href="#Caveats"><span class="toc-number">4. </span>Caveats</a></li>
	<li class="toc-level-1"><a href="#Setting_a_Non-Default_Install_Profile"><span class="toc-number">5. </span>Setting a Non-Default Install Profile</a></li>
</ol>
</div>
</div>

<p>If you need to import a site from an existing Aegir system, this can be done from an Aegir site backup.</p>

<p><strong>Requirements:</strong></p>

<ol>
<li>New Aegir version 0.4 alpha15 or later.</li>
<li>Access to Aegir backups from the old server.</li>
<li>A platform set up and verified that matches the platform on the old Aegir server.</li>
</ol>

<h2 id="Copy_backups">1. Copy backups</h2>

<p>First log into the new server via ssh - switch to the aegir user. Create a temporary directory somewhere, for example:
<div class="codeblock"><code>mkdir /var/aegir/tmp/migrate</code></div></p>

<p>Run a command to syncronize the new directory with the backups directory of the old Aegir hosting system. This command does the entire directory, but you may want to modify this if you have a lot of unneeded backups on the old system.</p>

<p>This command also assumes that you can shell into the other server as the aegir user. Modify as required.</p>

<p><div class="codeblock"><code>rsync -aPv -e ssh aegir@old-server.com:/var/aegir/backups/* /var/aegir/tmp/migrate</code></div></p>

<p>Now you can re-run the above command just before you are going to migrate a site. This is handy if you have a lot of sites to migrate and each site requires attention. Simply make a new backup of the site in the old system, and rerun the rsync command.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_the_site_context_and_deploy_the_backup">2. Create the site context and deploy the backup</h2>

<p>For brevity, I assume that drush can be executed as <code>drush</code>. Replace with <code>php /var/aegir/drush/drush.php</code> if needed.</p>

<p>Pay attention to these two commands, they require modification to match the name of the site, the alias of the platform, and the name of the backup archive. These commands should each be on one line. You also need to know the platform alias. You can see all the platform aliases available by typing <code>drush sa | grep platform</code>.</p>

<p>First tell Aegir about the site, which creates a site alias.</p>

<p><div class="codeblock"><code>drush provision-save @example.com --context_type=site --platform=@platform_d6 --uri=example.com --db_server=@server_localhost --client_name=admin</code></div></p>

<p>Then run the provision-deploy:</p>

<p><div class="codeblock"><code>drush @example.com provision-deploy /var/aegir/tmp/migrate/example.com-2010-11-11.tar.gz</code></div></p>

<p>Note: if you receive an error, you might also try adding the site to your new Aegir platform (using the same platform and site name, of course). Then run the provision-deploy again.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Verify_the_Platform">3. Verify the Platform</h2>

<p>The final step is to import the site into Aegir. This is easily done by logging into the Aegir front-end and verifying the platform, which then will trigger an import task for the new site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Caveats">4. Caveats</h2>

<p>The provision-save command will assume the database server is the same as the master server and that you are not using any install profile. So if your DB lives in another server or if you are using an install profile like openatrium you will probably need to edit the file created at /var/aegir/.drush/example.com.alias.drushrc.php</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Setting_a_Non-Default_Install_Profile">5. Setting a Non-Default Install Profile</h2>

<p>If you are using a non-default install profile, you may want to specify your install profile by adding <code>--profile=profilemachinename</code> to the <code>drush provision-save</code> command above.</p>

<p>Using the example above but using an install profile for Open Atrium, the command would look like:</p>

<p><div class="codeblock"><code>drush provision-save @example.com --context_type=site --platform=@platform_d6 --profile=openatrium --uri=example.com</code></div></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-305.html?destination=node%2F117%23comment-form">Login</a> or <a href="../../../../../user/register/index-305.html?destination=node%2F117%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../117/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-115" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/importing-single-site-manually/index.html">Importing a single site manually</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>If you already have a platform setup on Aegir with EXACTLY the same codebase as your existing site, then you don't need to transfer the entire old codebase - you can just transfer the sites/example.com directory. However, you also need to make sure any dependencies on contrib modules that your site has, are covered on the codebase or Platform that you're importing it into.</p>

<p>In general it may be considered safer/less prone to confusing errors to transfer the entire old codebase into Aegir as a whole Platform, whereby the site will be imported automatically under that Platform. You can then migrate it in Aegir to one of your existing Platforms later. See <a href="../../../../../content/importing-complete-drupal-platform/index.html">importing from a complete Drupal platform</a> for this method.</p>

<p>Also, it is much faster to just <a href="../../../../../content/importing-existing-aegir-backups/index.html">"deploy" an Aegir backup</a> than go through the manual procedure here, so you should generally follow <a href="../../../../../content/importing-existing-aegir-backups/index.html">that procedure</a> instead of the one defined here unless you have a very hairy setup.</p>

<p>To transer a site manually into Aegir, those are the steps you should follow:</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc1">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Create_the_site_database_user_and_directory"><span class="toc-number">1. </span>Create the site database, user and directory</a></li>
	<li class="toc-level-1"><a href="#Transfer_the_files"><span class="toc-number">2. </span>Transfer the files</a></li>
	<li class="toc-level-1"><a href="#Transfer_the_Database"><span class="toc-number">3. </span>Transfer the Database</a></li>
	<li class="toc-level-1"><a href="#Verify_In_Aegir"><span class="toc-number">4. </span>Verify In Aegir</a></li>
</ol>
</div>
</div>

<h2 id="Create_the_site_database_user_and_directory">1. Create the site database, user and directory</h2>

<p>In order to import the site, you need to create a database and database user for the site, along with a directory in the platform.</p>

<p>The simplest way to do this is to create an empty site in the right platform and overwrite it. Through the commandline:</p>

<p><div class="codeblock"><code>drush provision-save @example.com --context_type=site --platform=@platform_d6 --uri=example.com --db_server=@server_localhost --client_name=admin<br />drush provision-install @example.com</code></div></p>

<p>Through the UI, this can be done simply by creating a site in Create content.</p>

<p>If this is not working for some reason, you can create the mysql user and database manually using the following:</p>

<p><div class="codeblock"><code>GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, LOCK TABLES, CREATE TEMPORARY TABLES ON <code>databasename</code>.* TO &#039;databaseuser&#039;@&#039;localhost&#039; IDENTIFIED BY &#039;password&#039;;<br />CREATE DATABASE <code>databasename</code>;</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Transfer_the_files">2. Transfer the files</h2>

<p>You need to copy the <code>sites/example.com</code> directory from your old server to the new Aegir server.</p>

<p>To do this, first create a tarball of the site on the old server. Within the <code>sites/example.com</code> directory type:</p>

<p><div class="codeblock"><code>tar -zcvf example.com.tar.gz .</code></div></p>

<p>Then, on the Aegir server, you can create a directory for it in the codebase (platform) you want to put it under:</p>

<p><div class="codeblock"><code>cd /var/aegir/platforms/drupal-X.Y/sites<br />mkdir example.com<br />cd example.com<br />wget <a href="http://example.com/example.com.tar.gz<br />tar" title="http://example.com/example.com.tar.gz<br />tar">http://example.com/example.com.tar.gz<br />tar</a> -zxvf example.com.tar.gz ./files ./modules ./libraries ./themes</code></div></p>

<p>Instead of using wget you could of course use SCP or FTP to transfer the tarball onto the Aegir server.</p>

<p>In the above we assume that you have created an empty site as directed above, if not, you will also need to extract the settings.php file, so that last command should instead be simply:</p>

<p><div class="codeblock"><code>tar -zxvf example.com.tar.gz</code></div></p>

<p>Then you will need to modify the settings.php file to follow the user and database created in the first step. Again, this is not necessary if you let Aegir create the site for you.</p>

<p>Once the file is unpacked, check the ownership and group of each file by using <code>ls -al</code>. It should be either 'aegir:aegir' or 'aegir:www-data'. Change it if necessary.  In particular, files that may have been uploaded on your site via modules like imagecache, upload, Profile pics etc, may need to have their ownership changed:</p>

<p><div class="codeblock"><code>sudo chown -R aegir:www-data $platform/sites/*/files</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Transfer_the_Database">3. Transfer the Database</h2>

<p>Make a backup of the database on your old server (Backup and Migrate module is good for this, or you can use phpmyadmin or your favourite MySQL management tool. It's a good idea to truncate the cache, search and watchdog tables first to reduce the size of the database. The "Backup and Migrate" module does this for you.</p>

<p>If you are importing a site from a previous Aegir installation somewhere, such as from a backup tarball, the database.sql will already be within the tarball you unpacked. You can use this to import into a new database on your new server.</p>

<p>You can import the database with drush using the following command:</p>

<p><div class="codeblock"><code>drush @example.com sqlc &lt; database.sql</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Verify_In_Aegir">4. Verify In Aegir</h2>

<p>In the Aegir web interface click on the name of the platform you have added your site to. You can access the list of platforms via the 'Platforms' tab in the primary links menu.</p>

<p>Execute a new Verify task on this platform via the 'Verify' button in the task list.</p>

<p>Aegir will now re-verify the platform. In the process of this, it will discover your new site and spawn a new 'Import' task for the site.</p>

<p>Once it's done this (it may take a couple of cron runs to dispatch these tasks in the queue) the tasks should turn green (if not, see 'Troubleshooting' below).</p>

<p>At this point, presuming you have updated DNS or are overriding DNS via an entry in your <code>/etc/hosts</code> file to access the site via the new Aegir server, you can visit the site in a browser and check around to see that it has worked. Pay particular attention to any links in node content that pointed to paths referencing <code>/sites/community.aegirproject.org</code> if your site was not part of a multisite setup. (Drupal has a habit of storing these paths in the database, or they may have been hard-coded into nodes by users).</p>

<p>Aegir will not go through all your database and update all URLs, so some images or links may be broken. This will need to be done manually. Aegir does attempt to update paths stored in tables such as 'files' though.</p>

<p>It's a good idea to clear the caches, and you may need to get imagecache to rebuild its thumbnails if you use it.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-54.html?destination=node%2F115%23comment-form">Login</a> or <a href="../../../../../user/register/index-54.html?destination=node%2F115%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-54.html?destination=node%2F115%23comment-form">Login</a> or <a href="../../../../../user/register/index-54.html?destination=node%2F115%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-116" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/importing-complete-drupal-platform/index.html">Importing a complete Drupal platform</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc2">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Transfer_the_codebase"><span class="toc-number">1. </span>Transfer the codebase</a></li>
	<li class="toc-level-1"><a href="#Transfer_the_Database"><span class="toc-number">2. </span>Transfer the Database</a></li>
	<li class="toc-level-1"><a href="#Setup_Platform_in_Aegir"><span class="toc-number">3. </span>Setup Platform in Aegir</a></li>
	<li class="toc-level-1"><a href="#Import_and_Verify_Sites_In_Aegir"><span class="toc-number">4. </span>Import and Verify Sites In Aegir</a></li>
	<li class="toc-level-1"><a href="#Migrate_To_Another_Platform"><span class="toc-number">5. </span>Migrate To Another Platform</a></li>
	<li class="toc-level-1"><a href="#Troubleshooting"><span class="toc-number">6. </span>Troubleshooting</a></li>
</ol>
</div>
</div>

<p>This way of importing sites is often considered the safest whereby you transfer across an entire codebase containing Drupal core, and define it as a Platform first. This makes sure you bring any dependencies, contrib modules etc, in exactly the same version and configuration that is referenced in the database for the site.</p>

<h3 id="Transfer_the_codebase">1. Transfer the codebase</h3>

<p>Create a tarball of the codebase on the old server. Within the drupal root directory type:
<code>tar -zcvf example.com.tar.gz * .htaccess</code></p>

<p>Note that we have to specify including the .htaccess because it isn't picked up by the * wildcard due to being prefixed with a full stop. <strong>It is important to bring along the .htaccess for a platform so that Aegir can consider these settings when it generates Apache configuration for this platform.</strong></p>

<p>Then, on the new server you can create a directory for it in the codebase you want to put it under:
<div class="codeblock"><code>cd /var/aegir/platforms<br />mkdir your-new-platform<br />cd your-new-platform<br />wget <a href="http://example.com/example.com.tar.gz<br />tar" title="http://example.com/example.com.tar.gz<br />tar">http://example.com/example.com.tar.gz<br />tar</a> -zxvf example.com.tar.gz</code></div></p>

<p>Instead of using wget you could of course use SCP or FTP to transfer the tarball onto the Aegir server.</p>

<p>Once the file is unpacked, check the ownership and group of each file by using <code>ls -al</code>. It should be either 'aegir:aegir' or 'aegir:www-data'. Change it if necessary. We have to assume you have basic knowledge of Linux and POSIX permissions - we can't be responsible for teaching you sysadmin skills :)</p>

<p>In particular, files that may have been uploaded on your site via modules like imagecache, upload, Profile pics etc, may need to have their ownership changed:
<code>sudo chown -R aegir $platform/sites/*/files</code></p>

<p>If your site previously resided in sites/defau1t you need to move it because Aegir ignores the default directory (it has no way of understanding what URL this would be accessed by, so it is impossible to 'manage' it). Each site needs its own directory with the correct domain in typical Drupal multisite design:</p>

<p><div class="codeblock"><code>mv sites/defau1t sites/example.com</code></div></p>

<p>If you do this, you may need to also update your filepath's stored in the files table by running the following query on your database:
<div class="codeblock"><code>UPDATE files SET filepath = REPLACE(filepath, &#039;sites/defau1t&#039;, &#039;sites/example.com&#039;);</code></div></p>

<p>There are many other places in the database that can suffer the same problem, the <code>node_revisions</code> table for example. If you have phpMyAdmin available you can easily search the entire database for 'sites/defau1t'. Select the database, then click the Search tab. Once you know which tables are affected you can run a variation of the above query to correct these records.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Transfer_the_Database">2. Transfer the Database</h3>

<p><strong>Note:  This step is not necessary if you are moving your site from one directory on your server (e.g., /var/www/html) to a newly created Aegir directory on the same server (e.g., /var/aegir).</strong></p>

<p>Make a backup of the database on your old server (Backup and Migrate module is good for this, or you can use phpmyadmin or your favourite MySQL management tool. It's a good idea to truncate the cache, search and watchdog tables first to reduce the size of the database (Backup and Migrate does this for you).</p>

<p>Aegir does not provide support for importing databases with prefixed tables so it is best to remove prefixes form the database. However, there is work to bring this support in (<a href="http://drupal.org/node/483346" title="http://drupal.org/node/483346">http://drupal.org/node/483346</a>) and a solution if you want to keep prefixes on your tables (<a href="http://drupal.org/node/483346#comment-3113516" title="http://drupal.org/node/483346#comment-3113516">http://drupal.org/node/483346#comment-3113516</a>)</p>

<p>Unlike traditional Drupal projects the database settings cannot be found in settings.php. The database credentials are stored in the Apache vhost config of the associated site. This is a security measure implemented by the Aegir project.</p>

<p>In the vhost directory on your old server, <code>/var/aegir/config/server_master/apache/vhost.d/</code>, is a vhost file for every site on your server. The contents of the file can be displayed in your terminal with the command <code>cat thenameofthefile</code>. At the top of the file you will find the credentials  needed to create a database on the new server.</p>

<p>On your new server, manually create a new database and upload the .sql file from your backup.</p>

<p>Then create the mysql user that your site accesses the database as, and grant it all permissions on that database except 'GRANT'.</p>

<p>Connect to the database on the old server:
<code>mysql -u root -p</code></p>

<p>Create the new database:
<code>create database yourdatabasename</code></p>

<p>Add the user:
<code>CREATE USER &#039;yourdatabaseuser&#039;@&#039;localhost&#039; identified by &#039;youruserpassword&#039;;</code></p>

<p>Give the necessary privileges:
<code>GRANT ALL PRIVILEGES ON yourdatabasename.* TO &#039;yourdatabaseuser&#039;@&#039;localhost&#039;;</code></p>

<p>Import the database:
<code>mysql -u yourdatabaseuser -p -h localhost yourdatabasename &lt; thenameofthedatabase.sql</code></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Setup_Platform_in_Aegir">3. Setup Platform in Aegir</h3>

<p>In the Aegir web interface click on 'Create Content' and 'Platform'. This step is often easiest when using the admin-menu on the top of your screen.</p>

<p>Enter the name you want to use for the platform (eg 'My Platform import'), and the path to the platform on the server (eg '/var/aegir/platforms/your-new-platform')</p>

<p>Click Save to submit the form, and Aegir will spawn a Verify task for this platform into the queue.</p>

<p>Once the task is complete this the task should turn green (click through to the homepage to refesh and check. If not, see 'Troubleshooting' below).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Import_and_Verify_Sites_In_Aegir">4. Import and Verify Sites In Aegir</h3>

<p>Upon completion of the above Platform verification task, Aegir will discover your new site and spawn a new 'Import' task for the site.</p>

<p>Once it's done this (it may take a couple of cron runs to dispatch these tasks in the queue) the tasks should turn green (if not, see 'Troubleshooting' below).</p>

<p>At this point, presuming you have updated DNS or are overriding DNS via an entry in your /etc/hosts file to access the site via the new Aegir server, you can visit site in a browser and check around to see that it has worked. Pay particular attention to any links in node content that pointed to paths referencing <code>/sites/community.aegirproject.org</code> if your site was not part of a multisite setup. (Drupal has a habit of storing these paths in the database, or they may have been hard-coded into nodes by users).</p>

<p>It's a good idea to clear the caches, and you may need to get imagecache to rebuild its thumbnails if you use it.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Migrate_To_Another_Platform">5. Migrate To Another Platform</h3>

<p>Now that you have your sites under Aegir's control you can take advantage of its power, and easily migrate them to another platform. In the event that your sites were on old versions of Drupal core and a new one is available and present as another Platform on your Aegir server, you can use the Migrate process to upgrade those sites onto the new core.</p>

<p>For details on how to Migrate sites, consult the <a href="../../../../23/index.html">Migrate documentation</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Troubleshooting">6. Troubleshooting</h3>

<p>For those who are migrating existing sites that live with their files in the sites/community.aegirproject.org folder, things can get tricky. However, you can <a href="http://palma-seo.com/content/moving-single-drupal-install-default-directory-multi-site-drupal-installation">follow this tutorial</a> and successfully get things moved over rather easily.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-395.html?destination=node%2F116%23comment-form">Login</a> or <a href="../../../../../user/register/index-395.html?destination=node%2F116%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../116/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-517" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../517/index.html">Setting up a test Aegir site from an existing one</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>We have <a href="../../../../316/index.html">already seen</a> how to import sites in an Aegir install, but what if we want to test the "hostmaster" site itself, ie. setup a development or staging environment of an Aegir install itself?</p>

<p>This page explains how. The basic steps are:</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc3">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Installing_aegir"><span class="toc-number">1. </span>Installing aegir</a></li>
	<li class="toc-level-1"><a href="#Backup_the_production_site"><span class="toc-number">2. </span>Backup the production site</a></li>
	<li class="toc-level-1"><a href="#Deploy_the_production_site_in_staging"><span class="toc-number">3. </span>Deploy the production site in staging</a></li>
	<li class="toc-level-1"><a href="#Tweaking_the_install_for_the_staging_server"><span class="toc-number">4. </span>Tweaking the install for the staging server</a></li>
	<li class="toc-level-1"><a href="#Troubleshooting"><span class="toc-number">5. </span>Troubleshooting</a></li>
</ol>
</div>
</div>

<h1 id="Installing_aegir">1. Installing aegir</h1>

<p>The first step should be fairly simple and intuitive if you got that far: you have to <a href="../../../../../installing/index.html">install aegir itself</a> on the staging server. You should install the specific version that is currently in production.</p>

<p>Maybe that also involves <a href="../../../../../uninstalling/index.html">uninstalling the existing install</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Backup_the_production_site">2. Backup the production site</h1>

<p>Run a backup on the production site, on the production server. This can be done in the frontend or in the backend using:</p>

<p><div class="codeblock"><code>drush @hostmaster provision-backup</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Deploy_the_production_site_in_staging">3. Deploy the production site in staging</h1>

<p>Copy the resulting backup to the staging server. Then you should be able to deploy it with the following command:</p>

<p><div class="codeblock"><code>drush @hostmaster provision-deploy --old_uri=aegir.koumbit.net /home/anarcat/aegir.koumbit.net-20110326.161420.tar.gz --debug</code></div></p>

<p>In this case, we use deploy to also rename the site (<code>--old_uri=aegir.koumbit.net</code>).</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Tweaking_the_install_for_the_staging_server">4. Tweaking the install for the staging server</h1>

<p>The environment on the staging server could be <em>very</em> different from the production server. The server name will be different, maybe there will not be a dedicated mysql server, platforms will not exist, etc.</p>

<p>It is recommended to review the "Servers" page to change the domain names to the staging environment. In Koumbit's case, this means:</p>

<ol>
<li>editing the master server to change the hostname and IPs</li>
<li>renaming the DB server to "localhost" and changing the database credentials</li>
<li>renaming the main hostmaster site:
<div class="codeblock"><code>drush @hostmaster sqlq &quot;UPDATE node n JOIN hosting_context h ON h.nid = n.nid SET n.title=&#039;hostmaster.koumbit.net&#039; WHERE name=&#039;hostmaster&#039;;&quot;<br />drush @hostmaster sqlq &quot;UPDATE node_revisions nr JOIN hosting_context h ON h.nid = nr.nid JOIN node n ON n.vid = nr.vid SET nr.title=&#039;hostmaster.koumbit.net&#039; WHERE h.name=&#039;hostmaster&#039;;&quot;</code></div></li>
<li>change the sites to point to the good web and db servers:
<div class="codeblock"><code>UPDATE hosting_site SET db_server=3631 WHERE db_server &lt;&gt; 3631;<br />UPDATE hosting_platform SET web_server = 3 WHERE web_server &lt;&gt; 3;</code></div></li>
</ol>

<p>Note that this will have the added benefit of reverifying all platforms and therefore create them if they are makefile-based.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Troubleshooting">5. Troubleshooting</h1>

<p>I had weird issues with failing to run updatedb on the hostmaster site (while deploying to another alias would work). My workaround was to suspend the process right before it would run drush updatedb, then run updatedb manually, twice:</p>

<p><div class="codeblock"><code>drush @hostmaster updatedb<br />drush @hostmaster cc all<br />drush @hostmaster updatedb</code></div></p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-55.html?destination=node%2F517%23comment-form">Login</a> or <a href="../../../../../user/register/index-55.html?destination=node%2F517%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-55.html?destination=node%2F517%23comment-form">Login</a> or <a href="../../../../../user/register/index-55.html?destination=node%2F517%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-426" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../426/index.html">Troubleshooting creating a platform or importing sites</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>First things to check:</p>

<p>Does the aegir user have proper permissions?</p>

<pre>
sudo chown aegir -R PLATFORM/sites/yoursite
</pre>

<p>Is the database properly set up?
Try drush sql-cli to see if the site db user has access and if there are tables (try SHOW TABLES).</p>

<p>If something goes wrong with importing a site you might end up with a node for a non-working site.  In such a case it can be good to delete the node for this non-working site and verify the underlying platform again.  Since there is no direct way to delete such a node from the user interface you have change the URL from node/NUMBER/edit into node/NUMBER/delete to do this.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-56.html?destination=node%2F426%23comment-form">Login</a> or <a href="../../../../../user/register/index-56.html?destination=node%2F426%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-56.html?destination=node%2F426%23comment-form">Login</a> or <a href="../../../../../user/register/index-56.html?destination=node%2F426%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-30" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../30/index.html">Remote servers (multiserver)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir supports multiple 'server' entities. These servers have 'services' such as 'Web' or 'Database', and 'service types' which are implementations of that service, such as 'Apache' or 'MySQL'.</p>

<p>Some previous experience in the configuration of Apache and MySQL will help if you want to use remote servers with Aegir. If you haven't had any experience in setting up and maintaining Apache or MySQL before you might want get familiar with the basic concepts first.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc4">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Remote_web_servers"><span class="toc-number">1. </span>Remote web servers</a>
<ol>
	<li class="toc-level-2"><a href="#System_dependencies"><span class="toc-number">1.1. </span>System dependencies</a></li>
	<li class="toc-level-2"><a href="#Aegir_user"><span class="toc-number">1.2. </span>Aegir user</a></li>
	<li class="toc-level-2"><a href="#Web_server_configuration"><span class="toc-number">1.3. </span>Web server configuration</a></li>
	<li class="toc-level-2"><a href="#Sudoers"><span class="toc-number">1.4. </span>Sudoers</a></li>
	<li class="toc-level-2"><a href="#Login_shell"><span class="toc-number">1.5. </span>Login shell</a></li>
	<li class="toc-level-2"><a href="#MySQL_access"><span class="toc-number">1.6. </span>MySQL access</a></li>
	<li class="toc-level-2"><a href="#SSH_keys"><span class="toc-number">1.7. </span>SSH keys</a></li>
	<li class="toc-level-2"><a href="#Verify_the_server"><span class="toc-number">1.8. </span>Verify the server</a></li>
</ol>
</li>
</ol>
</div>
</div>

<h1 id="Remote_web_servers">1. Remote web servers</h1>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="System_dependencies">1.1. System dependencies</h2>

<p>On the remote server, install these packages</p>

<p><div class="codeblock"><code>&nbsp; apt-get install rsync apache2 php5 php5-cli php5-mysql postfix mysql-client sudo</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Aegir_user">1.2. Aegir user</h2>

<p>Any number of remote web servers may be configured. The remote server needs an aegir user created on the system.</p>

<p><div class="codeblock"><code> adduser --system --group --home /var/aegir aegir<br /> adduser aegir www-data&nbsp;&nbsp;&nbsp; #make aegir a user of group www-data</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Web_server_configuration">1.3. Web server configuration</h2>

<p>You'll also need to prepare the web server in the same way you did for the master Aegir server during installation:</p>

<p><div class="codeblock"><code> a2enmod rewrite<br /> ln -s /var/aegir/config/apache.conf /etc/apache2/conf.d/aegir.conf</code></div></p>

<p>Don't restart Apache even when it prompts you. This will be done by the Verify task you'll spawn for the server from the Aegir frontend later.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Sudoers">1.4. Sudoers</h2>

<p>Add the aegir user to sudoers so it can restart Apache (e.g. sudo visudo -f /etc/sudoers.d/aegir):</p>

<p><div class="codeblock"><code>aegir ALL=NOPASSWD: /usr/sbin/apache2ctl</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Login_shell">1.5. Login shell</h2>

<p>The remote aegir user will also need a login shell, which can be modified using the <code>chsh</code> command.</p>

<p><div class="codeblock"><code>chsh -s /bin/sh aegir</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="MySQL_access">1.6. MySQL access</h2>

<p>Aegir connects directly to the remote server's MySQL to create databases and users. Therefore, you need to log into MySQL in the remote server as root and create a user with the following command:
<div class="codeblock"><code>GRANT ALL PRIVILEGES ON &#42;.&#42; TO root@aegir_server_ip IDENTIFIED BY &#039;password&#039; WITH GRANT OPTION;<br />FLUSH PRIVILEGES;</code></div></p>

<p>Where</p>

<p><UL>
<LI>'root' is the username on the Aegir server that will be connecting. Leave 'root';
</li><LI>'aegir_server_ip' is the IP address of your Aegir server. For example '123.123.123.123';
</li><LI>'password' is the password that will be used by your Aegir 'root' user to connect to the remote server's MySQL to create databases and users. It is suggested to store that password in a secure location. To increase security, it is recommended to choose a password with 6 to 16 alphanumeric and or punctuation characters.
</li></ul></p>

<p>If MySQL returns something like "Query OK", that means the command was successful. For example:</p>

<blockquote>
<code>Query OK, 0 rows affected (0.00 sec)</code>
</blockquote>

<p>Note the comment about "bind-address    = 127.0.0.1" on <a href="../../../../../installing/manual/index.html#Database_configuration" title="http://community.aegirproject.org/installing/manual#Database_configuration">http://community.aegirproject.org/installing/manual#Database_configuration</a></p>

<p>When the server is being verified, Aegir will attempt to create a database and grant privileges to a user for that database. If any of these two fails, <a href="http://www.ghacks.net/2009/12/27/allow-remote-connections-to-your-mysql-server/" target="_blank">verify that your MySQL configuration is correct</a> and that there is no firewall blocking your MySQL port.</p>

<p>You can confirm that MySQL is configured correctly on the remote server by manually connecting from the command line on your Aegir machine:</p>

<p><div class="codeblock"><code>[aegir@aegir_box:~]$ mysql -h &lt;mysql_server_IP&gt; -u root -p</code></div></p>

<p>If your MySql database is running on the same server as the Aegir master and is configured with the name "localhost", you may run an issue where the remote web server tries to access MySql via a local socket rather than the hostname. To resolve this, just change the server hostname for the MySql server in Aegir from "localhost" to the hostname of the server.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="SSH_keys">1.7. SSH keys</h2>

<p>SSH public/private keys should be set up so the main Aegir server's aegir user can access remote web aegir users with no passwords required.</p>

<p>Example: on main Aegir server:</p>

<p><div class="codeblock"><code>ssh-keygen -t rsa<br />(follow prompts)</code></div></p>

<p><strong>Do not</strong> use a passphrase when you create your key.  Simply press Enter to leave the passphrase blank.  Otherwise, SSH will insist that you enter the passphrase everytime you try to SSH using the key.  We don't want SSH to present any prompts.</p>

<p>Put the public key's contents into <code>/var/aegir/.ssh/authorized_keys</code> on the remote web server.  The easiest way to do this is to use the ssh-copy-id command.</p>

<p>You should manually login for the first time from your Aegir master server to your remote server as the aegir user, so that the remote web server is added to the known_hosts file in /var/aegir/.ssh on your Aegir master server. <strong>Verifying the remote webserver will fail until this has been done.</strong></p>

<p>You can confirm that SSH is set up correctly by manually connecting from your aegirmaster server to your remote server as aegir@ user to aegir@ user:
<div class="codeblock"><code>[aegir@aegirmaster:~]$ ssh aegir@&lt;remoteserver&gt;</code></div>
This should directly log you into the remote shell command line without any additional keys pressed.
<div class="codeblock"><code>[...]<br />[aegir@&lt;remoteserver&gt;:~]$</code></div></p>

<p>There are many, many tutorials online for setting up ssh keys, and various mistakes can be made by inexperienced users such as permissions etc. Aegir isn't a 'Linux beginner's practice tool', so setting these up is really out of the scope of this document and users are encouraged to research this on their own.  (For Ubuntu, see <a href="http://help.ubuntu.com/community/SSH/OpenSSH/Keys" title="Ubuntu guide to SSH keys">this article</a>).</p>

<p>If you have followed the instructions above, and your SSH connection gets closed immediately after you try to connect to the remote server as the aegir user, you may not have given the aegir user a shell correctly.  Check the /etc/passwd file on the remote server to make sure that the aegir user has a shell.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Verify_the_server">1.8. Verify the server</h2>

<p>Now you can add a new server node in Aegir, set the hostname and/or IP and set the service type to be 'Apache' (or Apache_SSL if this site is to handle SSL sites).</p>

<div align="center"><img src="../../../../../sites/community.aegirproject.org/files/server/index.png" /></div>

<p>A verify task will be spawned and added to the Task queue ready for dispatching. During a server verification task, various configurations will be set on the Aegir master server and also synced to the remote web server, restarting Apache.</p>

<p>Now when you add a new Platform node in Aegir, you have the option of setting which web server to host it on. If you are not using a makefile but are downloading a platform manually, you must still do this on the main Aegir server. The contents will then be synced across to the web server.</p>

<p>You don't choose a web server when installing a new site. Because a site depends on a platform, its web server is implied by which platform has been chosen.  In other words, all sites on a platform are hosted on the same server.  You cannot host two sites on the same platform on different servers.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script><div class="itu-attachments"><table class="itu-attachment-list withoutstats sticky-enabled" id="attachments">
 <thead><tr><th class="preview">Preview</th><th class="file">Attachment</th><th class="size">Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td class="mime mime-png"><div  class="form-item" id="">
    <div class="itu-attachment-thumb"><a href="../../../../../sites/community.aegirproject.org/files/sudoers/index.png" title="sudoers.png"><img src="../../../../../sites/community.aegirproject.org/files/imagecache/AttachmentThumbnail/sudoers/index.png" alt="sudoers.png" title="sudoers.png" width="60" height="60" class="imagecache imagecache-AttachmentThumbnail"/></a></div>  </div>
</td><td class="file"><a href="../../../../../sites/community.aegirproject.org/files/sudoers/index.png">sudoers.png</a></td><td class="size">68.03 KB</td> </tr>
</tbody>
</table>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-396.html?destination=node%2F30%23comment-form">Login</a> or <a href="../../../../../user/register/index-396.html?destination=node%2F30%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../30/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-396" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../396/index.html">Remote webserver configuration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Any number of remote web servers may be configured. They need an <a href="../../../../../installing/manual/index.html#Create_the_Aegir_user">aegir user</a> and webserver configuration, with the same user name and directory paths. SSH public/private keys should be set up so hostmaster's Aegir user can access remote web Aegir users with no passwords. The above Apache configuration needs to be performed too.</p>

<p>Additionally, the remote web server needs the 'mysql' client binary installed so that Aegir can test that it can successfully connect to the database server. On (at least) Debian-based systems, this can be installed via the 'mysql-client' package.</p>

<p>They will also need a login shell, which can be modified using the <code>chsh</code> command.</p>

<p>Shell commands as root::</p>

<pre><code>apt-get install mysql-client
adduser --system --group --home /var/aegir aegir
adduser aegir www-data    #make aegir a user of group www-data
chsh -s /bin/sh aegir
apt-get install rsync apache2 php5 php5-cli php5-mysql
mkdir /var/aegir/.ssh
cat &gt; /var/aegir/.ssh/authorized_keys &lt;&lt;EOF
ssh-rsa AAAAB3NzaC1yc2EAAAADAQAB...UF aegir@filer01
EOF
chown aegir:aegir /var/aegir/.ssh -R
chmod 750 /var/aegir/.ssh
chmod 640 /var/aegir/.ssh/authorized_keys
a2enmod rewrite
ln -s /var/aegir/config/apache.conf /etc/apache2/conf.d/aegir.conf
cat &gt; /etc/sudoers.d/aegir &lt;&lt;EOF
Defaults:aegir  !requiretty
aegir ALL=NOPASSWD: /usr/sbin/apache2ctl
EOF
chmod 440 /etc/sudoers.d/aegir
</code></pre>

<p>For clusters, use the aegir-cluster-slave package to operate the above and NFS mounts for you. See also <a href="../../../../../content/web-clusters/index.html">web cluster configuration documentation</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-57.html?destination=node%2F396%23comment-form">Login</a> or <a href="../../../../../user/register/index-57.html?destination=node%2F396%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-57.html?destination=node%2F396%23comment-form">Login</a> or <a href="../../../../../user/register/index-57.html?destination=node%2F396%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-446" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../446/index.html">Adding a platform on a remote web server</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_119 first"><a href="../../../../../category/keywords/add-platform/index.html" rel="tag" title="">add platform</a></li>
<li class="taxonomy_term_120 last"><a href="../../../../../category/keywords/remote-server/index.html" rel="tag" title="">remote server</a></li>
</ul></div><p>Especially if you have been using Aegir for a while simply because it handles updates, moving to new releases, cloning, aliases and everything Drupal with such elegance on a single server - you might not be entirely clear on what changes when you make the move to multiple servers.  Hopefully this will help.</p>

<h2>Understanding the process</h2>

<p>Multiple servers are great even if you do not have to manage a server farm.  Having a server for development that you are free to break, one for testing that you hope will not break, one for approvals so your clients can go to see how their "real" website will look, and one for production that serves the daily grind of live sites is a wonderful thing.  This DTAP (Development, Testing, Acceptance, and Production) structure works and it is surprisingly easy to accomplish under Aegir.</p>

<p>If you are managing a farm, creating massive numbers of servers is quick and easy with Aegir - especially if you use virtual machines like Xen where a server image can be cloned or generated using LVM disks that can be migrated (even while running) to other physical machines.</p>

<p>When it is time break out an Aegir master controller and remote slaves you have to remember that Aegir is the place that it (almost) all happens.  Everything is stored in Aegir - including your remote platforms and your sites - and then distributed to the slave servers by Aegir in the Verify process.</p>

<p>Remember too that sites reside on platforms, and platforms reside on servers.  You are turning your Aegir install into an Aegir Master as the hub, and the Aeger Remote Slaves as the spokes.  To move into this "hub and spoke" architecture, you must build the remote server, tell the Aegir Master about that server and verify it, install a Drupal platform for that server on the Aegir Master and finally tell the Aegir Master about that Drupal install and verify that.  You then create the sites on the platform you want based upon the install profile you select for that site.  Need more?  How about an example:</p>

<h2>The mechanics</h2>

<p>(1) Build a server image on your network to become your Aegir Slave.  This can be anything from a separate headless server to a Virtual Machine image on physical machine with a dozen other Virtual Machines on it.  As long as it has its own IP and is capable of running a Drupal image, it will work.</p>

<p>(2) Ensure that your new server image is resolved in your DNS by adding it to your zone files and incrementing the serial number in the zone file.  Aegir can manage that for you now to some extent, but you might want to wait until that feature leaves the experimental status.  Make sure the entries in /etc/hostname and /etc/hosts all match your zone files (including reverse DNS).  Reload/restart the DNS server.  Any DNS slaves should automatically get notified and the incremented serial number should make sure they reload automatically.  Test the resolution and ping the new Aegir Slave server image from the Aegir Master to Ensure that the IPs all resolved properly.</p>

<p>(2) Follow the steps in the Aegir Handbook page at <a href="../../../../30/index.html" title="http://community.aegirproject.org/node/30">http://community.aegirproject.org/node/30</a> carefully.  You should be able to use cut and paste if you are using Debian Stable or the like.  In any case, you will need those packages.  You do not need Aegir on the slave, but you do need the aegir user and that user must have a shell.  I prefer the bash shell, but the sh shell in the instructions will do.</p>

<p>(3) You need to have the "passphraseless" ssh working and proven before you continue.  A web search on the terms "passphraseless ssh" plus your operating system will generally get you great instructions, but putting those instructions here for every possible combination is beyond the scope of this example.  In terms of helpful hints, however, you do not need to have a password for the aegir user on the Aegir Slave.  Your access will be this certificate.  By simply hitting enter when it asks for the passphrase, you make the certificate passphraseless.  You should carefully set the permissions and back these certificates up to a secure location.  You MUST log in manually from the Aegir Master to the Aegir Slave the first time or your verify will fail.  This is because the system has to add the ssh keys to the known hosts and it will ask about about it before it will allow the connection.  Aegir nows nothing about this and will not answer, so the verify will fail.  To be absolutely sure it works, after exiting the initial login, you should retry the login to verify it does not ask for a password and then exit the login and try an rsync (which is the process by which the Aegir Master controls the Aegir Slaves).  All of these commands should work from the Aegir Master to the new Aegir Slave while logged into the Aegir Master as the aegir user with no request for a password, proving that the systems are exchanging keys (do not proceed until you can do this flawlessly without having to enter a response):</p>

<p><div class="codeblock"><code>##&nbsp; Start from the Aegir Master as the aegir user<br /># Log in to the slave from the Aegir Master and exit without any password or reply required<br />ssh slavename.example.com<br />exit<br /># Create a test file for rsync<br />echo &#039;rsync test file&#039; &gt; MyRsyncTest<br /># Send the test file to the remote slave by name using rsync<br />rsync -azvv /var/aegir/MyRsyncTest aegir@slavename.example.com:/var/aegir<br /># Log back into the remote slave<br />ssh slavename.example.com<br /># Make sure the file is there and readable<br />cat /var/aegir/MyRsyncTest<br /># Delete the test file from the remote slave<br />rm /var/aegir/MyRsyncTest<br /># Exit the ssh login session on the remote<br />exit<br /># Delete the test file on the Aegir Master<br />rm /var/aegir/MyRsyncTest</code></div></p>

<p>(4) Go to Add Content/Server and put in the server name, leave the Database set as None (Your sites will use the Aegir Master database and none is required on the Remote Slave) and under Web select apache or apache ssl (to match the example) then click Save. After the process completes you should see that it found the IP address properly on its own, plugged it in all by itself and then Verify quite nicely. If you look on the Aegir Slave remote server you will see that you now have directories named config and platform.</p>

<p>(5) Now that hard decision for platform choice comes in play.  My preference is a Drupal install that is the same release as the Aegir Master server or higher.  Since sites are eventually destined to be Drupal 7 one day, and the Aegir system is not Drupal 7 ready as of this writing but heading that direction, making at least one Drupal 7 slave is a good idea so that you can migrate sites to that platform as they are ready.  If you are migrating sites off of your existing Aegir and onto slaves, migrating to platforms of the same Drupal version makes that process much easier.  In any case, firm up your decision about which Drupal version you want to install on your new Aegir Slave Platform.</p>

<p>(6) Time to create that platform.  The big thing here is to do it right the first time and make certain that the name of the platform is unique to any platform on your Aegir Master server.  If you look in your /var/aegir directory you will notice that Aegir has its own naming convention.  For instance, you should see /var/aegir/hostmaster-0.4-rc1 as the platform for the Aegir 0.4 release candidate 1.  You need to consider doing the same.  For instance, name your platform something like: /var/aegir/slavename-drupal-version and you will make it easier to distinguish which server the platform resides upon and the drupal version so that you can manage updates and migrations more easily.  Make certain that you are not destroying one platform when creating another.  Be aware that at some point Aegir started organizing platforms into a separate directory: /var/aegir/platforms and you should change to that structure if you have an older original install.  Again, be careful you are not overwriting an existing install when you create the new one.  For instance, if you already have a Drupal install in /var/aegir/platforms/drupal-7.14 the code below will attempt to recreate it on top of the existing install.  If you are using a Makefile, be sure that the same problem does not occur in that makefile.  To create a Drupal 7 Aegir Remote Slave Platform, log into the Aegir Master as the aegir user and run this simple code (of course edit it to match the platform and name you want to create:
<div class="codeblock"><code># Make sure you are in the proper directory<br />cd /var/aegir/platforms<br /># Install Drupal 7.14<br />drush/drush.php dl drupal-7.14<br /># Rename the platform to your own naming convention<br />mv /var/aegir/platforms/drupal-7.14 /var/aegir/platforms/slavename-drupal-7.14</code></div></p>

<p>(7) The final step in creating this platform is to actually tell the Aegir Master about it so that it can distribute it (via rsync) to the new Aegir Remote Slave.  Simple enough.  Just go to Create Content/Platform and the Create Platform screen comes up.  Under Name write something descriptive and unique.  In the example so far, this will be something like 'slavename Drupal 7.14' or in some way adhere to your chosen naming convention.  I use the directory name I created above since that serves two purposes.  Under Publish Path you will put the path that holds this Drupal distribution.  In the example above that will be /var/aegir/platforms/slavename-drupal-7.14 but the path will be reflected from the Aegir Master to the Aegir Slave and will be the same on both.  If you are using a Makefile you need to enter the full path and name of that Makefile here as well, but the creation and use of the Makefile is beyond the scope of this example.  Lastly choose the server that this platform will reside upon.  When you are finished, double check the screen and then click on Save.  The Verify step should execute flawlessly and when it does, your Aegir Remote Slave will be complete and ready to accept sites.</p>

<p>(8) Lather, rinse and repeat for each Aegir Remote Slave.</p>

<h2>Creating sites on the remote</h2>

<p>The only difference you will notice when creating a new site under Aegir will be the choice of platform.  The Create Site screen is quite self explanatory, but the main thing is to select the Install Profile that you  require and then the list of Platforms that support that install profile will be populated.</p>

<p>As usual, Aegir makes it all faster and easier than you expect.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-397.html?destination=node%2F446%23comment-form">Login</a> or <a href="../../../../../user/register/index-397.html?destination=node%2F446%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../446/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-37" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/web-clusters/index.html">Web clusters</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h1>Cluster module</h1>

<p>The cluster module is a simplified solution for maintaining platforms across multiple web servers.  A cluster server node does not require a physical machine to be present on the network.  Simply create web servers as usual and create a server node that has "Cluster" selected under the web field set of the server node add form.  Select the servers that should be part of the new web cluster by clicking the check box next to each web server in the "Servers" section.</p>

<p>The cluster module will rsync the platforms between each web server and keep them up to date.</p>

<h1>Pack module</h1>

<p>A Pack consists of a single server node that is specified as "pack" and any number of server nodes specified as "apache" or "nginx".  The main difference between the Pack functionality and Web Cluster functionality is that Aegir rsync's configuration (Apache &amp; Nginx) to "all" nodes in the Pack and rysnc's the platform and site code to only the "master" node in the Pack.  All other "slave" nodes will see the platform and site code via NFS.</p>

<p><strong>Configuring the Pack server node:</strong></p>

<p>The "pack" server node will not be used by Aegir to physically deploy sites or platforms on, so consider it more of a 'virtual server group' for logistical purposes only.  When creating the pack node, you do not need to supply a valid Server hostname or IP address, so choose a naming convention that makes sense in your environment.</p>

<p>Next, select the "pack" radio button option under the web configuration when creating or editing the server node, in order to designate this server node as the "pack" server.</p>

<p>Now select the "Master" server from the list of Master servers.  The Master server will be the server node that Aegir rsync's the platform and site to. Typically, you would choose the Aegir server itself as the 'master'.</p>

<p>Finally, select the "Slave" servers from the list of Slave servers.  The Slave servers will have the Apache or Nginx config rsync'd to them but not the platform or site code, since those will be available to all Slave servers via the NFS share.</p>

<p><strong>Configuring the Web server nodes (Master and Slaves):</strong></p>

<p>Configure all web server nodes using <a href="../../../../396/index.html">these instructions</a>. Take care to ensure the 'aegir' user and group on your NFS client machines, have the same UID/GID as that of the NFS server, or else you may run into permissions issues with NFS.</p>

<p>Then mount the files on the remote server.</p>

<p>On the NFS server:</p>

<pre><code>sudo apt-get install nfs-kernel-server
echo "/var/aegir/platforms    10.0.0.0/24(rw,no_subtree_check)" &gt;&gt; /etc/exports
sudo service nfs-kernel-server reload
</code></pre>

<p>(Replace the subnet here or add specific /32 hosts as necessary for your environment)</p>

<p>Then on the web servers (Master, if it wasn't also the NFS server, and the Slaves):</p>

<pre><code>sudo apt-get install nfs-client
sudo mount 10.0.0.1:/var/aegir/platforms /var/aegir/platforms
</code></pre>

<p>(Replace the NFS server's IP here with that of your master server/Aegir server)</p>

<p>Add this to your fstab on the servers that mount the NFS share, so that the share is mounted on boot:</p>

<pre><code>10.0.0.1:/var/aegir/platforms /var/aegir/platforms nfs rw 0 0
</code></pre>

<p><strong>Creating a Platform on a Pack:</strong></p>

<p>When configuring a Platform to be deployed on a Pack, choose the "Pack" server node from the Web server radio group during the Platform node creation. Then you choose this Platform as usual when adding a site, and that site will be served from any servers within the Pack.</p>

<p><strong>Caveats</strong></p>

<p>Relying on an NFS share to serve your entire /var/aegir/platforms can be a single point of failure if the NFS share becomes unavailable. You may want to look into providing some sort of failover for NFS (google for things like DRBD and Heartbeat), or using some other form of redundancy for your NFS (Netapp filer clusters etc)</p>

<p>There have also been reports of issues with MySQL GRANT statements not being provided to all webservers in the pack - especially where the master server is <em>not</em> the Aegir hostmaster server. This issue is ongoing - see the Talk page here or <a href="http://drupal.org/node/1555398">this ticket</a></p>

<p>Also attached is an example diagram of a Pack cluster known to be functioning in production (with an optional MySQL-MMM cluster out of scope for this documentation), which may help you visualise the Pack and how it can be put together.</p><div class="itu-attachments"><table class="itu-attachment-list withoutstats sticky-enabled" id="attachments">
 <thead><tr><th class="preview">Preview</th><th class="file">Attachment</th><th class="size">Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td class="mime mime-png"><div  class="form-item" id="">
    <div class="itu-attachment-thumb"><a href="../../../../../sites/community.aegirproject.org/files/aegir_pack/index.png" title="aegir_pack.png"><img src="../../../../../sites/community.aegirproject.org/files/imagecache/AttachmentThumbnail/aegir_pack/index.png" alt="aegir_pack.png" title="aegir_pack.png" width="60" height="60" class="imagecache imagecache-AttachmentThumbnail"/></a></div>  </div>
</td><td class="file"><a href="../../../../../sites/community.aegirproject.org/files/aegir_pack/index.png">aegir_pack.png</a></td><td class="size">41.2 KB</td> </tr>
</tbody>
</table>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-308.html?destination=node%2F37%23comment-form">Login</a> or <a href="../../../../../user/register/index-308.html?destination=node%2F37%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../37/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-388" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../388/index.html">Setting Up Varnish &amp; Memcache with Aegir</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_3 first last"><a href="../../../../../taxonomy/term/3/index.html" rel="tag" title="This level is for users, who are using hosted Aegir version, without access to the server root, with features limited to those allowed by their host, and often with Aegir UI changed/simplified.">Hosted</a></li>
</ul></div><p>I had the hardest time finding resources &amp; documentation on how to get this configured properly so I am adding this to the documentation for those of you who may need it.</p>

<p>A couple of notes:
I am using Ubuntu 10.04 LTS.
I set my apache to port 8082 because there was a conflict on port 8080 on my system.
You should make a copy of each file before editing it.
Memcache settings are drupal 7.</p>

<h2>Varnish</h2>

<p>Setting up varnish isn't too hard but it could end up being kind of tedious if you configure something incorrectly &amp; you have alot of sites.</p>

<p>First you install it
<code>sudo apt-get install varnish</code></p>

<p>Then you have to go to configure it. I use vim.
<code>sudo vim /etc/varnish/default.vcl</code></p>

<p>These are my settings.</p>

<pre>
backend default {
    .host = "127.0.0.1";
    .port = "8082";
    .connect_timeout = 600s;
    .first_byte_timeout = 600s;
    .between_bytes_timeout = 600s;
}
sub vcl_recv {
  // Remove has_js and Google Analytics __* cookies.
  set req.http.Cookie = regsuball(req.http.Cookie, "(^|;\s*)(__[a-z]+|has_js)=[^;]*", "");
  // Remove a ";" prefix, if present.
  set req.http.Cookie = regsub(req.http.Cookie, "^;\s*", "");
  // Remove empty cookies.
  if (req.http.Cookie ~ "^\s*$") {
    unset req.http.Cookie;
  }
 

// Skip the Varnish cache for install, update, and cron
  if (req.url ~ "install\.php|update\.php|cron\.php") {
    return (pass);
  }
 

// Cache all requests by default, overriding the
  // standard Varnish behavior.
  // if (req.request == "GET" || req.request == "HEAD") {
  //   return (lookup);
  // }
}
sub vcl_hash {
  if (req.http.Cookie) {
    set req.hash += req.http.Cookie;
  }
}

</pre>

<p>Now you have to edit /etc/default/varnish
<code>sudo vim /etc/default/varnish</code></p>

<p>Here are my settings</p>

<pre>
# Should we start varnishd at boot?  Set to "yes" to enable.
START=yes
# Maximum number of open files (for ulimit -n)
NFILES=$(ulimit -n)
#Malloc size depend on your memory server
DAEMON_OPTS="-a :80 \
             -T localhost:6082 \
             -f /etc/varnish/default.vcl \
             -S /etc/varnish/secret \
             -s malloc,512M \
             -u www-data \
             -g www-data"
</pre>

<p>Now we have to configure apache's listening ports</p>

<p><code>sudo vim /etc/apache2/ports.conf</code></p>

<p>change</p>

<pre>
NameVirtualHost *:80
Listen 80
</pre>

<p>So that it looks like this</p>

<pre>
NameVirtualHost *:8082
Listen 8082
</pre>

<p>Start varnish
<code>services varnish start</code></p>

<p>Now login to aegir
Edit your server &amp; change the port from 80 to 8082</p>

<p>Aegir will re-verify the server, as well as all platforms &amp; sites on the server.</p>

<p>If that doesnt work, you need to go to 
/var/aegir/config/server_master/apache/vhost.d 
and edit all of your virtual hosts so that the port shows 8082 instead of 80
then do the same thing with
/var/aegir/config/server_master/apache.conf
Reverify your server.</p>

<p>Now add this to the local.settings.php of the sites that you want to leverage varnish</p>

<pre>
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000"># Tell Drupal it's behind a proxy<br /></span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'reverse_proxy'</span><span style="color: #007700">] = </span><span style="color: #0000BB">TRUE</span><span style="color: #007700">;<br /></span><span style="color: #FF8000"># Tell Drupal what addresses the proxy server(s) use<br /></span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'reverse_proxy_addresses'</span><span style="color: #007700">] = array(</span><span style="color: #DD0000">'127.0.0.1'</span><span style="color: #007700">,</span><span style="color: #DD0000">'your-ip-address-here'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000"># Bypass Drupal bootstrap for anonymous users so that Drupal sets max-age &amp;gt; 0<br /></span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'page_cache_invoke_hooks'</span><span style="color: #007700">] = </span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
</pre>

<h2>Memcache</h2>

<p>There is hardly any current documentation for setting up memcache on D7, especially not for aegir.</p>

<p>FIrst you install memcache &amp; its dependencies
Download &amp; install memcache module into the platform of the site/sites in which you will be using memcache</p>

<p>Then you have to edit 
/etc/default/memcached
<code>sudo vim ./etc/init.d/memcached</code></p>

<p>Here are my settings</p>

<pre>
#! /bin/sh
#

PORT=11211
USER=nobody
MAXCONN=1024
OPTIONS=""
DAEMON=/usr/bin/memcached

RETVAL=0
prog="memcached"

start_instance() {
        echo -n $"Starting $prog ($1): "
        start-stop-daemon --start --quiet --pidfile /var/run/memcached/memcached.$1.pid --exec $DAEMON -- -d -p $PORT -u $USER  -m $2 -c $MAXCONN -P /var/run/memcached/memcached.$1.pid $OPTIONS
        RETVAL=$?
        echo
        [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/memcached.$1
        PORT=`expr $PORT + 1`
}

stop_instance() {
        echo -n $"Stopping $prog ($1): "
        start-stop-daemon --stop --quiet --oknodo --pidfile /var/run/memcached/memcached.$1.pid --exec $DAEMON 
        RETVAL=$?
        echo
        if [ $RETVAL -eq 0 ] ; then
            rm -f /var/lock/memcached.$1
            rm -f /var/run/memcached/memcached.$1.pid
        fi
}
start () {
        # insure that /var/run/memcached has proper permissions
        mkdir -p /var/run/memcached
        if [ "`stat -c %U /var/run/memcached`" != "$USER" ]; then
                chown $USER /var/run/memcached
        fi

        start_instance default 64;
        start_instance block 16;
        start_instance content 128;
        start_instance filter 128;
        start_instance form 32;
        start_instance menu 16;
        start_instance page 8;
        start_instance update 8;
        start_instance views 8;
        start_instance path 8;
        start_instance field 8;
        start_instance rules 8;
        start_instance token 8;
        start_instance image 8;
        start_instance apachesolr 16;
}
stop () {
        stop_instance default;
        stop_instance block;
        stop_instance content;
        stop_instance filter;
        stop_instance form;
        stop_instance menu;
        stop_instance page;
        stop_instance update;
        stop_instance views;
        stop_instance path;
        stop_instance field;
        stop_instance rules;
        stop_instance token;
        stop_instance image;
        stop_instance apachesolr;
}

restart () {
        stop
        start
}

# See how we were called.
case "$1" in
  start)
        start
        ;;
  stop)
        stop
        ;;
  status)
        status memcached
        ;;
  restart|reload|force-reload)
        restart
        ;;
  *)
        echo $"Usage: $0 {start|stop|status|restart|reload|force-reload}"
        exit 1
esac

exit $?
</pre>

<p>Start memcache
<code>sudo services memcached start</code>
If you see errors u may have an issue where a one line got split into two lines.
Check and make sure that none of your lines got broken off.</p>

<p>Place this code in your local.settings.php file inside your site folder</p>

<pre>
// the path to the core cache file
  include_once('./includes/cache.inc');
  // the path to the memcache cache file
  include_once('./sites/all/modules/memcache/memcache.inc');
  // make MemCacheDrupal the default cache class
  $conf['cache_default_class'] = 'MemCacheDrupal';
  
  # Key Prefix: edit this for multisite use.
  $conf['memcache_key_prefix'] = "$_SERVER[db_user]";
  
  $conf['memcache_servers'] = array(
  '127.0.0.1:11211' =&gt; 'default',
  '127.0.0.1:11212' =&gt; 'menu',
  '127.0.0.1:11213' =&gt; 'filter',
  '127.0.0.1:11214' =&gt; 'form',
  '127.0.0.1:11215' =&gt; 'block',
  '127.0.0.1:11216' =&gt; 'update',
  '127.0.0.1:11217' =&gt; 'views',
  '127.0.0.1:11218' =&gt; 'content',
  '127.0.0.1:11219' =&gt; 'apachesolr',
  '127.0.0.1:11220' =&gt; 'path',
  '127.0.0.1:11221' =&gt; 'field',
  '127.0.0.1:11222' =&gt; 'rules',
  '127.0.0.1:11223' =&gt; 'token',
  '127.0.0.1:11224' =&gt; 'image',    
);
$conf['memcache_bins'] = array(
  'cache' =&gt; 'default',
  'cache_menu'   =&gt; 'menu',
  'cache_filter' =&gt; 'filter',
  'cache_form'   =&gt; 'form',
  'cache_block'  =&gt; 'block',
  'cache_update' =&gt; 'update',
  'cache_views'  =&gt; 'views',
  'cache_views_data'  =&gt; 'views',
  'cache_content'  =&gt; 'content',
  'cache_apachesolr'  =&gt; 'apachesolr',
  'cache_path'  =&gt; 'path',
  'cache_field'  =&gt; 'field',
  'cache_rules'  =&gt; 'rules',
  'cache_token'  =&gt; 'token',
  'cache_image'  =&gt; 'image',
);
</pre>

<p>And that should be basically it.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-309.html?destination=node%2F388%23comment-form">Login</a> or <a href="../../../../../user/register/index-309.html?destination=node%2F388%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../388/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-427" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../427/index.html">Working as aegir user</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>It can be convenient to do stuff as the aegir user.
The default shell of the aegir user is /bin/false, so you have to make sure to use something more usable:</p>

<pre>
sudo su - aegir -s /bin/bash
</pre>

<p>GNU Screen is a super useful window manager for the console.  When launching screen you will usually get errors like</p>

<pre>
Cannot open your terminal '/dev/pts/6' - please check.
</pre>

<p>You can get around this by running</p>

<pre>
script /dev/null
</pre>

<p>All in all this works nicely:</p>

<pre>sudo su aegir -s /bin/bash -c "script -q /dev/null"</pre>

<p>It can be convenient to put it in a little script as <code>/usr/local/bin/suaegir</code></p>

<h2>Allowing other users besides root on your system to run commands as aegir</h2>

<p>If you wish to allow other users on your system to run commands as the aegir user using sudo, without allowing them to use sudo generally, you can add the following two lines to your /etc/sudoers file using visudo:</p>

<p><div class="codeblock"><code>User_Alias&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AEGIRUSERS = comma, separated, list, of, users<br />AEGIRUSERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL = (aegir) ALL</code></div></p>

<p>If you want to allow these users to use aegir without entering a password, simply change the second line to this:</p>

<p><div class="codeblock"><code>AEGIRUSERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL = (aegir) NOPASSWD:ALL</code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-402.html?destination=node%2F427%23comment-form">Login</a> or <a href="../../../../../user/register/index-402.html?destination=node%2F427%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../427/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-341" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../341/index.html">Adding apache config files</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>If you connect to your Hostmaster server and look at
~aegir/config/server_examplecom/apache.conf, you can see that this
file includes files from pre.d and post.d directories.  The includes
are done in the following order:</p>

<ol>
<li>pre.d</li>
<li>vhost.d</li>
<li>platform.d</li>
<li>post.d</li>
</ol>

<p>The earlier files take precendence over the later files for &lt;VirtualHost&gt; blocks. The latter files take precedence over earlier files for &lt;Directory&gt; blocks.</p>

<p>If we wanted to add a phpini directive that can only be set on a <a href="http://us2.php.net/manual/en/configuration.changes.modes.php">PHP_INI_PERDIR</a>-for
example, <a href="http://us2.php.net/manual/en/ini.core.php">post_max_size</a>-we
could create a file called upload.conf and add it either to pre.d or
post.d.</p>

<p>Here's a possible upload.conf:
<div class="codeblock"><code>####################################<br /># Custom Server-wide configuration #<br />####################################<br /># our php.ini sets memory limit to 96M<br /># <br /># post_max_size should also be less than memory_limit.<br /># <a href="http://us2.php.net/manual/en/ini.core.php#ini.post-max-size<br />#" title="http://us2.php.net/manual/en/ini.core.php#ini.post-max-size<br />#">http://us2.php.net/manual/en/ini.core.php#ini.post-max-size<br />#</a> <br />php_value post_max_size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 90M<br />php_value upload_max_filesize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 85M</code></div>
If we put upload.conf in pre.d, our setting would always take
precedence, because it occurs higher up the chain of include files.</p>

<p>If we put upload.conf in post.d, our setting would be applied only
if the same setting is not defined higher up the chain by the
aegir code. As Antoine <a href="http://drupal.org/node/936720#comment-3552466">states here</a>
post.d is mainly useful when migrating in sites.  It would also be
useful if you wanted to set a server-wide default which could be
overridden on by a virtual host or platform config setting.</p>

<p>Related: <a href="../../../../73/index.html" title="http://community.aegirproject.org/node/73">http://community.aegirproject.org/node/73</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-403.html?destination=node%2F341%23comment-form">Login</a> or <a href="../../../../../user/register/index-403.html?destination=node%2F341%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../341/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-29" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/content/administrator/post-install-configuration/using-ssl/index.html">Using SSL</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h3>Introduction</h3>

<p>SSL support was significantly improved in Aegir 0.4 alpha9 and subsequent releases have further refined the SSL functionality. Here are the current steps to configure SSL support in Aegir and apply it to your web sites.</p>

<h3>Prepare Your Server</h3>

<p><OL>
<LI>Make sure port 443 is open for SSL traffic.
</li><LI>From the command line, install SSL software for your web server (e.g. on Debian/Ubuntu you can use <code>sudo apt-get install openssl</code>).</li>
<LI>Enable SSL support (e.g. <code>sudo a2enmod ssl</code>).  You will need to restart Apache at this point.
</li></ol></p>

<h3>Enable SSL Support in Aegir</h3>

<p><OL>
<LI>You have to enable SSL support in Aegir as it is off by default.  Assuming the URL of your Aegir front end is aegir.example.com, browse to aegir.example.com/admin/hosting/features 
<img src="../../../../../sites/community.aegirproject.org/files/features-page/index.png" alt="how to get to the Aegir features page" />
</li><LI>Click on Experimental to reveal experimental features <img src="../../../../../sites/community.aegirproject.org/files/ssl-support/index.png" alt="experimental features of Aegir" />
</li><LI>Check SSL support
</li><LI>Click Save configuration
</li></ol></p>

<h3>Configure Your Aegir Server</h3>

<p><OL>
<LI>Click on the Servers tab
</li><LI>Click on the server that you wish to enable SSL support
</li><LI>Click Edit to change the server configuration
</li><LI>Click apache_ssl (this will reveal an additional field: SSL port, which should be already populated with 443).<img src="../../../../../sites/community.aegirproject.org/files/enable-ssl-on-server/index.png" alt="enabling SSL on your Aegir server" />
</li><LI>You may also have to add an IP address to the IP addresses field. The field is used as an "IP pool" for SSL certificates: IPs are assigned to SSL sites when they are created on a first come, first served basis. (Note that there are known issues with this process, see <a href="http://drupal.org/node/1126640">issue #1126640</a> for details.)
</li><LI>Click Save - this will start various tasks beginning with a verify task on the server followed by verify tasks on all platforms that are associated with that server
</li><LI>If all goes well you will see the following changes in your Aegir <a href="http://groups.drupal.org/node/93849">file system structure</a>:
a new <code>/var/aegir/config/ssl.d</code> directory and a 
new <code>/var/aegir/config/server_master/ssl.d</code> directory.
</li></ol></p>

<p>The <code>/var/aegir/config/ssl.d</code> directory is where you will be able to manipulate SSL keys and certificates, for example by importing commercial SSL certificates or generating a new key. Do <em>not</em> manually edit the <code>/var/aegir/config/server_master/ssl.d</code> directory as changes to that directory will be overwritten when the server or site are verified.</p>

<h3>Configure Your Aegir Site</h3>

<p><OL>
<LI>You must enable SSL on your sites that are on those platforms associated with the server.  Browse to aegir.example.com/hosting/c/example.com
</li><LI>Click Edit to change the site configuration
</li><LI>Choose the type of Encryption required and the Encryption key (see the explanatory notes below each option). <img src="../../../../../sites/community.aegirproject.org/files/site-ssl-configuration_0/index.png" alt="configuring an Aegir site for SSL" /> <em>NOTE:,</em> Alternatively, you may specify a directory under /var/aegir/config/server_master/ssl.d where your own certificate and key is to be stored (see Apache notes below).
</li><LI>Click Save.  Aegir will then generate a certificate and private key for your web site and insert these into a new VirtualHost directive in your vhost file.  (This file is typically at /config/server_master/apache/vhost.d/example.com).
</li><LI>If all goes well the VirtualHost directive will now have these important elements:</li></ol></p>

<p><div class="codeblock"><code>&lt;VirtualHost xx.xx.xx.xx:443&gt; # &lt;-- where xx.xx.xx.xx is an IP address dedicated for SSL access to your site and 443 is the port number<br />&nbsp;&nbsp;&nbsp; ....<br /><br />&nbsp;&nbsp;&nbsp; # Enable SSL handling.<br />&nbsp;&nbsp;&nbsp; SSLEngine on<br /><br />&nbsp;&nbsp;&nbsp; SSLCertificateFile /var/aegir/config/server_master/ssl.d/example.com/openssl.crt<br />&nbsp;&nbsp;&nbsp; SSLCertificateKeyFile /var/aegir/config/server_master/ssl.d/example.com/openssl.key</code></div></p>

<p>Now, when you navigate to <a href="https://example.com/" title="https://example.com">https://example.com</a> you should see that your site is SSL enabled. It will, however, generate warnings in your browsers because it is a self-signed certificates. See below for how to use commercial certificates to remove this warning.
</p>

<h2>Notes for Apache users with Commercial Certificate File(s)</h2>

<p>If you wish to use your own commercial certificate and key you will need to do the following:</p>

<p><OL>
<LI>Follow the directions above, using the "Generate new encryption key" option and using your site's domain name for the "New encryption key". This will create a site directory under <code>/var/aegir/config/ssl.d/example.com</code>. With this step, you have created a self-signed certificate, and your site is now configured to use it.
</li><LI>This generated a 2048 bit RSA key for you along with a CSR (Certificate Signing Request). If you prefer to generate your own RSA key, replace the files (<code>openssl.key</code> and <code>openssl.csr</code>) in the <code>/var/aegir/config/ssl.d/example.com</code> directory with your RSA key and associated CSR.
</li><LI>Copy and paste the <code>.csr</code> file into the form for the issuing Certificate 
Authority (CA) to create your certificate.
</li><LI>When your certificate has been generated, download the files from the issuing authority and place in your temporary folder on your PC. You may have more than one .crt files, in this case you have a "bundle" or what we call a "certificate chain" that you need to add in aegir (see below).
</li><LI>Transfer all the files to /var/aegir/config/ssl.d/example.com. Rename the site .crt file to openssl.crt. If you have a certificate chain, install it in <code>openssl_chain.crt</code>. You should have at least three files in the directory (<code>openssl.crt</code>, <code>openssl.key</code>, <code>openssl.csr</code>, and optionnally <code>openssl_chain.crt</code>).
</li></ol></p>

<h3>Verify your site from aegir's frontend.</h3>

<p>You should now be able to access your site via https:// using your commercial certificate.</p>

<h2>Notes for Nginx users:</h2>

<p>It is recommended to allow Aegir to create a default self-signed certificate and key first, and then replace the contents of both files (not the files itself) with your real key and certificate. Any chained certificates (bundles) should be included in the same file, directly below your own certificate - there is no need for extra files/lines like it is for Apache configuration.</p><div class="itu-attachments"><table class="itu-attachment-list withoutstats sticky-enabled" id="attachments">
 <thead><tr><th class="preview">Preview</th><th class="file">Attachment</th><th class="size">Size</th> </tr></thead>
<tbody>
 <tr class="odd"><td class="mime mime-png"><div  class="form-item" id="">
    <div class="itu-attachment-thumb"><a href="../../../../../sites/community.aegirproject.org/files/site-ssl-configuration_0_0/index.png" title="site-ssl-configuration_0.png"><img src="../../../../../sites/community.aegirproject.org/files/imagecache/AttachmentThumbnail/site-ssl-configuration_0_0/index.png" alt="site-ssl-configuration_0.png" title="site-ssl-configuration_0.png" width="60" height="60" class="imagecache imagecache-AttachmentThumbnail"/></a></div>  </div>
</td><td class="file"><a href="../../../../../sites/community.aegirproject.org/files/site-ssl-configuration_0_0/index.png">site-ssl-configuration_0.png</a></td><td class="size">26.91 KB</td> </tr>
</tbody>
</table>
</div>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-299.html?destination=node%2F29%23comment-form">Login</a> or <a href="../../../../../user/register/index-299.html?destination=node%2F29%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../29/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-38" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../administrator/dns/index.html">DNS</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h1> Debian/Ubuntu</h1>

<p>There is preliminary support for DNS in Aegir's backend that allows it to manage zonefiles dynamically when sites are created. There are still a few major bits missing (described in <a href="http://drupal.org/node/922280">this meta-ticket</a>) so we generally recommend people use the <a href="../../../../../dnswildcard/index.html">wildcard approach</a> for now.</p>

<p>That said, while perhaps not yet ready for production use, Aegir's DNS functionality can be quite useful for local development environments. If you run Aegir locally, you're probably in the habit of hacking <em>/etc/hosts</em> regularly, or if you're more adventurous, you've set up a local DNS forwarder, such as dnsmasq. With Aegir's DNS feature, you can avoid this hassle, and let Aegir handle it transparently.</p>

<p>While Aegir supports both BIND and dnsmasq, this documentation will focus on the former. The first step is to install BIND. On Debian-based distros, this will look like:
<div class="codeblock"><code>apt-get install bind9</code></div></p>

<p>Next we need to allow the <em>aegir</em> user to run <strong>rndc</strong> (the name server control utility). On recent Debian systems, this will involve editing <em>/etc/sudoers.d/aegir</em>, whereas on older releases this would be <em>/etc/sudoers</em>. Modify the aegir line to read:
<div class="codeblock"><code>aegir ALL=NOPASSWD: /usr/sbin/apache2ctl, /usr/sbin/rndc</code></div></p>

<p>Then we need to make sure the <em>bind</em> user has access to read Aegir's files, so we'll add <em>bind</em> to the <em>aegir</em> group:
<div class="codeblock"><code>adduser bind aegir</code></div></p>

<p>We're now ready to activate the feature in Aegir's frontend. Go to Hosting &gt;&gt; Features (<em>admin/hosting/features</em>) and select "DNS Support" under the "Experimental" fieldset, and save the configuration.</p>

<p>Finally, we need to activate DNS on the Aegir server. Visit the server node (<em>hosting/c/server_master</em>) and click the edit tab (which should bring you to <em>node/2/edit</em>). Then under "DNS Service", select "Bind" and then save.</p>

<p>This should trigger a verify of the server (and then probably the platforms on it too), after which Aegir will be managing your local BIND server, and it's zonefile(s). If you have installed Aegir in /var/aegir, put this line in the file <em>/etc/bind/named.conf.local</em>:
<div class="codeblock"><code>include &quot;/var/aegir/config/bind.conf&quot;;</code></div></p>

<p>Aegir is now a full-fledged DNS server that you can use to resolve addresses locally. This can be accomplished on Debian-like systems by editing <em>/etc/resolv.conf</em> to include "nameserver 127.0.0.1". If you're running Aegir in a VM, you can just point this to the address of the virtual machine.</p>

<h1>CentOS/RHEL</h1>

<p>You need to have a working DNS/bind/named server for AEgir to take control of. What follows is rough documentation to reach that stage. It is currently <em>UNTESTED</em> in a production environment.
<div class="codeblock"><code>yum -y install bind-chroot bind-utils bind-libs bind<br />chkconfig named on<br />ln -s /var/named/chroot/var/named/named.conf /etc/named.conf<br />cat &gt;&gt; /etc/named.conf &lt;&lt; EOF<br />controls {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inet 127.0.0.1 allow {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; localnets;<br />} keys {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rndckey;<br />};<br />};<br />options {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listen-on port 53 { any; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; listen-on-v6 port 53 { ::1; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; directory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;/var/named&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dump-file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;/var/named/data/cache_dump.db&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; statistics-file &quot;/var/named/data/named_stats.txt&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Those options should be used carefully because they disable port<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // randomization<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // query-source&nbsp;&nbsp;&nbsp; port 53;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // query-source-v6 port 53;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; forwarders { 192.168.122.1; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; forward only;<br />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allow-query&nbsp;&nbsp;&nbsp;&nbsp; { localhost; };<br />//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; allow-query-cache { localhost; };<br />};<br /><br />logging {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; channel default_debug {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file &quot;data/named.run&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; severity dynamic;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br />};<br /><br />view localhost_resolver {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; match-clients&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { any; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; match-destinations { any; };<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recursion yes;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include &quot;/etc/named.rfc1912.zones&quot;;<br /><br />&nbsp;&nbsp;&nbsp; // Add local zone definitions here.<br /><br />&nbsp;&nbsp;&nbsp; include &quot;/var/aegir/config/bind.conf&quot;;<br />};<br /><br />include &quot;/etc/rndc.key&quot;;<br />EOF<br />service named start</code></div></p>

<h1>Additional Notes</h1>

<p>Additional documentation can be found in the Provision DNS module: <a href="http://drupalcode.org/project/provision.git/blob/HEAD:/dns/NOTES" title="http://drupalcode.org/project/provision.git/blob/HEAD:/dns/NOTES">http://drupalcode.org/project/provision.git/blob/HEAD:/dns/NOTES</a>.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-404.html?destination=node%2F38%23comment-form">Login</a> or <a href="../../../../../user/register/index-404.html?destination=node%2F38%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../38/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-285" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../dnswildcard/index.html">DNS Wildcard Configuration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <h4>Why run a wildcard DNS server?</h4>

<p>A wildcard DNS setup lets you automatically have subdomains for a given domain. For example, say you own the domain widgets.com and you want to setup an unlimited number of subdomains like dev.widgets.com, test.widgets.com, customers.widgets.com, etc.... Typically you would have to set these all up individually. A wildcard DNS can let you bypass a lot of configuration.  In a development environment it can let you setup any number of test/development sites very quickly and easily.  Drupal developers in particular can leverage Drupal's multisite installation feature to setup lots of sites for development or production very quickly.</p>

<h4>Creating a DNS wildcard with hosted DNS</h4>

<p>Many of the popular domain registration companies allow you to manage your DNS records through a web interface. If you have access to such a facility, adding a DNS wildcard is easy: you just create an A record called '*', pointing to your server's IP address.</p>

<p>For convenience, here are instructions for some popular hosting providers: <a href="http://community.godaddy.com/groups/domains-management-and-services/forum/topic/dns-wildcards/">GoDaddy</a>, <a href="http://www.hosting.com/support/cpanel/dns/wildcard">hosting.com</a> (which uses the popular cPanel system) and <a href="http://www.123-support.co.uk/support/answers/how-do-i-change-my-dns-settings-279/">123-reg.co.uk</a>. It is likely that your host will have a similar system to one of these.</p>

<h4>How to configure DNS wildcards on your own server</h4>

<h4><a href="#debian">  Ubuntu/Debian  </a></h4>

<h4><a href="#osx"> OS X Snow Leopard </a></h4>

<h3 id="debian">Setting up a Wildcard DNS configuration on Ubuntu/Debian</h3>

<h4>Overview of Steps on Ubuntu/Debian</h4>

<p>I. Install Bind 9
II. Add a zone to /etc/bind/named.conf.local. Check the syntax  of named.conf.local with named-checkconf
III. Add a zone file &amp; Check the syntax  of  your zone files for errors with named-checkzone
IV.  Edit /etc/resolv.conf
V. Start up Bind 
VI.  Check setup with dig 
VII. Troubleshoot if needed</p>

<h4>I. Install Bind 9</h4>

<p><div class="codeblock"><code>$ sudo apt-get install bind9</code></div></p>

<h4>II. Edit /etc/bind/named.conf.local to add a zone.</h4>

<p> We need to add a zone to /etc/bind/named.conf.local. A zone is a record for a domain. In this case we'll use a fake domain for development purposes. Our domain can be called  anything. Let's call it mydev. (I was really tempted to call the domain bullshit - would have been great for screencasts). So at a shell prompt do:</p>

<p><div class="codeblock"><code>$ sudo nano /etc/bind/named.conf.local</code></div></p>

<p> Add this to the end of the file:</p>

<p><div class="codeblock"><code>zone &quot;mydev&quot; {<br /> type master;<br />&nbsp;&nbsp; file &quot;/etc/bind/db.mydev&quot;;<br />};</code></div></p>

<p> Save the file with Control - O  and enter.  Exit from nano with Control X.</p>

<p>Check the syntax of the file as follows: </p>

<p><div class="codeblock"><code>$ named-checkconf /etc/bind/named.conf.local </code></div></p>

<p> If the file is syntactically correct the shell prompt will return nothing. If there is an error - make sure you did not miss a quote or semicolon and recheck the file.</p>

<h4>III. Add a zone file  &amp;  Check the syntax  of  your zone files for errors with named-checkzone </h4>

<p><div class="codeblock"><code>$ sudo nano /etc/bind/db.mydev</code></div></p>

<p>Add this to the file replacing 10.0.2.15 with your IP address</p>

<p><div class="codeblock"><code>mydev. 86400 IN SOA mydev. hostmaster.mydev. (<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20091028 ; serial yyyy-mm-dd<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10800; refresh every 15 min<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3600; retry every hour<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3600000; expire after 1 month +<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400 ); min ttl of 1 day<br />&nbsp; IN NS mydev. <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN MX 10 mydev.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN A 10.0.2.15<br />*.mydev. IN A 10.0.2.15</code></div></p>

<p> Save the file with Control - O  and enter.  Exit from nano with Control X. Check the syntax with the following:</p>

<p><div class="codeblock"><code>$ named-checkzone mydev /etc/bind/db.mydev </code></div></p>

<p> If the syntax of the file is correct you should see something like: </p>

<p><div class="codeblock"><code>zone mydev/IN: loaded serial 20091028<br />OK</code></div></p>

<p> If not review the file for errors. In particular whenever referring to a domain, it must end in a  .  , thus  mydev.  </p>

<h4>IV.  Edit /etc/resolv.conf</h4>

<p>resolv.conf tells applications like browsers where to look for DNS info. By default it may have your ISPs info. We need to tell it to check our local DNS server first then the ISP. </p>

<p><div class="codeblock"><code>$ sudo nano /etc/resolv.conf</code></div></p>

<p>Add/change the following</p>

<p><div class="codeblock"><code>domain mydev<br />search mydev<br />nameserver 127.0.0.1<br />nameserver (your isp nameserver or open dns)</code></div></p>

<p>If you are receiving an IP address via DHCP then you need to edit /etc/dhcp3/dhclient.conf too. </p>

<p><div class="codeblock"><code>$ sudo nano&nbsp; /etc/dhcp3/dhclient.conf</code></div></p>

<p>Look for the lines send host-name,  supersede domain-name,  and prepend domain-name-servers  and set them as follows (and make sure they are uncommented ) :</p>

<p><div class="codeblock"><code>send host-name &quot;mydev&quot;;<br />supersede domain-name &quot;mydev&quot;;<br />prepend domain-name-servers 127.0.0.1;</code></div>
<div class="codeblock"><code>sudo dhclient</code></div></p>

<p>Whew! Almost there.</p>

<h4>V. Start up Bind (or Restart) </h4>

<p><div class="codeblock"><code>$ sudo /etc/init.d/bind9 restart </code></div></p>

<h4> VI.  Check setup with ping and dig </h4>

<p><div class="codeblock"><code>$&nbsp; ping testing.mydev<br />PING testing.mydev (10.0.2.15) 56(84) bytes of data.<br />64 bytes from ubuntu.local (10.0.2.15): icmp_seq=1 ttl=64 time=0.041 ms<br />64 bytes from ubuntu.local (10.0.2.15): icmp_seq=2 ttl=64 time=0.039 ms<br />64 bytes from ubuntu.local (10.0.2.15): icmp_seq=3 ttl=64 time=0.0</code></div></p>

<p> If ping works then you should be good to go.  If not try dig and part V. To stop the ping action press [Ctrl]+[c].</p>

<h4>VII. Troubleshoot  </h4>

<p>I found the section on Troubleshooting Bind in O'Reilly's  "Linux System Administration" helpful. Fortunately, this part of the book is viewable on Google books as of this writing (10/29/2009): <a href="http://books.google.com/books?id=-jYe2k1p5tIC&amp;lpg=PP1&amp;dq=Linux%20System%20Administration&amp;pg=PA66#v=onepage&amp;q=&amp;f=false" title="http://books.google.com/books?id=-jYe2k1p5tIC&amp;lpg=PP1&amp;dq=Linux%20System%20Administration&amp;pg=PA66#v=onepage&amp;q=&amp;f=false">http://books.google.com/books?id=-jYe2k1p5tIC&amp;lpg=PP1&amp;dq=Linux%20System%...</a> .  See page 66 </p>

<h3 id="osx">Getting a Wildcard DNS running on OSX Snow Leopard</h3>

<p>Note: it took me several tries to get this working. If you are new to DNS be patient with yourself - you'll get it, but may take a few tries. </p>

<p>In this example I will concentrate on setting a development environment with OSX using wildcard DNS</p>

<h3>Overview of Steps</h3>

<p>I. Edit /etc/named.conf to add a zone.<br />
II. Add a zone file at /var/named/
III. Check the syntax  of named.conf and your zone files for errors
IV.  Edit /etc/resolv.conf
V. Set your computers network settings to use 127.0.0.1 as a name server
VI. Start up Bind 
VII.  Check setup with dig 
VIII. Reboot if needed</p>

<h4>Before we start a few more notes.  </h4>

<p>I tend to use the nano text editor to edit Unix configuration files you could use Emacs, VI, Textmate, BBEdit or the editor of your choice.  </p>

<p>Backup all these files we are editing so you can start over if you mess up. I didn't do this and it added more time to the project.
For example to backup /etc/named.conf  do:</p>

<p><div class="codeblock"><code>$ sudo cp /etc/named.conf /etc/named.conf.bck </code></div></p>

<p>Last, most of the files we need to edit are owned by root so you will need to use sudo to edit these files. If you get tired of typing sudo you can become root by doing this:</p>

<p><div class="codeblock"><code>$ sudo -s </code></div></p>

<p>Be careful when working as root or using sudo. You can mess up your system so make sure to backup. All example here are run as root.  </p>

<h4>I. Edit /etc/named.conf to add a zone</h4>

<p>We need to edit named.conf to add our zone.</p>

<p><div class="codeblock"><code>$ nano /etc/named.conf</code></div></p>

<p>I called my zone vmdev so I added this to named.conf </p>

<p><div class="codeblock"><code>zone &quot;vmdev&quot; IN {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type master;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file &quot;db.vmdev&quot;;<br />};</code></div></p>

<p>I added this right before the zone  0.0.127.inaddr.apra  and saved the file. So we told Bind to look in /var/named/db.vmdev for this zone.</p>

<h4>II. Add a zone file at /var/named/</h4>

<p><div class="codeblock"><code>$ nano /var/named/db.vmdev<br />vmdev. 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SOA&nbsp;&nbsp;&nbsp;&nbsp; vmdev. root.vmdev. (<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2008031801 ;&nbsp;&nbsp;&nbsp; Serial<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Refresh every 15 minutes<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3600&nbsp;&nbsp;&nbsp; ; Retry every hour<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3000000 ; Expire after a month+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400 ) ; Minimum ttl of 1 day<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vmdev.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10 vmdev.<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199<br />*.vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199</code></div></p>

<p>You can just copy this but be sure to change 192.168.0.199 to you Mac's IP address </p>

<h4>III. Check the syntax  of named.conf and your zone files for errors</h4>

<p>Run this to check your named.conf file:</p>

<p><div class="codeblock"><code>$ named-checkconf /etc/named.conf&nbsp; </code></div></p>

<p>If it returns nothing, your named.conf file is at least syntactically correct. If there is an error, then well you have to diagnose and fix the error.</p>

<p>Now run this to check your zone file:</p>

<p><div class="codeblock"><code>$ named-checkzone vmdev /var/named/db.vmdev </code></div></p>

<p>It should return something like this:</p>

<p><div class="codeblock"><code>zone vmdev/IN: loaded serial 2008031801<br />OK</code></div></p>

<p>If there are errors then diagnose and fix them.</p>

<h4>IV.  Edit /etc/resolv.conf</h4>

<p><div class="codeblock"><code>$ nano /etc/resolv.conf<br />#<br /># Mac OS X Notice<br />#<br /># This file is not used by the host name and address resolution<br /># or the DNS query routing mechanisms used by most processes on<br /># this Mac OS X system.<br />#<br /># This file is automatically generated.<br />#<br />domain vmdev.<br />nameserver 127.0.0.1<br />nameserver 192.168.0.1</code></div></p>

<h4>V. Set your computers network settings to use 127.0.0.1 as a name server  </h4>

<p>Do this at System Preferences -&gt; Network.
You may want to use your ISPs Name server as the second name server
</p>

<h4>VI. Start up Bind </h4>

<p><div class="codeblock"><code>$ launchctl load -w /System/Library/LaunchDaemons/org.isc.named.plist</code></div></p>

<p>The -w option tells OSX to enable Bind at startup</p>

<h4>VII.  Check setup with dig  </h4>

<p><div class="codeblock"><code>$ dig faker.vmdev&nbsp; </code></div></p>

<p>Should return something like this:</p>

<p><div class="codeblock"><code>; &lt;&lt;&gt;&gt; DiG 9.6.0-APPLE-P2 &lt;&lt;&gt;&gt; faker.vmdev<br />;; global options: +cmd<br />;; Got answer:<br />;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45640<br />;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1<br /><br />;; QUESTION SECTION:<br />;faker.vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A<br /><br />;; ANSWER SECTION:<br />faker.vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199<br /><br />;; AUTHORITY SECTION:<br />vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vmdev.<br /><br />;; ADDITIONAL SECTION:<br />vmdev.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7200&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 192.168.0.199<br /><br />;; Query time: 0 msec<br />;; SERVER: 127.0.0.1#53(127.0.0.1)<br />;; WHEN: Wed Oct 14 19:28:56 2009<br />;; MSG SIZE&nbsp; rcvd: 75 </code></div></p>

<p>The key here is  status NOERROR; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45640
If you get an error then check previous steps.</p>

<p>Now try:</p>

<p><div class="codeblock"><code>$ ping faker.vmdev</code></div></p>

<p>should return: </p>

<p><div class="codeblock"><code>PING test.vmdev (192.168.0.199): 56 data bytes<br />64 bytes from 192.168.0.199: icmp_seq=0 ttl=64 time=0.059 ms<br />64 bytes from 192.168.0.199: icmp_seq=1 ttl=64 time=0.087 ms</code></div></p>

<p>but if it does not got to VIII.</p>

<h4>VIII. Reboot if needed.</h4>

<p>I needed to reboot to get everything to take. Whoila! Have a cookie or something.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-58.html?destination=node%2F285%23comment-form">Login</a> or <a href="../../../../../user/register/index-58.html?destination=node%2F285%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-58.html?destination=node%2F285%23comment-form">Login</a> or <a href="../../../../../user/register/index-58.html?destination=node%2F285%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-39" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../39/index.html">Hooking into Aegir (site overrides)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Because Aegir is capable of installing, deploying and moving your sites around, it has to manage the various configuration files that keep your sites running.</p>

<p>These configurations include the standard Drupal settings.php for a site, .htaccess overrides for your HTTP server, as well as HTTP 'VirtualHost' or 'vhost' configuration files that tell your HTTP server where your site is.</p>

<p>A caveat of this system is that Aegir regularly re-generates these configuration files to apply new changes that have been made to the sites or platforms, as well as doing so as a safety mechanism to ensure these files are 'sane'.</p>

<p>For example, if you make a modification to a site vhost or settings.php and it breaks your site, running a 'Verify' task on the site should restore the file back to how it was.</p>

<p>However, sometimes it is necessary to add custom configuration or overrides to these files, and you can't do that if Aegir is regularly wiping your changes.</p>

<p>Fortunately, Aegir provides a series of hooks and inclusions for overriding or injecting customisations into these files safely and persistently.</p>

<p>This chapter shows you how each of these hooks or inclusions work.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-59.html?destination=node%2F39%23comment-form">Login</a> or <a href="../../../../../user/register/index-59.html?destination=node%2F39%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-59.html?destination=node%2F39%23comment-form">Login</a> or <a href="../../../../../user/register/index-59.html?destination=node%2F39%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-73" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../73/index.html">Injecting into server-wide vhosts</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Changing <em>maximum filesize upload</em> is common when setting up sites in Drupal. As described in <a href="../../../../990/index.html">Overriding site-specific PHP values</a> you can change this value for each site created with Ægir by adding a .drush.inc file in /var/aegir/.drush directory. But wouldn´t it be nice to be able to do it side-wide?</p>

<p>Here below is the same code from ergonlogic demonstrating how to create a <em>domainname</em>.drush.inc file using the domain name as a condition before the code injection.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">ergonlogiccom_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">== </span><span style="color: #DD0000">"ergonlogic.com"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"Overriding PHP file size values. See .drush/ergonlogiccom.drush.inc"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"php_value upload_max_filesize 100M"</span><span style="color: #007700">, </span><span style="color: #DD0000">"php_value post_max_size 200M"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>Apparently you can do this side-wide by omitting the IF statement and create a file with a .drush.inc extension.</p>

<p>For instance, you could create a file called <em>global_settings.drush.inc</em> and put in the following code:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">globalsettings_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"Overriding PHP file size values. See .drush/global_settings.drush.inc"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"php_value upload_max_filesize 100M"</span><span style="color: #007700">, </span><span style="color: #DD0000">"php_value post_max_size 200M"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; <br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
<em>* the closing ?&gt; syntax should not be used</em></p>

<p>Make sure you <strong>Verify</strong> your site after you create the file. Then scroll through the log and find the message you added in the code:</p>

<blockquote>Overriding PHP file size values. See .drush/global_settings.drush.inc</blockquote>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-60.html?destination=node%2F73%23comment-form">Login</a> or <a href="../../../../../user/register/index-60.html?destination=node%2F73%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-60.html?destination=node%2F73%23comment-form">Login</a> or <a href="../../../../../user/register/index-60.html?destination=node%2F73%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-72" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../72/index.html">Injecting into platform-wide vhosts (.htaccess)</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Using a .htaccess with an Allow Override all directive in Apache can be a major performance killer, because it requires Apache to stat each subdirectory of the codebase looking for overrides in .htaccess.</p>

<p>As a result, Aegir disables the reading of the Drupal .htaccess in the runtime environment.</p>

<p>This does not mean that the .htaccess is not needed. Instead, when you run the Verify task against a Platform, the .htaccess is studied by Aegir and its contents are copied into the platform-wide Apache vhost configuration, typically located in /var/aegir/config/server_master/apache/platform.d</p>

<p>Need to make a modification to the .htaccess? Simple: you can simply edit it in-place as you normally would, but you must re-Verify the platform in Aegir afterward, in order for those new or modified settings to be 'loaded in' to the platform vhost file.</p>

<p>The end result is improved performance for your sites, without losing any functionality, as you can still customise the .htaccess to your liking.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-61.html?destination=node%2F72%23comment-form">Login</a> or <a href="../../../../../user/register/index-61.html?destination=node%2F72%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-61.html?destination=node%2F72%23comment-form">Login</a> or <a href="../../../../../user/register/index-61.html?destination=node%2F72%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-70" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../70/index.html">Injecting into site vhosts</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Aegir provides some hook functions in its API, one of which allows you to inject extra configuration snippets into your Apache vhost files for sites.</p>

<h2>When would I want to do this?</h2>

<p>A good example for this is when you may need to inject a custom Rewrite rule that goes beyond what the Aegir Aliases 'redirection' feature provides.</p>

<p>Or, perhaps you have to inject some htpasswd mod_auth password protection for your site, or perhaps a CustomLog definition. The <a href="https://drupal.org/project/hosting_tasks_extra">http_basic_auth</a> module uses this. (<a href="http://drupalcode.org/project/hosting_tasks_extra.git/tree/HEAD:/http_basic_auth">code</a>)</p>

<p>Typically you'd just add what you need to the vhost file, but the problem is that Aegir manages these vhosts, and on every Verify task, will rewrite the config from a template, blowing away your changes in the process. Ouch!</p>

<p>Fortunately there is a very easy and elegant solution to this problem to save your configurations persistently across Verify tasks and the like, by means of invoking the Provision hook <code>provision_apache_vhost_config()</code>, or, if you are using Nginx, <code>provision_nginx_vhost_config()</code> (and just replace the below examples with 'nginx' instead of 'apache' where necessary). Below "mig5" is just an example, you can replace this with anything as drush looks for all *.drush.inc files in <code>~aegir/.drush</code></p>

<h2>A simple example</h2>

<p>In this example I'll inject a simple 'ErrorLog' apache definition into a vhost to save the site error logs to a file.</p>

<ol>
<li>Create a file in <code>~aegir/.drush</code> called <code>mig5.drush.inc</code>. (Choose <code>&lt;any&gt;</code> prefix for the file name <code>&lt;any&gt;.drush.inc</code>).  </li>
<li>Add this snippet of PHP to the file:
<div class="codeblock"><code> <br /> <span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">mig5_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; return </span><span style="color: #DD0000">"ErrorLog /var/aegir/" </span><span style="color: #007700">. </span><span style="color: #0000BB">$uri </span><span style="color: #007700">. </span><span style="color: #DD0000">".error.log"</span><span style="color: #007700">;<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
(Choose <code>&lt;any&gt;</code> prefix for the function name <code>&lt;any&gt;_provision_apache_vhost_config</code>).</li>
<li><code>drush cache-clear drush</code> </li>
<li>Install a site or verify an existing one</li>
</ol>

<p>Check your site's vhost config file (in <code>/var/aegir/config/server_master/apache/vhost.d/</code>) and you'll see the line has been injected into the '#Extra configuration' area of the vhost</p>

<p><div class="codeblock"><code>&lt;VirtualHost *:80&gt;<br /><br />&nbsp; DocumentRoot /var/aegir/hostmaster-HEAD <br />&nbsp;&nbsp;&nbsp; <br />&nbsp; ServerName 1.mig5-forge.net<br />&nbsp; SetEnv db_type&nbsp; mysqli<br />&nbsp; SetEnv db_name&nbsp; 1mig5forgenet<br />&nbsp; SetEnv db_user&nbsp; 1mig5forgenet<br />&nbsp; SetEnv db_passwd&nbsp; X7KzsFhxhp<br />&nbsp; SetEnv db_host&nbsp; tardis<br />&nbsp; SetEnv db_port&nbsp; 3306<br /><br /><br /><br /># Extra configuration from modules:<br />&nbsp; ErrorLog /var/aegir/1.mig5-forge.net.error.log<br />&nbsp;&nbsp;&nbsp; # Error handler for Drupal &gt; 4.6.7<br />&nbsp;&nbsp;&nbsp; &lt;Directory &quot;/var/aegir/hostmaster-HEAD/sites/1.mig5-forge.net/files&quot;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SetHandler This_is_a_Drupal_security_line_do_not_remove<br />&nbsp;&nbsp;&nbsp; &lt;/Directory&gt;<br /><br />&lt;/VirtualHost&gt;</code></div></p>

<p>It's that simple! You can see that via the hook, we pass $uri and the drush data to the function, allowing me to abstract the site url so that each site will get its own error log. You could do extra PHP conditionals to ensure certain data only gets inserted into certain sites of a specific name.</p>

<p>To inject multiple lines instead of one, use an array, i.e</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">mig5_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"ErrorLog /var/aegir/" </span><span style="color: #007700">. </span><span style="color: #0000BB">$uri </span><span style="color: #007700">. </span><span style="color: #DD0000">".error.log"</span><span style="color: #007700">, </span><span style="color: #DD0000">"LogLevel warn"</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>The key point of this is that the file <code>~aegir/.drush/mig5.drush.inc</code> file will never be touched by Aegir, so you can rest assured your changes will be respected.</p>

<p>If you want to only inject code into a specific site, wrap your code with an if statement, i.e
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">mig5_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">=== </span><span style="color: #DD0000">"&lt;site-name-in-aegir&gt;"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"ErrorLog /var/aegir/" </span><span style="color: #007700">. </span><span style="color: #0000BB">$uri </span><span style="color: #007700">. </span><span style="color: #DD0000">".error.log"</span><span style="color: #007700">, </span><span style="color: #DD0000">"LogLevel warn"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; }<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<h2>A more advanced example</h2>

<p>Managing multiple versions of a production site can be a tricky proposition, even in Aegir.  This is particularly true when you want to use the same canonical domain name to allow users to access one such site of your choosing at any given moment.  For instance, in Aegir I might have a site named <a href="http://www.example.com/" title="www.example.com">www.example.com</a> (with an alias of example.com,) and a couple of alternates with the site names of test1.example.com and test2.example.com.  If I suddenly decide that I want my primary domain to access test1.example.com, Aegir forces me into a tedious process that ultimately results in site downtime – I have to delete or migrate the existing <a href="http://www.example.com/" title="www.example.com">www.example.com</a> site to a new unused site name (or clone it to an unused site name, and delete the original) and then I have to migrate test1.example.com to the vacated site name <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  Alternatively, I could add the <a href="http://www.example.com/" title="www.example.com">www.example.com</a> and example.com aliases to test1.example.com but then my users would just be redirected to test1.example.com.</p>

<p>Given the way Aegir manages aliases, it would actually be easier to make this switch if the desired address was never used as a site name to begin with.  Instead of having the site name <a href="http://www.example.com/" title="www.example.com">www.example.com</a> alongside of the two other test sites, we might have live.example.com, with in-use aliases of <a href="http://www.example.com/" title="www.example.com">www.example.com</a> and example.com, and a rewrite instruction in the vhost that rewrites live.example.com to <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  If we could easily change the rewrite instructions in that vhost, all we would need to do is move the aliases from one site to the next in the GUI (with the requisite verify tasks executed on each site in question) in order to quickly change which site was being loaded at any given moment by <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  For example, if I wanted to move to test2.example.com, I would remove the <a href="http://www.example.com/" title="www.example.com">www.example.com</a> and example.com aliases from live.example.com and verify, add those aliases to test2.example.com and verify, and change my vhost so that test2 .example.com is rewritten as <a href="http://www.example.com/" title="www.example.com">www.example.com</a>.  Since as previously mentioned Aegir overwrites changes to the vhost during the verify process, the solution is to use the provision_apache_vhost_config hook in a drush.inc file to selectively add the rewrite information to the vhost when verifying the site that we want our canonical domain to refer to.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">aliasredirects_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// the uri to check here is the name of the site in Aegir<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #007700">if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">=== </span><span style="color: #DD0000">"test2.example.com"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"# Forces redirect to one uri"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"RewriteEngine On"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// if the host is not example.com <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"RewriteCond %{HTTP_HOST} !^example.com$ [NC]"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// rewrite to example.com with a 301 redirect<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">"RewriteRule ^(.*)$ http://example.com$1 [R=301,L]"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$rval</span><span style="color: #007700">[] = </span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return </span><span style="color: #0000BB">$rval</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp; }<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
When we want to switch again, say to test1.example.com, We could update the code to look for the test1.example.com uri.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-310.html?destination=node%2F70%23comment-form">Login</a> or <a href="../../../../../user/register/index-310.html?destination=node%2F70%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../70/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-990" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/overriding-site-specific-php-values/index.html">Overriding site-specific PHP values</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Sometimes it is useful to override certain PHP values on a per-site basis, but changes to <code>php.ini</code> are generally server-wide. Depending on the value you want to override, a couple of options present themselves.</p>

<p>First, let's consider where PHP values can be changed. <a href="http://www.php.net/manual/en/ini.list.php" title="http://www.php.net/manual/en/ini.list.php">http://www.php.net/manual/en/ini.list.php</a> lists <code>php.ini</code> directives, and under the "Changeable" column, indicates <a href="http://www.php.net/manual/en/configuration.changes.modes.php">where a configuration setting may be set</a>. If your value shows either <code>PHP_INI_USER</code> or <code>PHP_INI_ALL</code>, then the easiest way to change this value would be using <code>ini_set()</code> in a <code>local.settings.php</code>:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'memory_limit'</span><span style="color: #007700">, </span><span style="color: #DD0000">'128M'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>On the other hand, if the changes mode is either <code>PHP_INI_PERDIR</code> or <code>PHP_INI_SYSTEM</code>, <code>php_ini()</code> won't work. In this case, the solution is to inject the value into the vhost. Since vhosts are managed by Aegir, manually adding an override to <code>/var/aegir/config/server_master/apache/vhost.d/&lt;uri&gt;</code> would get blown away the next time that the site is verified.</p>

<p>As described in <a href="../../../../70/index.html">Injecting into site vhosts</a>, we can inject values into vhosts using a Drush hook. For example, to raise the file upload size limit on <a href="http://ergonlogic.com/" title="http://ergonlogic.com">http://ergonlogic.com</a>, I added the following code in <code>/var/aegir/.drush/ergonlogiccom.drush.inc</code>:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">ergonlogiccom_provision_apache_vhost_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp; if (</span><span style="color: #0000BB">$uri </span><span style="color: #007700">== </span><span style="color: #DD0000">"ergonlogic.com"</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"Overriding PHP file size values. See .drush/ergonlogiccom.drush.inc"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return array(</span><span style="color: #DD0000">"php_value upload_max_filesize 100M"</span><span style="color: #007700">, </span><span style="color: #DD0000">"php_value post_max_size 200M"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>This results in the insertion of the following lines into <code>/var/aegir/config/server_master/apache/vhost.d/ergonlogic.com</code>:
<div class="codeblock"><code>php_value upload_max_filesize 100M<br />php_value post_max_size 200M</code></div></p>

<p>Also, in the verify task log I get the following informative message:
<div class="codeblock"><code>Overriding PHP file size values. See .drush/ergonlogiccom.drush.inc</code></div></p>

<p>One challenge this technique may present is inspecting the values of the parameters passed into this function. It appears that the Hostmaster site doesn't get bootstrapped, and so common debugging tools (such as devel.module's <a href="http://api.drupal.org/api/devel/devel.module/function/dd/6">dd()</a>) aren't available. However <a href="http://api.drush.ws/api/function/drush_log/4.x">drush_log()</a> is, and when called, will push arbitrary messages back into your Aegir site's verify task log.</p>

<p>So sticking the following into the function above can help:
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp; drush_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$uri</span><span style="color: #DD0000">: " </span><span style="color: #007700">. </span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-62.html?destination=node%2F990%23comment-form">Login</a> or <a href="../../../../../user/register/index-62.html?destination=node%2F990%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-62.html?destination=node%2F990%23comment-form">Login</a> or <a href="../../../../../user/register/index-62.html?destination=node%2F990%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-71" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../71/index.html">Injecting into settings.php</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_2 first last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h3>Introduction</h3>

<p>Every web site in an Aegir environment has a Drupal configuration file <code>settings.php</code> in /sites/example.com directory.  Web administrators often need to make changes to this file; however, the Aegir system also manages this file and any manual customizations will be lost when a site is verified.</p>

<p>Fortunately, there are two mechanisms to ensure that your customizations can be preserved.  If you look in the bottom of an Aegir <code>settings.php</code> file you will see references to two files <code>local.settings.php</code> and <code>global.inc</code>.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp; </span><span style="color: #FF8000"># Additional host wide configuration settings. Useful for safely specifying configuration settings.<br />&nbsp; </span><span style="color: #007700">if (</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'/var/aegir/config/includes/global.inc'</span><span style="color: #007700">)) {<br />&nbsp;&nbsp;&nbsp; include_once(</span><span style="color: #DD0000">'/var/aegir/config/includes/global.inc'</span><span style="color: #007700">);<br />&nbsp; }<br /><br />&nbsp; </span><span style="color: #FF8000"># Additional site configuration settings. Allows to override global settings.<br />&nbsp; </span><span style="color: #007700">if (</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'/var/aegir/example-platform/sites/example.com/local.settings.php'</span><span style="color: #007700">)) {<br />&nbsp;&nbsp;&nbsp; include_once(</span><span style="color: #DD0000">'/var/aegir/example-platform/sites/example.com/local.settings.php'</span><span style="color: #007700">);<br />&nbsp; }<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>If these files exist they are loaded at run time by Drupal.  As you can probably surmise from the paths to these files, <code>local.settings.php</code> is for site-specific customizations and <code>global.inc</code> is for Aegir-wide customization.</p>

<p>Let's look at these files in more detail.  We'll use customization of user session cookies as an example.  If you look at the <code>settings.php</code> file generated by Aegir you see that it sets more conservative php settings for cookies (<code>@ini_set(&#039;session.cookie_lifetime&#039;,&nbsp; 0);</code> i.e. cookies expire immediately) than are in the <code>default.settings.php</code> packaged with Drupal (<code>@ini_set(&#039;session.cookie_lifetime&#039;,&nbsp; 2000000);</code> i.e. 2 million seconds, which is just over 23 days).</p>

<h3>Site-specific Customization</h3>

<p>The <code>local.settings.php</code> file by default does not exist in a new Aegir site installation so you have to create it.  Continuing with our example of user session cookies, let's override the Aegir default.</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #FF8000"># site-specific Drupal customization<br /><br /># override Aegir-generated cookie policy for sites - set cookies to expire after a week (604,800 seconds)<br /></span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">604800</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>Note that because <code>local.settings.php</code> is included after the variables are set in the main <code>settings.php</code> it's customizations takes precedence.</p>

<p>Now, whenever you clone a site or migrate it between platforms, Aegir moves a copy of <code>local.settings.php</code> as well.</p>

<h4>Using drush_hook_provision_drupal_config</h4>

<p>You can also use the API to add module-specific site configurations with hook_provision_drupal_config
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #007700">* </span><span style="color: #0000BB">Append PHP code to Drupal</span><span style="color: #DD0000">'s settings.php file.<br /> * <br /> * To use templating, return an include statement for the template.<br /> *<br /> * @param $uri<br /> *&nbsp;&nbsp; URI for the site.<br /> * @param $data<br /> *&nbsp;&nbsp; Associative array of data from provisionConfig_drupal_settings::data.<br /> *<br /> * @return<br /> *&nbsp;&nbsp; Lines to add to the site'</span><span style="color: #0000BB">s settings</span><span style="color: #007700">.</span><span style="color: #0000BB">php file</span><span style="color: #007700">.<br /> *<br /> * @</span><span style="color: #0000BB">see provisionConfig_drupal_settings<br /> </span><span style="color: #007700">*/<br />function </span><span style="color: #0000BB">drush_hook_provision_drupal_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$config</span><span style="color: #007700">) {<br />&nbsp; return </span><span style="color: #DD0000">'$conf[\'reverse_proxy\'] = TRUE;'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>For example it could look like this
<div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">drupalwiki_provision_drupal_config</span><span style="color: #007700">(</span><span style="color: #0000BB">$uri</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$config</span><span style="color: #007700">) {<br />&nbsp; </span><span style="color: #0000BB">$extra </span><span style="color: #007700">= </span><span style="color: #0000BB">drush_get_option</span><span style="color: #007700">(</span><span style="color: #DD0000">'site_extra_settings'</span><span style="color: #007700">, </span><span style="color: #DD0000">''</span><span style="color: #007700">);<br />&nbsp; </span><span style="color: #FF8000">// remove window CR<br />&nbsp; </span><span style="color: #0000BB">$extra </span><span style="color: #007700">= </span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"\r"</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">,</span><span style="color: #0000BB">$extra</span><span style="color: #007700">);<br />&nbsp; return </span><span style="color: #0000BB">$extra</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>That is used to add the site settings added by the UI in the hosting backend implemented in <a href="https://github.com/EugenMayer/hosting_site_settings" title="https://github.com/EugenMayer/hosting_site_settings">https://github.com/EugenMayer/hosting_site_settings</a></p>

<h3>Aegir-wide Customization</h3>

<p>In some situations you may want to implement the same configuration settings on all your Aegir sites.  This is where <code>global.inc</code> comes in.  Note that <code>global.inc</code> is now included in <code>settings.php</code> <strong>before</strong> <code>local.settings.php</code>, so that Aegir system administrators no longer retain the ability to override configuration changes in <code>local.settings.php</code>, but instead it is possible to override global settings per site (read why this has been changed: <a href="http://drupal.org/node/1044938" title="http://drupal.org/node/1044938">http://drupal.org/node/1044938</a> - note: this change is available since 0.4-rc1 release).</p>

<p>For example, say the system administrator wanted to limit users' session lifetimes to a maximum of one day they could create a <code>global.inc</code> as follows:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #FF8000"># Aegir-wide Drupal customization<br /><br /># override Aegir-generated cookie policy for all sites - set cookies to expire after a day (86,400 seconds)<br /></span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">86400</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>You can even set more granular policy within <code>global.inc</code> (however it makes more sense to keep site-specific overrides in the local.settings.php):</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /> </span><span style="color: #FF8000"># Aegir-wide Drupal customization<br /><br /># override Aegir-generated cookie policy for all sites - set cookies to expire after a day (86,400 seconds)<br /></span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">86400</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000"># Make the aegir front-end server more secure by expiring cookies immediately<br /></span><span style="color: #007700">if (</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/hostmaster/"</span><span style="color: #007700">, </span><span style="color: #0000BB">$conf</span><span style="color: #007700">[</span><span style="color: #DD0000">'install_profile'</span><span style="color: #007700">])) {<br />&nbsp; </span><span style="color: #FF8000"># set cookies to expire immediately on hostmaster<br />&nbsp; </span><span style="color: #007700">@</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.cookie_lifetime'</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>If you are using Aegir to manage multiple remote webservers, you will need to run the Verify task on the webserver in order to push global.inc to the remote machine.</p>

<p>Note: on some Aegir installations (e.g. alpha14) the permissions on <code>/var/aegir/config</code> are insufficent for Apache to properly include the <code>global.inc</code> file.  If you find that the configuration settings in <code>global.inc</code> are being ignored, change the permissions with <code>chmod a+x /var/aegir/config</code>.  This only has to be applied to the config directory as the sub directory and file permissions should be correct.</p>

<p>If you have other configuration examples, create a wiki and reference it here.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-63.html?destination=node%2F71%23comment-form">Login</a> or <a href="../../../../../user/register/index-63.html?destination=node%2F71%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-63.html?destination=node%2F71%23comment-form">Login</a> or <a href="../../../../../user/register/index-63.html?destination=node%2F71%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-3007" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/injecting-drushrcphp/index.html">Injecting into drushrc.php</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>The <code>drushrc.php</code> file can be changed in two ways:</p>

<ol>
<li>by changing the templates used for the Drushrc context (see the <a href="http://api.aegirproject.org/api/aegir/provision3%21provision.api.php/function/hook_provision_config_load_templates/7.x-3.x">hook_provision_config_load_templates()</a> hook)</li>
<li>by creating a <code>local.drushrc.php</code> file in the site-specific folder (e.g. <code>sites/example.com/local.drushrc.php</code></li>
</ol>

<p>This is a stub. You can put more stuff here and it would be prettier.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-64.html?destination=node%2F3007%23comment-form">Login</a> or <a href="../../../../../user/register/index-64.html?destination=node%2F3007%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-64.html?destination=node%2F3007%23comment-form">Login</a> or <a href="../../../../../user/register/index-64.html?destination=node%2F3007%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-515" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../contrib-modules/index.html">Contributed Modules</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc5">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Aegir_7.x-3.x"><span class="toc-number">1. </span>Aegir 7.x-3.x</a></li>
	<li class="toc-level-1"><a href="#Extensions_to_Hostmaster_frontend"><span class="toc-number">2. </span>Extensions to Hostmaster (frontend)</a>
<ol>
	<li class="toc-level-2"><a href="#Verified_in_Aegir_2.x"><span class="toc-number">2.1. </span>Verified in Aegir 2.x</a></li>
	<li class="toc-level-2"><a href="#Aegir_1.x"><span class="toc-number">2.2. </span>Aegir 1.x</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#Extensions_to_Provision_backend"><span class="toc-number">3. </span>Extensions to Provision (backend)</a></li>
	<li class="toc-level-1"><a href="#Themes"><span class="toc-number">4. </span>Themes</a></li>
	<li class="toc-level-1"><a href="#Puppet_modules_and_Chef_cookbooks"><span class="toc-number">5. </span>Puppet modules and Chef cookbooks</a></li>
	<li class="toc-level-1"><a href="#Others"><span class="toc-number">6. </span>Others</a></li>
	<li class="toc-level-1"><a href="#Your_module_here"><span class="toc-number">7. </span>Your module here?</a></li>
</ol>
</div>
</div>

<h2 id="Aegir_7.x-3.x">1. Aegir 7.x-3.x</h2>

<p><a href="../../../../../content/contrib-modules/contribs-aegir-7x-3x/index.html">Contrib modules for the upcomming version are listed on a sub page</a></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Extensions_to_Hostmaster_frontend">2. Extensions to Hostmaster (frontend)</h2>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Verified_in_Aegir_2.x">2.1. Verified in Aegir 2.x</h3>

<dl>
<dt><a href="https://drupal.org/project/hosting_tasks_extra">Aegir HTTP basic authentication</a> (now included in hosting_tasks_extra)</dt>
<dd>This module allows you to protect sites with passwords.</dd>

<dt><a href="http://drupal.org/project/hosting_server_titles">Hosting server titles</a></dt>
<dd>This is a really simple module that allows you to change the names of servers that are displayed in lists in the Hosting frontend when choosing what server to use for something.</dd>

<dt><a href="http://drupal.org/project/hosting_site_backup_manager">Hosting site Backup Manager</a></dt>
<dd>Add a backups tab to a site node. It extends the default backup functionality with the ability to download a backup over HTTP.</dd>

<dd>Now also includes the functionality from <a href="http://drupal.org/project/hosting_backup_gc">Hosting backup garbage collection</a> and <a href="http://drupal.org/project/hosting_backup_queue">Hosting backup queue</a></dd>

<dt><a href="http://drupal.org/project/hosting_site_git">Hosting site Git</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Git pull', 'Git checkout' and 'Git clone' task for sites.</dd>

<dt><a href="http://drupal.org/project/hosting_platform_git">Hosting platform Git</a></dt>
<dd>Provides integration with Aegir that allows provisioning a platform from a git repository (also allows specifying the branch or tag name)</dd>

<dt><a href="http://drupal.org/project/hosting_tasks_extra">Hosting tasks extra</a></dt>
<dd>This module extends Aegir hostmaster (and drush/provision) with some additional tasks. Such as: cache-clear and registry-rebuild.</dd>

<dd>Now also includes the functionality from <a href="https://github.com/computerminds/aegir_http_basic">Aegir HTTP basic authentication</a></dd>

<dt><a href="http://drupal.org/project/hosting_dblogin">Hosting database login</a></dt>
<dd>Provides a link to login into a PHPMyAdmin instance (or other db management web software) configured for the current site database server. Requires dblogin to be installed on the site.</dd>

<dt><a href="http://drupal.org/project/hosting_piwik">Aegir Piwik integration</a></dt>
<dd>Makes it easy to connect an Aegir instance and a Piwik instance.  When you create a site in Aegir, the site is registered in Piwik.  When you verify the site in Aegir, new site aliases (if any) get added to Piwik.  Also adds system variables to settings.php in order to integrate properly with the <a href="http://www.drupal.org/project/piwik">Piwik</a> module.</dd>
</dl>

<p><strong>Note: There's a good chance that other Aegir 1.x contrib modules also work on 2.x</strong></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h3 id="Aegir_1.x">2.2. Aegir 1.x</h3>

<dl>
<dt><a href="http://drupal.org/project/uc_hosting">Aegir Ubercart Integration</a></dt>
<dd>This module allows you to sell an Ægir client, with quotas and access to specific platforms, through Ubercart . It automates a number of set-up tasks from the moment the order ...</dd>

<dt><a href="https://github.com/computerminds/aegir_http_basic">Aegir HTTP basic authentication</a></dt>
<dd>This module allows you to protect sites with passwords.</dd>

<dt><a href="https://github.com/poetaster/aegir_http_basic_ldap">Aegir HTTP basic LDAP authentication</a></dt>
<dd>A fork of the above to allow you to specify an LDAP server and Require (ldap filter) string for authentication of 'sites'.</dd>

<dt><a href="http://drupal.org/project/aegir_feeds">Aegir feeds</a></dt>
<dd>This is a very basic module that provides feeds integration with Aegir . Features Provides mapping targets for Aegir site nodes, allowing you to create new sites from a feed or file upload.</dd>

<dt><a href="http://drupal.org/project/hosting_piwik">Aegir Piwik integration</a></dt>
<dd>Makes it easy to connect an Aegir instance and a Piwik instance.  When you create a site in Aegir, the site is registered in Piwik.  When you verify the site in Aegir, new site aliases (if any) get added to Piwik.  Also adds system variables to settings.php in order to integrate properly with the <a href="http://www.drupal.org/project/piwik">Piwik</a> module.</dd>

<dt><a href="http://drupal.org/project/aegir_rules">Aegir Rules</a></dt>
<dd>Aegir Rules provides Rules integration for the Aegir.</dd>

<dt><a href="https://github.com/computerminds/aegir_make_working_copy">Aegir Drush Make Platform working-copy</a></dt>
<dd>This feature allows you to specify 'working-copy' when adding a platform using a Drush makefile. Working-copy means your .git subdirectories are preserved in the platform, which may be useful for development purposes.</dd>

<dt><a href="http://mig5.net/content/aegir-subfolder-support">Aegir Subfolders</a></dt>
<dd>Support for 'example.com/subsite1' style sites in Aegir (experimental as of July 2012)</dd>

<dt><a href="http://drupal.org/project/hosting_platform_pathauto">Hosting Platform Pathauto</a></dt>
<dd>This is an add-on module for the Aegir hosting system: <a href="http://aegirproject.org/" title="http://aegirproject.org/">http://aegirproject.org/</a> This module simply makes a little time-saving tweak when creating a new platform: ...</dd>

<dt><a href="http://drupal.org/project/hosting_queue_runner">Hosting queue runner</a></dt>
<dd>This module allows the Hosting tasks queue for the Aegir project to be 'daemonized' so that tasks are run as soon as possible instead of waiting for a cron run. This makes Aegir appear much more responsive. This module was inspired by the Waiting queue project. Requirements You will need ...</dd>

<dt><a href="http://drupal.org/project/hosting_reinstall">Hosting Reinstall</a></dt>
<dd>The Hosting Reinstall module provides a frontend for the <a href="http://drupal.org/project/provision_reinstall">Provision Reinstall</a> module so that you can reinstall any sites via Hostmaster (Aegir).</dd>

<dt><a href="http://drupal.org/project/hosting_backup_gc">Hosting backup garbage collection</a></dt>
<dd>This is an add-on module for the Aegir hosting system: <a href="http://aegirproject.org/" title="http://aegirproject.org">http://aegirproject.org</a> Introduction This module allows you to specify how long Aegir should retain backups for. You can specify, ...</dd>

<dt><a href="http://drupal.org/project/hosting_backup_queue">Hosting backup queue</a></dt>
<dd>This is a simple module for the Aegir project that allows scheduling of backups. E.g. backup sites every hour, day or month. The module allows for the general settings to be applied to all sites, ...</dd>

<dt><a href="http://drupal.org/project/hosting_site_backup_manager">Hosting site Backup Manager</a></dt>
<dd>Add a backups tab to a site node. It extends the default backup functionality with the ability to download a backup over HTTP.</dd>

<dt><a href="http://drupal.org/project/hosting_site_git">Hosting site Git</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Git pull', 'Git checkout' and 'Git clone' task for sites.</dd>

<dt><a href="http://drupal.org/project/hosting_upload">Hosting upload</a></dt>
<dd>This module allows administrators to add platforms to aegir and extend platforms and sites with modules, themes, libraries without the need of ssh access.</dd>

<dt><a href="http://drupal.org/project/hosting_profile_roles">Hosting Profile Roles</a></dt>
<dd>Hosting Profile Roles extends Aegir to enable more control over what role(s) a client is assigned during site install. Since, by default, Aegir client's are given UID1 during site installs, this module also allows UID1 to be assigned to another user.</dd>

<dt><a href="http://drupal.org/project/hosting_server_titles">Hosting server titles</a></dt>
<dd>This is a really simple module that allows you to change the names of servers that are displayed in lists in the Hosting frontend when choosing what server to use for something.</dd>

<dt><a href="../../../../311/index.html">Services API Support</a></dt>
<dd>Integrates the Services API framework into the Hostmaster suite of tools. It allows Aegir managers the ability to build Services API connections over any of the available servers for Services API.</dd>

<dt><a href="http://drupal.org/project/hosting_advanced_cron">Hosting Advanced Cron</a></dt>
<dd>This module allows an administrator to set the default cron interval globally and to override that interval for individual sites.</dd>

<dt><a href="http://drupal.org/project/hosting_features">Hosting Features</a></dt>
<dd>This module provides a Task to Hostmaster that provides integration with a site's Features. (In beta as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/hosting_notifications">Hosting Notifications</a></dt>
<dd>This is a module that integrates with the Notifications framework. This allows you to receive notifications about task execution in various formats.</dd>

<dt><a href="http://drupal.org/project/hosting_task_gc">Hosting Task Garbage Collection</a> (merged into Aegir 7.x-3.x)</dt>
<dd>This module will delete rows in the {hosting_task} and {hosting_task_log} tables. (In alpha as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/hosting_remote_import">Hosting Remote Import</a></dt>
<dd>This Drupal module provides a UI for fetching sites from remote Aegir servers. (In development as of June 1, 2012)</dd>

<dt><a href="http://drupal.org/project/hosting_varnish">Hosting Varnish</a></dt>
<dd>Allows the Varnish cache for Aegir-managed sites to be purged via the user interface. (In alpha as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/hosting_civicrm_cron">Hosting CivicCRM Cron</a></dt>
<dd>This module provides the ability to trigger CiviCRM cron jobs on sites hosted on the Aegir Hosting System.</dd>

<dt><a href="http://drupal.org/project/hosting_tasks_extra">Hosting tasks extra</a></dt>
<dd>This module extends Aegir hostmaster (and drush/provision) with some additional tasks. Such as: cache-clear and registry-rebuild.</dd>

<dt><a href="http://drupal.org/project/hosting_filemanager">Hosting Filemanager</a></dt>
<dd>This module provides a web file browser for viewing files under sites and platforms. (In beta as of August 29,2012)</dd>

<dt><a href="http://drupal.org/sandbox/mccrodp/1819860">Hosting Signup Settings</a></dt>
<dd>This module is dependent on hosting_signup module in the hosting package of Aegir. It allows the Signup form at /hosting/signup to be configured. (Sandbox project, October 22, 2012)</dd>

<dt><a href="https://github.com/doka/uc_hosting_client">Hosting Client Roles</a></dt>
<dd>Client Roles module integrates Aegir user roles into hosting_products as product
feature. With this module you can assign Aegir user roles to Ubercart products, and sell
them as hosting products. This module is part of the "Hosting &amp; Ubercart Integration" package, and depends on uc_hosting and uc_hosting_products modules</dd>

<dt><a href="http://drupal.org/project/hosting_solr">Hosting Solr</a></dt>
<dd>Works with <a href="http://drupal.org/project/provision_solr">Provision Solr</a> to give Aegir the ability to manage Solr servers and and gives sites a Solr database.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Extensions_to_Provision_backend">3. Extensions to Provision (backend)</h2>

<dl>
<dt><a href="http://drupal.org/project/provision_boost">Provision boost support</a></dt>
<dd>the Aegir project and therefore depends on the provision backend and expects the Aegir environment to be functional. Quickstart Download the provision_boost code into your /var/aegir/.drush/ Download ...</dd>

<dt><a href="http://drupal.org/project/provisionacl">Provision ACL support</a></dt>
<dd>This drush command aims to provide preliminary ACL support for the Aegir backend . The objective here is to allow administrators to set more granular access policies on files managed by Aegir and resolve more hairy access permissions requirements than what is usually allowed by the Aegir core. ...</dd>

<dt><a href="http://drupal.org/project/project_status">Project Status</a></dt>
<dd>Project status is an extension for drush which takes a list of drupal platforms as arguments and returns a list of modules which are not in use by any site within these platforms. It is also optionally able to list modules which are use, by platform and site.</dd>

<dt><a href="http://drupal.org/project/provision_civicrm">Provision CiviCRM</a></dt>
<dd>A Drush module to automatically setup Drupal instances with the CiviCRM Constituent Relationship Management solution. It is specifically aimed towards the Aegir project.</dd>

<dt><a href="http://drupal.org/sandbox/helmo/1283656">Provision Backup Platform</a></dt>
<dd>This hooks into deleting a platform and creates a simple tar backup.</dd>

<dt><a href="http://drupal.org/project/kplatforms">kPlatforms</a></dt>
<dd>Koumbit's "standard Drupal platforms", a set of makefiles to build and maintain development and production platforms easily.</dd>

<dt><a href="http://drupal.org/project/provision_git">Provision Git</a></dt>
<dd>Provision Git is a backend Drush module. It provides 4 drush commands. (In alpha as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/provision-mergelog">Provision Merge Log</a></dt>
<dd>This Aegir extension allows you to automate fetching and merging logs from multiple servers part of the same cluster in a single logfile for later analysis with various analysis tools</dd>

<dt><a href="http://drupal.org/project/provision_cdn">Provision CDN</a></dt>
<dd>This is a simple module and drush script for that allows you to enable CDN support per site in Aegir. (In development as of June 1,2012)</dd>

<dt><a href="http://drupal.org/project/provision_profile_settings">Provision profile settings</a></dt>
<dd>Incredibly simple extension for provision that allows install profiles to easily inject settings into settings.php for provisioned sites.</dd>

<dt><a href="http://drupal.org/project/provision_newrelic">Provision New Relic</a></dt>
<dd>This is a simple extension that exposes all sites in New Relic, so you can monitor each sites performance.</dd>

<dt><a href="http://drupal.org/project/provision_solr">Provision Solr</a></dt>
<dd>Works with <a href="http://drupal.org/project/hosting_solr">Hosting Solr</a> to give Aegir the ability to manage Solr servers and and gives sites a Solr database.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Themes">4. Themes</h2>

<ul>
<li>Koumbit has provided it's <a href="http://drupal.org/project/eldir_kt">custom Aegir theme</a> as a sample subtheme of <a href="http://drupal.org/project/eldir">Eldir</a>.</li>
<li><a href="https://www.drupal.org/project/saeven">Saeven</a>, a clone of the core theme Seven, based on Omega 4 or 5, clean, simple and responsive.</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Puppet_modules_and_Chef_cookbooks">5. Puppet modules and Chef cookbooks</h2>

<p>Those projects allow you to manage Aegir instance(s) through Puppet. Chef recipes also welcome, we don't discriminate.</p>

<ul>
<li><a href="http://drupal.org/project/puppet-aegir">Aegir Puppet module</a></li>
<li><a href="http://drupal.org/project/puppet-drush">Drush Puppet module</a></li>
<li><a href="https://supermarket.chef.io/cookbooks/aegir2">Aegir Chef cookbook</a></li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Others">6. Others</h2>

<dl>
<dt><a href="http://drupal.org/project/aegir-up">Aegir up</a></dt>
<dd>Aegir-up is a Drush extension that deploys a local instance of the Aegir Hosting System atop Vagrant and Virtualbox, for development and testing purposes.</dd>

<dt><a href="http://drupal.org/project/devshop">DevShop</a></dt>
<dd>DevShop is a Drupal Development Environment Manager built on Aegir.</dd>

<dd>
<p>DevShop creates Aegir platforms and sites automatically from Git URLs.  It tracks multiple Projects and allows multiple environments to be created for each Project, such as dev, test, and live.  It provides tools to Pull Code, Sync Data, Commit Features, and Run Tests on these environments, and provides a dashboard with useful links and information for developers.</p>
</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Your_module_here">7. Your module here?</h2>

<p><em>Developers:</em> Please add your contributed module here, and feel free to put install instructions or other documentation in a child page. If you are looking for ways of extending Aegir or have already done so and want to document the <em>internals</em> of your module, head over to the <a href="../../../../../contrib/index.html">extending Aegir</a> page.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-12.html?destination=node%2F515%23comment-form">Login</a> or <a href="../../../../../user/register/index-12.html?destination=node%2F515%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-12.html?destination=node%2F515%23comment-form">Login</a> or <a href="../../../../../user/register/index-12.html?destination=node%2F515%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-311" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../contrib-modules/aegir-services/index.html">Aegir Services</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p><a href="http://drupal.org/project/hosting_services">Aegir Services</a> integrates the Services API framework into the Hostmaster suite of tools. It allows Aegir managers the ability to build Services API connections over any of the available servers for Services API.</p>

<p>Using Services 3.x we are aiming at full CRUD support for clients, tasks and sites, as well as read access to profiles, platforms, and eventually, packages.</p>

<p>The 2.x branch of <a href="../../../../516/index.html">Aegir Ubercart Integration</a> will take advantage of this support to provide a remote storefront functionality.</p>

<p>Please report issues and request support via the <a href="http://drupal.org/project/issues/hosting_services?categories=All">issue queue on Drupal.org</a></p>

<h2>Installation</h2>

<ol>
<li>Install <a href="../../../../../installing/index.html">Aegir</a></li>
<li>Install the <strong>dev</strong> version of <a href="http://drupal.org/project/services">services 3.x</a>, including at least one server and, ideally, an authentication server.</li>
<li>Install this module.</li>
<li><a href="http://drupal.org/node/736522">Configure your endpoint, it's resources and authentication, normally</a>.</li>
<li>Optionally, test your rest server using the included bash script, <code>hosting_services.rest_test.sh</code></li>
</ol>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-405.html?destination=node%2F311%23comment-form">Login</a> or <a href="../../../../../user/register/index-405.html?destination=node%2F311%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../311/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-12861" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/contrib-modules/contribs-aegir-7x-3x/index.html">Contribs for Aegir 7.x-3.x</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc6">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Extensions_to_Hostmaster_frontend"><span class="toc-number">1. </span>Extensions to Hostmaster (frontend)</a></li>
	<li class="toc-level-1"><a href="#Extensions_to_Provision_backend"><span class="toc-number">2. </span>Extensions to Provision (backend)</a></li>
	<li class="toc-level-1"><a href="#Themes"><span class="toc-number">3. </span>Themes</a></li>
	<li class="toc-level-1"><a href="#Puppet_modules_and_Chef_cookbooks"><span class="toc-number">4. </span>Puppet modules and Chef cookbooks</a></li>
	<li class="toc-level-1"><a href="#Others"><span class="toc-number">5. </span>Others</a></li>
	<li class="toc-level-1"><a href="#Your_module_here"><span class="toc-number">6. </span>Your module here?</a></li>
</ol>
</div>
</div>

<h2 id="Extensions_to_Hostmaster_frontend">1. Extensions to Hostmaster (frontend)</h2>

<dl>
<dt><a href="http://drupal.org/project/hosting_git">Hosting Git</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Git pull', 'Git checkout' and 'Git clone' task for sites.</dd>

<dd>The successor of Hosting site Git &amp; Hosting platform Git</dd>

<dt><a href="http://drupal.org/project/hosting_logs">Hosting Logs</a></dt>
<dd>This is a simple module for the Aegir project that adds a 'Logs' tab to sites and platforms. Showing Apache error, Git commit and watchdog logs.</dd>

<dt><a href="http://drupal.org/project/hosting_platform_pathauto">Hosting Platform Pathauto</a></dt>
<dd>This is an add-on module for the Aegir hosting system: <a href="http://aegirproject.org/" title="http://aegirproject.org/">http://aegirproject.org/</a> This module simply makes a little time-saving tweak when creating a new platform: ...</dd>

<dt><a href="https://github.com/mglaman/hosting_site_make">Hosting site make</a></dt>
<dd>Allows a site to have its modules built from a makefile in the sites directory.</dd>

<dt><a href="http://drupal.org/project/hosting_tasks_extra">Hosting tasks extra</a></dt>
<dd>This module extends Aegir hostmaster (and drush/provision) with some additional tasks. Such as: cache-clear and registry-rebuild.</dd>

<dd>Now also includes the functionality from <a href="https://github.com/computerminds/aegir_http_basic">Aegir HTTP basic authentication</a></dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Extensions_to_Provision_backend">2. Extensions to Provision (backend)</h2>

<p>Starting from Aegir 7.x-3.x the Drush component can be included in a 'drush' directory in the same git repository as the hosting module.</p>

<p>Therefore this list will be shorter then for previous versions.</p>

<dl>
<dt><a href="https://github.com/mlutfy/provision_sts">Provision STS</a></dt>
<dd>Adds the Strict Transport Security header to hosts that require SSL.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Themes">3. Themes</h2>

<ul>
<li><a href="https://www.drupal.org/project/saeven">Saeven</a></li>
<li><a href="http://drupal.org/project/eldir">Eldir</a>. (The default theme)</li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Puppet_modules_and_Chef_cookbooks">4. Puppet modules and Chef cookbooks</h2>

<p>Those projects allow you to manage Aegir instance(s) through Puppet. Chef recipes also welcome, we don't discriminate.</p>

<ul>
<li><a href="http://drupal.org/project/puppet-aegir">Aegir Puppet module</a></li>
<li><a href="http://drupal.org/project/puppet-drush">Drush Puppet module</a></li>
<li><a href="https://supermarket.chef.io/cookbooks/aegir3">Aegir3 Chef Cookbook</a></li>
</ul>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Others">5. Others</h2>

<dl>
<dt><a href="http://drupal.org/project/aegir-up">Aegir up</a></dt>
<dd>Aegir-up is a Drush extension that deploys a local instance of the Aegir Hosting System atop Vagrant and Virtualbox, for development and testing purposes.</dd>

<dt><a href="http://drupal.org/project/devshop">DevShop</a></dt>
<dd>DevShop is a Drupal Development Environment Manager built on Aegir.</dd>

<dd>
<p>DevShop creates Aegir platforms and sites automatically from Git URLs.  It tracks multiple Projects and allows multiple environments to be created for each Project, such as dev, test, and live.  It provides tools to Pull Code, Sync Data, Commit Features, and Run Tests on these environments, and provides a dashboard with useful links and information for developers.</p>
</dd>

<dt><a href="https://github.com/Lab43/aegir-pathologic-files">Aegir Pathologic Files</a></dt>
<dd>A tiny Drupal Module to simplify file paths in content. This helps prevent broken images when the site directory name changes. Requires an apache rewrite rule to point /files to /sites/example.com/files, which Aegir provides by default.</dd>

<dd>This module is not for hostmaster, but for the sites hosted under Aegir.</dd>
</dl>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Your_module_here">6. Your module here?</h2>

<p><em>Developers:</em> Please add your contributed module here, and feel free to put install instructions or other documentation in a child page. If you are looking for ways of extending Aegir or have already done so and want to document the <em>internals</em> of your module, head over to the <a href="../../../../../contrib/index.html">extending Aegir</a> page.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-65.html?destination=node%2F12861%23comment-form">Login</a> or <a href="../../../../../user/register/index-65.html?destination=node%2F12861%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-65.html?destination=node%2F12861%23comment-form">Login</a> or <a href="../../../../../user/register/index-65.html?destination=node%2F12861%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2325" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/contrib-modules/devshop-provision/index.html">DevShop Provision</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>Homepage: <a href="http://drupal.org/project/devshop" title="http://drupal.org/project/devshop">http://drupal.org/project/devshop</a></p>

<h1>DevShop Provision</h1>

<p>Drupal development infrastructure made easy.</p>

<p>This module provides the backend commands needed to 
deploy and manage sites using the DevShop git and features 
based development workflow.</p>

<h2>About DevShop</h2>

<p>The goals of DevShop are...</p>

<ol>
<li>to simplify management of multiple environments for multiple Drupal projects.</li>
<li>to provide web-based tools that streamline the Drupal site building workflow.</li>
<li>to provide a common, open-source infrastructure for Drupal development shops.</li>
</ol>

<h2>Installation</h2>

<p>To install devshop_provision, simply use drush:</p>

<p>$ drush dl devshop_provision</p>

<p>Or, you can download the source code to any available drush commands folder,
such as /usr/share/drush or ~/.drush</p>

<h2>Usage</h2>

<p>DevShop Provision works by providing a new Provision class called "Project".</p>

<p>To start, you must have a Project drush alias.  Using the DevShop+Hostmaster
system will make this much easier, but if you wish to only use the backend, you
can create a project alias with provision-save, for project NAME:
<div class="codeblock"><code>&nbsp; $ drush provision-save project_NAME --context_type=project --code_path=/var/aegir/projects/NAME --git_url=http://git.url/to/repo.git --base_url=NAME.server.com</code></div></p>

<p><div class="codeblock"><code>&nbsp;&nbsp;&nbsp; $ drush provision-save project_NAME --project_name=NAME --context_type=project --code_path=/var/aegir/projects/NAME --git_url=git@github.com:devudo/drupal-flat.git --base_url=NAME.server.com</code></div></p>

<h2>Commands</h2>

<p>DevShop contains a set of features that make Drupal site building within a
version-controlled code workflow quick and easy.</p>

<p>Currently you must create new platforms within a project in hostmaster.  Once created, you can execute the following commands:</p>

<h2>1. Pull Code</h2>

<p><div class="codeblock"><code>&nbsp; $ drush @project_NAME provision-devshop-pull ENVIRONMENT</code></div></p>

<p>This task runs on the dev platform for this project. It runs git pull, and
  optionally runs new updates, reverts features, and clears caches.  It is used
  to keep the dev server up to date on every commit via the devshop_pull module,
  and can be used as the deployment task.</p>

<ul>
<li>Git Pull the code for your site's platform.</li>
<li>Then, all optionally:

<ul>
<li>Run update.php.</li>
<li>Revert all Features modules</li>
<li>Clear caches</li>
</ul></li>
</ul>

<h2>2. Commit Features</h2>

<p><div class="codeblock"><code>&nbsp; $ drush @project_NAME provision-devshop-commit ENVIRONMENT --message=&quot;My Commit&quot;</code></div></p>

<p>This task integrates with Features.module to make it very easy to commit
  your changes to your features.</p>

<ul>
<li>Calls drush features-update-all</li>
<li>Commits the result, with a part automated and part customized commit message.</li>
<li>(Optionally) pushes the commits.</li>
<li>(Optionally) force-reverts after a commit.</li>
</ul>

<h2>3. Sync Content</h2>

<p><div class="codeblock"><code>&nbsp; $ drush @project_NAME provision-devshop-sync SOURCE_ENVIRONMENT DESTINATION_ENVIRONMENT</code></div></p>

<p>This task makes it easy to syncronize the database and files down from other
  environments within the project.</p>

<p>WARNING: This will DESTROY the destination site's database!</p>

<p>This task:</p>

<ul>
<li>(optionally) Pulls code</li>
<li>Drops the @destination database.</li>
<li>Creates an SQL dump from @source.</li>
<li>Copies the SQL dump to the local system (if @source is a remote).</li>
<li>Imports the SQL dump into @destination database.</li>
<li>(optionally) Runs update.php.</li>
<li>(optionally) Runs features-revert-all.</li>
<li>(optionally) Clears all caches.</li>
</ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-66.html?destination=node%2F2325%23comment-form">Login</a> or <a href="../../../../../user/register/index-66.html?destination=node%2F2325%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-66.html?destination=node%2F2325%23comment-form">Login</a> or <a href="../../../../../user/register/index-66.html?destination=node%2F2325%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2326" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/content/contrib-modules/devshop-provision/commands/index.html">Commands</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><h1>$ drush --filter=devshop_provision</h1>

<p><div class="codeblock"><code>All commands in devshop_provision: (devshop_provision)<br /> provision-devshop-co&nbsp; Export the site&#039;s Features and commit the result.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> mmit (pdc)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> provision-devshop-pu&nbsp; Pull &amp; verify platform code and (optionally) run update.php, clear cache, and revert features. <br /> ll (pdp)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> provision-devshop-sy&nbsp; Sync database (and files, coming soon) from a chosen source site.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> nc (pds)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> provision-devshop-te&nbsp; Run a group of SimpleTest tests.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> st (pdt)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div></p>

<h1>$ drush provision-devshop-commit --help</h1>

<p><div class="codeblock"><code>Export the site&#039;s Features and commit the result.<br /><br />Examples:<br /> drush @project_mysite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Recreates and Commits all features from the dev environment of @project_mysite with an additional commit <br /> provision-devshop-commit dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; message.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --message=&quot;changed some settings&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Arguments:<br /> environment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The name of the environment to commit from. <br /><br /><br />Options:<br /> --message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Add a commit message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --revert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Force revert all features after exporting and committing. <br /><br /><br />Aliases: pdc</code></div></p>

<h1>$ drush provision-devshop-pull --help</h1>

<p><div class="codeblock"><code>Pull &amp; verify platform code and (optionally) run update.php, clear cache, and revert features.<br /><br />Examples:<br /> drush @project_mysite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Triggers a git pull and a clear cache command on @project_mysite&#039;s dev and test environments. <br /> provision-devshop-pull dev test --cache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Arguments:<br /> environments&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A list of environment names to Pull Code to. <br /><br /><br />Options:<br /> --update&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Run update.php after code pull.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --revert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Revert all features after code pull. <br /> --cache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Clear all caches after code pull.&nbsp;&nbsp;&nbsp; <br /><br /><br />Aliases: pdp</code></div></p>

<h1>$ drush provision-devshop-sync --help</h1>

<p><div class="codeblock"><code>Sync database (and files, coming soon) from a chosen source site.<br /><br />Examples:<br /> drush @project_mysite&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Syncs the database from for project_mysite&#039;s live to&nbsp; project_mysite&#039;s dev server. <br /> provision-devshop-sync live dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Arguments:<br /> from&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Environment to sync from. <br /> to&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Environment to sync to.&nbsp;&nbsp; <br /><br /><br />Options:<br /> --update&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Run update.php after content sync.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --revert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Revert all features after content sync. <br /> --cache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Clear all caches after content sync.&nbsp;&nbsp;&nbsp; <br /> --files&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sync site files.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br /><br />Aliases: pds</code></div></p>

<h1>$ drush provision-devshop-test --help</h1>

<p><div class="codeblock"><code>Run a group of SimpleTest tests.<br /><br />Arguments:<br /> environment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The name of the environment to run tests on. <br /><br /><br />Options:<br /> --tests-to-run&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The list of tests to run.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> --sync-from-live&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sync contents from Live before running tests. <br /><br /><br />Aliases: pdt</code></div></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-67.html?destination=node%2F2326%23comment-form">Login</a> or <a href="../../../../../user/register/index-67.html?destination=node%2F2326%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-67.html?destination=node%2F2326%23comment-form">Login</a> or <a href="../../../../../user/register/index-67.html?destination=node%2F2326%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-526" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/contrib-modules/provision-acl/index.html">Provision ACL</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>This page documents the <a href="http://drupal.org/project/provisionacl">Provision ACL extension</a> to Aegir which allows more granular access control over your sites files and directories.</p>

<script type="text/javascript">toc_collapse=0;</script><div class="toc" id="toc7">
<div class="toc-title">Table of Contents<span class="toc-toggle-message">&nbsp;</span></div>
<div class="toc-list">
<ol>
	<li class="toc-level-1"><a href="#Install_instructions"><span class="toc-number">1. </span>Install instructions</a>
<ol>
	<li class="toc-level-2"><a href="#Download_and_install_provision"><span class="toc-number">1.1. </span>Download and install provision</a></li>
	<li class="toc-level-2"><a href="#Enable_ACLs_on_your_filesystem"><span class="toc-number">1.2. </span>Enable ACLs on your filesystem</a></li>
	<li class="toc-level-2"><a href="#Install_ACL_support_package"><span class="toc-number">1.3. </span>Install ACL support package</a></li>
	<li class="toc-level-2"><a href="#Create_a_UNIX_group"><span class="toc-number">1.4. </span>Create a UNIX group</a></li>
	<li class="toc-level-2"><a href="#Add_users_to_the_group"><span class="toc-number">1.5. </span>Add users to the group</a></li>
	<li class="toc-level-2"><a href="#Create_a_client"><span class="toc-number">1.6. </span>Create a client</a></li>
	<li class="toc-level-2"><a href="#Create_a_site"><span class="toc-number">1.7. </span>Create a site</a></li>
</ol>
</li>
	<li class="toc-level-1"><a href="#What_it_does"><span class="toc-number">2. </span>What it does</a></li>
	<li class="toc-level-1"><a href="#LDAP_integration"><span class="toc-number">3. </span>LDAP integration</a></li>
	<li class="toc-level-1"><a href="#API_-_how_to_add_ACL_support_to_your_Aegir_extension"><span class="toc-number">4. </span>API - how to add ACL support to your Aegir extension</a></li>
	<li class="toc-level-1"><a href="#Caveats_ie._what_it_does_not"><span class="toc-number">5. </span>Caveats (ie. what it does not)</a></li>
	<li class="toc-level-1"><a href="#Debugging"><span class="toc-number">6. </span>Debugging</a></li>
	<li class="toc-level-1"><a href="#Notes"><span class="toc-number">7. </span>Notes</a></li>
</ol>
</div>
</div>

<h1 id="Install_instructions">1. Install instructions</h1>

<p>First, you'll need a running Aegir install (1.0-rc3 or later), see <a href="../../../../../installing/index.html" title="http://community.aegirproject.org/installing">http://community.aegirproject.org/installing</a>. Most (if not all) of these commands will have to be run as root (or using sudo, etc.)</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Download_and_install_provision">1.1. Download and install provision</h2>

<pre><code>drush dl provisionacl-6.x
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Enable_ACLs_on_your_filesystem">1.2. Enable ACLs on your filesystem</h2>

<pre><code>mount -o remount,acl /
</code></pre>

<p>Here we assume everything is under the root (<code>/</code>) filesystem here, otherwise run this command for every filesystem Aegir will work on (e.g. <code>/srv</code>, <code>/var</code> or <code>/home</code>).</p>

<p>You also need to edit your <code>/etc/fstab</code> for this configuration to survive reboots.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Install_ACL_support_package">1.3. Install ACL support package</h2>

<pre><code>apt-get install acl
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_a_UNIX_group">1.4. Create a UNIX group</h2>

<p>In this case we choose a group called "devs" but you can choose another name.</p>

<pre><code>groupadd devs
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Add_users_to_the_group">1.5. Add users to the group</h2>

<p>Add one or more UNIX users that you want to give access to that group. For an existing user (socrates32), this would look like:</p>

<pre><code>usermod -a -G devs socrates32
</code></pre>

<p>For a new user (ergonlogic), this would look like:</p>

<pre><code>useradd -G devs ergonlogic
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_a_client">1.6. Create a client</h2>

<p>Create a client (should be called "devs" for this example) in the frontend at /node/add/client.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h2 id="Create_a_site">1.7. Create a site</h2>

<p>Create a site for the client in the frontend at /node/add/site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="What_it_does">2. What it does</h1>

<p>When the site is installed, members of the "devs" group will be able to write to the sites' directories (e.g. upload files and modules) and run drush commands on the site (yes, including site aliases, although see caveats below).</p>

<p>This works also for existing sites; make sure you create a group matching the internal name of the existing client and reverify the site.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="LDAP_integration">3. LDAP integration</h1>

<p>Provisionacl supports LDAP groups as well. Ensure that an LDAP client is running and that the 'aegir' user can see the LDAP-provided groups:</p>

<pre><code>getent groups
</code></pre>

<p>You may need to restart the Name Service Cache Daemon (nscd):</p>

<pre><code>/etc/init.d/nscd restart
</code></pre>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="API_-_how_to_add_ACL_support_to_your_Aegir_extension">4. API - how to add ACL support to your Aegir extension</h1>

<p>To change ACLs on files, you should use something like this:</p>

<pre><code>if (function_exists('provisionacl_set_acl')) {
    provisionacl_files_acls(d()-&gt;site_path . '/mysettings.php');
}
</code></pre>

<p>You can optionnally pass a group as an argument, but it will guess that from the client name of the site. Also note that this will raise a drush error if setfacl fails, but just set a warning if the group doesn't exist.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Caveats_ie._what_it_does_not">5. Caveats (ie. what it does not)</h1>

<p>Giving shell access to users in Aegir is still insecure, see this upstream issue: <a href="http://drupal.org/node/762138">#762138</a>.</p>

<p>We aim to refactor this into the Aegir core in 2.x, but in the meantime this should provide a good workaround for the limitations of the existing permission system.</p>

<p>This will only work in 1.0 and above, as it needs the "client_name" field to be populated.</p>

<p>You will need to change your $HOME variable for aliases to work, because of this bug in drush: <a href="http://drupal.org/node/1104438">#1104438</a>. Example:</p>

<p><div class="codeblock"><code>env HOME=/var/aegir drush @hostmaster cc all</code></div></p>

<p>See also <a href="../../../../494/index.html">this post for context and design</a>.</p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Debugging">6. Debugging</h1>

<p>If for some reason you have lost the ACLs on the directories and you need to restore them, use the following commands, which is basically what the module does:</p>

<p><div class="codeblock"><code>cd sites/example.com<br />setfacl -R -m user:aegir:rwx .<br />setfacl -R -m default:user:aegir:rwx .<br />setfacl -R -m group:www-data:rwx .<br />setfacl -R -m d:group:www-data:rwx .<br />setfacl -R -m group:cl-group:rwx .<br />setfacl -R -m default:group:cl-admin:rwx .</code></div></p>

<div class="toc-back-to-top"><a href="#toc">Back to top</a></div><h1 id="Notes">7. Notes</h1>

<p>This page is the reference documentation for the <a href="https://drupal.org/project/provisionacl">Provision ACL module page on Drupal.org</a> - keep this in mind when editing please.</p><div class="toc-back-to-top"><a href="#toc">Back to top</a></div><script type="text/javascript">toc_scroll_back_to_top = 1;</script>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-68.html?destination=node%2F526%23comment-form">Login</a> or <a href="../../../../../user/register/index-68.html?destination=node%2F526%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-68.html?destination=node%2F526%23comment-form">Login</a> or <a href="../../../../../user/register/index-68.html?destination=node%2F526%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-516" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../516/index.html">Ubercart Integration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_27 first"><a href="../../../../../category/level/developer/index.html" rel="tag" title="This level is generally for users interested in further developing the Aegir system itself, or extending it with contributed modules.">Developer</a></li>
<li class="taxonomy_term_2 last"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
</ul></div><p>This module provides several features to ubercart products on an Aegir platform.</p>

<h2>Requirements</h2>

<ul>
<li>Hostmaster 6.x-1.0 or higher</li>
<li>Ubercart 6.x-2.4 or higher</li>
<li>Patience</li>
</ul>

<h2>Installation</h2>

<ol>
<li>Download the module and its dependencies into sites/all/modules on your hostmaster platform (<code>drush @hostmaster dl uc_hosting ubercart</code> should work)</li>
<li>Activate the clients feature for hostmaster (<code>admin/hosting/features</code>)</li>
<li>Enable the module uc_hosting_products. This should enable all dependencies (<code>drush @hostmaster en uc_hosting_products</code>)</li>
</ol>

<h2>Creating your first site product</h2>

<p><strong>N.B.</strong> A video introduction covering configuration is available from the DrupalCon London session <a href="http://london2011.drupal.org/conference/sessions/aegir-based-business-models">Aegir-based Business Models</a> (starting at 26:30).</p>

<ol>
<li>Create a product. Make sure it is not shippable. (<code>node/add/product</code>)</li>
<li>Edit the product. Go to the features tab.</li>
<li>Choose the "Create a site and adjust quotas accordingly" feature. It should use the sku of your product automatically.</li>
<li>For single-site products, make sure, on the product feature form, to check off "Force clients to create their site on purchase" if you want to be sure people create their site.</li>
<li>Now all you need is a drupal platform that any user can create sites on and you are ready to go. (<code>node/add/platform</code>)</li>
</ol>

<h2>Creating more complex offerings using product kits</h2>

<p>The method we recommend for creating complex offerings, including multiple site quotas and access to restricted platforms, is via Ubercart product kits.</p>

<ol>
<li>Enable uc_product_kit.</li>
<li>Create one or more uc_hosting products.</li>
<li>Create a product kit with these products in them in the appropriate quantities.</li>
</ol>

<h2>Support</h2>

<p>You can report bugs, request support and propose patches <a href="http://drupal.org/project/issues/uc_hosting">via our issue queue on Drupal.org</a>.</p>

<h2>Development</h2>

<p>If you would like to use uc_hosting to develop your own Aegir dependant product features, be sure to <a href="../../../../../creating-product-features-using-uchosting-1x/index.html">read the relevant documentation</a>.</p>

<p>Check out the <a href="../../../../108/index.html">roadmap</a>.</p>

<h2>Other Resources</h2>

<ul>
<li><a href="../../../../../index.html">Aegir community site</a></li>
<li><a href="http://www.ubercart.org/docs">Ubercart Documentation</a></li>
<li>#aegir IRC channel on <a href="http://freenode.net/">freenode</a></li>
</ul>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-69.html?destination=node%2F516%23comment-form">Login</a> or <a href="../../../../../user/register/index-69.html?destination=node%2F516%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-69.html?destination=node%2F516%23comment-form">Login</a> or <a href="../../../../../user/register/index-69.html?destination=node%2F516%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-888" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../contrib-modules/provision-civicrm/index.html">Provision CiviCRM</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p><a href="https://drupal.org/project/provision_civicrm">provision_civicrm</a> helps to manage the installation and upgrades of CiviCRM in Drupal sites managed with Aegir.</p>

<p>CiviCRM is not a typical Drupal module. It is a third-party system that integrates with Drupal, WordPress and Joomla for its front-end and permission system. CiviCRM has its own installer, upgrade system and cron. The "provision_civicrm" module helps to manage any CiviCRM+Drupal site as any other Drupal site managed in Aegir.</p>

<h3>Requirements</h3>

<ul>
<li>Aegir 2.x or 3.x</li>
<li><a href="https://drupal.org/project/hosting_civicrm">hosting_civicrm</a> must be installed in the hostmaster front-end (~/hostmaster-x-y/sites/example.org/modules).</li>
</ul>

<h3>Installation</h3>

<p>Download the provision_civicrm module as the "aegir" user:</p>

<pre><code>drush dl provision_civicrm-6.x-2.x
</code></pre>

<p>This should install the module in ~/.drush/provision_civicrm.</p>

<p>NB: provision_civicrm 6.x-2.x is a Drush module, and works with both Aegir 2 and Aegir 3. However, for Aegir 3, you must use the 7.x-3.x branch of the hosting_civicrm module.</p>

<h3>Creating a CiviCRM platform</h3>

<p>provision_civicrm assumes that if you have a CiviCRM installation in your sites/all/modules/civicrm, then this is a CiviCRM platform and CiviCRM should be installed automatically.</p>

<p>(A cleaner way, in theory, would be to have an install profile and let the user configure it through the front-end, patches welcome! -- however, you do not want any site to simply enable CiviCRM from the Drupal admin/build/modules, so having dedicated platforms for CiviCRM makes sense in any case.)</p>

<p>A sample drush makefile is provided with provision_civicrm.</p>

<p>Assuming you are running as the user 'aegir', whose $HOME is /var/aegir/, save this in a file such as ~/makefiles/drupal-6.22-civicrm-3.3.4.make</p>

<p>Then create the new platform:</p>

<pre><code>mkdir ~/platforms/drupal-6.22-civicrm-3.3.4
cd ~/platforms/drupal-6.22-civicrm-3.3.4
drush make ~/makefiles/drupal-6.22-civicrm-3.3.4.make
</code></pre>

<p>You can now add your platform in the Aegir front-end and then create new sites.</p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-406.html?destination=node%2F888%23comment-form">Login</a> or <a href="../../../../../user/register/index-406.html?destination=node%2F888%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../888/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>




<div  id="node-13160" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/content/administrator/post-install-configuration/create-sudo-user-server-administration/index.html">Create a SUDO user for server administration</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <div class='field terms clear-block'><span class='field-label-inline-first'>Tagged:</span> <ul class="links inline"><li class="taxonomy_term_602 first"><a href="../../../../../category/keywords/sudo/index.html" rel="tag" title="">sudo</a></li>
<li class="taxonomy_term_2"><a href="../../../../../taxonomy/term/2/index.html" rel="tag" title="This level is generally for users with the root access to their server, who are responsible for installation and configuration of entire Aegir system environment.">Sysadmin</a></li>
<li class="taxonomy_term_603 last"><a href="../../../../../category/keywords/users/index.html" rel="tag" title="">users</a></li>
</ul></div><p>Sometimes you will need to administer your server beyond what you can do as the Aegir user.</p>

<p>Examples include installing additional software or editing PHP configuration.</p>

<p>It's not recommended to use the <code>root</code> user for administering things as it can be easy to make mistakes that could break your system.</p>

<p>Instead of running as root, it is recommended to create a user for yourself that has sudo privileges.</p>

<h2>Create a user with SUDO privileges</h2>

<p>In ubuntu/debian systems, creating a user and giving them the ability to run commands with <code>sudo</code> is easy with the <code>adduser</code> command.</p>

<p>Think of a username and password for yourself, then run the following commands as root:</p>

<pre>
root@aegir:~# adduser bob
Adding user `bob' ...
Adding new group `bob' (1001) ...
Adding new user `bob' (1001) with group `bob' ...
Creating home directory `/home/bob' ...
Copying files from `/etc/skel' ...
Enter new UNIX password: 
Retype new UNIX password: 
passwd: password updated successfully
Changing the user information for bob
Enter the new value, or press ENTER for the default
    Full Name []: Bob
    Room Number []: 
    Work Phone []: 
    Home Phone []: 
    Other []: 
Is the information correct? [Y/n] y
root@aegir:~#
</pre>

<p>Then add them to the "sudo" user group:</p>

<pre>
root@aegir:~# adduser bob sudo
Adding user `bob' to group `sudo' ...
Adding user bob to group sudo
Done.
root@aegir:~# 
</pre>

<p>Then you can switch to the "bob" user using <code>sudo su</code>, or login via ssh with your password.</p>

<pre>
root@aegir:~# sudo su - bob
bob@aegir:~$
</pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-70.html?destination=node%2F13160%23comment-form">Login</a> or <a href="../../../../../user/register/index-70.html?destination=node%2F13160%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-70.html?destination=node%2F13160%23comment-form">Login</a> or <a href="../../../../../user/register/index-70.html?destination=node%2F13160%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-2799" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../content/content/administrator/post-install-configuration/experimental-aegir-2-ubuntu-1204-apache-php/index.html">Experimental: Aegir 2 on Ubuntu 12.04 with apache, php-fpm</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>These notes describe a possible way of installing Apache with fastcgi using php5-fpm.
The below configuration works but is experimental.</p>

<p>On a Ubuntu 12.04 box:</p>

<h2>Install Aegir2 from Debian packages</h2>

<p>Follow <a href="../../../../../installing/debian/index.html" title="http://community.aegirproject.org/installing/debian">http://community.aegirproject.org/installing/debian</a>. Below is a shortened form.</p>

<p>Add the Aegir package "Software Source" repository:
<div class="codeblock"><code>echo &quot;deb <a href="http://debian.aegirproject.org/" title="http://debian.aegirproject.org">http://debian.aegirproject.org</a> stable main&quot; | sudo tee -a /etc/apt/sources.list.d/aegir-stable.list<br />wget -q <a href="http://debian.aegirproject.org/key.asc" title="http://debian.aegirproject.org/key.asc">http://debian.aegirproject.org/key.asc</a> -O- | sudo apt-key add -</code></div></p>

<p>Install aegir2:
<div class="codeblock"><code>sudo apt-get update<br />sudo apt-get install mysql-server<br />sudo mysql_secure_installation<br />sudo apt-get install aegir2</code></div></p>

<p>If the installation fails, it might be that your FQDN is not set or your postfix is not configured.</p>

<h2>Verify your aegir site is working</h2>

<p>Navigate your browser to the FQDN of your aegir server. You need to see the "Welcome to Aegir" page.</p>

<h2>Modify the configuration to use fastcgi / php5-fpm</h2>

<p>Edit <code>/etc/apt/sources.list</code> and enable the multiverse repository (it's needed for the libapache2-mod-fastcgi package).</p>

<p>Then install php5-fpm and make apache use it:
<div class="codeblock"><code>sudo apt-get update<br />sudo apt-get install php5-fpm libapache2-mod-fastcgi<br />sudo apt-get --purge remove libapache2-mod-php5</code></div></p>

<p>Modify <code>/etc/php5/fpm/pool.d/www.conf</code>
Make it listen on socket, instead of IP:
<div class="codeblock"><code>;listen = 127.0.0.1:9000<br />listen = /var/run/php-fpm.sock</code></div></p>

<p>Create <code>/etc/apache2/conf.d/php-fpm.conf</code> with this content:
<div class="codeblock"><code>ScriptAlias /php5.fastcgi /var/www/fastcgi<br />FastCGIExternalServer /var/www/fastcgi -socket /run/php-fpm.sock<br />AddHandler php-fastcgi .php<br />Action php-fastcgi /php5.fastcgi virtual<br /><br />Options FollowSymLinks ExecCGI<br /><br />&lt;Directory /var/www/fastcgi&gt;<br />&nbsp; Options ExecCGI FollowSymLinks<br />&nbsp; SetHandler fastcgi-script<br />&nbsp; Order allow,deny<br />&nbsp; Allow from all<br />&lt;/Directory&gt;</code></div></p>

<p>Enable apache modules:
<div class="codeblock"><code>sudo a2enmod actions alias fastcgi</code></div></p>

<p>Restart php5-fpm and apache to load the new configs: 
<div class="codeblock"><code>sudo service php5-fpm restart<br />sudo service apache2 restart</code></div></p>

<h2>Verify that you can still reach your Aegir site</h2>

<p>Navigate your browser to the FQDN of your aegir server. This time, you are using php5-fpm. Verify e.g. via phpinfo().</p>

<p>--<br />
Page author: Marji Cermak <a href="mailto:marji@morpht.com">&#109;&#97;&#x72;&#x6a;&#x69;&#x40;&#x6d;&#x6f;&#x72;ph&#116;&#46;&#99;&#111;&#109;</a>, <a href="http://morpht.com/" title="http://morpht.com">http://morpht.com</a></p>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-71.html?destination=node%2F2799%23comment-form">Login</a> or <a href="../../../../../user/register/index-71.html?destination=node%2F2799%23comment-form">register</a> to post comments</span></li>
<li class="talk_forbidden last"><span><a href="../../../../../user/login/index-71.html?destination=node%2F2799%23comment-form">Login</a> or <a href="../../../../../user/register/index-71.html?destination=node%2F2799%23comment-form">register</a> to post comments</span></li>
</ul></div>
  </div>




<div  id="node-1226" class="node node-book clear-block">
  
      <h2 class='node-title'>
            <a href="../../../../../handbook/administrator/post-install-configuration/using-proxy-cache-accelerate-platform-build/index.html">Using a proxy cache to accelerate platform builds</a>
    </h2>
  
      <div class='node-content clear-block prose'>
      <p>While building (and re-building) platforms using makefiles and the Aegir front-end (node/add/platform) is great, it has a number of minor annoyances. They're slow, and consume lots of bandwidth, but worse still, even a small hiccup in drupal.org (or other) infrastructure can break a platform build, which requires starting from scratch each time.</p>

<p>When you maintain platforms with upwards of 300 modules, themes and libraries, such as with <a href="http://drupal.org/project/kplatforms">kPlatforms</a>, and you start to deploy these to multiple clients' <a href="http://www.koumbit.org/en/services/AegirVPS">Aegir servers</a>, those minor annoyances can become significant challenges.</p>

<p>There is good documentation on setting this up for use with Drush Make already, such as this <a href="http://reluctanthacker.rollett.org/using-squid-caching-server-drush-module-downloads">blog post</a>. However, there are some gotchas when doing so in Aegir. Most of the suggested solutions involve something like setting environment variables in ~/.bashrc, which works fine if you're running 'drush make' yourself in a login shell. However, since the Aegir is running in a non-interactive shell, there isn't a opportunity to set environment variables.</p>

<p>Thankfully, Drush Make supports curl, and opts for it automatically if it's installed. Careful reading of curl's manpage indicates that:</p>

<pre><code>[curl] always [...] checks for a default config file and uses it if found.
</code></pre>

<p>So, in the end, all that's required is a /var/aegir/.curlrc file containing:</p>

<pre><code>proxy = "http://&lt;proxy_host&gt;[:port]"
</code></pre>

<p>Thus a basic configuration on Debian would involve installing a proxy, such as Squid:</p>

<pre><code># apt-get install squid3
</code></pre>

<p>Then add an acl in /etc/squid3/squid.conf allowing access from your local network, e.g.:</p>

<pre><code>acl localnet src 192.168.0.0/16
http_access allow localnet
</code></pre>

<p>Restart Squid and you're good to go:</p>

<pre><code># /etc/init.d/squid3 restart
</code></pre>

<p>Testing that Aegir is actually using your new proxy cache, and that Squid is actually caching the makefile projects involves taking a quick look at the logs of the Squid server:</p>

<pre><code># tail -f /var/log/squid3
</code></pre>    </div>
  
      <div class='node-links clear-block'><ul class="links inline"><li class="comment_forbidden first"><span><a href="../../../../../user/login/index-407.html?destination=node%2F1226%23comment-form">Login</a> or <a href="../../../../../user/register/index-407.html?destination=node%2F1226%23comment-form">register</a> to post comments</span></li>
<li class="talk_comments last"><a href="../../../../1226/talk/index.html" title="Jump to the first comment of this posting.">Talk</a></li>
</ul></div>
  </div>



    </div>
      </div>
</body>


<!-- Mirrored from community.aegirproject.org/node/945/revisions/2537/view?print&book_recurse by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 29 Jul 2015 18:03:57 GMT -->
</html>
